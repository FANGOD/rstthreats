<div>
Posted on <a href="https://asec.ahnlab.com/en/34707/" rel="bookmark" title="6:45 am">May 25, 2022</a>
<h1 class="title">Method that Tricks Users to Perceive Attachment of PDF File as Safe File</h1>
<p>The ASEC analysis team has discovered the distribution of info-stealer malware using Attachment feature of PDF files. This attack method was discovered previously, but as the malware of this type has resurfaced and is being actively distributed, the team would like to share the information. Note that the attacker used a simple trick of using the attachment’s name to deceive users.</p>
<figure class="aligncenter"><img alt="" class="wp-image-34374 jetpack-lazy-image jetpack-lazy-image--handled" height="615" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-29.png?resize=766%2C615&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="766"/><img alt="" class="wp-image-34374" height="615" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-29.png?resize=766%2C615&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="766"/><figcaption>Figure 1. Phishing e-mail with PDF attachment</figcaption></figure>
<p></p>
<p>Acrobat Reader has a feature of adding attachments to PDF files. Files with extensions such as .bin/.exe/.bat/.chm are blacklisted and cannot be attached because they are considered threats. For other files that do not exist in the default blacklist and whitelist, a message box that requires the user’s decision appears. The attacker exploited this aspect of the software.</p>
<p>Upon running the PDF file attached to the e-mail, an intentionally blurred image is displayed, and a security warning message of ‘Open file’ appears due to Adobe Reader’s default setting. This is a warning message for running the attachment of the PDF, and the filename appears directly on the message box. The sentence looks unnatural in Korean PC environment (see Figure 2), but if the user runs the PDF file in English PC environment (see Figure 3), the user can easily find out the intention of the attacker.</p>
<figure class="aligncenter"><img alt="" class="wp-image-34362 jetpack-lazy-image" height="636" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-25.png?resize=742%2C636&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="742"/><img alt="" class="wp-image-34362" height="636" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-25.png?resize=742%2C636&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="742"/><figcaption>Figure 2. When running PDF file in Korean PC environment</figcaption></figure>
<p></p>
<figure class="aligncenter"><img alt="" class="wp-image-34365 jetpack-lazy-image" height="661" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-27.png?resize=1024%2C648&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1045"/><img alt="" class="wp-image-34365" height="661" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-27.png?resize=1024%2C648&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1045"/><figcaption>Figure 3. When running PDF file in English PC environment</figcaption></figure>
<p></p>
<p>The file attached to PDF is an Excel file with the filename: ‘has been verified. However PDF, jpeg, docx, .xlsx,’ and ignoring apostrophe that comes after “The file” in the message box forms a natural message like below. If the user does not read the file carefully, it is likely that they will think of it as a typical security message.</p>
<p>If the filename is ‘has been verified.’ ‘However PDF,’ ‘jpeg,’ ‘docx,’ ‘.xlsx’,</p><p>The file ‘has been verified. However PDF, jpeg, docx, .xlsx’ may contain programs, macros, or viruses that could potentially harm your computer. Open the file only if you are sure it is safe. Would you like to:
– Open this file
– Always allow opening files of this type
– Never allow opening files of this type
→ (User-executed) file is a (normal) file, but file with PDF, jpeg, docx, xlsx extension may contain malicious program, macro, virus, etc.</p>
<p>It appears that the attacker wrote this message after considering the possibility that the user may realize that the file is malware if the filename is the one that is commonly used in malware distribution (e.g. Quotation.xlsx) despite the same attachment being used, and promptly block the access to Acrobat Reader’s open file settings.</p>
<p>If the filename is Quotation.xlsx</p><p>The file ‘Quotation.xlsx’ may contain programs, macros, or viruses that could potentially harm your computer. Open the file only if you are sure it is safe. Would you like to:
– Open this file
– Always allow opening files of this type
– Never allow opening files of this type
→ ‘Quotation.xlsx’ file may contain malicious programs, malicious macro, or virus that may harm the PC.</p>
<p>Filename of attachment inside the PDF file of this type are created to trick users. XLSX files as well as DOCX files have been confirmed as attachment, and each file utilized malicious elements that are commonly employed in Excel and Word type malware.</p>
<ul><li>has been verified. However PDF, jpeg, docx, .xlsx</li><li>has been verified. However PDF, jpeg, xlsx, .docx</li><li>is scanned and Verified. However PDF, docx, .xlsx</li><li>is verified. However PDF, jpeg, Docx, .xlsx</li></ul>
<figure class="aligncenter"><img alt="" class="wp-image-34363 jetpack-lazy-image" height="589" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-26.png?resize=683%2C589&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="683"/><img alt="" class="wp-image-34363" height="589" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-26.png?resize=683%2C589&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="683"/><figcaption>Figure 4. Attachment inside PDF file with same type but slightly different filename</figcaption></figure>
<p></p>
<p>When the Excel file is run, it connects to the external network via the formula editor (EQNEDT32.EXE) vulnerability and downloads the malware. The malware strains that have been confirmed over half a month of May were infostealer such as FormBook and Lokibot. FormBook and Lokibot are malware strains that consistently ranked high in ASEC weekly statistics. It is confirmed that they are being distributed through more meticulous means.</p>
<figure class="aligncenter"><img alt="" class="wp-image-34454 jetpack-lazy-image" height="271" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-37.png?resize=772%2C271&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="772"/><img alt="" class="wp-image-34454" height="271" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-37.png?resize=772%2C271&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="772"/><figcaption>Figure 5. RAPIT process tree of Excel file</figcaption></figure>
<p></p>
<figure class="aligncenter"><img alt="" class="wp-image-34457 jetpack-lazy-image" height="92" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-39.png?resize=587%2C92&amp;ssl=1" width="587"/><img alt="" class="wp-image-34457" height="92" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-39.png?resize=587%2C92&amp;ssl=1" width="587"/><figcaption>Figure 6. Lokibot (bokvb.exe) that is run by malware (vbc.exe) in NSIS form</figcaption></figure>
<p></p>
<p>To check the execution flow of the ‘has been verified. However PDF, jpeg, docx, .xlsx‘ file attached to the PDF file, the team saved the Excel attachment separately and executed it to check the process tree shown above. First, the malware (vbc.exe) in the form of NSIS (Nullsoft Scriptable Install System) is downloaded from an external URL via the formula editor (EQNEDT32.EXE) vulnerability, followed by the final malware (bokvb.exe) that is dropped and run. This file is run at the end and has been confirmed as Lokibot.</p>
<p>There have been cases of the attacker using Word files as well as Excel files that exploit the formula editor vulnerability. (Filename: has been verified. However PDF, jpeg, xlsx, .docx)</p>
<figure class="aligncenter"><img alt="" class="wp-image-34470 jetpack-lazy-image" height="219" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-40.png?resize=988%2C141&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1539"/><img alt="" class="wp-image-34470" height="219" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-40.png?resize=988%2C141&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1539"/><figcaption>Figure 7. External URL that exists within document.xml.rels</figcaption></figure>
<p></p>
<p>The shortened URL that exists in document.xml.rels redirects to the final URL where the additional malware can be downloaded. An RTF file is downloaded from the final URL. The RTF file also adopts the same execution flow of using the formula editor vulnerability to download the NSIS malware.</p>
<figure class="aligncenter"><img alt="" class="wp-image-34441 jetpack-lazy-image" height="216" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-33.png?resize=382%2C216&amp;ssl=1" width="382"/><img alt="" class="wp-image-34441" height="216" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-33.png?resize=382%2C216&amp;ssl=1" width="382"/><figcaption>Figure 8. Word file attempting to connect to External URL
(has been verified. However PDF, jpeg, xlsx, .docx)</figcaption></figure>
<p></p>
<figure class="aligncenter"><img alt="" class="wp-image-34447 jetpack-lazy-image" height="287" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-36.png?resize=899%2C287&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="899"/><img alt="" class="wp-image-34447" height="287" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/image-36.png?resize=899%2C287&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="899"/><figcaption>Figure 9. Information of internal Word file saved in Acrobat Temp folder</figcaption></figure>
<p></p>
<ul><li>Shortened URL: hxxps://shorted[.]pro/stumwd</li><li>Final URL: hxxp://172.245.163[.]188/document_shipping/document_g010.doc (RTF download)</li></ul>
<p>The PC environment in which the PDF file is run may not be in English, but there is also a high chance that the user may click the confirm button (Open this file (O)) without paying attention to the message box that is created when opening the PDF file. Users can prevent the attachment file from being run instantly by selecting the third radio button of the message box and selecting the option ‘Do Not Allow of Opening of This File Type (N).’ Afterward, the user can check the information of the attachment again by clicking the clip-shaped tab on the tab to the left. (The default settings can be restored via Edit – Default Settings ‘Trust Manager’ menu.)</p>
<p>Recently however, there have been attackers distributing EML to Korean users. Extreme caution is advised for users when ultimately running the attachment inside received mails.</p>
<p>AhnLab’s anti-malware software detect and block the malware above using the aliases below.</p>
<p>[File Detection]
OLE/Cve-2017-0199.Gen
OLE/Cve-2018-0798.Gen
RTF/Malform-A.Gen
Exploit/Pdf.Generic
XML/Dloader
Trojan/Win.NSISInject.R491618
Trojan/Win.NSISInject.R487995
Trojan/Win.FormBook.R492664
Trojan/Win.Generic.R481309</p>
<p>
[IOC]
2d418caa178a376491815af16535ee08 (PDF)
374b79c1e46034ad1e3625c99195c113 (has been verified. However PDF, Jpeg, docx, .xlsx)
hxxp://23.94.159[.]221/800/vbc.exe
4f2b5d6712ca51ba7619581acc9e6c06 (vbc.exe, NSIS)
016471d2742c31adedd647c6ee2022c1 (bokvb.exe / Lokibot)
hxxp://hyatqfuh9olahvxf[.]ga/Legend/fre.php (Lokibot C2)
947ad46aa4cfc0eaf59fd7781aadc039 (PDF)
c790888adcb84f9add8288d3634103da (has been verified. However PDF, Jpeg, xlsx, .docx)
hxxp://172.245.163[.]188/document_shipping/document_g010.doc
53edca969843ae183610def08b00f022 (RTF)
hxxp://172.245.163[.]188/crypted%20exes/ge010.exe
1bc2e6b3bcfc05766b833d0ee1bd9638 (ge010.exe, NSIS)
a8cd72078de5d385315aa7b699e69ef9 (yphxlgsy.exe / Lokibot)
hxxp://sempersim[.]su/ge10/fre.php (Lokibot C2)</p>
<p>Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to check related IOC and detailed analysis information.</p>
<p>
Categories:<a href="https://asec.ahnlab.com/en/category/malware-information/" rel="category tag">Malware Information</a> </p>
<p>Tagged as:<a href="https://asec.ahnlab.com/en/tag/formbook-en/" rel="tag">Formbook</a>, <a href="https://asec.ahnlab.com/en/tag/infostealer-en/" rel="tag">InfoStealer</a>, <a href="https://asec.ahnlab.com/en/tag/lokibot-en/" rel="tag">LOKIBOT</a>, <a href="https://asec.ahnlab.com/en/tag/malware-en/" rel="tag">malware</a>, <a href="https://asec.ahnlab.com/tag/pdf-malware/" rel="tag">pdf malware</a>, <a href="https://asec.ahnlab.com/en/tag/phishing-en/" rel="tag">phishing</a></p>
</div>