<div>
<h1 class="cmp-title__text">Conti’s Hacker Manuals — Read, Reviewed &amp; Analyzed</h1>
<img alt="Akamai blue wave" src="https://www.akamai.com/site/en/images/blog/userpics/akamai-wave-blog-author.png" style="max-width:80%;height:auto;width:auto;"/>
<p>Written by</p>
<p>Stiv Kupchik</p>
<p>April 05, 2022</p>
<p>Senior Security Researcher, based in Tel Aviv, IL</p>
<p>Share</p>
<img alt="conti.png" class="cmp-image__image" src="https://www.akamai.com/site/en/images/blog/2022/thumnails/conti.png" style="max-width:80%;height:auto;width:auto;"/>
<h3>Executive Summary</h3>
<ul>
<li><p>Akamai Security Researchers have reviewed and analyzed the leaked Conti group’s internal documentation to understand the tools and techniques used by a modern ransomware group.</p>
</li>
<li><p>Conti is a ransomware gang with revenues projected at almost 200 million dollars and is considered one of the most successful ransomware gangs in the world.</p>
</li>
<li><p>The analysis reveals a list of concrete techniques and procedures (<a href="#summary" target="_self">TTPs</a>) and indicators of compromise (<a href="https://github.com/akamai/akamai-security-research/tree/main/leaks/Conti" rel="nofollow noreferrer" target="_blank">IoC</a>) employed by the group, as well as potential <a href="#mitigations" target="_self">mitigation</a> techniques that can be utilized by blue teams.</p>
</li>
<li><p>These attack scenarios are multifaceted and detail-oriented. They have found a formula that continues to work: harvest credentials, propagate, repeat.</p>
</li>
<li><p>The attack documentation shows a strong focus on “hands on keyboard” network propagation — hinting at the need for strong protections against lateral movement, and its critical role in defending against ransomware.</p>
</li>
<li><p>These TTPs are well-known, but highly effective techniques. It is a sobering reminder of the arsenal that is at the disposal of attack groups like Conti, and may hint at the tools often used by other groups. Studying these TTPs offers security teams an “inside scoop” into the attackers’ modus operandi in an effort to be better prepared against them.</p>
</li>
<li><p>The group’s emphasis in their documentation on hacking and hands-on propagation, rather than encryption, should drive network defenders to focus on those parts of the kill chain as well, instead of focusing on the encryption phase.</p>
</li>
</ul>
<h3>Table of Contents
</h3>
<p><a href="#introduction" target="_self">Introduction</a></p>
<p><a href="#methodology" target="_self">Conti’s attack methodology</a></p>
<p><a href="#goals" target="_self">Network propagation goals</a></p>
<p><a href="#dominance" target="_self">Conti’s step-by-step guide to network dominance</a></p>
<p><a href="#toolkit" target="_self">Conti’s toolkit</a></p>
<p><a href="#access" target="_self">Initial access</a></p>
<p><a href="#movement" target="_self">Lateral movement</a></p>
<p><a href="#backdoors" target="_self">Persistency and backdoors</a></p>
<p><a href="#escalation" target="_self">Privilege escalation</a></p>
<p><a href="#harvesting" target="_self">Credential harvesting</a></p>
<p><a href="#evasion" target="_self">Defense evasion</a></p>
<p><a href="#mitigations" target="_self">Mitigations</a></p>
<p><a href="#zerotrust" target="_self">Access control and ZeroTrust</a></p>
<p><a href="#segmentation" target="_self">Segmentation</a></p>
<p><a href="#firewall" target="_self">Web application firewall</a></p>
<p><a href="#management" target="_self">Software inventory and patch management</a></p>
<p><a href="#av" target="_self">Malware detection — EDR/AV</a></p>
<p><a href="#conclusion" target="_self">Conclusion</a></p>
<p><a href="#summary" target="_self">Summary: Conti’s toolkit</a></p>
<p><a href="#references" target="_self">References</a></p>
<h3>Introduction</h3>
<p>Conti is a notorious ransomware group that targets high-revenue organizations. They were first detected in 2020, and appear to be based in Russia. It is believed that the group is the successor to Ryuk ransomware group. According to <a href="https://go.chainalysis.com/rs/503-FAP-074/images/Crypto-Crime-Report-2022.pdf" rel="nofollow noreferrer" target="_blank">Chainalysis</a>, the ransomware group was the highest grossing of all ransomware groups in 2021, with an estimated revenue of at least 180 million dollars. </p>
<p>On February 27, 2022, the Twitter handle <a href="https://twitter.com/contileaks" rel="nofollow noreferrer" target="_blank">@contileaks</a> was created and began leaking internal documents and chat logs of the group, as well as the addresses of some of their internal servers and source code. It is widely accepted in the community that it was an internal member who leaked the documents after a dispute over the group’s <a href="https://www.reuters.com/technology/russia-based-ransomware-group-conti-issues-warning-kremlin-foes-2022-02-25/" rel="nofollow noreferrer" target="_blank">public support of the Russian government </a>during the Russian–Ukrainian conflict, but the person behind the contileaks Twitter account claims to be an independent Ukrainian researcher.</p>
<p> </p>
<img alt="conti1.png" class="cmp-image__image" src="https://www.akamai.com/site/en/images/blog/2022/conti1.png" style="max-width:80%;height:auto;width:auto;"/>
<p>Although leaks like this have happened in the past (usually due to personal interests of the operators), what makes this one particularly interesting is the sheer amount of information leaked. Regardless of the circumstances, these documents give the community a rare glimpse into how these attack groups operate on a grand scale, what they use, and how they think in general. </p>
<p>There has, understandably, been a significant amount of news coverage on these documents, particularly the chat logs, which have opened a window into the human connections inside a cybercrime group. However, not much has been written so far about the tools, techniques, and procedures of the group. </p>
<p>In an effort to glean this information, we decided to focus on internal documentation, which includes guidelines for operators on target selection, hacking, and using their tools. We believe that these TTPs and methodologies should also give insight into other ransomware operators, allowing us to put ourselves in the shoes of these attackers, understand their ways of operating, and prepare our defenses accordingly.</p>
<p>In this blog post, we discuss the attack methodology and tools used by the Conti ransomware group, as gleaned from their leaked documentation. If you’d just like to know how to defend yourself and your network, or just want a quick list of their TTPs, you can skip to our Mitigations or summary sections.</p>
<h3>Conti’s attack methodology</h3>
<p>Like many modern cybercrime groups, Conti operates like a business. As outlined in <a href="https://www.wired.co.uk/article/conti-leaks-ransomware-work-life#intcid=_wired-uk-right-rail_05a9eccf-45d5-4dce-b5fb-37ab6742d1b9_popular4-1" rel="nofollow noreferrer" target="_blank">this article from Wired</a>, the group is capable of making profits (some operators have claimed personal gains of almost US$100 thousand), growing their operation, and adding new operators — and even has a CEO. As part of their business operation, Conti employs an “onboarding process” for new operators, governed by manuals detailing their methodology and modus operandi. In these manuals, we find important information on how Conti propagates inside networks, what targets they select, and what tools they use.</p>
<p>Interestingly, Conti is known for being a <a href="https://www.zdnet.com/article/ransomware-theres-been-a-big-rise-in-double-extortion-attacks-as-gangs-try-out-new-tricks/" rel="nofollow noreferrer" target="_blank">double-extortion attack group</a> — Conti both exfiltrates and encrypts data in order to ensure payment. The exfiltrated data is either used to blackmail a company into paying the ransom or sold to the highest bidder. In this way, even if backups are available, companies are pressured to pay in order to avoid the damage that may be caused by a leak. This method was first popularized by the Maze ransomware group, which was supposedly shut down in 2020, and from which many members were recruited into Conti.</p>
<p>As shown in the screenshots below, taken from Conti’s site, Conti operates on a release timeline of sorts: Once they’ve alerted the organization of the extortion, they release more and more of the data they’ve exfiltrated, the longer the victim takes to pay them. The group does not appear to have a predefined ransom price guideline, with some leaked chat logs showing group members discussing the ransom price for victims.</p>
<p> </p>
<img alt="Conti's leak website, front page" class="cmp-image__image" src="https://www.akamai.com/site/en/images/blog/2022/conti2.png" style="max-width:80%;height:auto;width:auto;"/>
Conti's leak website, front page
<p>The leak features two documents that overview Conti’s network attack methodology and their propagation goals. These documents are directed at the hacking operators/associates of the group. We haven’t seen documentation or manuals regarding initial access practices, only design documents for various internet crawlers. We think this might indicate that this vector is somewhat automated. The operator guidelines are used after the initial breach has been made. </p>
<p>Both documents describe the same methodology, which can be summarized as “harvest credentials, propagate, repeat.” As mentioned, an operator is assumed to have access to a machine in the network. Their goal then is to begin propagating through the network, first either by attempting to dump and decrypt passwords or by brute force. Then, the operator is instructed to use credentials on the next machine, expanding their reach, then repeat step one. Likewise, operators are taught that encryption doesn’t start until network dominance has been reached, which ensures the impact is maximized. </p>
<p>Conti’s attack doctrine is not a novel one. The use of effective tools and persistence seems to do the trick. The process appears to be mostly “hands on keyboard” — while some functions can be scripted or automated, operators are generally expected to do the work of stealing credentials and making cognizant decisions on spreading in the network. </p>
<h3>Network propagation goals</h3>
<p>First and foremost, Conti’s goal is to reach the domain controller (DC). Operators are instructed to work their way to the DC via the aforementioned process of stealing credentials and expanding. Since the process seems to be largely manual, this allows Conti operators a level of discretion in choosing targets. Once the domain admin credentials are found, Conti operators will have gained access to a number of critical assets: </p>
<ul>
<li><p>Login logs for most of the network to analyze user behavior</p>
</li>
<li><p>DNS records for most of the domain, which can be used to infer usage</p>
</li>
<li><p>Password hashes</p>
</li>
<li><p>Focal points for lateral movement</p>
</li>
</ul>
<p>This focus on the DC bolsters the idea that the network propagation phase is crucial to the attack. From the DC, the attackers can extract most (if not all) the credentials they need to access the entire network. Also, as more domain configuration is usually stored there, the attackers usually gain a lot of intel about the network itself and its crown jewels.</p>
<table>
<tbody><tr><td><ul>
<li>Interestingly, Conti discourages leaving backdoors and persistence on the DC, and instead encourages backdooring outward-facing servers since a DC is often much more heavily monitored. Although reaching the DC is pivotal to their success, it could also entirely thwart their efforts if detected.</li>
</ul>
</td>
</tr></tbody></table>
<p>Conti defines crown jewels as network file shares and other machines that hold data that can be exfiltrated. This data includes:</p>
<ul>
<li><p>Emails, address lists, contact information</p>
</li>
<li><p>Databases</p>
</li>
<li><p>Source code</p>
</li>
<li><p>Accounting information</p>
</li>
<li><p>Design documents</p>
</li>
<li><p>Passwords/credentials for other networks</p>
</li>
<li><p>Digital wallets</p>
</li>
</ul>
<h3>Conti’s step-by-step guide to network dominance</h3>
<p>Conti illustrates their doctrine with a step-by-step technical guideline on gaining network dominance. The following is an almost literal translation of their method, but a bit more organized than the original text. It requires some technical understanding of the tools and processes used. However, for those concerned with defending their organization against similar attacks, or those looking to emulate a Conti attack, valuable information can be gleaned as to the type of telemetry that should appear during the lateral movement and privilege escalation phases. </p>
<p>It is likely that not every operator follows this to the letter, but it should shed some light on the thought process of the Conti gang. If you are more interested in how to mitigate the threat, rather than the threat itself, you can jump to our Mitigations section.</p>
<p> </p>
<img alt="conti5.png" class="cmp-image__image" src="https://www.akamai.com/site/en/images/blog/2022/conti5.png" style="max-width:80%;height:auto;width:auto;"/>
<table>
<tbody><tr><td><p> 1. Query domain structure (using adfind, net view etc)
</p>
<p>a. Sometimes passwords will appear in those tools’ output immediately, under some comments</p>
<p> 2. Try to elevate to SYSTEM rights</p>
<p> 3. If possible:</p>
<p>a. Poison ARP-cache and intercept password hashes from other machines in the network</p>
<p>b. Dump local password hashes</p>
<p> 4. If not:</p>
<p>a. Try to see if other machines in the network are accessible, specifically if their admin$ share is accessible</p>
<p>i. If it is, jump there to obtain SYSTEM rights</p>
<p>b. Look for RCE vulnerabilities in the network</p>
<p>c. Attempt Kerberoast to obtain more password hashes</p>
<p>d. For small networks, also possible to attempt brute forcing user passwords</p>
<p>i. There’s a special emphasis on testing the lockout limits for brute force before attempting it</p>
<p> 5. For any server with a writeable inetpub directory, drop an aspx webshell</p>
<p> 6. Scan the network for further spread paths</p>
</td>
</tr></tbody></table>
<h3>Conti’s toolkit </h3>
<p>To achieve their network infiltration and propagation goals, Conti employs various tools, most of them not of Conti’s own making. In fact, only the crypter, the trojan, and the injector seem to be proprietary, but for lateral movement, propagation, and exfiltration Conti seems to use a plethora of tools that should be familiar to anyone on both red and blue teams: Cobalt Strike, Mimikatz, and PSExec, to name a few.</p>
<p>Although some readers may expect to see 0days and proprietary tools, the leak demonstrates that a tool or technique’s effectiveness is not directly correlated with how novel or unknown it is. Readers would be advised to pay close attention to the tools and techniques leaked from the Conti documentation in an effort to have more effective mitigation of these TTPs in their own defense.</p>
<table>
<tbody><tr><td><ul>
<li>The main hacking tool in Conti’s arsenal appears to be Cobalt Strike. Most of the examples in the docs appear to be direct commands for its shell or instructions for its GUI.</li>
</ul>
</td>
</tr></tbody></table>
<h3>Initial access</h3>
<p>Before Conti can begin wreaking havoc inside the network, they have to first breach it and get a foothold. As mentioned before, there is nothing in the documentation that outlines this process; rather, it seems Conti has developed various crawlers and scanners that scour the internet in search for exploitable/breachable servers. These crawlers will either grant them that initial access to a victim network, or mark them as breachable for their operators and affiliates. </p>
<table>
<tbody><tr><td><p>⚠ The following list was created from design documents. We are unsure if they are actually implemented.</p>
</td>
</tr></tbody></table>
<p> </p>
<table>
<tbody><tr><td><p>Service</p>
</td>
<td><p>Crawler logic</p>
</td>
</tr><tr><td><p>Apache Tomcat</p>
</td>
<td><p>Scan for Tomcat servers, and attempt to exploit the cgi-bin vulnerability</p>
</td>
</tr><tr><td><p>Outlook Web Access (OWA)</p>
</td>
<td><p>Internet crawler and credential brute forcer</p>
</td>
</tr><tr><td><p>Remote Desktop Protocol (RDP)</p>
</td>
<td><p>Scan for servers open to RDP from the internet and attempt to brute force login details.</p>
<p>It is port agnostic and does not rely on RDP being on TCP 3389.</p>
</td>
</tr><tr><td><p>SQL</p>
</td>
<td><p>Scan websites that have user inputs and attempt to use SQL injection on them</p>
</td>
</tr><tr><td><p>Printers</p>
</td>
<td><p>Scan for printers accessible from the internet and attempt to exploit them using <a href="https://github.com/RUB-NDS/PRET">PRET</a></p>
</td>
</tr><tr><td><p>Mail</p>
</td>
<td><p>Automatic spambot, capable of sending phishing mails from the local mailbox</p>
</td>
</tr></tbody></table>
<h3>Lateral movement</h3>
<p>Besides the methodology documents, there are additional manuals with concrete examples and guides on implementing lateral movement — the techniques listed here are aggregated from all of them, ordered by the amount of examples/references to each (in order of most prominent to least):</p>
<ul>
<li><p>Remote Windows Management Instrumentation (<a href="https://docs.microsoft.com/en-us/windows/win32/wmisdk/about-wmi" rel="nofollow noreferrer" target="_blank">WMI</a>) — used for triggering payloads remotely using /node:.. process call create</p>
<ul>
<li><p>Interestingly, the attackers sometimes use it to actually trigger a <a href="https://docs.microsoft.com/en-us/windows/win32/bits/background-intelligent-transfer-service-portal" rel="nofollow noreferrer" target="_blank">BITS</a> job to download the malware hosted remotely (or on a breached share)</p>
</li>
</ul>
</li>
<li><p>PSExec — both the Sysinternals tool itself and its Cobalt Strike implementation are used for remote payload execution</p>
</li>
<li><p>Remote scheduled task — using the command line utility SCHTASKS with the /s flag to create a remote task to execute a dropped payload</p>
</li>
<li><p>WinRM — this is the built-in code execution method in Cobalt Strike</p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010" rel="nofollow noreferrer" target="_blank">EternalBlue</a> — exploiting a remote code execution vulnerability in SMB</p>
</li>
<li><p><a href="https://msrc-blog.microsoft.com/2019/05/14/prevent-a-worm-by-updating-remote-desktop-services-cve-2019-0708/" rel="nofollow noreferrer" target="_blank">BlueKeep</a> — exploiting a remote code execution vulnerability in RDP</p>
</li>
</ul>
<h3>Persistency and backdoors</h3>
<p>From the leaked chat logs, the only persistence methods we’ve seen discussed are <a href="https://attack.mitre.org/techniques/T1053/005/" rel="nofollow noreferrer" target="_blank">scheduled tasks</a>. We’ve added all of the task names and paths that we’ve seen in the chat logs to our <a href="https://github.com/akamai/akamai-security-research/tree/main/leaks/Conti" rel="nofollow noreferrer" target="_blank">GitHub repository</a>.</p>
<p>Other persistence methods that we’ve seen explained in one of Conti’s manuals include:</p>
<ul>
<li><p><a href="https://attack.mitre.org/techniques/T1547/001/" rel="nofollow noreferrer" target="_blank">Registry run keys</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1137/002/" rel="nofollow noreferrer" target="_blank">Office application startup</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1543/003/" rel="nofollow noreferrer" target="_blank">Windows services</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1546/012/" rel="nofollow noreferrer" target="_blank">Image file execution options</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1546/003/" rel="nofollow noreferrer" target="_blank">WMI event subscription</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1546/010/" rel="nofollow noreferrer" target="_blank">AppInit DLLs</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1547/004/" rel="nofollow noreferrer" target="_blank">Winlogon userInit</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1547/002/" rel="nofollow noreferrer" target="_blank">LSASS notification packages</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1546/007/" rel="nofollow noreferrer" target="_blank">Netsh helper DLL</a></p>
</li>
</ul>
<p>In addition to the above, which are used to launch their beacons/reverse shells, the manuals also mention installing AnyDesk and Atera, as well as changing the RDP port (and enabling it to pass through Windows’ firewall) — all presumably to have another entry point in case communication is lost (their term for this is закреп, which roughly translates to screwed [in place]).</p>
<h3>Privilege escalation</h3>
<p>Besides the existing local privilege escalation (LPE) tools available in Cobalt Strike, it appears that Conti uses the LPE variant of PrintNightmare to create new local administrators for beacons that run as a regular user.</p>
<p> </p>
<h3>Credential harvesting</h3>
<p>Most of Conti’s credential harvesting manuals reference Mimikatz, but their full arsenal includes:</p>
<ul>
<li><p>Mimikatz</p>
<ul>
<li><p><a href="https://attack.mitre.org/techniques/T1003/001/" rel="nofollow noreferrer" target="_blank">lsadump</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1003/006/" rel="nofollow noreferrer" target="_blank">dcsync</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1550/002/" rel="nofollow noreferrer" target="_blank">pth</a></p>
</li>
<li><p><a href="https://attack.mitre.org/techniques/T1134/001/" rel="nofollow noreferrer" target="_blank">token injection</a></p>
</li>
<li><p>Zerologon — exploiting a netlogon vulnerability to get an authenticated session to the domain controller and reset the krbtgt password</p>
</li>
</ul>
</li>
<li><p>Kerberoast — used to crack kerberos service user passwords from service tickets</p>
</li>
<li><p>Zerologon — this time used as a Cobalt Strike post exploitation module to acquire a login session to the DC to run dcsync</p>
</li>
<li><p>Credential stealer — probably an in-house development; scans the local filesystem for user passwords stored in text files and documents</p>
</li>
</ul>
<h3>Defense evasion</h3>
<p>Conti has various ways to avoid detection. The primary (and most surprising) one is ensuring that their released tools do not trigger detection in the first place.</p>
<p>Conti’s documentation includes evidence that they test their tools and techniques against a number of well-known antiviruses. These include testing that their droppers and injectors don’t trigger various antivirus engines. To do this, they use both local machines running the antivirus engines and dyncheck, a platform that allows sample upload and analysis (similar to VirusTotal, though it seems to not be accessible at the moment).</p>
<p>In particular, the attackers are interested in the following antivirus engines:</p>
<ul>
<li><p>Windows Defender</p>
</li>
<li><p>ESET Nod32</p>
</li>
<li><p>Avast Home</p>
</li>
<li><p>Kaspersky Antivirus</p>
</li>
<li><p>Bitdefender</p>
</li>
</ul>
<p>In addition, Conti has some manuals on shutting down Windows Defender, either by manipulating the host’s policy to turn it off, or by killing its service. It seems that special attention is given to the service, likely due to its widespread usage in target organizations.</p>
<p>The persistent backdoor gets command and control addresses from obfuscated methods, which also helps evade detection:</p>
<ul>
<li><p>emercoin dns</p>
</li>
<li><p>Google cache</p>
</li>
<li><p>bitcoin transactions</p>
</li>
</ul>
<p>Saving files to the disk is discouraged, and scripts/lolbins are the preferred way of work. Files saved to disk should be hidden using <a href="https://attack.mitre.org/techniques/T1027/003/" rel="nofollow noreferrer" target="_blank">steganography</a> (in pictures or certificate files) or in a way that can be easily listed (registry, file streams).</p>
<h3>Mitigations</h3>
<p>Since the attack surface is multifaceted, your defense should also be multi-layered — there is no one solution that can keep you immediately safe and secure. As we can see in the attack methodology, there is a sophisticated process before the first ransomware instance is deployed, which gives us plenty of opportunity to detect and respond to the attack.</p>
<p>For a correlation between attack method and its mitigation, please refer to <a href="https://docs.google.com/document/d/1mmMF2uNM2xHUcLd6YA6qU_Z6QaImdUbQcL7_hJswUEA/edit#heading=h.tk6zwnfdrvu8" rel="nofollow noreferrer" target="_blank">Summary: Conti’s toolkit</a>.</p>
<h3>Access control and ZeroTrust</h3>
<p>Conti relies a lot on existing users and their credentials for lateral movement and access. Enforcing control over who can access what and where, and purposely separating power users from daily activities, can greatly inhibit and slow the lateral movement process. It also allows for much more detection surface.</p>
<h3>Segmentation</h3>
<p>In addition to controlling user access, you can also control the communication paths. Disabling protocols that can be abused for lateral movement (RPC, RDP, WinRM, SSH, etc) between user endpoints, restricting access to file shares (or disabling them altogether on anything that isn’t a fileserver), and limiting access to databases and backup servers can greatly reduce your network attack surface.</p>
<p>For a bit of extra granularity, lateral movement methods that rely on RPC (such as remote WMI, remote scheduled tasks, and psexec) can be also controlled at the operating system level, using <a href="https://www.akamai.com/blog/security/guide-rpc-filter">RPC filters</a>.</p>
<h3>Web application firewall</h3>
<p>Before any attack can propagate inside your network, the attacker needs to get a foothold in it. In Conti’s cases, their initial access crawlers and vectors include phishing (mail spambot) and exploiting internet-facing services (OWA, SQL injection, Apache Tomcat cgi-bin). In most cases, a good web application firewall should block most attacker attempts to gain that initial foothold in the network.</p>
<h3>Software inventory and patch management</h3>
<p>Keeping track of what software is installed and where it is installed can help detect unwanted additions. This holds true for Conti’s Atera and AnyDesk backdoors, and also for other attacks. (Looking at you, LAPSUS$, with your procexp and ProcessHacker.) In addition, patch management can also keep your chestnuts out of the fire. None of the exploits discussed in this blog are recent; patches were released long ago. Despite this, Conti and other groups have been able to be successful because many servers remain unpatched.</p>
<h3>
Malware detection — EDR/AV</h3>
<p>This is the last line of defense on the machines in the network. A good (and up-to-date) endpoint detection and response (EDR) or antivirus (AV) solution may help detect and block the tools used during the attack. It is a cat-and-mouse game, (as we’ve seen that Conti tests whether their tools bypass detection), but it’s better to have a cat that sometimes catches mice than no cat and a mouse infestation.</p>
<p>Some EDRs today also claim to be able to detect and prevent ransomware heuristically, when it starts encrypting your host. We will not make claims on the efficiency rate of this feature, but it is something to consider.</p>
<h3>Conclusion</h3>
<p>Although there is still much that is unknown about Conti and other ransomware groups, these documents have given the security community a firsthand look at a cybercriminal organization. This information is invaluable as we continue the fight against them and against ransomware in general. </p>
<p>It has become a bit of a trope to say we need to understand the attacker’s point of view, but there is a lot of truth to it. By looking at Conti as a business operation whose go-to-market strategy was leaked, we can act as their competitors in a sense, using their own intellectual property against them. </p>
<p>None of the tools Conti is using are particularly novel. Conti’s operators have many tools and methods that they employ to infect and eventually encrypt target networks, but they are all known to us. They’re not unique zero-day threats, they’re “common knowledge” TTPs that are also employed by red teams everywhere.</p>
<p>Despite this, they still have wide success. “If it ain’t broke, don’t fix it,” as they say. This supports the idea that security teams need to take a hard look at how they’re approaching defense. Zero days may make the headlines, but the foundational attacks make the money.</p>
<p>Network domination is the goal. Usually, when discussing ransomware, there’s more emphasis on the actual act of encryption. The truth, however, that we wanted to showcase with this post, is that there is a long process that has to occur before any encryption can even begin. This time, our discussion is backed by actual ransomware operator documentation. Considering the ratio between hacking documentation and encryption documentation, it becomes clear that the main issue is with hacking (network breach, lateral movement and propagation, avoiding detection) rather than with just data encryption and exfiltration. </p>
<p>This is actually somewhat of a silver lining. This knowledge demonstrates that the detection surface that we as defenders can employ is much wider than it seems — we just need to reach out and utilize it. Just because these TTPs are not new does not make them trivial — if they were, they wouldn't be used by one of the most successful ransomware groups active today. This documentation and analysis supports that we as a community need to look at ransomware more holistically rather than just at the encryption. By focusing primarily on the encryption aspect of ransomware, we are missing out on a wide detection surface which could be the difference between an incident and a headline. </p>
<h3>Summary: Conti’s toolkit</h3>
<p>We have aggregated the following table of Conti’s TTPs and possible mitigation measures for them:</p>
<table>
<tbody><tr><th><p>Category</p>
</th>
<th><p>Method</p>
</th>
<th><p>Description</p>
</th>
<th><p>Mitigation</p>
</th>
</tr><tr><td rowspan="2">Attack Tools</td>
<td><p><a href="https://attack.mitre.org/software/S0154/" rel="nofollow noreferrer" target="_blank">Cobalt Strike</a></p>
</td>
<td><p>Commercial remote access tools designed for red teams, but often misused by malware operators</p>
</td>
<td rowspan="2"><p>• EDR/AV</p>
<p>• Segmentation</p>
<p>• Access control</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/software/S0266/" rel="nofollow noreferrer" target="_blank">Trickbot</a></p>
</td>
<td><p>Trojan spyware</p>
</td>
</tr><tr><td rowspan="6"><p>Lateral Movement</p>
</td>
<td><p><a href="https://attack.mitre.org/software/S0029" rel="nofollow noreferrer" target="_blank">PSExec</a></p>
</td>
<td><p>Free Microsoft tool for remote program execution</p>
</td>
<td rowspan="4"><p>• Segmentation</p>
<p>• Access control</p>
<p>• <a href="https://www.akamai.com/blog/security/guide-rpc-filter">RPC filters</a></p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1047/" rel="nofollow noreferrer" target="_blank">Remote WMI</a></p>
</td>
<td rowspan="2"><p>Microsoft administration feature capable of remote program execution</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1053/005/" rel="nofollow noreferrer" target="_blank">Remote Task Scheduler</a></p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1021/006/" rel="nofollow noreferrer" target="_blank">WinRM</a></p>
</td>
<td><p>Windows service and protocol for remote host management</p>
</td>
</tr><tr><td><p><a href="https://msrc-blog.microsoft.com/2019/05/14/prevent-a-worm-by-updating-remote-desktop-services-cve-2019-0708/" rel="nofollow noreferrer" target="_blank">BlueKeep</a></p>
</td>
<td><p>A Remote Code Execution vulnerability in Microsoft RDP</p>
</td>
<td rowspan="2"><p>• Patch management</p>
<p>• Segmentation</p>
<p>• Access control</p>
</td>
</tr><tr><td><p><a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010" rel="nofollow noreferrer" target="_blank">EternalBlue</a></p>
</td>
<td><p>A Remote Code Execution vulnerability in Microsoft SMB</p>
</td>
</tr><tr><td><p>Privilege Escalation</p>
</td>
<td><p>PrintNightmare</p>
</td>
<td><p>A Remote Code Execution vulnerability in the Window Print Spooler service</p>
</td>
<td><p> </p>
<p>• Patch management</p>
<p> </p>
</td>
</tr><tr><td rowspan="2"><p>Credential Harvest</p>
</td>
<td><p><a href="https://attack.mitre.org/software/S0002/" rel="nofollow noreferrer" target="_blank">Mimikatz</a></p>
</td>
<td><p>Open source credential dumper</p>
</td>
<td><p> </p>
<p>• EDR/AV</p>
<p> </p>
</td>
</tr><tr><td><p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1472" rel="nofollow noreferrer" target="_blank">ZeroLogon</a></p>
</td>
<td><p>An Elevation of Privilege vulnerability in MS-NRPC</p>
</td>
<td><p>• Patch management</p>
<p>• Segmentation</p>
<p>• Access control</p>
<p>• <a href="https://www.akamai.com/blog/security/guide-rpc-filter" target="_self">RPC filters</a></p>
</td>
</tr><tr><td rowspan="4"><p>Backdoor</p>
</td>
<td><p><a href="https://attack.mitre.org/techniques/T1219/" rel="nofollow noreferrer" target="_blank">AnyDesk, Atera</a></p>
</td>
<td><p>Remote access software</p>
</td>
<td><p>• Software inventory management</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1505/003/" rel="nofollow noreferrer" target="_blank">Webshells</a></p>
</td>
<td><p>Dropping webshells on breached web servers</p>
</td>
<td><p> </p>
<p>• EDR/AV</p>
<p> </p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1021/001/" rel="nofollow noreferrer" target="_blank">RDP</a></p>
</td>
<td><p>Windows remote desktop protocol</p>
</td>
<td><p>• Segmentation</p>
<p>• Access control</p>
</td>
</tr><tr><td><p><a href="https://docs.google.com/document/d/1mmMF2uNM2xHUcLd6YA6qU_Z6QaImdUbQcL7_hJswUEA/edit#heading=h.nj6bx0gi2koz" rel="nofollow noreferrer" target="_blank">Persistency techniques</a></p>
</td>
<td><p>Various persistency methods to load a bot/dropper</p>
</td>
<td><p>• EDR/AV</p>
</td>
</tr><tr><td rowspan="2"><p>Detection Avoidance</p>
</td>
<td><p><a href="https://attack.mitre.org/techniques/T1562/001/" rel="nofollow noreferrer" target="_blank">Disabling Windows Defender</a></p>
</td>
<td><p>Disabling the antivirus to prevent malware detection</p>
</td>
<td><p>• EDR/AV</p>
<p>• Software inventory management</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1027/" rel="nofollow noreferrer" target="_blank">Obfuscation</a></p>
</td>
<td><p>Encoding C2 addresses and communication to inhibit detection</p>
</td>
<td><p>• EDR/AV</p>
<p>• IDS</p>
</td>
</tr><tr><td rowspan="6"><p>Initial Access</p>
</td>
<td><p>Outlook Web Access (<a href="https://attack.mitre.org/techniques/T1566/" rel="nofollow noreferrer" target="_blank">OWA</a>) </p>
</td>
<td><p>Brute forcing access to Outlook web interface to spread phishing emails</p>
</td>
<td><p>• Web application firewall</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1133/" rel="nofollow noreferrer" target="_blank">RDP</a></p>
</td>
<td><p>Brute forcing access to internet-facing servers with RDP open</p>
</td>
<td><p>• Segmentation</p>
<p>• Access control</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1190/" rel="nofollow noreferrer" target="_blank">SQL</a></p>
</td>
<td><p>Attempting SQL injection on websites with user input</p>
</td>
<td><p>• EDR/AV</p>
<p>• IDS</p>
<p>• Web application firewall</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1190/" rel="nofollow noreferrer" target="_blank">Printers</a></p>
</td>
<td><p>Using exploit kits on printers open to the internet</p>
</td>
<td><p>• Patch management</p>
<p>• Segmentation</p>
<p>• Access control</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1190/" rel="nofollow noreferrer" target="_blank">Apache Tomcat Scanner</a></p>
</td>
<td><p>Attempting to exploit Apache Tomcat servers</p>
</td>
<td><p>• Web application firewall</p>
</td>
</tr><tr><td><p><a href="https://attack.mitre.org/techniques/T1566/" rel="nofollow noreferrer" target="_blank">Mail</a></p>
</td>
<td><p>Using a spambot to spread phishing emails on compromised mailboxes/hosts</p>
</td>
<td><p>• EDR/AV</p>
</td>
</tr></tbody></table>
<h3>References</h3>
<p>Although we read all of the documentation files from the leak, some files contained more information than others. We’ve listed all files that contain the information that was used to write this blog post. We follow the folder tree from <a href="https://share.vx-underground.org/Conti/" rel="nofollow noreferrer" target="_blank">vx-underground</a>.</p>
<ul>
<li><p>Conti Toolkit Leak/</p>
<ul>
<li><p>Мануали для работяг и софт/</p>
<ul>
<li><p>MANUALS/</p>
<ul>
<li><p>МАНУАЛ.txt</p>
</li>
<li><p>Заменяем sorted адфиндера.txt</p>
</li>
<li><p>ПРОСТАВЛЕНИЕ.txt</p>
</li>
<li><p>Меняем RDP порт.txt</p>
</li>
<li><p>по отключению дефендера.txt</p>
</li>
<li><p>ПЕРВОНАЧАЛЬНЫЕ ДЕЙСТВИЯ.txt</p>
</li>
</ul>
</li>
<li><p>CobaltStrike MANUAL_V2 .docx</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Conti Documentation Leak/</p>
<ul>
<li><p>docs/</p>
<ul>
<li><p>modules/</p>
<ul>
<li><p>ТЗ доработка модуля распространения.txt</p>
</li>
<li><p>ТЗ автоматизация чистки.txt</p>
</li>
<li><p>требования к лоадеру.txt</p>
</li>
<li><p>ТЗ бэкдор.txt</p>
</li>
<li><p>сканер apache tomcat.txt</p>
</li>
<li><p>ТЗ брут OWA.txt</p>
</li>
<li><p>ТЗ сканер rdp.txt</p>
</li>
<li><p>ТЗ сканер sql инъекций2.txt</p>
</li>
<li><p>ТЗ сканер принтеров.txt</p>
</li>
<li><p>ТЗ спамбот.txt</p>
</li>
</ul>
</li>
<li><p>misc/</p>
<ul>
<li><p>ТЗ автоматизация группового тестирования в криптопанели.txt</p>
</li>
</ul>
</li>
<li><p>management/</p>
<ul>
<li><p>чистка АВ.txt</p>
</li>
</ul>
</li>
<li><p>быстрый старт хакера.txt</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="cmp-tag-list__list">
<li class="cmp-tag-list__list-item"><a class="cmp-tag-list__list-item--link" href="https://www.akamai.com/blog?filter=blogs/security">Security</a></li>
</ul>
<p>Share</p>
<img alt="Akamai blue wave" src="https://www.akamai.com/site/en/images/blog/userpics/akamai-wave-blog-author.png" style="max-width:80%;height:auto;width:auto;"/>
<p>Written by</p>
<p>Stiv Kupchik</p>
<p>April 05, 2022</p>
<p>Senior Security Researcher, based in Tel Aviv, IL</p>
</div>