<html lang="en-US"><head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://news.sophos.com/xmlrpc.php">
	<link rel="alternate" hreflang="es-419" href="https://news.sophos.com/es-419/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="nl-nl" href="https://news.sophos.com/nl-nl/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="pt-br" href="https://news.sophos.com/pt-br/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="de-de" href="https://news.sophos.com/de-de/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="en-us" href="https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="fr-fr" href="https://news.sophos.com/fr-fr/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="es-es" href="https://news.sophos.com/es-es/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="it-it" href="https://news.sophos.com/it-it/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="ja-jp" href="https://news.sophos.com/ja-jp/2022/05/04/attacking-emotets-control-flow-flattening">
	<link rel="alternate" hreflang="zh-tw" href="https://news.sophos.com/zh-tw/2022/05/04/attacking-emotets-control-flow-flattening">
<!-- Google Tag Manager -->
<script async="" src="https://l.clarity.ms/s/0.6.34/clarity.js"></script><script type="text/javascript" async="" src="https://www.googleadservices.com/pagead/conversion_async.js"></script><script async="" id="demandbase_js_lib" src="https://scripts.demandbase.com/WuEFNglz.min.js"></script><script src="https://s.yimg.com/wi/ytc.js" async=""></script><script async="" src="https://tags.srv.stackadapt.com/events.js"></script><script async="" src="https://a.quora.com/qevents.js"></script><script async="" src="//static.ads-twitter.com/uwt.js"></script><script type="text/javascript" async="" src="https://snap.licdn.com/li.lms-analytics/insight.min.js"></script><script src="https://connect.facebook.net/signals/config/334990480506518?v=2.9.57&amp;r=stable" async=""></script><script async="" src="https://connect.facebook.net/en_US/fbevents.js"></script><script src="//bat.bing.com/bat.js" async=""></script><script type="text/javascript" async="" src="//img03.en25.com/i/elqCfg.min.js"></script><script type="text/javascript" async="" src="https://stats.g.doubleclick.net/dc.js"></script><script async="" src="https://www.googletagmanager.com/gtm.js?id=GTM-5L6H3LN&amp;gtm_auth=d5XceCG5H_eblswmMfURjQ&amp;gtm_preview=env-2&amp;gtm_cookies_win=x"></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl+ '&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5L6H3LN');</script>
<!-- End Google Tag Manager -->
<title>Attacking Emotet’s Control Flow Flattening – Sophos News</title>
<meta name="robots" content="max-image-preview:large">
<!-- Jetpack Site Verification Tags -->
<meta name="google-site-verification" content="8r1qg681OjOolfxmHEY1IYupmTBdyKXc-OPfpgeQHFk">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="dns-prefetch" href="//v0.wordpress.com">
<link rel="alternate" type="application/rss+xml" title="Sophos News » Feed" href="https://news.sophos.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Sophos News » Comments Feed" href="https://news.sophos.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Sophos News » Attacking Emotet’s Control Flow Flattening Comments Feed" href="https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/feed/">
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/news.sophos.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.9.3"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
</script><script src="https://news.sophos.com/wp-includes/js/wp-emoji-release.min.js?ver=5.9.3" type="text/javascript" defer=""></script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="all-css-0" href="https://news.sophos.com/_static/??-eJyNy0EOQDAQheELqVFCYiHOUu1EhmlJpyK9PRsJO8s/731w7oqC5cOhgBUBR5Jg4s2uimmKJmaQlBlLT6G8DwW8xSLg0ZFBRo8hfWJnkzEqxtnY/I/f27sfNPpBd23V60bX9QWHdUGf" type="text/css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<style id="global-styles-inline-css">
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
</style>
<link rel="stylesheet" id="all-css-2" href="https://news.sophos.com/_static/??/wp-content/themes/sophosnews-2017/style-2021.css,/wp-content/mu-plugins/jetpack-10.8/css/jetpack.css?m=1648757293" type="text/css" media="all">
<script type="text/javascript" src="https://news.sophos.com/_static/??-eJzTLy/QzcxLzilNSS3WzwKiwtLUokoopZebmaeXVayjj0+Rbm5melFiSSpUsX2uraGZqYGlobGhkVEWAK9PIhY="></script><link rel="https://api.w.org/" href="https://news.sophos.com/wp-json/"><link rel="alternate" type="application/json" href="https://news.sophos.com/wp-json/wp/v2/posts/84215"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://news.sophos.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://news.sophos.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.9.3">
<link rel="canonical" href="https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/">
<link rel="shortlink" href="https://news.sophos.com/?p=84215">
<link rel="alternate" type="application/json+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F">
<link rel="alternate" type="text/xml+oembed" href="https://news.sophos.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F&amp;format=xml">
<style type="text/css">img#wpstats{display:none}</style>
	<link rel="amphtml" href="https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article">
<meta property="og:title" content="Attacking Emotet’s Control Flow Flattening">
<meta property="og:url" content="https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/">
<meta property="og:description" content="Sweeping aside one obfuscation technique in a notorious strain of malware">
<meta property="article:published_time" content="2022-05-04T14:01:08+00:00">
<meta property="article:modified_time" content="2022-05-04T14:11:08+00:00">
<meta property="og:site_name" content="Sophos News">
<meta property="og:image" content="https://news.sophos.com/wp-content/uploads/2022/04/shutterstock_105181163.jpg?w=640">
<meta property="og:image:secure_url" content="https://news.sophos.com/wp-content/uploads/2022/04/shutterstock_105181163.jpg?w=640">
<meta property="og:image:width" content="640">
<meta property="og:image:height" content="435">
<meta property="og:image:alt" content="">
<meta property="og:locale" content="en_US">
<meta property="fb:admins" content="28552295016">
<meta name="twitter:text:title" content="Attacking Emotet’s Control Flow Flattening">
<meta name="twitter:image" content="https://news.sophos.com/wp-content/uploads/2022/04/shutterstock_105181163.jpg?w=640">
<meta name="twitter:card" content="summary_large_image">

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=32" sizes="32x32">
<link rel="icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=192" sizes="192x192">
<link rel="apple-touch-icon" href="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=180">
<meta name="msapplication-TileImage" content="https://news.sophos.com/wp-content/uploads/2020/01/cropped-sophos.png?w=270">
<style type="text/css"></style><script src="https://bat.bing.com/p/action/4015302.js" type="text/javascript" async="" data-ueto="ueto_db5f8a93a6"></script><link id="sa-css" rel="stylesheet" type="text/css" href="https://tags.srv.stackadapt.com/sa.css" media="all"><script src="https://googleads.g.doubleclick.net/pagead/viewthroughconversion/743773256/?random=1651691734645&amp;cv=9&amp;fst=1651691734645&amp;num=1&amp;bg=ffffff&amp;guid=ON&amp;resp=GooglemKTybQhCsO&amp;u_h=1080&amp;u_w=1900&amp;u_ah=1080&amp;u_aw=1900&amp;u_cd=24&amp;u_his=2&amp;u_tz=0&amp;u_java=false&amp;u_nplug=0&amp;u_nmime=0&amp;gtm=2oa520&amp;sendb=1&amp;ig=1&amp;data=event%3Dgtag.config&amp;frm=0&amp;url=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F&amp;tiba=Attacking%20Emotet%E2%80%99s%20Control%20Flow%20Flattening%20%E2%80%93%20Sophos%20News&amp;hn=www.googleadservices.com&amp;async=1&amp;rfmt=3&amp;fmt=4"></script></head>

<body class="post-template-default single single-post postid-84215 single-format-standard group-blog">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5L6H3LN&gtm_auth=d5XceCG5H_eblswmMfURjQ&gtm_preview=env-2&gtm_cookies_win=x"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="page" class="hfeed site">
	<a class="sr-only" href="#content">Skip to content</a>

	
<header class="bg-blue-600" x-data="{ mobileMenu: false, searchField: false }">
	<div class="container">
		<div class="flex items-center justify-between h-16">

			<!-- Logo -->
			<div class="flex-shrink-0">
				<a class="site-logo" href="https://news.sophos.com/en-us/" rel="home">
				<svg width="172" height="17" xmlns="http://www.w3.org/2000/svg">
					<g fill="#FFF" fill-rule="evenodd">
						<path d="M113.024 5.298V16.74h-2.595V.259h2.265l7.997 11.49V.26h2.619v16.482h-2.289l-7.997-11.443M126.064.259h10.78v2.307H128.8v4.521h7.549v2.214h-7.55v5.133h8.376v2.307h-11.111V.259M138.478.259h2.855l2.694 12.29L147.29.26h2.783l3.61 12.314L156.005.26h2.783l-3.62 16.482h-2.76l-3.751-12.126-3.426 12.126h-2.784L138.478.259M168.933 4.968v-.283c0-1.318-.778-2.425-3.492-2.425-2.43 0-3.279 1.013-3.279 2.284 0 1.201.708 1.743 2.218 2.073l3.491.776c2.123.448 4.129 1.602 4.129 4.333 0 3.014-1.675 5.274-6.204 5.274-5.214 0-6.559-2.26-6.559-4.52v-.307h2.737v.26c0 1.2.755 2.284 3.774 2.284 2.5 0 3.421-1.084 3.421-2.638 0-1.224-.731-1.907-2.289-2.237l-3.49-.777c-2.407-.517-3.917-1.742-3.917-4.309 0-2.566 1.77-4.756 6.016-4.756 4.553 0 6.18 2.26 6.18 4.639v.33h-2.736M85.303 16.718h8.88c2.492 0 3.549-.15 4.379-.677 1.308-.803 2.139-2.378 2.139-4.162 0-1.457-.504-2.868-1.258-3.622-.981-1.006-2.316-1.382-4.783-1.382h-2.693c-1.208 0-2.097-.05-2.6-.276-.605-.277-.956-.81-.956-1.562 0-.88.427-1.455 1.132-1.632.529-.124 1.14-.124 2.726-.15h7.949V.265h-8.754c-1.963 0-2.843.075-3.598.353-1.737.602-2.921 2.383-2.921 4.518 0 1.458.58 2.745 1.587 3.624.881.753 2.189 1.105 4.202 1.105h3.584c.805 0 1.46.1 1.813.3.678.327 1.08.934 1.08 1.714 0 .652-.301 1.122-.83 1.447-.426.278-1.158.403-2.49.403h-8.588v2.99zm-84.945 0h8.88c2.492 0 3.549-.15 4.38-.677 1.307-.803 2.138-2.378 2.138-4.162 0-1.457-.504-2.868-1.258-3.622-.982-1.006-2.316-1.382-4.783-1.382H7.023c-1.209 0-2.098-.05-2.6-.276-.605-.277-.957-.81-.957-1.562 0-.88.427-1.455 1.132-1.632.53-.124 1.141-.124 2.726-.15h7.95V.265H6.52c-1.964 0-2.844.075-3.6.353C1.185 1.22 0 3 0 5.136 0 6.594.582 7.881 1.587 8.76c.881.753 2.19 1.105 4.203 1.105h3.582c.807 0 1.46.1 1.814.3.678.327 1.08.934 1.08 1.714 0 .652-.3 1.122-.83 1.447-.426.278-1.157.403-2.49.403H.358v2.99zM71.99 4.596c-.52.813-.765 2.118-.765 3.87 0 3.845 1.331 5.595 4.294 5.595 2.915 0 4.248-1.75 4.248-5.546 0-3.847-1.308-5.571-4.248-5.571-1.604 0-2.864.592-3.53 1.652zm10.05-1.897c1.013 1.33 1.58 3.498 1.58 6.039 0 2.882-.914 5.249-2.544 6.555-1.233.986-3.11 1.528-5.335 1.528-3.16 0-5.654-1.037-6.937-2.884-.964-1.355-1.435-3.155-1.435-5.35 0-3.152.866-5.544 2.495-6.826C71.149.726 73.175.158 75.497.158c2.938 0 5.284.913 6.543 2.54zM65.36.279h-3.507v6.73h-6.345V.278h-3.507v16.439h3.507V9.94h6.345v6.778h3.506V.278zM43.533 8.042c.938 0 1.48-.123 1.852-.469.442-.37.715-1.158.715-2.07 0-1.084-.443-1.872-1.208-2.144-.272-.1-.717-.149-1.286-.149h-4.839v4.832h4.766zm-4.766 8.674h-3.507V.278h8.223c2.889 0 3.902.295 4.988 1.504.964 1.036 1.481 2.39 1.481 3.845 0 1.725-.69 3.327-1.826 4.289-.962.813-1.854 1.058-3.728 1.058h-5.63v5.743zM21.665 4.596c-.519.813-.764 2.118-.764 3.87 0 3.845 1.333 5.595 4.297 5.595 2.913 0 4.247-1.75 4.247-5.546 0-3.847-1.308-5.571-4.247-5.571-1.606 0-2.866.592-3.533 1.652zm10.052-1.897c1.014 1.33 1.581 3.498 1.581 6.039 0 2.882-.914 5.249-2.545 6.555-1.233.986-3.11 1.528-5.333 1.528-3.162 0-5.656-1.037-6.94-2.884-.964-1.355-1.432-3.155-1.432-5.35 0-3.152.865-5.544 2.496-6.826C20.825.726 22.85.158 25.173.158c2.938 0 5.286.913 6.544 2.54z"></path>
					</g>
				</svg>
				</a>
			</div>

			<!-- Search Field -->
			<div class="lg:flex justify-end flex-grow hidden" x-show="searchField" style="display: none;">
				<div class="relative w-1/2 rounded-md shadow-sm">
					<form role="search" method="get" action="https://news.sophos.com/en-us/">
						<input type="text" class="block w-full text-lg text-white placeholder-gray-100 bg-blue-800 border-0 rounded-md font-sansMedium font-medium" placeholder="Type to Search News" x-ref="searchInput" name="s">
						<div class="absolute inset-y-0 right-0 flex items-center px-3">
							<button class="hover:opacity-100 opacity-60 p-1 text-xs text-white uppercase rounded-full cursor-pointer" type="submit">
								Search							</button>
						</div>
					</form>
				</div>
			</div>

			<!-- Main Nav -->
			<div class="lg:flex items-center flex-grow hidden" x-show="!searchField">
				<div class="flex ml-auto">
				<ul id="menu-en-us-primary" class="primary-menu"><li id="menu-item-77773" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77773"><a href="https://news.sophos.com/en-us/category/products-services/">Products &amp; Services<div class="menu-item-description"></div></a></li>
<li id="menu-item-77772" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77772"><a href="https://news.sophos.com/en-us/category/security-operations/">Security Operations<div class="menu-item-description"></div></a></li>
<li id="menu-item-77774" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-77774"><a href="https://news.sophos.com/en-us/category/threat-research/">Threat Research<div class="menu-item-description"></div></a></li>
<li id="menu-item-77775" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77775"><a href="https://ai.sophos.com">AI Research<div class="menu-item-description"></div></a></li>
<li id="menu-item-77776" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77776"><a href="https://nakedsecurity.sophos.com">Security News<div class="menu-item-description"></div></a></li>
<li id="menu-item-83702" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-83702"><a href="https://news.sophos.com/en-us/category/sophos-life/">Sophos Life<div class="menu-item-description"></div></a></li>
</ul>				</div>
			</div>

			<!-- Search button -->
			<div class="lg:block hidden ml-4">
				<div class="flex items-center">
					<button class="border-2 border-transparent hover:border-white inline-flex items-center justify-center p-2 text-white rounded-md focus:outline-none transition-colors" @click.prevent="searchField = !searchField; $nextTick(() => { setTimeout(() => { $refs.searchInput.focus(); }, 150);});">
						<span class="sr-only">Search</span>
						<!-- Heroicon name: outline/bell -->
						<svg class="w-5 h-5 block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" :class="{ 'block': !searchField, 'hidden': searchField }">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
						</svg>
						<svg class="hidden w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" :class="{ 'block': searchField, 'hidden': !searchField }">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path>
						</svg>
					</button>
				</div>
			</div>

			<!-- Mobile menu button -->
			<div class="lg:hidden flex -mr-2">
				<button type="button" class="hover:text-white hover:bg-blue-800 focus:outline-none hover:ring-2 focus:ring-offset-2 focus:ring-offset-gray-300 focus:ring-white inline-flex items-center justify-center p-2 text-white rounded-md" aria-controls="mobile-menu" aria-expanded="false" @click="mobileMenu = !mobileMenu">
					<span class="sr-only">Open main menu</span>
					<!--
						Heroicon name: outline/menu

						Menu open: "hidden", Menu closed: "block"
					-->
					<svg class="block w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" :class="{ 'block': !mobileMenu, 'hidden': mobileMenu }">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 6h16M4 12h16m-7 6h7"></path>
					</svg>
					<!--
						Heroicon name: outline/x

						Menu open: "block", Menu closed: "hidden"
					-->
					<svg class="hidden w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" :class="{ 'block': mobileMenu, 'hidden': !mobileMenu }">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</button>
			</div>
		</div>
	</div>

	<!-- Mobile menu, show/hide based on menu state. -->
	<div class="lg:hidden container" x-show="mobileMenu" x-transition:enter="transition-all ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" style="display: none;">
		<div class="pt-2 pb-8 space-y-2">
			<div class="relative rounded-md shadow-sm">
				<form role="search" method="get" action="https://news.sophos.com/en-us/">
					<input type="text" class="focus:ring-blue-600 focus:border-blue-600 sm:text-sm block w-full placeholder-gray-600 border-gray-300 rounded-md" placeholder="Search News" name="s">
					<div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
						<button class="p-1 text-gray-500 rounded-full" type="submit">
							<span class="sr-only">Search</span>
							<!-- Heroicon name: outline/bell -->
							<svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
							</svg>
						</button>
					</div>
				</form>
			</div>

			<ul id="menu-en-us-primary-1" class="mobile-menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77773"><a href="https://news.sophos.com/en-us/category/products-services/">Products &amp; Services<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77772"><a href="https://news.sophos.com/en-us/category/security-operations/">Security Operations<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-77774"><a href="https://news.sophos.com/en-us/category/threat-research/">Threat Research<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77775"><a href="https://ai.sophos.com">AI Research<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77776"><a href="https://nakedsecurity.sophos.com">Security News<div class="menu-item-description"></div></a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-83702"><a href="https://news.sophos.com/en-us/category/sophos-life/">Sophos Life<div class="menu-item-description"></div></a></li>
</ul>		</div>
	</div>
</header>

	<div id="content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-84215" class="post-84215 post type-post status-publish format-standard has-post-thumbnail hentry category-sophoslabs-uncut tag-emotet tag-obfuscation tag-secops region-en-us">

		<div class="md:mt-16 container mt-8">
		<div class="relative max-w-5xl mx-auto">
				<div class="aspect-w-16 aspect-h-9 flex bg-gray-400 bg-right bg-no-repeat bg-cover">
					<img width="1000" height="680" src="https://news.sophos.com/wp-content/uploads/2022/04/shutterstock_105181163.jpg?w=1000" class="object-cover wp-post-image" alt="" srcset="https://news.sophos.com/wp-content/uploads/2022/04/shutterstock_105181163.jpg 1000w, https://news.sophos.com/wp-content/uploads/2022/04/shutterstock_105181163.jpg?resize=300,204 300w, https://news.sophos.com/wp-content/uploads/2022/04/shutterstock_105181163.jpg?resize=768,522 768w" sizes="(max-width: 1000px) 100vw, 1000px">				</div>
								<div class="left-8 w-28 h-28 lg:left-12 xl:left-16 lg:w-40 lg:h-40 place-items-center absolute top-0 grid  ">
										<img src="https://news.sophos.com/wp-content/uploads/2021/05/Category-Icon-Threat-Research@2x.min_.png" alt="SophosLabs Uncut">
														</div>
						</div>
	</div>


			
	<header>
		<div class="container mt-8 md:mt-16 md:-mb-4">
			<div class="max-w-4xl mx-auto">

				<h1 class="text-style-h1 mb-8">Attacking Emotet’s Control Flow Flattening</h1>
									<div class="text-xl md:text-2xl -mt-2 mb-6">
						Sweeping aside one obfuscation technique in a notorious strain of malware					</div>
				
				<div class="text-xl md:text-xl -mt-2">
					<span class="byline">
		Written by 				<span class="author vcard">
				<a href="https://news.sophos.com/en-us/author/andreas-klopsch/" title="Posts by Andreas Klopsch" class="author url fn" rel="author">Andreas Klopsch</a>				</span>
								</span>
						</div>

				<div class="text-sophos-gray-600 mt-4 text-xs font-sansSemiBold font-semibold leading-tight uppercase">
					<span class="posted-on"><a href="https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/" rel="bookmark">May 04, 2022</a></span>				</div>

				<div class="mt-6 space-y-2 space-x-1">
					<a href="https://news.sophos.com/en-us/category/threat-research/sophoslabs-uncut/" class="category-tag-pill">SophosLabs Uncut</a> <a href="https://news.sophos.com/en-us/tag/emotet/" class="category-tag-pill">emotet</a> <a href="https://news.sophos.com/en-us/tag/obfuscation/" class="category-tag-pill">obfuscation</a> <a href="https://news.sophos.com/en-us/tag/secops/" class="category-tag-pill">SecOps</a>				</div>
			</div>
		</div>
	</header><!-- .entry-header -->

	<div class="container md:my-16 xl:my-24 my-8">
	<div class="entry-content lg:prose-lg mx-auto prose max-w-4xl">
		
<p>Emotet has been one of the most professional and long-lasting cybercrime services and malware infections in the threat landscape. Notorious since shortly after its debut in 2014, the botnet was disrupted in January 2021 by a multinational law enforcement effort that sidelined its activity for almost a year. Unfortunately, in November 2021 the botnet re-emerged and once again began to appear on Sophos’ radar.</p>
<p>To protect our customers, SophosLabs is always looking for the most significant techniques, tactics, and procedures used to distribute and deliver Emotet. In this post, we’ll look at Control Flow Flattening (CFF), one of several obfuscation tactics Emotet’s developers use to make detection and reverse engineering of the malware’s payload more difficult. We’ll provide a brief example of CFF applied to a simple hello-world program, and then discuss how Sophos researchers address CFF in Emotet’s code. We’ll finish by summarizing the challenges and problems we encountered during research.</p>
<p>Emotet’s internals have been covered by many researchers, but we have not seen discussions on de-obfuscating its use of Control Flow Flattening so far.</p>
<p><b><span data-contrast="auto">Emotet: Resurgence and Tenacity</span></b><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}">&nbsp;</span></p>
<p><span data-contrast="auto">Figure 1 shows the volume of Emotet payloads detected in our sandbox systems in the first quarter of 2022. As the chart shows, we receive multiple Emotet submissions daily; we believe that the recurring larger spikes result from large-scale campaigns being kicked off by the malware’s distributors. This is a sensible assumption; Emotet is mainly distributed via email spam, and more malicious emails naturally lead to more sandbox submissions. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}">&nbsp;</span></p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/PIcture1-1a.png"><img loading="lazy" class="alignnone size-full wp-image-84355" src="https://news.sophos.com/wp-content/uploads/2022/04/PIcture1-1a.png" alt="Timeline showing Emotet sandbox trends during the first quarter of 2022" width="640" height="239" srcset="https://news.sophos.com/wp-content/uploads/2022/04/PIcture1-1a.png 1665w, https://news.sophos.com/wp-content/uploads/2022/04/PIcture1-1a.png?resize=300,112 300w, https://news.sophos.com/wp-content/uploads/2022/04/PIcture1-1a.png?resize=768,286 768w, https://news.sophos.com/wp-content/uploads/2022/04/PIcture1-1a.png?resize=1024,382 1024w, https://news.sophos.com/wp-content/uploads/2022/04/PIcture1-1a.png?resize=1536,573 1536w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">1</span></i><i><span data-contrast="none">: Timeline of 2022 Emotet detections in SophosLabs’ sandbox systems</span></i><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200,&quot;335559740&quot;:240}">&nbsp;</span></p>
<p><span data-contrast="auto">In addition to Emotet’s delivery mechanism and prevalence, we also analyze the final payload in depth. Thus, we noticed Control Flow Flattening in an unpacked Emotet sample.&nbsp; Control Flow Flattening hides program flow by putting all function blocks next to each other. It is a well-known obfuscation technique used to conceal the purpose of software. While extracting the original code from a flattened binary is inherently challenging, we have successfully adapted some existing toolsets to deobfuscate the majority of Emotet payload functionality.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}">&nbsp;</span></p>
<p><strong>What is Control Flow Flattening?</strong></p>
<p>Control Flow Flattening is a technique that aims to obfuscate program flow by taking away tidy program structures in favor of putting the program blocks inside a loop with a single switch statement controlling program flow.</p>
<p>First, the body of the function is broken into basic blocks, and then the blocks are put next to each other on the same level. A visualization of this transformation can be seen in Figure 2. Control Flow Flattening can be combined with other obfuscation techniques, such as API Hashing or String Encryption. Some of the most prominent obfuscators for flattening functions are <a href="https://github.com/obfuscator-llvm/obfuscator/wiki">OLLVM</a> and <a href="http://tigress.cs.arizona.edu/">Tigress</a>.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture2-1.png"><img loading="lazy" class="alignnone size-full wp-image-84224" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture2-1.png" alt="Comparing a flattened and non-flattened control flow graph (CFG)" width="606" height="305" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture2-1.png 606w, https://news.sophos.com/wp-content/uploads/2022/04/Picture2-1.png?resize=300,151 300w" sizes="(max-width: 606px) 100vw, 606px"></a></p>
<p><em>Figure 2: Comparing a flattened and non-flattened control flow graph (CFG)</em></p>
<p>Let’s take a quick look at a simplified example of CFF in action.</p>
<p><strong>Flattening Hello World</strong></p>
<p>For demonstration purposes, we’ve compiled a simple program written in C. On the left side of Figure 3, an annotated control flow graph (CFG) of the binary is shown. On the right side you can see the decompiled output generated by the Hex-Rays Decompiler.</p>
<p>In this figure, no obfuscation techniques have been applied. The Hex-Rays Decompiler has no trouble generating an easy-to-read high-level language representation of the disassembly. Even without a decompiler, an experienced reverse engineer can simply follow the control flow graph to understand its purpose.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture3-1.png"><img loading="lazy" class="alignnone size-full wp-image-84225" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture3-1.png" alt="Control Flow Graph and decompiled output of sample program" width="602" height="315" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture3-1.png 602w, https://news.sophos.com/wp-content/uploads/2022/04/Picture3-1.png?resize=300,157 300w" sizes="(max-width: 602px) 100vw, 602px"></a></p>
<p><em>Figure 3: Control Flow Graph and decompiled output of sample program</em></p>
<p>Now we’ll flatten the function and compare the results. Figure 4 displays the CFG and decompiled output after Control Flow Flattening was applied. On the left side, we see that the number of basic blocks has more than doubled, and reading the decompiled output is not possible any more without spending a significant amount of time analyzing it.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture4-1.png"><img loading="lazy" class="alignnone size-full wp-image-84227" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture4-1.png" alt="Annotated example of a flattened function" width="640" height="245" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture4-1.png 724w, https://news.sophos.com/wp-content/uploads/2022/04/Picture4-1.png?resize=300,115 300w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p><em>Figure 4: Annotated example of a flattened function</em></p>
<p>Overall, CFF introduces the following problems to hamper our analysis:</p>
<ul>
<li>The control flow is concealed. Instead of being able to follow the blocks, a control flow dispatcher block is implemented. This block determines which blocks are executed next.</li>
<li>A state variable annotated as <code>stateVar </code>in the decompiled output is updated with high entropy variables throughout the function. The state variable is used by the control flow dispatcher to decide which block gets executed next.</li>
<li>The two problems above lead to a highly complex decompiled output. While it is still possible to follow the execution flow, the time and effort needed to understand the function is significantly larger than it would be compared to the decompiled output in Figure 3.</li>
</ul>
<p><strong>Unflattening Emotet</strong></p>
<p>To deobfuscate Emotet’s use of Control Flow Flattening, we started with a review of existing tools and research on CFG deobfuscation. Some of those include:</p>
<ul>
<li><a href="https://hex-rays.com/blog/hex-rays-microcode-api-vs-obfuscating-compiler/">Hex-Rays Microcode API vs. Obfuscating Compiler</a> by Rolf Rolles</li>
<li><a href="https://blogs.vmware.com/security/2019/02/defeating-compiler-level-obfuscations-used-in-apt10-malware.html">Defeating Compiler-Level Obfuscations used in APT10 Malware</a> by VMWare’s Threat Analysis Unit</li>
<li><a href="https://blog.quarkslab.com/deobfuscation-recovering-an-ollvm-protected-program.html">Deobfuscation: recovering an OLLVM-protected program</a> by Francis Gabriel of Quarkslab</li>
<li><a href="https://eshard.com/posts/D810-a-journey-into-control-flow-unflattening">D810: A journey into control flow unflattening</a> by Boris Batteaux of eShard</li>
</ul>
<p>For deeper dives into the algorithm behind CFG Unflattening, the articles referenced above provide a wealth of information.</p>
<p>In Figure 5 you can see the decompiled output and CFG of a function in an unpacked Emotet sample. Excluding the Control Flow Flattening applied here, the output might seem confusing, because Emotet applies more than just one obfuscation technique. (If you are not familiar with those other techniques, an appendix at the end of this article briefly explains the other obfuscation techniques .)</p>
<p>First, the function calls OpenSCManagerA to retrieve a handle to the Service Control Manager. Next, it calls OpenServiceW to open an existing service. If opening the service succeeds, the opened service will be deleted via DeleteService. Finally, the opened handles will be closed. If the service was deleted successfully, the function returns 1, otherwise 0.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture5-1.png"><img loading="lazy" class="alignnone size-full wp-image-84228" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture5-1.png" alt="Annotated example of a flattened function" width="640" height="300" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture5-1.png 645w, https://news.sophos.com/wp-content/uploads/2022/04/Picture5-1.png?resize=300,140 300w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p><em>Figure 5: Annotated example of a flattened function</em></p>
<p>If we compare the decompiled output of Figure 3 and Figure 4, we can see multiple similarities, and we can identify the CFG dispatcher again. In the decompiled output, we see a variable we annotated as <code>stateVar</code>. Like the output in Figure 3, this is our state variable that is constantly updated and used by the dispatcher to determine which block is executed next.</p>
<p>On a high level, if we want to restore the control flow, we need to:</p>
<ol>
<li>Identify the dispatcher block and states</li>
<li>For each block, identify the corresponding constant and find the address of the next block to execute based on dispatcher and state variable value</li>
<li>Patch the outbound dispatcher blocks to jump to the address of the original next block</li>
</ol>
<p>Instead of patching and operating on the disassembly directly, we make use of the Hex-Rays Microcode API. Microcode is an intermediate language used by the Hex-Rays decompiler. During decompilation, the decompiler steps through different maturity phases. The different phases are displayed in Figure 6 below. The API allows us to hook the decompilation progress and operate on the microcode instead of patching the disassembly directly.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture6.png"><img loading="lazy" class="alignnone size-full wp-image-84229" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture6.png" alt="IDA Microcode maturity levels" width="601" height="363" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture6.png 601w, https://news.sophos.com/wp-content/uploads/2022/04/Picture6.png?resize=300,181 300w" sizes="(max-width: 601px) 100vw, 601px"></a></p>
<p><em>Figure 6: IDA Microcode maturity levels</em></p>
<p><strong>Adjusting the Tool</strong></p>
<p>We used an IDAPython fork of the Rolf Rolles’ HexRaysDeob tool as our foundation. Like the fork, we are operating solely on the maturity level MMAT_LOCOPT, the third level in the figure above. As seen in Figure 6, that maturity level includes information about inbound and outbound blocks, which are necessary to correctly identify dispatcher blocks. Furthermore, the original code was based around the MMAT_LOCOPT layer. Changing the layer would have required plenty more investigation, verification, and adjustments of the existing code than keeping the layer. Below is a summarization of changes we applied on the existing code base.</p>
<p><strong>Handling Multiple/Related Dispatchers</strong></p>
<p>In multiple functions, running the deobfuscation algorithm on a single dispatcher did not generate an output we were satisfied with. Analysis showed that more complex functions might contain multiple nested dispatchers instead of one. We added additional logic to identify and run the algorithm on multiple dispatchers. This option can be turned on or off by setting the RUN_MLTPL_DISPATCHERS flag to True or False. In Figure 7 below, you can see an example of a function with two potential dispatchers.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture7.png"><img loading="lazy" class="alignnone size-full wp-image-84231" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture7.png" alt="Example of a function of two potential dispatchers" width="598" height="406" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture7.png 598w, https://news.sophos.com/wp-content/uploads/2022/04/Picture7.png?resize=300,204 300w" sizes="(max-width: 598px) 100vw, 598px"></a></p>
<p><em>Figure 7: Example of a function with two potential dispatchers</em></p>
<p><strong>Risky Search for the Cluster Head</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>A flattened block might be implemented by multiple microcode blocks. To find the end of the region, the original algorithm by Rolf Rolles generates a dominator tree and uses the generated information to determine the end of a region, or the beginning of a cluster. In some cases, the algorithm failed to find the cluster head. We added an additional function to determine the cluster head as a fallback. We believe that the original algorithm by Rolf Rolles is more reliable; however, evaluation showed that the fallback algorithm still led to good results and improved the decompiled output.</p>
<p><strong>Adding Additional Patterns and Small Code Updates</strong></p>
<p>In some cases, the existing logic failed in patching all flattened blocks. After analyzing multiple functions, we identified various patterns that reoccurred throughout the whole binary. We added additional logic to identify and unflatten blocks following these patterns to the existing code base. Finally, we adjusted the overall code a little. Some of the changes include:</p>
<ul>
<li>The IDAPython fork of Rolf Rolles´ HexRaysDeob tool was based on Python2.7. We updated several parts of the code to match Python3 standards.</li>
<li>In the original version of the tool, if the “run” function was invoked once, the plugin got activated and if the tool determined the function as flattened via an algorithm, it attempted to unflatten it. During implementation and testing, we experienced crashes of IDA Pro when using the IDAPython microcode API. This might lead to a corrupted IDB database. As an additional safety mechanism, the address of the target function must be added to the array “white_list” to allow unflattening. Overall, we recommend saving often and keeping a separate IDB copy when using the tool.</li>
</ul>
<p>Out of 254 functions, we categorized 68 functions as flattened. From these 68 functions, we were able to unflatten 38 successfully. Nineteen functions were partially flattened, and 11 functions failed. By “unflattened successfully,” we mean cases in which our script failed to unflatten a maximum of 3 states. “Partially unflattened” means that most of the function remains flattened, but our tool was able to unflatten some blocks. Finally, “failed” means that we were not able to deobfuscate a single block in the function.</p>
<p>Figure 8 below shows the function from Figure 5 after our script was applied.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture8.png"><img loading="lazy" class="alignnone size-full wp-image-84232" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture8.png" alt="Analyzed function after the CFG unflattening tool was applied" width="640" height="404" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture8.png 751w, https://news.sophos.com/wp-content/uploads/2022/04/Picture8.png?resize=300,189 300w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p><em>Figure 8: Analyzed function after the CFG unflattening tool was applied</em></p>
<p><strong>IoCs</strong></p>
<table>
<tbody>
<tr>
<td width="301">
<p><strong>Description</strong></p>
</td>
<td width="301">
<p><strong>SHA256</strong></p>
</td>
</tr>
<tr>
<td width="301">
<p>Packed Emotet</p>
</td>
<td width="301">
<p><strong>9a0286ec0a3e7ea346759c9497c8b5c7c212fa2c780a1cabb094134bf492a51b</strong></p>
</td>
</tr>
<tr>
<td width="301">
<p>Unpacked Emotet</p>
</td>
<td width="301">
<p>1bbce395c839c737fdc983534b963a1521ab9693a5b585f15b8a4950adea5973</p>
</td>
</tr>
</tbody>
</table>
<p><strong>&nbsp;</strong></p>
<p>Our unflattening tool is <a href="https://github.com/sophoslabs/emotet_unflatten_poc">now available</a> on the SophosLabs Github. <span class="TextRun SCXW235147564 BCX0" lang="EN-GB" xml:lang="EN-GB" data-contrast="auto"><span class="NormalTextRun SCXW235147564 BCX0">(For those interested in such things, we also recommend to your attention a </span></span><a class="Hyperlink SCXW235147564 BCX0" href="https://github.com/eset/stadeo" target="_blank" rel="noreferrer noopener"><span class="TextRun Underlined SCXW235147564 BCX0" lang="EN-GB" xml:lang="EN-GB" data-contrast="none"><span class="NormalTextRun SCXW235147564 BCX0" data-ccp-charstyle="Hyperlink">CFF-unpacking tool</span></span></a><span class="TextRun SCXW235147564 BCX0" lang="EN-GB" xml:lang="EN-GB" data-contrast="auto"><span class="NormalTextRun SCXW235147564 BCX0"> released by ESET several years back to address control-flow flattening&nbsp;in the </span><span class="NormalTextRun SpellingErrorV2 SCXW235147564 BCX0">Stantinko</span><span class="NormalTextRun SCXW235147564 BCX0"> botnet – another example of why, since attackers freely share tactics, techniques, and procedures among themselves, defenders are wise to do the same.)</span></span></p>
<p><strong>Conclusion and Limitations</strong></p>
<p>Control Flow Flattening is a complex topic, and the purpose of this article is to share our experience and results attacking Emotet’s Control Flow Flattening. While we made multiple adjustments and met with some success, our solution is not able to deobfuscate all functions completely. &nbsp;Among the outstanding issues:</p>
<ul>
<li>The algorithm to detect nested dispatchers is simple. Therefore, we have added an option to turn it on and off. In rare cases, a faulty output is generated if the nested dispatcher is enabled.</li>
<li>In many functions, we had to deal with conditional states. Depending on the outcome of, for example, a WINAPI function, the state variable changes to a different value at runtime. Additional patching and insertion of microcode instructions would be needed to unflatten these conditional blocks.</li>
<li>Our main approach was to add logic for reoccurring patterns in the binary. As our work progressed, we realized that a microcode emulator might have been a better choice, or would have been an adjustment that led to more unflattened blocks.</li>
<li>During development and evaluation, we experienced multiple crashes. We are all humans and we make mistakes, so some crashes will result from bugs in our code. However, judging from the error messages, we believe that there is a deeper-rooted problem in the Python port of the Microcode API. Therefore, we recommend saving often and keeping a copy of the IDB file.</li>
</ul>
<p>Overall, we recommend that researchers always cross-check their results and not trust the output blindly. Control Flow Flattening used in conjunction with other obfuscation techniques certainly complicates the process of reverse engineering Emotet, but the technique we’ve described helps to even the odds against researchers examining this high-profile malware.</p>
<h2><strong>Appendix: Emotet and Code Obfuscation</strong></h2>
<p>When sharing the decompiled output of functions in an Emotet sample, it is impossible not to encounter other Emotet obfuscation techniques beyond CFF. This appendix covers the most prevalent obfuscation techniques we have identified in an unpacked Emotet sample. Keep in mind that Emotet is usually delivered in a packed form and needs to be unpacked first.</p>
<p><strong>String Encryption</strong></p>
<p>Emotet contains encrypted strings in its unpacked form. Before usage, strings will be decrypted and freed again right after each serves its purpose.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture9.png"><img loading="lazy" class="alignnone size-full wp-image-84233" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture9.png" alt="Cross references of DecryptString function with corresponding decrypted string" width="632" height="156" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture9.png 632w, https://news.sophos.com/wp-content/uploads/2022/04/Picture9.png?resize=300,74 300w" sizes="(max-width: 632px) 100vw, 632px"></a></p>
<p><em>Figure 9: Cross references of DecryptString function with corresponding decrypted string</em></p>
<p><strong>API Hashing</strong></p>
<p>Emotet uses API Hashing to conceal the usage of API functions. The malware calculates the hash of exported function names for a given DLL. If the calculated hash matches the constant pushed onto the stack at method invocation, the pointer to the exported function will be retrieved.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture10.png"><img loading="lazy" class="alignnone size-full wp-image-84235" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture10.png" alt="Disassembly of ApiHash function invocation" width="503" height="314" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture10.png 503w, https://news.sophos.com/wp-content/uploads/2022/04/Picture10.png?resize=300,187 300w" sizes="(max-width: 503px) 100vw, 503px"></a></p>
<p><em>Figure 10: Disassembly of ApiHash function invocation</em></p>
<p>In most cases, API Hashing calls and their corresponding dynamic call are wrapped into separate functions. We have automated this analysis, and functions with prefix DYN_ are functions determined at runtime via API Hashing.</p>
<p><strong>Junk Instructions</strong></p>
<p>Emotet embeds junk instructions to confuse reverse engineers. Junk instructions are instructions that do not serve any purpose except to complicate and slow down analysis. Figure 11 below shows an example of a junk instruction block.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture11.png"><img loading="lazy" class="alignnone size-full wp-image-84236" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture11.png" alt="Example of junk instructions in unpacked Emotet sample" width="410" height="292" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture11.png 410w, https://news.sophos.com/wp-content/uploads/2022/04/Picture11.png?resize=300,214 300w" sizes="(max-width: 410px) 100vw, 410px"></a></p>
<p><em>Figure 11: Example of junk instructions in unpacked Emotet sample</em></p>
<p><strong>Stack Obfuscation</strong></p>
<p>Another interesting technique that confuses the IDA decompiler is the way in which Emotet passes parameters to functions. In Figure 12 below, we show how DYN_BCryptEncrypt is invoked.</p>
<p>DYN_BCryptEncrypt first resolves the API function BCryptEncrypt and stores the pointer to this function in register EAX. The function is then called via call EAX. Instead of just pushing the necessary parameters, this method pushes values onto the stack not being used by the actual EAX call. This leads to generation of a function signature that is much harder to read than normal.</p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture12.png"><img loading="lazy" class="alignnone size-full wp-image-84237" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture12.png" alt="Multiple values being pushed onto the stack before DYN_BCryptEncrypt is invoked" width="640" height="255" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture12.png 723w, https://news.sophos.com/wp-content/uploads/2022/04/Picture12.png?resize=300,120 300w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p><em>Figure 12: Multiple values being pushed onto the stack before DYN_BCryptEncrypt is invoked</em></p>
<p><a href="https://news.sophos.com/wp-content/uploads/2022/04/Picture13.png"><img loading="lazy" class="alignnone size-full wp-image-84238" src="https://news.sophos.com/wp-content/uploads/2022/04/Picture13.png" alt="Corresponding generated function signature" width="640" height="212" srcset="https://news.sophos.com/wp-content/uploads/2022/04/Picture13.png 752w, https://news.sophos.com/wp-content/uploads/2022/04/Picture13.png?resize=300,99 300w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p><em>Figure 13: Corresponding generated function signature</em></p>
<p>&nbsp;</p>
			</div>
	<div class="mt-12">
		
<ul id="social-sharing" class="flex justify-center items-center space-x-6">
	<li class="facebook">
		<a class="js-share-modal" href="http://www.facebook.com/share.php?u=https://news.sophos.com/?p=84215&amp;title=Attacking%20Emotet’s%20Control%20Flow%20Flattening" data-title="Attacking Emotet’s Control Flow Flattening" title="Share on Facebook">
				<span class="sr-only">Share on Facebook</span>
				<svg width="8" height="16" xmlns="http://www.w3.org/2000/svg" class="text-sophos-gray-600 hover:text-black" fill="currentColor">
					<path d="M7.145 8.006H4.903V16H1.581V8.006H0V5.182h1.581V3.354C1.581 2.045 2.202 0 4.933 0l2.461.01v2.742H5.608c-.291 0-.705.145-.705.77v1.66h2.533l-.291 2.824z" fill-rule="nonzero"></path>
				</svg>
		</a>
	</li>
	<li class="twitter">
		<a class="js-share-modal" href="http://twitter.com/intent/tweet?text=Attacking%20Emotet%E2%80%99s%20Control%20Flow%20Flattening%20https%3A%2F%2Fnews.sophos.com%2F%3Fp%3D84215" data-title="" title="Share on Twitter">
				<span class="sr-only">Share on Twitter</span>
				<svg width="14" height="13" xmlns="http://www.w3.org/2000/svg" class="text-sophos-gray-600 hover:text-black" fill="currentColor">
					<path d="M12.567 3.238c.007.141.01.281.01.424 0 4.338-2.89 9.34-8.173 9.34-1.623 0-3.132-.543-4.403-1.475.225.03.453.045.685.045 1.346 0 2.584-.523 3.566-1.404-1.255-.028-2.317-.977-2.682-2.28a2.56 2.56 0 001.296-.056C1.554 7.53.562 6.203.562 4.613v-.04c.389.245.83.392 1.302.41C1.094 4.393.587 3.387.587 2.25c0-.602.142-1.166.388-1.65 1.416 1.986 3.534 3.292 5.92 3.43a3.735 3.735 0 01-.074-.749c0-1.813 1.286-3.28 2.873-3.28.825 0 1.572.397 2.096 1.034a5.324 5.324 0 001.824-.797c-.215.768-.67 1.41-1.263 1.816a5.178 5.178 0 001.65-.515 6.362 6.362 0 01-1.434 1.7" fill-rule="nonzero"></path>
				</svg>
		</a>
	</li>
	<li class="linkedin">
		<a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/" data-title="Attacking Emotet’s Control Flow Flattening" title="Share on LinkedIn" onclick="window.open(this.href, '', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;">
			<span class="sr-only">Share on LinkedIn</span>
			<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" class="text-sophos-gray-600 hover:text-black" fill="currentColor">
				<path d="M16 15.293h-3.43v-5.52c0-1.386-.496-2.334-1.738-2.334-.946 0-1.512.64-1.76 1.256-.09.22-.113.526-.113.836v5.762H5.53s.044-9.35 0-10.316h3.43v1.46c.456-.705 1.27-1.703 3.091-1.703 2.256 0 3.95 1.473 3.95 4.643v5.916zM1.917 3.566h-.022C.745 3.566 0 2.773 0 1.783 0 .772.768 0 1.94 0c1.173 0 1.896.772 1.917 1.783 0 .99-.744 1.783-1.94 1.783zM.202 15.293h3.431V4.977H.203v10.316z" fill-rule="nonzero"></path>
			</svg>
		</a>
	</li>
	<li class="comments">
		<a href="#comments" title="Leave a Reply" class="flex items-center space-x-1">
			<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" class="text-sophos-gray-600 hover:text-black" fill="currentColor">
				<path d="M8.5 0a7.5 7.5 0 11-3.916 13.898C3.317 15.273 1.773 15.36.256 15.135c1.011-1.185 1.678-2.357 2-3.517l-.007.027A7.5 7.5 0 018.5 0z" fill-rule="evenodd"></path>
			</svg>
					</a>
	</li>
</ul>

			</div><!-- .entry-social -->
	</div>

</article><!-- #post-## -->

			<div class="container my-8 md:my-16">
				<div class="max-w-4xl mx-auto">
					<div class="article-author-block article-co-authors-block">
	
					<div class="author-block">
				<div class="author-block__profile">
					<img width="200" height="200" src="https://news.sophos.com/wp-content/uploads/2022/04/Andreas-Klopsch.png?w=200" class="avatar avatar-400 photo wp-post-image" alt="">				</div> <!-- .author-profile -->

				<div class="author-block__wrapper">
					<div class="author-block__content">

													<div class="author-block__about">
								About the Author							</div>
						
						<h3 class="author-block__name">
						<a href="https://news.sophos.com/en-us/author/andreas-klopsch/" title="Posts by Andreas Klopsch" class="author url fn" rel="author">Andreas Klopsch</a>						</h3>

						
							<div class="author-block__bio">
								<p>Andreas Klopsch (@hackingump1), a threat researcher at Sophos, is currently completing a master's degree in cybersecurity at the Institute of IT Security at the Westfällische Hochschule in Gelsenkirchen.</p>
							</div> <!-- .author-bio -->

					</div>
				</div>

			</div> <!-- .author-block-container -->
		
		</div>
				</div>
			</div>

			
<div class="pb-24 bg-white">
<div class="container">
<div class="max-w-5xl mx-auto">

			
			<h3 class="text-style-h2 md:my-8 my-4">
				Read Similar Articles			</h3>

			<div class="article-grid article-grid--3-column">
				<!-- Article -->
<article id="post-75410" class="hover:shadow-lg dark:bg-sophos-gray-900 border-sophos-gray-200 flex flex-col overflow-hidden text-gray-700 transition-all bg-white border rounded-md shadow-md post-75410 post type-post status-publish format-standard has-post-thumbnail hentry category-security-operations tag-encryption tag-mtr tag-ransomware tag-security tag-sidebar tag-sophos-rapid-response region-en-us">
	<!-- Image -->
	<a class="aspect-w-16 aspect-h-9 flex block bg-gray-400 bg-right bg-no-repeat bg-cover" href="https://news.sophos.com/en-us/2021/05/24/what-to-expect-when-youve-been-hit-with-avaddon-ransomware/" rel="bookmark" style="
			background-image: url('https://news.sophos.com/wp-content/uploads/2021/05/sophos-ransomware-web-banner-1200x628px-option-2.png?w=640');
		"></a>

	<!-- Wrapper -->
	<div class="flex flex-col justify-between flex-grow">

		<!-- Content -->
		<div class="sm:px-8 sm:py-8 p-4 py-6">
			<!-- Date -->
			<div class="text-sophos-blue-600 font-sansMedium mb-2 text-xs leading-tight uppercase truncate">
				May 24, 2021			</div>
			<!-- Post Title -->
				<h2 class="text-style-h2 line-clamp-3 sm:mb-4 sm:text-2xl sm:leading-snug text-lg leading-tight text-gray-700"><a href="https://news.sophos.com/en-us/2021/05/24/what-to-expect-when-youve-been-hit-with-avaddon-ransomware/" rel="bookmark" class="dark:text-white font-sansSemiBold font-semibold text-gray-900 no-underline cursor-pointer">What to expect when you’ve been hit with Avaddon ransomware</a></h2>			<!-- Excerpt -->
						</div>

			</div>
</article>
<!-- Article -->
<article id="post-75301" class="hover:shadow-lg dark:bg-sophos-gray-900 border-sophos-gray-200 flex flex-col overflow-hidden text-gray-700 transition-all bg-white border rounded-md shadow-md post-75301 post type-post status-publish format-standard has-post-thumbnail hentry category-products-services tag-intercept-x tag-sidebar tag-sophos-edr tag-sophos-xdr region-en-us">
	<!-- Image -->
	<a class="aspect-w-16 aspect-h-9 flex block bg-gray-400 bg-right bg-no-repeat bg-cover" href="https://news.sophos.com/en-us/2021/05/19/whats-new-in-sophos-edr-4-0/" rel="bookmark" style="
			background-image: url('https://news.sophos.com/wp-content/uploads/2021/05/sophos-edr-news-blog-image-838x440px@2x.png?w=640');
		"></a>

	<!-- Wrapper -->
	<div class="flex flex-col justify-between flex-grow">

		<!-- Content -->
		<div class="sm:px-8 sm:py-8 p-4 py-6">
			<!-- Date -->
			<div class="text-sophos-blue-600 font-sansMedium mb-2 text-xs leading-tight uppercase truncate">
				May 19, 2021			</div>
			<!-- Post Title -->
				<h2 class="text-style-h2 line-clamp-3 sm:mb-4 sm:text-2xl sm:leading-snug text-lg leading-tight text-gray-700"><a href="https://news.sophos.com/en-us/2021/05/19/whats-new-in-sophos-edr-4-0/" rel="bookmark" class="dark:text-white font-sansSemiBold font-semibold text-gray-900 no-underline cursor-pointer">What’s New in Sophos EDR 4.0</a></h2>			<!-- Excerpt -->
						</div>

			</div>
</article>
<!-- Article -->
<article id="post-75396" class="hover:shadow-lg dark:bg-sophos-gray-900 border-sophos-gray-200 flex flex-col overflow-hidden text-gray-700 transition-all bg-white border rounded-md shadow-md post-75396 post type-post status-publish format-standard has-post-thumbnail hentry category-products-services tag-sidebar tag-sophos-xdr tag-xdr region-en-us">
	<!-- Image -->
	<a class="aspect-w-16 aspect-h-9 flex block bg-gray-400 bg-right bg-no-repeat bg-cover" href="https://news.sophos.com/en-us/2021/05/19/sophos-xdr-driven-by-data/" rel="bookmark" style="
			background-image: url('https://news.sophos.com/wp-content/uploads/2021/05/sophos-xdr.png?w=640');
		"></a>

	<!-- Wrapper -->
	<div class="flex flex-col justify-between flex-grow">

		<!-- Content -->
		<div class="sm:px-8 sm:py-8 p-4 py-6">
			<!-- Date -->
			<div class="text-sophos-blue-600 font-sansMedium mb-2 text-xs leading-tight uppercase truncate">
				May 19, 2021			</div>
			<!-- Post Title -->
				<h2 class="text-style-h2 line-clamp-3 sm:mb-4 sm:text-2xl sm:leading-snug text-lg leading-tight text-gray-700"><a href="https://news.sophos.com/en-us/2021/05/19/sophos-xdr-driven-by-data/" rel="bookmark" class="dark:text-white font-sansSemiBold font-semibold text-gray-900 no-underline cursor-pointer">Sophos XDR: Driven by data</a></h2>			<!-- Excerpt -->
						</div>

			</div>
</article>
			</div>

	
</div>
</div>
</div> <!-- #secondary -->

			
<div class="bg-sophos-gray-50 px-4 pt-16 pb-8" id="comments">

	
	
	<div class="container max-w-2xl py-6 md:py-16">
			<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/en-us/2022/05/04/attacking-emotets-control-flow-flattening/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://news.sophos.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate=""><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> <span class="required-field-message" aria-hidden="true">Required fields are marked <span class="required" aria-hidden="true">*</span></span></p><p class="comment-form-comment"><label for="comment">Comment <span class="required" aria-hidden="true">*</span></label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required=""></textarea></p><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245"></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200"></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes"> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<input type="hidden" name="redirect_to" value="https://news.sophos.com/en-us/2022/05/04/attacking-emotets-control-flow-flattening/" id="redirect_to"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="84215" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="2b637d3349"></p><p style="display: none !important;"><label>Δ<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js_1" name="ak_js" value="1651691733459"><script>document.getElementById( "ak_js_1" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form>	</div><!-- #respond -->
		</div>

</div><!-- #comments -->
</main></div><!-- #comments -->

		
		<!-- #main -->
	</div><!-- #primary -->


	</div> <!-- #content -->

	

<div class="bg-sophos-gray-50 md:py-16 px-4" x-data="subscribeForm()">
	<div class="container max-w-2xl" x-show="!subscribed">
	<div class="text-style-h2-lg">
		Subscribe to get the latest updates in your inbox.	</div>
	<form action="">
		<div class="flex flex-col my-6">
		<input type="text" placeholder="name@email.com" class="w-full" x-model="email" x-on:keydown="resetErrors()" required="">
		<div x-show="message" x-text="message" class="font-sansMedium px-4 py-3 mt-2 text-sm font-medium text-white bg-black border rounded-md" style="display: none;"></div>
		</div>
		<div class="mb-4 text-lg">
			Which categories are you interested in?		</div>
		<div class="my-2 space-y-1">
		<template x-for="category in Object.entries(categories)" :key="category[0]">
			<div>
			<label x-bind:for="category[1].value" class="inline-flex items-center">
				<input type="checkbox" x-bind:value="category[1].value" x-bind:id="category[1].value" x-bind:name="category[1].value" x-model="subscribeTo">
				<span class="text-style-form-label ml-2" x-text="category[1].name">
				</span>
			</label>
			</div>
		</template>
		
			<div>
			<label x-bind:for="category[1].value" class="inline-flex items-center" for="products-services">
				<input type="checkbox" x-bind:value="category[1].value" x-bind:id="category[1].value" x-bind:name="category[1].value" x-model="subscribeTo" value="products-services" id="products-services" name="products-services">
				<span class="text-style-form-label ml-2" x-text="category[1].name">Products and Services</span>
			</label>
			</div>
		
			<div>
			<label x-bind:for="category[1].value" class="inline-flex items-center" for="threat-research">
				<input type="checkbox" x-bind:value="category[1].value" x-bind:id="category[1].value" x-bind:name="category[1].value" x-model="subscribeTo" value="threat-research" id="threat-research" name="threat-research">
				<span class="text-style-form-label ml-2" x-text="category[1].name">Threat Research</span>
			</label>
			</div>
		
			<div>
			<label x-bind:for="category[1].value" class="inline-flex items-center" for="security-operations">
				<input type="checkbox" x-bind:value="category[1].value" x-bind:id="category[1].value" x-bind:name="category[1].value" x-model="subscribeTo" value="security-operations" id="security-operations" name="security-operations">
				<span class="text-style-form-label ml-2" x-text="category[1].name">Security Operations</span>
			</label>
			</div>
		
			<div>
			<label x-bind:for="category[1].value" class="inline-flex items-center" for="sophos-life">
				<input type="checkbox" x-bind:value="category[1].value" x-bind:id="category[1].value" x-bind:name="category[1].value" x-model="subscribeTo" value="sophos-life" id="sophos-life" name="sophos-life">
				<span class="text-style-form-label ml-2" x-text="category[1].name">#SophosLife</span>
			</label>
			</div>
		</div>
		<div class="mt-6">
		<input type="submit" class="round-button round-button--primary opacity-30 cursor-not-allowed" @click.prevent="submit()" x-bind:value="buttonText()" x-bind:class="{ 'opacity-30 cursor-not-allowed': buttonDisabled() }" x-bind:disabled="buttonDisabled()" value="Subscribe" disabled="disabled">
		</div>
	</form>
	</div>

	<div class="container max-w-2xl" x-show="subscribed &amp;&amp; !loading" style="display: none;">
	<div class="text-style-h2 md:text-3xl mb-4 text-2xl text-center">
		You’re now subscribed!	</div>
	<div class="text-lg text-center" x-text="`Check your email to confirm your subscription.`">Check your email to confirm your subscription.</div>
	</div>
</div>

<script>
	let subscribeForm = function () {
	return {
		config: {
		endpoints: {
			signup:
			"https://sophos-mailchimp-signup.netlify.app/.netlify/functions/newsletter-signup",
		},
		},
		subscribed: false,
		loading: false,
		error: false,
		message: "",
		categories: {
		1: {
			name: decodeURIComponent( 'Products%20and%20Services' ),
			value: "products-services",
		},
		2: {
			name: decodeURIComponent( 'Threat%20Research' ),
			value: "threat-research",
		},
		3: {
			name: decodeURIComponent( 'Security%20Operations' ),
			value: "security-operations",
		},
		4: {
			name: decodeURIComponent( '%23SophosLife' ),
			value: "sophos-life",
		},
		},
		subscribeTo: [],
		email: "",

		reset() {
		this.loading = false;
		if (!this.error) {
			this.email = "";
		}
		},

		resetErrors() {
		this.error = false;
		this.message = "";
		},

		setError(message) {
		this.error = true;
		this.message = message;
		},

		setSuccess(message) {
		this.error = false;
		this.message = message;
		},

		emailIsValid(email) {
		return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
		},

		submit() {
		this.loading = true;
		this.resetErrors();

		const mcList = "8d6471d831";
		const mcLanguage = decodeURIComponent( 'en' );
		const mcTags = [...this.subscribeTo, mcLanguage];

		const payload = {
			email: this.email,
			listId: mcList,
			tags: mcTags,
			language: mcLanguage,
		};

		fetch(this.config.endpoints.signup, {
			method: "POST",
			headers: {
			"Content-Type": "application/json",
			},
			body: JSON.stringify(payload),
		})
			.then((r) => r.json())
			.then((data) => {
			if (data.status === "pending") {
				this.setSuccess(
					decodeURIComponent( 'You%20have%20been%20subscribed.%20Please%20check%20your%20email%20to%20confirm.' )
				);
				this.subscribed = true;
			} else if (
				data.status === "subscribed"
			) {
				this.setSuccess(
					decodeURIComponent( 'You%20are%20already%20subscribed.%20Thank%20you%21' )
				);
			} else {
				this.setError(
					decodeURIComponent( 'We%20could%20not%20subscribe%20you.%20Please%20try%20again.' )
				);
			}
			})
			.catch((e) => {
			this.setError(
				decodeURIComponent( 'We%20could%20not%20subscribe%20you.%20Please%20try%20again.' )
			);
			})
			.finally(() => {
			this.reset();
			});
		},

		buttonText() {
		return this.loading ? decodeURIComponent( 'Please%20Wait' ) : decodeURIComponent( 'Subscribe' );
		},

		buttonDisabled() {
		return (
			this.subscribeTo.length < 1 ||
			!this.emailIsValid(this.email) ||
			this.loading
		);
		},
	};
	};
</script>


	<footer class="bg-white border-t border-sophos-gray-200 " x-data="{ languageMenu: false, privacyMenu: false, legalMenu: false }">
		<div class="container">
			<div class="md:flex-row md:items-center flex flex-col justify-between py-8">
				<div class="flex items-baseline flex-grow space-x-6">
					<!-- Language -->
					
<div class="relative mr-auto">
	<a href="#" class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight" @click.prevent="languageMenu = !languageMenu" @click.away="languageMenu = false">
		Change Region		<svg xmlns="http://www.w3.org/2000/svg" width="8" height="4" class="inline-block transition-transform transform" :class="{'rotate-180': languageMenu }">
			<path fill="#7F8C9D" fill-rule="evenodd" d="M4 2.178L5.915.262a.708.708 0 01.996 0 .702.702 0 010 .995L4.75 3.415A.7.7 0 014 3.94a.702.702 0 01-.751-.524l-2.16-2.158a.702.702 0 11.996-.995L4 2.178z"></path>
		</svg>
	</a>

	<!-- Language Menu -->
	<div class="focus:outline-none border-sophos-gray-200 absolute bottom-0 left-0 w-48 px-4 py-1 py-4 mb-8 -ml-4 origin-bottom-left bg-white border rounded-md shadow-md" role="menu" aria-orientation="vertical" aria-labelledby="user-menu" x-show="languageMenu" x-transition:enter="transition-all ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" style="display: none;">
		<ul class="font-sansMedium text-sophos-gray-600 space-y-1 text-xs font-medium">
											<li>
					<a href="https://news.sophos.com/es-419">
						América Latina					</a>
				</li>
															<li>
					<a href="https://news.sophos.com/pt-br">
						Brasil					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/de-de">
						Deutschland					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/en-us">
						English					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/fr-fr">
						France					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/es-es">
						Iberia					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/it-it">
						Italia					</a>
				</li>
											<li>
					<a href="https://news.sophos.com/ja-jp">
						Japan					</a>
				</li>
									</ul>
	</div>
</div>

					<!-- Terms -->
					<a href="https://www.sophos.com/en-us/legal/sophos-website.aspx" class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block ml-auto text-xs font-medium leading-tight">Terms</a>

					<!-- Privacy -->
					
<span class="relative">
	<a href="#" class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight" @click.prevent="privacyMenu = !privacyMenu" @click.away="privacyMenu = false">
		Privacy
		<svg xmlns="http://www.w3.org/2000/svg" width="8" height="4" class="inline-block transition-transform transform" :class="{'rotate-180': privacyMenu }">
			<path fill="#7F8C9D" fill-rule="evenodd" d="M4 2.178L5.915.262a.708.708 0 01.996 0 .702.702 0 010 .995L4.75 3.415A.7.7 0 014 3.94a.702.702 0 01-.751-.524l-2.16-2.158a.702.702 0 11.996-.995L4 2.178z"></path>
		</svg>
	</a>
	<div class="focus:outline-none border-sophos-gray-200 absolute bottom-0 left-0 w-48 px-4 py-1 py-4 mb-8 -ml-4 origin-bottom-left bg-white border rounded-md shadow-md" role="menu" aria-orientation="vertical" aria-labelledby="user-menu" x-show="privacyMenu" x-transition:enter="transition-all ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" style="display: none;">
		<ul class="font-sansMedium text-sophos-gray-600 space-y-1 text-xs font-medium">
			<li>
				<a href="https://www.sophos.com/en-us/legal/sophos-group-privacy-policy.aspx">
					Privacy Notice				</a>
			</li>
			<li>
				<a href="https://www.sophos.com/en-us/legal/cookie-information.aspx">
					Cookies				</a>
			</li>
		</ul>
	</div>
</span>

					<!-- Legal -->
					
<span class="relative">
	<a href="#" class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight" @click.prevent="legalMenu = !legalMenu" @click.away="legalMenu = false">
		Legal
		<svg xmlns="http://www.w3.org/2000/svg" width="8" height="4" class="inline-block transition-transform transform" :class="{'rotate-180': legalMenu }">
			<path fill="#7F8C9D" fill-rule="evenodd" d="M4 2.178L5.915.262a.708.708 0 01.996 0 .702.702 0 010 .995L4.75 3.415A.7.7 0 014 3.94a.702.702 0 01-.751-.524l-2.16-2.158a.702.702 0 11.996-.995L4 2.178z"></path>
		</svg>
	</a>
	<div class="focus:outline-none border-sophos-gray-200 absolute bottom-0 left-0 w-48 px-4 py-1 py-4 mb-8 -ml-4 origin-bottom-left bg-white border rounded-md shadow-md" role="menu" aria-orientation="vertical" aria-labelledby="user-menu" x-show="legalMenu" x-transition:enter="transition-all ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" style="display: none;">
		<ul class="font-sansMedium text-sophos-gray-600 space-y-1 text-xs font-medium">
			<li>
				<a href="https://www.sophos.com/en-us/legal.aspx">
					General				</a>
			</li>
			<li>
				<a href="https://www.sophos.com/en-us/legal/modern-slavery-act-transparency-statement.aspx">
					Modern Slavery Statement				</a>
			</li>
			<li>
				<a href="https://secure.ethicspoint.eu/domain/media/en/gui/104916/index.html">
					Speak Out				</a>
			</li>
		</ul>
	</div>
</span>

					<!-- Copyright -->
					<div class="md:ml-6 mt-2 md:mt-0">
						<span class="whitespace-nowrap font-sansMedium text-sophos-gray-600 inline-block text-xs font-medium leading-tight">
							© 1997 - 2022 Sophos Ltd. All rights reserved						</span>
					</div>
				</div>
			</div>
			</div>
		
	</footer>
	<script id="sophos-js-core-js-extra">
var PG8Data = {"startPage":"1","maxPages":"1","nextLink":""};
</script>
<script type="text/javascript" src="https://news.sophos.com/_static/??-eJyVjFsOgyAQRTdUBiHa+tN0LRMyUWh5hJlql1+MG5Dkfp2cc/VelMtJKImWlSKx5lzWzIl2VnYwDx24rUn57UltFiyYBuAEEPimL324XDts+klFvu6fCL7iP/2Vw1jQL6k7LFglUe3uFuxODtaiV3ya+zhPwzgbG/6goqA/"></script><script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.1/dist/alpine.min.js?ver=2.0.1" id="alpine-js-js"></script>
<script type="text/javascript" id="" src="https://www.googletagmanager.com/gtag/js?id=AW-743773256"></script><script type="text/javascript" id="">(function(c,d,f,g,e){c[e]=c[e]||[];var h=function(){var b={ti:"4015302"};b.q=c[e];c[e]=new UET(b);c[e].push("pageLoad")};var a=d.createElement(f);a.src=g;a.async=1;a.onload=a.onreadystatechange=function(){var b=this.readyState;b&&"loaded"!==b&&"complete"!==b||(h(),a.onload=a.onreadystatechange=null)};d=d.getElementsByTagName(f)[0];d.parentNode.insertBefore(a,d)})(window,document,"script","//bat.bing.com/bat.js","uetq");</script><noscript><img src="//bat.bing.com/action/0?ti=4015302&amp;Ver=2" height="0" width="0" style="display: none; visibility: hidden;"></noscript>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","334990480506518");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display: none" src="https://www.facebook.com/tr?id=334990480506518&amp;ev=PageView&amp;noscript=1"></noscript>
<script type="text/javascript" id="">_linkedin_partner_id="461060";window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[];window._linkedin_data_partner_ids.push(_linkedin_partner_id);</script><script type="text/javascript" id="">(function(){var b=document.getElementsByTagName("script")[0],a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://snap.licdn.com/li.lms-analytics/insight.min.js";b.parentNode.insertBefore(a,b)})();</script><noscript><img height="1" width="1" style="display: none;" alt="" src="https://dc.ads.linkedin.com/collect/?pid=461060&amp;fmt=gif"></noscript>
<script type="text/javascript" id="">!function(d,e,f,a,b,c){d.twq||(a=d.twq=function(){a.exe?a.exe.apply(a,arguments):a.queue.push(arguments)},a.version="1.1",a.queue=[],b=e.createElement(f),b.async=!0,b.src="//static.ads-twitter.com/uwt.js",c=e.getElementsByTagName(f)[0],c.parentNode.insertBefore(b,c))}(window,document,"script");twq("init","o4apa");twq("track","PageView");</script>


<script type="text/javascript" id="">!function(d,e,f,a,b,c){d.qp||(a=d.qp=function(){a.qp?a.qp.apply(a,arguments):a.queue.push(arguments)},a.queue=[],b=document.createElement(e),b.async=!0,b.src=f,c=document.getElementsByTagName(e)[0],c.parentNode.insertBefore(b,c))}(window,"script","https://a.quora.com/qevents.js");qp("init","6bed874137d04358a290eecc797a0cd6");qp("track","ViewContent");</script>
<noscript><img height="1" width="1" style="display:none" src="https://q.quora.com/_/ad/6bed874137d04358a290eecc797a0cd6/pixel?tag=ViewContent&amp;noscript=1"></noscript>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.saq||(a=b.saq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._saq||(b._saq=a),a.push=a,a.loaded=!0,a.version="1.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://tags.srv.stackadapt.com/events.js");saq("ts","uxMvfKEouJZfJzsjwRVn_Q");</script>  <script type="text/javascript" id="" src="https://js.adsrvr.org/up_loader.1.1.0.js"></script><script type="text/javascript" id="">(function(a,c,e,k,b){a[b]=a[b]||[];a[b].push({projectId:"10000",properties:{pixelId:"10150886"}});var d=c.createElement(e);d.src=k;d.async=!0;d.onload=d.onreadystatechange=function(){var f=this.readyState,l=a[b];if(!f||"complete"==f||"loaded"==f)try{var g=YAHOO.ywa.I13N.fireBeacon;a[b]=[];a[b].push=function(h){g([h])};g(l)}catch(h){}};c=c.getElementsByTagName(e)[0];e=c.parentNode;e.insertBefore(d,c)})(window,document,"script","https://s.yimg.com/wi/ytc.js","dotq");</script>
<script type="text/javascript" src="https://news.sophos.com/wp-includes/js/comment-reply.min.js?m=1650913122g"></script><script src="https://stats.wp.com/e-202218.js" defer=""></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:10.8',blog:'166161023',post:'84215',tz:'-4',srv:'news.sophos.com',hp:'vip'} ]);
	_stq.push([ 'clickTrackerInit', '166161023', '84215' ]);
</script>


<img src="https://pixel.wp.com/g.gif?v=ext&amp;j=1%3A10.8&amp;blog=166161023&amp;post=84215&amp;tz=-4&amp;srv=news.sophos.com&amp;hp=vip&amp;host=news.sophos.com&amp;ref=&amp;fcp=1463&amp;rand=0.14703261810820956" alt="" width="6" height="5" id="wpstats"><div style="display: none; visibility: hidden;"><script>(function(a,b,c,d,e){a=b.createElement(c);b=b.getElementsByTagName(c)[0];a.async=1;a.id=e;a.src=d;b.parentNode.insertBefore(a,b)})(window,document,"script","https://scripts.demandbase.com/WuEFNglz.min.js","demandbase_js_lib");</script></div>
<script type="text/javascript" id="">window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date);gtag("config","AW-743773256");</script><div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon417633220106"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon422832086873" width="0" height="0" alt="" src="https://bat.bing.com/action/0?ti=4015302&amp;Ver=2&amp;mid=790a1784-d81f-40cd-9ba2-ef942d0f64bc&amp;sid=927a6e10cbde11ecb6b0677139d23e38&amp;vid=927a9f30cbde11ec9623998ca9e6ffcb&amp;vids=1&amp;pi=0&amp;lg=en-US&amp;sw=1900&amp;sh=1080&amp;sc=24&amp;tl=Attacking%20Emotet%E2%80%99s%20Control%20Flow%20Flattening%20%E2%80%93%20Sophos%20News&amp;p=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F&amp;r=&amp;lt=2174&amp;evt=pageLoad&amp;msclkid=N&amp;sv=1&amp;rn=709351"></div>
        <script type="text/javascript" id="">ttd_dom_ready(function(){if("function"===typeof TTDUniversalPixelApi){var a=new TTDUniversalPixelApi;a.init("j022xlj",["ql4fc2b"],"https://insight.adsrvr.org/track/up")}});</script><img src="https://analytics.twitter.com/i/adsct?type=javascript&amp;version=2.3.4&amp;p_id=Twitter&amp;p_user_id=0&amp;txn_id=o4apa&amp;events=%5B%5B%22pageview%22%2C%7B%7D%5D%5D&amp;tw_order_quantity=0&amp;tw_sale_amount=0&amp;tw_iframe_status=0&amp;event_id=497d5d2b-e489-4271-829c-f6bebbf53b38&amp;tw_document_href=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F" height="1" width="1" style="display: none;"><img src="https://t.co/i/adsct?type=javascript&amp;version=2.3.4&amp;p_id=Twitter&amp;p_user_id=0&amp;txn_id=o4apa&amp;events=%5B%5B%22pageview%22%2C%7B%7D%5D%5D&amp;tw_order_quantity=0&amp;tw_sale_amount=0&amp;tw_iframe_status=0&amp;event_id=497d5d2b-e489-4271-829c-f6bebbf53b38&amp;tw_document_href=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F" height="1" width="1" style="display: none;"><img class="ywa-10000" src="https://sp.analytics.yahoo.com/sp.pl?a=10000&amp;d=Wed%2C%2004%20May%202022%2019%3A15%3A34%20GMT&amp;n=0&amp;b=Attacking%20Emotet%E2%80%99s%20Control%20Flow%20Flattening%20%E2%80%93%20Sophos%20News&amp;.yp=10150886&amp;f=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F&amp;enc=UTF-8&amp;yv=1.12.0&amp;tagmgr=gtm" alt="dot image pixel" style="display: none;"><img style="display:none" alt="" aria-hidden="true" width="0" height="0" id="db_bw_pixel_ad" src="https://match.prod.bidr.io/cookie-sync/demandbase"><img style="display:none" alt="" aria-hidden="true" width="0" height="0" id="db_lr_pixel_ad" src="https://id.rlcdn.com/464526.gif"><iframe id="universal_pixel_ql4fc2b" height="0" width="0" style="display:none;" src="https://insight.adsrvr.org/track/up?adv=j022xlj&amp;ref=https%3A%2F%2Fnews.sophos.com%2Fen-us%2F2022%2F05%2F04%2Fattacking-emotets-control-flow-flattening%2F&amp;upid=ql4fc2b&amp;upv=1.1.0" title="TTD Universal Pixel"></iframe></body></html>