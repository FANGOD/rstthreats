{
    "id": "<report_0x1c01e3ff>",
    "url": "https://www.esentire.com/blog/updateagent-macos-malware",
    "title": "UpdateAgent macOS Malware",
    "meta": [
        {
            "id": "<chapter_0x54de65c8>",
            "title": "UpdateAgent macOS Malware",
            "title_level": 1,
            "sentences": [
                {
                    "id": "<sentence_0x5a0c7a14>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "4 min read",
                    "html": "\n4 min read\n"
                },
                {
                    "id": "<sentence_0xf886b54d>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "SHARE:",
                    "html": "<p>SHARE:</p>"
                },
                {
                    "id": "<sentence_0x93a974c2>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<a_0xbf4cef19>": "https://twitter.com/share?ref_src=twsrc%5Etfw"
                    },
                    "text": "",
                    "html": "<a href=\"https://twitter.com/share?ref_src=twsrc%5Etfw\"></a>"
                },
                {
                    "id": "<sentence_0x1d9a95c9>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<a_0x30bb1834>": "https://linkedin.com/shareArticle?url=https://www.esentire.com/blog/updateagent-macos-malware/&title=UpdateAgent%20macOS%20Malware"
                    },
                    "text": "",
                    "html": "<a href=\"https://linkedin.com/shareArticle?url=https://www.esentire.com/blog/updateagent-macos-malware/&amp;title=UpdateAgent%20macOS%20Malware\" target=\"_blank\"></a>"
                },
                {
                    "id": "<sentence_0xe71cdc74>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x9a4a49e8>": "https://www.esentire.com/get-started"
                    },
                    "text": "Speak With A Security Expert Now",
                    "html": "<a class=\"BlogBody__SecurityAdvisoryTopCTA\" href=\"/get-started\">Speak With A Security Expert Now</a>"
                }
            ]
        }
    ],
    "chapters": [
        {
            "id": "<chapter_0x70c87a93>",
            "title": "UpdateAgent macOS Malware",
            "title_level": 1,
            "sentences": [
                {
                    "id": "<sentence_0xbb7a6dbb>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xc770329>": "https://www.esentire.com/what-we-do/security-operations-center"
                    },
                    "text": "Adversaries dont work 9-5 and neither do we. At eSentire, our 24/7 SOCs are staffed with Elite Threat Hunters and Cyber Analysts who hunt, investigate, contain and respond to threats within minutes.",
                    "html": "<p>\nAdversaries don\u2019t work 9-5 and neither do we. At eSentire, our <a href=\"https://www.esentire.com/what-we-do/security-operations-center\">24/7 SOCs</a> are staffed with Elite Threat Hunters and Cyber Analysts who hunt, investigate, contain and respond to threats within minutes.\n</p>"
                },
                {
                    "id": "<sentence_0x24737499>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "We have discovered some of the most dangerous threats and nation state attacks in our space including the Kaseya MSP breach and the more_eggs malware.",
                    "html": "<p>We have discovered some of the most dangerous threats and nation state attacks in our space \u2013 including the Kaseya MSP breach and the more_eggs malware.</p>"
                },
                {
                    "id": "<sentence_0x2a186e15>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Our Security Operations Centers are supported with Threat Intelligence, Tactical Threat Response and Advanced Threat Analytics driven by our Threat Response Unit the TRU team.",
                    "html": "<p>Our Security Operations Centers are supported with Threat Intelligence, Tactical Threat Response and Advanced Threat Analytics driven by our Threat Response Unit \u2013 the TRU team.</p>"
                },
                {
                    "id": "<sentence_0xa8dad56a>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "In TRU Positives, eSentires Threat Response Unit (TRU) provides a summary of a recent threat investigation. We outline how we responded to the confirmed threat and what recommendations we have going forward.",
                    "html": "<p>In TRU Positives, eSentire\u2019s Threat Response Unit (TRU) provides a summary of a recent threat investigation. We outline how we responded to the confirmed threat and what recommendations we have going forward.</p>"
                },
                {
                    "id": "<sentence_0xbf623b45>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Heres the latest from our TRU Team",
                    "html": "<p>Here\u2019s the latest from our TRU Team\u2026</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x9dbf08ab>",
            "title": "What did we find?",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x675ee547>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "UpdateAgent malware impacting a customer in the software industry, specific to Apples macOS operating system.<crlf>The malware is used to deliver additional payloads and maintain a persistent foothold on systems.<crlf>According to Microsoft, the malware has gone through several iterations since it first appeared in September 2020.<crlf>In a recent case, analysts identified a suspicious launch agent and traced it to a shell script matching UpdateAgents known behavior patterns and traits, including:Use of CloudFront domains for C2 communications and secondary payloads.Collection of system information (see below).Removal of quarantine bit from payloads to bypass Gatekeeper.Establishing persistence by modifying property list files in the users /Library/LaunchAgents directory.Removal of files from device to cover tracks.<crlf>Use of CloudFront domains for C2 communications and secondary payloads.<crlf>Collection of system information (see below).<crlf>Removal of quarantine bit from payloads to bypass Gatekeeper.<crlf>Establishing persistence by modifying property list files in the users /Library/LaunchAgents directory.<crlf>Removal of files from device to cover tracks.<crlf>UpdateAgent is known to deliver adware as its second stage payload, but there is potential for more severe payload delivery.",
                    "html": "<ul>\n<li>UpdateAgent malware impacting a customer in the software industry, specific to Apple\u2019s macOS operating system. </li><li>The malware is used to deliver additional payloads and maintain a persistent foothold on systems.</li><li>According to Microsoft, the malware has gone through several iterations since it first appeared in September 2020.</li><li>In a recent case, analysts identified a suspicious launch agent and traced it to a shell script matching UpdateAgent\u2019s known behavior patterns and traits, including:<ol><li>Use of CloudFront domains for C2 communications and secondary payloads.</li><li>Collection of system information (see below).</li><li>Removal of quarantine bit from payloads to bypass Gatekeeper.</li><li>Establishing persistence by modifying property list files in the user\u2019s /Library/LaunchAgents directory.</li><li>Removal of files from device to cover tracks.</li></ol></li><li>UpdateAgent is known to deliver adware as its second stage payload, but there is potential for more severe payload delivery.</li></ul>"
                }
            ]
        },
        {
            "id": "<chapter_0x74fe5b86>",
            "title": "Summary of UpdateAgent's Initiation Shell Script",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x549b4db>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "UpdateAgent collects information about the system and submits it to the C2 domain (hxxps://dgu8hufljhqqu[.]cloudfront[.]net/pkg) via HTTP POST request:",
                    "html": "<p>UpdateAgent collects information about the system and submits it to the C2 domain (hxxps://dgu8hufljhqqu[.]cloudfront[.]net/pkg) via HTTP POST request:</p>"
                },
                {
                    "id": "<sentence_0x2bb2451f>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The information collected includes the active user, machine ID, operating system, and version.",
                    "html": "<p>The information collected includes the active user, machine ID, operating system, and version.</p>"
                },
                {
                    "id": "<sentence_0xa7d39b3b>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x96a4a6b2>": "https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture1.png"
                    },
                    "text": "",
                    "html": "<figure><img class=\"MaxWidth\" src=\"https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture1.png\"/></figure>"
                },
                {
                    "id": "<sentence_0xbf9b3d5c>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0xe57df508>": "https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture2.png"
                    },
                    "text": "",
                    "html": "<figure><img class=\"MaxWidth\" src=\"https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture2.png\"/></figure>"
                },
                {
                    "id": "<sentence_0x37ad6af5>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Then it, retrieves a DMG file from<crlf>hxxps://duh59xv2mx0nn[.]cloudfront[.]net, adds the current user to the sudoers<crlf>file and disables the password prompt:",
                    "html": "<p>Then it, retrieves a DMG file from\nhxxps://duh59xv2mx0nn[.]cloudfront[.]net, adds the current user to the \u2018sudoers\u2019\nfile and disables the password prompt:</p>"
                },
                {
                    "id": "<sentence_0xd2a184c1>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x4b832cb7>": "https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture3.png"
                    },
                    "text": "",
                    "html": "<figure><img class=\"MaxWidth\" src=\"https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture3.png\"/></figure>"
                },
                {
                    "id": "<sentence_0x92d1f441>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xfe354301>": "https://attack.mitre.org/techniques/T1553/001/"
                    },
                    "text": "Next, it clears extended attributes on the DMG file to bypass Gatekeeper,<crlf>which is a security feature in macOS aimed at reducing the likelihood of users<crlf>accidentally running malware downloaded from the internet.",
                    "html": "<p>Next, it clears extended attributes on the DMG file to <a href=\"https://attack.mitre.org/techniques/T1553/001/\">bypass Gatekeeper</a>,\nwhich is a security feature in macOS aimed at reducing the likelihood of users\naccidentally running malware downloaded from the internet. </p>"
                },
                {
                    "id": "<sentence_0x64fdb24a>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xd50b9baf>": "https://ss64.com/osx/xattr.html"
                    },
                    "text": "Similar to the Mark-of-Web attribute in Windows, macOS<crlf>applications (such as browsers) add an extended attribute known as a quarantine<crlf>flag to files downloaded from the internet. UpdateAgent clears all extended<crlf>attributes (including the quarantine flag) using the xattr command.",
                    "html": "<p>Similar to the Mark-of-Web attribute in Windows, macOS\napplications (such as browsers) add an extended attribute known as a quarantine\nflag to files downloaded from the internet. UpdateAgent clears all extended\nattributes (including the quarantine flag) using the <a href=\"https://ss64.com/osx/xattr.html\">xattr</a> command.</p>"
                },
                {
                    "id": "<sentence_0x69705725>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0xaa4804fa>": "https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture4.png"
                    },
                    "text": "",
                    "html": "<figure><img class=\"MaxWidth\" src=\"https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture4.png\"/></figure>"
                },
                {
                    "id": "<sentence_0x68ca2349>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Then, it uses PlistBuddy in direct mode to add arguments to<crlf>a property list file. (com.shenbfgbvgsfssfmrynamdzyetzfnd.plist) under the<crlf>users /Library/LaunchAgents/ folder for persistence:",
                    "html": "<p>Then, it uses PlistBuddy in direct mode to add arguments to\na property list file. (com.shenbfgbvgsfssfmrynamdzyetzfnd.plist) under the\nuser\u2019s /Library/LaunchAgents/ folder for persistence:</p>"
                },
                {
                    "id": "<sentence_0x6ce460e8>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0xbe796866>": "https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture5.png"
                    },
                    "text": "",
                    "html": "<figure><img class=\"MaxWidth\" src=\"https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture5.png\"/></figure>"
                },
                {
                    "id": "<sentence_0xeef71e7>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Lastly, the cleanup actions show as follows:",
                    "html": "<p>Lastly, the cleanup actions show as follows:</p>"
                },
                {
                    "id": "<sentence_0x95dee737>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x2ee5a686>": "https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture6.png"
                    },
                    "text": "",
                    "html": "<figure><img class=\"MaxWidth\" src=\"https://s3.ca-central-1.amazonaws.com/esentire-dot-com-assets/assetsV3/Blog/Blog-Images/March28_Picture6.png\"/></figure>"
                }
            ]
        },
        {
            "id": "<chapter_0x383126f2>",
            "title": "How did we find it?",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x41c857a3>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x587a0c9d>": "https://www.esentire.com/how-we-do-it/signals/endpoint"
                    },
                    "text": "Our MDR for Endpoint service identified the launch agent persistence technique.",
                    "html": "<ul><li>Our <a href=\"https://www.esentire.com/how-we-do-it/signals/endpoint\">MDR for Endpoint</a>\nservice identified the launch agent persistence technique. </li></ul>"
                }
            ]
        },
        {
            "id": "<chapter_0x5a5c28e>",
            "title": "What did we do?",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0xf3eb8715>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xc770329>": "https://www.esentire.com/what-we-do/security-operations-center"
                    },
                    "text": "Our 24/7 SOC cyber analysts alerted the customer, isolated the host and provided details of the infection to assist with remediation.",
                    "html": "<ul><li>Our <a href=\"https://www.esentire.com/what-we-do/security-operations-center\">24/7 SOC</a>\ncyber analysts alerted the customer, isolated the host and provided details of the infection to assist with remediation.</li></ul>"
                }
            ]
        },
        {
            "id": "<chapter_0x762619c6>",
            "title": "What can you learn from this TRU positive?",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x615596b7>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "UpdateAgent is initiated by macOS users installing malicious software masquerading as legitimate applications.<crlf>UpdateAgent has seen continuous improvement since it first emerged.<crlf>While adware payloads may seem low-risk, the potential for follow-on malware exists.Additionally, the information collected and sent via UpdateAgents heartbeat mechanism could be used to target the system for follow-on attacks.<crlf>Additionally, the information collected and sent via UpdateAgents heartbeat mechanism could be used to target the system for follow-on attacks.",
                    "html": "<ul><li>UpdateAgent is initiated by macOS users installing malicious software masquerading as legitimate applications.</li><li>UpdateAgent has seen continuous improvement since it first emerged.</li><li>While adware payloads may seem low-risk, the potential for follow-on malware exists.<ul><li>Additionally, the information collected and sent via UpdateAgent\u2019s heartbeat mechanism could be used to target the system for follow-on attacks.</li></ul></li></ul>"
                }
            ]
        },
        {
            "id": "<chapter_0x8206a151>",
            "title": "Recommendations from our Threat Response Unit (TRU) Team:",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x328cdb7f>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x894a1432>": "https://www.esentire.com/what-we-do/managed-vulnerability-and-risk/technical-testing/security-awareness-training-managed-phishing-training"
                    },
                    "text": "Encourage good security hygiene among your users through phishing and security awareness training.Only download and install applications from trusted locations.For additional protection, validate the file hash if the vendor provides the hash informationIgnore unsolicited pop-ups or application download requests. Do not click on the unsolicited pop-up links.<crlf>Only download and install applications from trusted locations.For additional protection, validate the file hash if the vendor provides the hash information<crlf>For additional protection, validate the file hash if the vendor provides the hash information<crlf>Ignore unsolicited pop-ups or application download requests. Do not click on the unsolicited pop-up links.<crlf>Monitor for modifications to plist files in auto-run locations such as /Library/LaunchAgents/.<crlf>Restrict access/monitor for changes to sudoers file and launch agents folders.",
                    "html": "<ul><li>Encourage good security hygiene among your users through <a href=\"https://www.esentire.com/what-we-do/managed-vulnerability-and-risk/technical-testing/security-awareness-training-managed-phishing-training\">phishing and security awareness training</a>.<ul><li>Only download and install applications from trusted locations.<ul><li>For additional protection, validate the file hash if the vendor provides the hash information</li></ul></li><li>Ignore unsolicited pop-ups or application download requests. Do not click on the unsolicited pop-up links. </li></ul></li><li>Monitor for modifications to plist files in auto-run locations such as /Library/LaunchAgents/.</li><li>Restrict access/monitor for changes to sudoers file and launch agents folders.</li></ul>"
                }
            ]
        },
        {
            "id": "<chapter_0x3659427>",
            "title": "Ask Yourself",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0xe4ff12d7>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "What level of visibility do you have across your network, endpoint, and overall environment to detect malicious behavior at scale?<crlf>What level of managed endpoint support do you have in place?<crlf>What level of managed endpoint support do you have in place?<crlf>Are you monitoring your endpoints 24/7 and what degree of control do you have to initiate a kill switch when required?",
                    "html": "<ol><li>What level of visibility do you have across your network, endpoint, and overall environment to detect malicious behavior at scale?</li>\n<li>What level of managed endpoint support do you have in place?</li>\n<li>What level of managed endpoint support do you have in place? </li>\n<li>Are you monitoring your endpoints 24/7 and what degree of control do you have to initiate a kill switch when required?</li></ol>"
                }
            ]
        },
        {
            "id": "<chapter_0x2784e1b0>",
            "title": "Indicators of Compromise",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0xba978227>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<table_0x8ae99eb1>": {
                            "0": {
                                "0": "Indicator",
                                "1": "28C2FF8C6F78EB61361DECE949108910",
                                "2": "dgu8hufljhqqu[.]cloudfront[.]net",
                                "3": "duh59xv2mx0nn[.]cloudfront[.]net"
                            },
                            "1": {
                                "0": "\u201cNote",
                                "1": "Initiation Shell Script",
                                "2": "Command and Control",
                                "3": "Payload Hosting"
                            }
                        }
                    },
                    "text": "",
                    "html": "<table class=\"table-bordered\">\n<tbody>\n<tr>\n<td>Indicator</td>\n<td>\u201cNote</td>\n</tr>\n<tr>\n<td>28C2FF8C6F78EB61361DECE949108910</td>\n<td>Initiation Shell Script</td>\n</tr>\n<tr>\n<td>dgu8hufljhqqu[.]cloudfront[.]net</td>\n<td>Command and Control</td>\n</tr>\n<tr>\n<td>duh59xv2mx0nn[.]cloudfront[.]net</td>\n<td>Payload Hosting</td>\n</tr>\n</tbody>\n</table>"
                },
                {
                    "id": "<sentence_0xc55a325d>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "eSentires Threat Response Unit (TRU) is a world-class team of threat researchers who develop new detections enriched by original threat intelligence and leverage new machine learning models that correlate multi-signal data and automate rapid response to advanced threats.<crlf>If you are not currently engaged with an MDR provider, eSentire MDR can help you reclaim the advantage and put your business ahead of disruption.",
                    "html": "<p>eSentire\u2019s Threat Response Unit (TRU) is a world-class team of threat researchers who develop new detections enriched by original threat intelligence and leverage new machine learning models that correlate multi-signal data and automate rapid response to advanced threats.\nIf you are not currently engaged with an MDR provider, eSentire MDR can help you reclaim the advantage and put your business ahead of disruption.</p>"
                },
                {
                    "id": "<sentence_0xef557066>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x9a4a49e8>": "https://www.esentire.com/get-started"
                    },
                    "text": "Learn what it means to have an elite team of Threat Hunters and Researchers that works for you. Connect with an eSentire Security Specialist.",
                    "html": "<p>Learn what it means to have an elite team of Threat Hunters and Researchers that works for you. <a href=\"https://www.esentire.com/get-started\" rel=\"noreferrer\" target=\"_blank\">Connect</a> with an eSentire Security Specialist.</p>"
                }
            ]
        }
    ]
}