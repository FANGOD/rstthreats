{"id": "sentence_0x2b553bc4", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "May 9, 2022"}
{"id": "sentence_0x5cb465d", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "by"}
{"id": "sentence_0xe9e59b23", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "Dinesh Devadoss"}
{"id": "sentence_0xafdf9517", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "oRAT Distribution"}
{"id": "sentence_0x83f572bc", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "The oRAT Payload"}
{"id": "sentence_0x853e6ca2", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "Detecting oRAT in the Enterprise"}
{"id": "sentence_0xe6c1d278", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "Conclusion"}
{"id": "sentence_0x12a82a7f", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xc3a9f5cd", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "Indicators of Compromise"}
{"id": "sentence_0xc17a2e2b", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0x85937852", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "By Dinesh Devadoss and Phil Stokes"}
{"id": "sentence_0x996596ac", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0x85937852", "chapter_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "text": "Researchers looking into a new APT group targeting gambling sites with a variety of cross-platform malware recently identified a version of oRAT malware targeting macOS users and written in Go. While neither RATs nor Go malware are uncommon on any platform, including the Mac, the development of such a tool by a previously unknown APT is an interesting turn, signifying the increasing need for threat actors to address the rising occurrence of Macs among their intended targets and victims. In this post, we dig deeper into the technical details of this novel RAT to understand better how it works and how security teams can detect it in their environments."}
{"id": "sentence_0x563ee723", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xd29474f3", "chapter_title": "oRAT Distribution", "text": "The oRAT malware is distributed via a Disk Image masquerading as a collection of Bitget Apps. The disk image contains a package with the name Bitget Apps.pkg and the distribution identifier com.adobe.pkg.Bitget."}
{"id": "sentence_0xa6d61328", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xd29474f3", "chapter_title": "oRAT Distribution", "text": "The disk image and installer package are notable for two reasons: neither has a valid developer signature, and the latter doesnt actually install any files and only contains a preinstall script."}
{"id": "sentence_0x22a30204", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xd29474f3", "chapter_title": "oRAT Distribution", "text": "The preinstall script is a succinct bash shell script whose purpose is to deliver a payload to the /tmp directory, give the payload executable permissions, and then launch it."}
{"id": "sentence_0xe4d46693", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xd29474f3", "chapter_title": "oRAT Distribution", "text": "Precisely what kind of lure the threat actors use to convince targets to download and launch the dropper is unknown at this time, but given that the target would need to override default security warnings from Gatekeeper, it is likely either that the users are sourcing the malware from an environment where this is typical (e.g., a 3rd-party software distribution site that regularly delivers unsigned software) or users have been pre-groomed to bypass Gatekeeper during a social engineering engagement of some kind."}
{"id": "sentence_0x5c5fcb58", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xd29474f3", "chapter_title": "oRAT Distribution", "text": "In either case, the fact that theres no deliverable from the users perspective is a risky gamble on the part of the threat actors. After running the installer and finding that it did not provide whatever they were expecting, users are likely to become suspicious. This might suggest the campaign was broadly targeted and that the threat actors were playing a numbers game, happy to sweep up opportunistic infections as they occurred."}
{"id": "sentence_0xad458f7f", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "Things get more interesting when we examine the darwinx64 payload dropped in the /tmp folder. The binary doesnt define any Symbols, and outputting the list of Sections tells us that the file has been packed with UPX."}
{"id": "sentence_0x3e1e33db", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "Packed files like this are opaque to static analysis, but fortunately standard UPX is very easy to unpack thanks to the UPX utility itself. Dumping the strings tells us that it was packed with UPX 3.96, the most recently released version available."}
{"id": "sentence_0xc1e36c4d", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "The packed binary is around 3MB in size, but after unpacking we are presented with a massive ~10MB file. Such large file sizes are typical of cross-platform malware, particularly when binaries are compiled in Go, since they contain the entire run-time for the language along with a number of supporting libraries."}
{"id": "sentence_0x1517ae4c", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "Fortunately, from a reverse engineering perspective, we can easily ignore most of the standard code that is common to all Go bins and focus on what is unique to the sample at hand. For IDA Pro users, see here; for r2 users, we can start by printing out a list of the functions flagged with sym._main."}
{"id": "sentence_0xf442ccba", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "In Go binaries, the program code entrypoint is at main.main, and we can work our way through there to see what other functions, packages and modules are called. Below, we see that the main.main function calls out to another custom package, orat_utils."}
{"id": "sentence_0x748c0262", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "The orat_utils package contains several interesting functions and gives us an entry into understanding how the RAT works."}
{"id": "sentence_0x7634f433", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "Of particular interest is the LoadConfig function. This is used to parse a blob of data appended to the binary which turns out to be an encrypted malware configuration. The encrypted data at the end of the unpacked binary occupies 166 bytes and consists of the data, an AES key, and two bytes representing the entire blob size."}
{"id": "sentence_0x860f1649", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "Once decrypted, the blob turns out to contain configuration data for the malware C2."}
{"id": "sentence_0x1461f70e", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "After the malware decodes the config, it calls into sym._orat_cmd_agent.app and begins a number of loops through sys._orat_protocal.Dial. Depending on the config, it will call one of orat_protocol.DialTCP, orat_protocol.DialSTCP or orat_protocol.DialSUDP to establish a connection. The TCP protocols leverage smux while the SUDP protocol leverages QUIC. The malware loops with a sleep cycle of 5 seconds as it waits for a response."}
{"id": "sentence_0xad1b150c", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "The sym._orat_cmd_agent.app contains the primary RAT functionality of the malware and defines the following functions."}
{"id": "sentence_0xdb1da8fa", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0xaf92a619", "chapter_title": "The oRAT Payload", "text": "orat/cmd/agent/app.(*App).DownloadFile orat/cmd/agent/app.(*App).Info orat/cmd/agent/app.(*App).Join orat/cmd/agent/app.(*App).KillSelf orat/cmd/agent/app.(*App).NewNetConn orat/cmd/agent/app.(*App).NewProxyConn orat/cmd/agent/app.(*App).NewShellConn orat/cmd/agent/app.(*App).Ping orat/cmd/agent/app.(*App).PortScan orat/cmd/agent/app.(*App).registerRouters orat/cmd/agent/app.(*App).run orat/cmd/agent/app.(*App).Screenshot orat/cmd/agent/app.(*App).Serve orat/cmd/agent/app.(*App).Unzip orat/cmd/agent/app.(*App).UploadFile orat/cmd/agent/app.(*App).Zip"}
{"id": "sentence_0xdab872dc", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0x87b789be", "chapter_title": "Detecting oRAT in the Enterprise", "text": "The SentinelOne agent detects the oRAT payload as malicious when it is written to disk, protecting SentinelOne customers from this threat."}
{"id": "sentence_0x830ff34e", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0x87b789be", "chapter_title": "Detecting oRAT in the Enterprise", "text": "The SentinelOne agent also detects the malware on execution."}
{"id": "sentence_0xc32c962f", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0x87b789be", "chapter_title": "Detecting oRAT in the Enterprise", "text": "For those not protected by the SentinelOne platform, security teams are advised to hunt for artifacts as listed in the Indicators of Compromise section at the end of this post."}
{"id": "sentence_0xbe43dd5a", "report_id": "report_0xcc3ae16e", "report_date": "2022-05-09T00:00:00Z", "report_title": "From the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win", "report_url": "https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win", "chapter_id": "chapter_0x769d1f3e", "chapter_title": "Conclusion", "text": "The oRAT malware targets macOS users using a combination of custom-written code and public Golang repos. The developers are clearly familiar with using sophisticated features of Go for networking and communications, but due to the simplistic way the malware dropper was packaged, unsigned and with no observable install to distract the victim, it would seem they are less experienced with the challenges of infecting Mac users. Unfortunately, other threat actors have provided plenty of examples from which this new player can learn, and security teams should expect to see any future campaigns from this actor using more sophisticated droppers."}
