<div>
<h1>LemonDuck Targets Docker for Cryptomining Operations</h1>
<p>April 21, 2022</p> <a href="https://www.crowdstrike.com/blog/author/manoj-ahuje/" rel="author" title="Posts by Manoj Ahuje">Manoj Ahuje</a> <a href="https://www.crowdstrike.com/blog/category/from-the-front-lines/" title="From The Front Lines">From The Front Lines</a>
<img alt="" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" height="698" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Blog_1060x698-11.jpeg" style="max-width:800px;height:auto;width:auto;" width="1060"/>
<ul>
<li>LemonDuck, a well-known cryptomining botnet, is targeting Docker to mine cryptocurrency on Linux systems. This campaign is currently active.</li>
<li>It runs an anonymous mining operation by the use of proxy pools, which hide the wallet addresses.</li>
<li>It evades detection by targeting Alibaba Cloud’s monitoring service and disabling it.</li>
<li>CrowdStrike customers are protected from this threat with the Falcon Cloud Workload Protection module. </li>
</ul>
<h2>Summary</h2>
<p>The recent cryptocurrency boom has driven crypto prices through the roof in the last couple of years. As a result, cryptomining activities have increased significantly as attackers are looking to get immediate monetary compensation. According to the <a href="https://securityonline.info/86-of-the-compromised-google-cloud-instances-were-used-to-perform-cryptocurrency-mining/">Google Threat Horizon report</a> published Nov. 29, 2021, 86% of compromised Google Cloud instances were used to perform cryptocurrency mining.</p>
<p>The CrowdStrike Cloud Threat Research team detected <a href="https://www.bleepingcomputer.com/news/security/microsoft-exchange-exploits-now-used-by-cryptomining-malware/">LemonDuck</a> targeting <a href="https://docs.docker.com/engine/api/">Docker</a> to mine cryptocurrency on the Linux platform. This campaign is currently active. </p>
<p>LemonDuck is a well-known cryptomining botnet involved in targeting Microsoft Exchange servers via <a href="https://proxylogon.com/">ProxyLogon</a> and the use of <a href="https://en.wikipedia.org/wiki/EternalBlue">EternalBlue</a>, <a href="https://en.wikipedia.org/wiki/BlueKeep">BlueKeep</a>, etc. to mine cryptocurrency, escalate privileges and move laterally in compromised networks. This botnet tries to monetize its efforts via various simultaneous active campaigns to mine cryptocurrency like <a href="https://www.getmonero.org/">Monero</a>.</p>
<h2>What Is the Exposed Docker API?</h2>
<p><a href="https://www.docker.com/">Docker</a> is the platform for building, running and managing containerized workloads. Docker provides a number of APIs to help developers with automation, and these APIs can be made available using local <a href="https://man7.org/linux/man-pages/man2/socket.2.html">Linux sockets</a> or daemons (the default port is 2375).</p>
<p>Since Docker is primarily used to run container workloads in the cloud, a misconfigured cloud instance can expose a Docker API to the internet. Then an attacker can exploit this API to run a cryptocurrency miner inside an attacker-controlled container. Additionally, an attacker can escape a running container by abusing privileges and misconfigurations, but also by exploiting multiple vulnerabilities found in the container runtime like <a href="https://www.docker.com/">Docker</a>, <a href="https://containerd.io/">Containerd</a> and <a href="https://cri-o.io/">CRI-O</a>.</p>
<p><a href="https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811/">Cr8escape</a> is an example of one such vulnerability discovered by CrowdStrike in container runtime <a href="https://cri-o.io/">CRI-O</a>.</p>
<h2>Initial Compromise via Docker</h2>
<p>LemonDuck targets exposed Docker APIs to get initial access. It runs a malicious container on an exposed Docker API by using a custom Docker ENTRYPOINT to download a “core.png” image file that is disguised as Bash script. In Figure 1, you can see the initial malicious entrypoint.</p>
<img alt="" class="wp-image-119402" height="44" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Screen-Shot-2022-04-20-at-9.02.13-AM.png" width="550"/><p>Figure 1. Malicious entrypoint downloading disguised Bash file as an image</p>
<p>The file “core.png” was downloaded from a domain <code>t.m7n0y[.]com</code>, which is associated with LemonDuck. By further analyzing this domain, CrowdStrike found multiple campaigns being operated via the domain targeting Windows and Linux platforms simultaneously.</p>
<p>As shown in Figure 2, the domain has a self-signed certificate installed, generated in May 2021 with expiration in May 2022. It further indicates that this domain is currently being used.</p>
<img alt="" class="wp-image-119392" height="444" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-7.png" width="625"/><p>Figure 2. LemonDuck domain certificate</p>
<p>The unique certificate signatures lead investigation to other domains that are actively used by this actor to potentially identify other command and control (C2) used in this campaign. As shown in Figure 3, investigation found a few domains that were using the same certificate at the moment. But we did not find a “core.png” file being distributed by other related domains at the time of this writing. As shown in Figure 4, historical data collected by CrowdStrike suggests “core.png” was distributed on multiple domains used by this actor in the past.</p>
<img alt="" class="wp-image-119404" height="57" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Screen-Shot-2022-04-20-at-9.04.16-AM.png" width="200"/><p>Figure 3. Domain sharing the same Certificate</p>
<img alt="" class="size-full wp-image-119393" height="743" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-8.png" style="max-width:800px;height:auto;width:auto;" width="3058"/><p>Figure 4. Core.png like files being distributed in the past</p>
<p>Attackers usually run a single campaign from a single C2 server, but interestingly, on multiple C2 used by LemonDuck, there are multiple campaigns running that target Windows as well as the Linux platform. Figure 5 shows various dropper files used in multiple campaigns.</p>
<img alt="" class="wp-image-119415 size-full" height="1476" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Screen-Shot-2022-04-20-at-9.23.52-AM.png" style="max-width:800px;height:auto;width:auto;" width="1316"/><p>Figure 5. Dropper files used in multiple campaigns targeting Windows and Linux</p>
<h2>Disguised Scripts to Set Up a Miner</h2>
<p>As shown in Figure 6, the “core.png” file acts as a pivot by setting a Linux cronjob inside the container. Next, this cronjob downloads another disguised file “a.asp,” which is actually a Bash file.</p>
<img alt="" class="size-full wp-image-119394" height="895" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-9.png" style="max-width:800px;height:auto;width:auto;" width="2768"/><p>Figure 6. Core.png adds cronjob to download a.asp</p>
<p>The “a.asp” file is the actual payload in this attack. It takes several steps before downloading and starting a mining operation once it is triggered by a cronjob, as follows.</p>
<ul>
<li>Kills processes based on names. Kills the number of processes based on names of known mining pools, competing cryptomining groups, etc.</li>
<li>Kills known daemons. Daemons like crond, sshd and syslog are killed by grabbing daemon process ids.</li>
<li>Deletes known indicator of compromise (IOC) file paths. The known IOC file paths of competing cryptomining groups are deleted to disrupt any existing operation.</li>
<li>Kills known network connections. Connections that are ESTABLISHED or in progress (SYN_SENT) to known C2 of competing cryptomining groups are killed.</li>
</ul>
<h3>Disables Alibaba Cloud Defense</h3>
<p><a href="https://www.alibabacloud.com/help/en/cloudmonitor">Alibaba Cloud’s monitoring service</a> monitors cloud instances for malicious activities once the agent is installed on a host or container. LemonDuck’s “a.asp” file has the capability to disable aliyun service in order to evade detection by the cloud provider, as shown in Figure 7.</p>
<img alt="" class="size-full wp-image-119395" height="1031" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-10.png" style="max-width:800px;height:auto;width:auto;" width="2537"/><p>Figure 7. Disable Cloud monitoring service</p>
<h3>Cryptominer Startup and Use of Proxy Pools</h3>
<p>As a final step, LemonDuck’s “a.asp” file downloads and runs XMRig as “xr” file that mines the cryptocurrency as shown in Figure 8. Further, Figure 9 shows the version of XMRig being used in mining (version 6.14.0 released in August 2021). The config file used by XMRig indicates the use of a <a href="https://github.com/xmrig/xmrig-proxy">cryptomining proxy pool</a>. Proxy pools help in hiding the actual crypto wallet address where the contributions are made by current mining activity. You can see the pool address in Figure 9.</p>
<img alt="" class="size-full wp-image-119396" height="854" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-11.png" style="max-width:800px;height:auto;width:auto;" width="2772"/><p>Figure 8. Binary named “xr” running as a mining process</p>
<img alt="" class="size-full wp-image-119397" height="1238" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Untitled-1.jpg" style="max-width:800px;height:auto;width:auto;" width="2500"/><p>Figure 9. XMRig version in use and pool address</p>
<h3>Lateral Movement via SSH</h3>
<p>Rather than mass scanning the public IP ranges for exploitable attack surface, LemonDuck tries to move laterally by searching for SSH keys on filesystem. This is one of the reasons this campaign was not evident as other mining campaigns run by other groups. Once SSH keys are found, the attacker uses those to log in to the servers and run the malicious scripts as discussed earlier. Figure 10 shows the search for SSH keys on the filesystem.</p>
<img alt="" class="size-full wp-image-119398" height="762" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-12.png" style="max-width:800px;height:auto;width:auto;" width="3524"/><p>Figure 10. Key search</p>
<h2>CrowdStrike Detection</h2>
<p>The CrowdStrike Falcon® platform protects its customers with its runtime protection and cloud machine learning models from any post-exploitation activities. As shown in Figure 11, a malicious mining process was killed by the CrowdStrike machine learning model. Figure 12 additionally shows the origin of the process and container information using CrowdStrike Threat Graph®.</p>
<img alt="" class="size-full wp-image-119399" height="935" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-13.png" style="max-width:800px;height:auto;width:auto;" width="2068"/><p>Figure 11. CrowdStrike cloud-based machine learning killing a malicious container process</p>
<img alt="" class="size-full wp-image-119400" height="1141" src="https://www.crowdstrike.com/wp-content/uploads/2022/04/Picture1-14.png" style="max-width:800px;height:auto;width:auto;" width="2070"/><p>Figure 12. CrowdStrike Threat Graph for the malicious process</p>
<h2>Conclusion</h2>
<p>Due to the cryptocurrency boom in recent years, combined with cloud and container adoption in enterprises, cryptomining is proven to be a monetarily attractive option for attackers. Since cloud and container ecosystems heavily use Linux, it drew the attention of the operators of botnets like LemonDuck, which started targeting Docker for cryptomining on the Linux platform.</p>
<p>As you can see in this attack, LemonDuck utilized some part of its vast C2 operation to target Linux and Docker in addition to its Windows campaigns. It utilized techniques to evade defenses not only by using disguised files and by killing monitoring daemon, but also by disabling Alibaba Cloud’s monitoring service.</p>
<p>At CrowdStrike, we expect such kinds of campaigns by large <a href="https://www.crowdstrike.com/cybersecurity-101/botnets/">botnet</a> operators to increase as cloud adoption continues to grow.</p>
<p><a href="https://www.crowdstrike.com/cybersecurity-101/cloud-security/container-security/">Securing containers</a> need not be an overly complex task. Using the Falcon platform, you can easily identify security issues in your environment in real time. You can use built-in features of Kubernetes and best practices to keep your container environment safe. For enhanced security, you can use integrated container security products such as <a href="https://www.crowdstrike.com/cloud-security-products/falcon-cloud-workload-protection/">CrowdStrike Falcon Cloud Workload Protection</a> that can protect your Kubernetes environment seamlessly. </p>
<p>CrowdStrike strives to support organizations that allow their users to stay ahead of the curve and remain fully protected from adversaries and breaches.</p>
<h4>Additional Resources</h4>
<ul>
<li>Learn how you can <a href="https://www.crowdstrike.com/cloud-security-products/">stop cloud breaches with CrowdStrike</a> unified cloud security posture management and breach prevention for multi-cloud and hybrid environments — all in one lightweight platform.</li>
<li>Learn more about how <a href="https://www.crowdstrike.com/cloud-security-products/falcon-cloud-workload-protection/">Falcon Cloud Workload Protection</a> enables organizations to build, run and secure cloud-native applications with speed and confidence</li>
<li>See if a managed solution is right for you. Find out about <a href="https://www.crowdstrike.com/products/cloud-security/falcon-cloud-workload-protection-complete/">Falcon Cloud Workload Protection Complete: Managed Detection and Response for Cloud Workloads</a>.</li>
</ul>
<ul class="list-share-buttons">
<li class="share-button">
<a class="tweet-btn" href="https://twitter.com/share?text=LemonDuck+Targets+Docker+for+Cryptomining+Operations&amp;url=https://www.crowdstrike.com/blog/lemonduck-botnet-targets-docker-for-cryptomining-operations/" rel="noopener noreferrer" target="_blank">
Tweet
</a>
</li>
<li class="share-button">
<a class="li-btn" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.crowdstrike.com/blog/lemonduck-botnet-targets-docker-for-cryptomining-operations/&amp;title=LemonDuck+Targets+Docker+for+Cryptomining+Operations" rel="noopener noreferrer" target="_blank">
Share
</a>
</li>
</ul>
<a href="https://go.crowdstrike.com/try-falcon-prevent.html">
<img class="post_cta" src="https://www.crowdstrike.com/wp-content/themes/main-theme/dist/images/blog/breaches-stop-here-post-cta.jpeg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<h5>Related Content</h5>
</div>