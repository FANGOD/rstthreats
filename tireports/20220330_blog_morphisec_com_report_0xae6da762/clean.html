<div>
<h1>New Wave of Remcos RAT Phishing Campaign</h1>
Posted by
<a class="author-link" href="https://blog.morphisec.com/author/hido-cohen">Hido Cohen</a> on March 30, 2022
<ul class="hs-blog-social-share-list">
<li class="hs-blog-social-share-item hs-blog-social-share-item-twitter">
</li>
<li class="hs-blog-social-share-item hs-blog-social-share-item-linkedin">
</li>
<li class="hs-blog-social-share-item hs-blog-social-share-item-facebook">
</li>
</ul>
<h2><img alt="New Wave of Remcos RAT Phishing Campaign" src="https://blog.morphisec.com/hs-fs/hubfs/New%20Wave%20of%20Remcos%20RAT%20Phishing%20Campaign.png?width=1200&amp;name=New%20Wave%20of%20Remcos%20RAT%20Phishing%20Campaign.png" style="max-width:800px;height:auto;width:auto;" width="1200"/></h2>
<p>Morphisec Labs has detected a new wave of Remcos trojan infection. The theme of the phishing emails is again financial, this time as payment remittances sent from financial institutions. The attacker lures a user to open a malicious Excel file that contains “confidential information” which starts the infection chain.</p>
<p>Morphisec’s analysis has identified several services used for these phishing campaigns. They include Wells Fargo, FIS Global, and ACH Payment notifications. For example:</p>
<p></p>
<h2><img alt="Email from Wells Fargo’s CEO with malicious attachment" src="https://blog.morphisec.com/hs-fs/hubfs/Email%20from%20Wells%20Fargo%E2%80%99s%20CEO%20with%20malicious%20attachment.png?width=835&amp;name=Email%20from%20Wells%20Fargo%E2%80%99s%20CEO%20with%20malicious%20attachment.png" style="max-width:800px;height:auto;width:auto;" width="835"/></h2>
<p>Figure 1: Email from Wells Fargo’s CEO with a malicious attachment</p>
<p>This infection contains many stages and largely depends on the C2 server, which stores the required files for each stage.</p>
<p><img alt="All stages stored in the C2 " src="https://blog.morphisec.com/hs-fs/hubfs/All%20stages%20stored%20in%20the%20C2%20.png?width=1212&amp;name=All%20stages%20stored%20in%20the%20C2%20.png" style="max-width:800px;height:auto;width:auto;" width="1212"/></p>
<p>Figure 2: All stages stored in the C2.</p>
<p>The attacker also uses a password-protected .xls file to lower the detection rate. The password is in the phishing email, and as we can see—password protection helps:</p>
<p><img alt="The malicious attachment and first stage detection rate" src="https://blog.morphisec.com/hs-fs/hubfs/The%20malicious%20attachment%20and%20first%20stage%20detection%20rate.png?width=1389&amp;name=The%20malicious%20attachment%20and%20first%20stage%20detection%20rate.png" style="max-width:800px;height:auto;width:auto;" width="1389"/></p>
<p>Figure 3: The malicious attachment and first stage detection rate</p>
<p>In this blog post, we analyze the full attack chain used by the attacker and explain how each step works.</p>
<h2>What is the Remcos Trojan?</h2>
<p>Remcos is a commercial remote access trojan (RAT) developed by <a href="https://breakingsecurity.net/remcos/">BreakingSecurity</a>. Remcos has many capabilities, and a free version downloadable directly from BreakingSecurity’s website. Morphisec has previously covered Remcos as the <a href="https://blog.morphisec.com/guloader-the-rat-downloader">payload in Guloader</a>, and the payload in the <a href="https://blog.morphisec.com/the-babadeda-crypter-targeting-crypto-nft-defi-communities">Babadeda crypter</a>.</p>
<p>The Remcos trojan allows attackers to quickly and easily control an infected computer, steal personal information, and surveil a victim’s activity. All this without investing time in developing a tool with remote administration capabilities.</p>
<h1>The Infection Chain</h1>
<p><img alt="Remcos Infection chain " src="https://blog.morphisec.com/hs-fs/hubfs/Remcos%20Infection%20chain%20.png?width=587&amp;name=Remcos%20Infection%20chain%20.png" width="587"/></p>
<p>Figure 4: Infection chain steps</p>
<p>The .xls file writes and executes a new .vbs file. The code inside the file executes a PowerShell command that downloads another .vbs file from a remote server. Once downloaded and saved on the disk, PowerShell executes the file. Next, the newly downloaded .vbs file connects to the C2 server again and fetches an encoded PowerShell command. This PowerShell code is responsible for downloading the next stage and decoding it. This stage contains a .NET injector and the final payload. After decoding, the PowerShell initiates the injector that introduces the final payload, known as Remcos RAT.</p>
<h2>Technical Analysis</h2>
<p>Analyzed Sample</p>
<p>.xls: 8740cdcef9e825fd5105b021e0616a1d6a41f761c92f29127cd000c8500f70e6</p>
<h3>First Stage: .xls</h3>
<p>Steps 2-3 in Figure 4</p>
<p><img alt="The malicious .xls file" src="https://blog.morphisec.com/hs-fs/hubfs/The%20malicious%20.xls%20file.png?width=1595&amp;name=The%20malicious%20.xls%20file.png" style="max-width:800px;height:auto;width:auto;" width="1595"/></p>
<p>Figure 5: The malicious .xls file</p>
<p>The .xls file contains a Visual Basic code that executes once a user opens the file and enables macros. Looking inside the file reveals the logic behind the script.</p>
<p><img alt="Main VB function" src="https://blog.morphisec.com/hs-fs/hubfs/Main%20VB%20function.png?width=876&amp;name=Main%20VB%20function.png" style="max-width:800px;height:auto;width:auto;" width="876"/></p>
<p>Figure 6: Main VB function</p>
<p>First, the .vbs reads the PowerShell command that is written to F variable, a FileSystemObject CLSID to F2, and a second CLSID (Shell.Application) to F3. Next it creates a new file inside %AppData% using the CLSID object located inside F2. Finally, it writes F to that file and calls the function that executes it. It does so by creating a Shell.Application object using the second CLSID loaded and runs the newly created QAITB.vbs file.</p>
<h3>Second Stage: .vbs Executes PowerShell Downloader</h3>
<p>Steps 3-5 in Figure 4</p>
<p>Inside QAITB.vbs is a reversed PowerShell command which downloads the next stage and saves it to disk.</p>
<p><img alt="vbs Downloader" src="https://blog.morphisec.com/hs-fs/hubfs/vbs%20Downloader.png?width=1001&amp;name=vbs%20Downloader.png" style="max-width:800px;height:auto;width:auto;" width="1001"/></p>
<p>Figure 7: .vbs downloader</p>
<p>The malware uses Shell.Application CLSID again to execute the PowerShell command. The PowerShell command downloads the file from 209.127.19[.]101/win.vbs in this case, and saves it inside %Temp%\harvest.vbs which also deletes the previous file at %APPDATA%\QAITB.vbs. (See the IOCs section for more.)</p>
<h3>Third Stage: Another.vbs Downloader</h3>
<p>Steps 6-7 in Figure 4</p>
<p>The malware continues to communicate with its C2 server, requesting more files. This time the file request is made by harvest.vbs. This .vbs file is responsible for two things: </p>
1. Setting persistence by copying the script file to the Startup folder.
<p><img alt="Set persistence by copying the script to the Startup folder" src="https://blog.morphisec.com/hs-fs/hubfs/Set%20persistence%20by%20copying%20the%20script%20to%20the%20Startup%20folder.png?width=999&amp;name=Set%20persistence%20by%20copying%20the%20script%20to%20the%20Startup%20folder.png" style="max-width:800px;height:auto;width:auto;" width="999"/></p>
<p>Figure 8: Set persistence by copying the script to the Startup folder</p>
2. Downloading the next stage from the C2 server.
<p><img alt="Download and execute the next stage" src="https://blog.morphisec.com/hs-fs/hubfs/Download%20and%20execute%20the%20next%20stage.png?width=863&amp;name=Download%20and%20execute%20the%20next%20stage.png" style="max-width:800px;height:auto;width:auto;" width="863"/></p>
<p>Figure 9: Download and execute the next stage</p>
<p>The malware uses InternetExplorer class to create a hidden new IE window that navigates to a URL. It then extracts the command located in InnerText.</p>
<p>The next stage is executed using the same Shell.Application CLSID as before:</p>
<p><img alt="Powershell execution from .vbs" src="https://blog.morphisec.com/hs-fs/hubfs/Powershell%20execution%20from%20.vbs.png?width=948&amp;name=Powershell%20execution%20from%20.vbs.png" style="max-width:800px;height:auto;width:auto;" width="948"/></p>
<p>Figure 10: Powershell execution from .vbs</p>
<p>Which translates to:</p>
<p>GetObject("new:13709620-C279-11CE-A49E-444553540000").ShellExecute powershell &lt;command&gt;</p>
<h3>Fourth Stage: Encoded Powershell</h3>
<p>Steps 8-9 in Figure 4</p>
<p>The downloaded PowerShell command is another encoded command that translates to:</p>
<p><img alt="Decoded PowerShell command" src="https://blog.morphisec.com/hs-fs/hubfs/Decoded%20PowerShell%20command.png?width=964&amp;name=Decoded%20PowerShell%20command.png" style="max-width:800px;height:auto;width:auto;" width="964"/></p>
<p>Figure 11: Decoded PowerShell command</p>
<p>Where g is an alias for IEX.</p>
<p>This command checks if the machine has an internet connection by pinging google.com. If so, it communicates with the C2 server again. The next stage is another PowerShell command executed using IEX.</p>
<h3>Fifth Stage: Powershell Unzips Injector and FInal Payload</h3>
<p>Steps 10-11 in Figure 4</p>
<p>This stage uses two large GZipped archives and extracts them. The first blob is a .NET injector. The second is the final payload injected into the target process.</p>
<p>The important commands in this stage are:</p>
<p><img alt="Final payload injector execution" src="https://blog.morphisec.com/hs-fs/hubfs/Final%20payload%20injector%20execution.png?width=943&amp;name=Final%20payload%20injector%20execution.png" style="max-width:800px;height:auto;width:auto;" width="943"/></p>
<p>Figure 12: Final payload injector execution</p>
<p>The malware loads the extracted data located inside $JtpgNId. This is the injector. Once the injector is loaded into memory, the malware calls a toooyou.Black function that injects the payload into RegAsm.exe.</p>
<h3>FInal Payload</h3>
<p>At this point we get the final payload, a Remcos RAT.</p>
<p><img alt="Figure 12- Remcos RAT agent initialized message" src="https://blog.morphisec.com/hs-fs/hubfs/Figure%2012-%20Remcos%20RAT%20agent%20initialized%20message.png?width=445&amp;name=Figure%2012-%20Remcos%20RAT%20agent%20initialized%20message.png" width="445"/></p>
<p>Figure 13: Remcos RAT agent initialized message</p>
<p>In this case the configuration of the Remcos trojan is stored as a resource named SETTINGS. It is RC4 encrypted. We can extract the configuration by decrypting it using the following steps:</p>
<ol>
<li>Read the first byte in the resource—this is the key length.</li>
<li>Read the next &lt;key_length&gt; bytes—this is the key.</li>
<li>Read the rest of the data—this is the encrypted section.</li>
<li>RC4 decrypt the encrypted section using the key.</li>
</ol>
<p>After extracting the configuration, we can find where the stolen data was sent to:</p>
<p><img alt="Remcos decrypted configuration " src="https://blog.morphisec.com/hs-fs/hubfs/Remcos%20decrypted%20configuration%20.png?width=266&amp;name=Remcos%20decrypted%20configuration%20.png" width="266"/></p>
<p>Figure 14: Remcos decrypted configuration</p>
<p>This sample communicates with freshdirect.dvrlists[.]com:119.</p>
<h2>How Do You Stop a Remcos Trojan?</h2>
<p>A Remcos RAT is just the final component of a lengthy and sophisticated attack chain delivery process. Such attacks use advanced <a href="https://attack.mitre.org/tactics/TA0005/">defense evasion</a> techniques to sneak past cybersecurity solutions. These techniques include disabling or uninstalling security tools, and obfuscating or encrypting data and scripts. According to the latest Picus report, defense evasion is now the <a href="https://www.picussecurity.com/resource/blog/red-report-2021-top-ten-attack-techniques">most popular tactic</a> among malware operators. </p>
<p>Morphisec’s patented Moving Target Defense is the best on the market for preventing defense evasion techniques. Unlike other cybersecurity solutions which focus on detecting known patterns with response playbooks, Morphisec MTD preemptively blocks attacks on memory and applications and remediates the need for response. To find out more about Morphisec’s revolutionary Moving Target Defense technology, read the white paper: <a href="https://engage.morphisec.com/the-ultimate-ransomware-strategy">Zero Trust + Moving Target Defense: Stopping Ransomware, Zero-Day, and Other Advanced Threats Where NGAV and EDR Are Failing</a>.</p>
<h3>Indicators of Compromise (IOCs)</h3>
<h4> Emails</h4>
<table>
<tbody>
<tr>
<td>
<p>c221b6eb8437d1f43ebffae9e51c7d330016290d048cfff2f402a7508b1e16e3</p>
<p>8740cdcef9e825fd5105b021e0616a1d6a41f761c92f29127cd000c8500f70e6</p>
<p>6d9d1de4f4ea0e4aeb553458f4cea2af1a2554fe84c952b367ed5eb753990fc7</p>
<p>342bad5211bf3c8af50e263334bb90b580d71220e6b16597ba7bdd6f404e4215</p>
<p>b5833f95871ced64f48649b55e075e85c1c595f4af8522082c8e3ef72917ae80</p>
<p>a2cffc70c2b63baa3ada0b916b778996204bd3b7a91eab66757b4343888eec3f</p>
<p>1a5b5299afb0c657e2141aaf46600c6ca91ca80840d65fb3b5afb53a99069e53</p>
</td>
</tr>
</tbody>
</table>
<h4> XLSs</h4>
<table>
<tbody>
<tr>
<td>
<p>6ad5d2aae0cb58f943f39d8b43492fd6007cd8caeeaaea03013194572756b124</p>
<p>85c4808b3ed64480ae0d9f5c6fdaade6c7298f89cb4b799f0d5510b674d0a367</p>
<p>dc88c4ddc7f428a266cf619d4d5367fa10a86c2c7fc18a359eb8d9d264437111</p>
<p>26bd031cb4a5333bbd77698f5aaf737cb108b4b9d30670d92218a8c31ec0abc7</p>
<p>5115b590c285b437f5d432b1ca0ad8ee8ba89afedd7a5228d8d79e20e6ec84d8</p>
<p>77268e599a7bee74da06206f33c4725e262627d88123c7920e6aab9d9473a1c0</p>
</td>
</tr>
</tbody>
</table>
<h4>XLSs .vbs</h4>
<table>
<tbody>
<tr>
<td>
<p>e0306366dd9c04bc92421d855a116d145e4b9afe4852bc77a02089d363d031a4</p>
<p>1e7dba5f19588eeceffb45e96f4673ce181d64392805c5a78e83ae8c15d42d61</p>
<p>a954043909b90d12ab1659e2d28adb236b4ac521084282448757f7b1fd8d8b05</p>
<p>6f2e30793f43ea5b71f5609fa508acf595393d1a3e2ac2a9e8205228e0c50fe8</p>
<p>128971c9ae22f36db1074ff2e93c2adb07c21eb3e5c139d501e06ef29bf28b97</p>
<p>3f54c5f1cf53bb9a87aabdd0847c3506aebda16e5c384ab2d939264541e214e9</p>
<p>70a1064fee27885c8d3caa5c18e0c08609c50ecdaa8e0ee2b9ce5c97a6df21f1</p>
<p>e646ad0c447c477004947aa49154c9d1cf1013769332f76aa46bc230ae286d1c</p>
<p>c04840608386221e34ec81c5e9875e6e77cbdbf3acd63e76e338a1ad5ccf8da5</p>
<p>1cb0c04eefe74736dc16b418e01fa7d61753992bc4898fe3600f61d648e64e1c</p>
<p>da546ce81e022979c8dc7942667e57aa605b11cae9eb20d917df63cad75d4ec3</p>
<p>f3ef4e8e91f7558a6e86f4001e0fc78defeaafe0298263a8f3bd62a451e45c5e</p>
</td>
</tr>
</tbody>
</table>
<h4>URLs</h4>
<table>
<tbody>
<tr>
<td>
<p>hxxp://kingspalmhomes[.]com/wprl/Protected Client.vbs</p>
<p>hxxp://kingspalmhomes[.]com/admin/Protected Client.vbs</p>
<p>hxxp://kingspalmhomes[.]com/wprl/Protected.vbs</p>
<p>hxxp://kingspalmhomes[.]com/admin/Protected Client.vbs</p>
<p>hxxp://kingspalmhomes[.]com/product/Protected.vbs</p>
<p>hxxp://fisintegrateds[.]com/zp-admin/Protected Client.vbs</p>
<p>hxxp://fisintegrateds[.]com/zp-admin/Protected Client.vbs</p>
<p>hxxp://gotovacoil[.]com/created/Protected Client.vbs</p>
<p>hxxp://gotovacoil[.]com/newfolder/Protected Client.vbs</p>
<p>hxxp://dreamwatchevent[.]com/wsalptza/Client.vbs</p>
<p>hxxp://dreamwatchevent[.]com/zp-user/Protected Client.vbs</p>
<p>hxxp://209.127.19[.]101/win.vbs</p>
<p>hxxp://209.127.19[.]101/pit.txt</p>
<p>hxxp://209.127.19[.]101/kif.jpg</p>
</td>
</tr>
</tbody>
</table>
<h4>Domains</h4>
<table>
<tbody>
<tr>
<td>
<p>fisintegrateds[.]com</p>
<p>kingspalmhomes[.]com</p>
<p>gotovacoil[.]com</p>
<p>dreamwatchevent[.]com</p>
<p>209.127.19[.]101</p>
</td>
</tr>
</tbody>
</table>
<h4>Final Payload (Remcos)</h4>
<table>
<tbody>
<tr>
<td>
<p>79AD11D52EA3D0BD956CAD871396C8DA2C9A76FFFC02E694339B7FE8B6CE18EA</p>
<p>401D142905E2253E7E38CC7E275A09A4A0F45AE73F15748EA69C1F6CB0591A81</p>
<p>CFD29C1AC568E0A21B5F2C05B96BB5BBF2848E89BD6DBDDF4C69DAB3B1CD8A32</p>
<p>79AD11D52EA3D0BD956CAD871396C8DA2C9A76FFFC02E694339B7FE8B6CE18EA</p>
<p>CFD29C1AC568E0A21B5F2C05B96BB5BBF2848E89BD6DBDDF4C69DAB3B1CD8A32</p>
</td>
</tr>
</tbody>
</table>
<h4>Remcos C2s</h4>
<table>
<tbody>
<tr>
<td>
<p>shiestynerd[.]dvrlists[.]com</p>
<p>breakingsecurity[.]dvrlists[.]com</p>
<p>freshdirect[.]dvrlists[.]com</p>
</td>
</tr>
</tbody>
</table>
<p><a href="https://engage.morphisec.com/the-ultimate-ransomware-strategy" rel="noopener"><img src="https://blog.morphisec.com/hs-fs/hubfs/image-Mar-09-2022-06-20-00-29-PM.png?width=640&amp;name=image-Mar-09-2022-06-20-00-29-PM.png" width="640"/></a></p>
<p> </p>
<h3>Subscribe to our blog</h3>
<p>Stay in the loop with industry insight, cyber security trends, and cyber attack information and company updates.</p>
<a class="cta_button" href="https://blog.morphisec.com/cs/c/?cta_guid=262dcaf9-2354-46c6-b31c-babe01409164&amp;signature=AAH58kFsd-SKR2dxWxw67RlqDBWDlgDuyw&amp;pageId=69822655248&amp;placement_guid=91ae0282-4842-46a2-a64f-055310ee09b0&amp;click=168ad6c6-b888-4ef8-be7e-906e8ddba578&amp;hsutk=95d45a3ea2e56313e198ebaf93ab0b87&amp;canon=https%3A%2F%2Fblog.morphisec.com%2Fremcos-trojan-analyzing-attack-chain&amp;portal_id=1534169&amp;redirect_url=APefjpH7mMFCubcX3pKXYEe0B2MnVzqKgCu0lGilRMRPSKW7FuzQY3vkwXxWprIxQQF3PsFl8NjCeLwPdjh8X4Nbs9-lEJo2oR05o5m65TdGirIGEVkN05rPK000efKPDwOr9gx2weP88GjNPhbk75KI169Qnm0qwTaq6kR_Shz2v4qYfO_8Eb-PoogLL1PH-4vI2qfVMa7jI568DG_zM595pTEAzoncs3DXR3QGI8oa11qqpCbMyM_DfT_bS3uCKrMhs8An7lCI8v9pRw2TWMZGAT8oWX22UA&amp;__hstc=182053752.95d45a3ea2e56313e198ebaf93ab0b87.1648652275425.1648652275425.1648652275425.1&amp;__hssc=182053752.1.1648652275425&amp;__hsfp=98101046&amp;contentType=blog-post" id="cta_button_1534169_262dcaf9-2354-46c6-b31c-babe01409164"><img alt="New call-to-action" class="hs-cta-img" id="hs-cta-img-91ae0282-4842-46a2-a64f-055310ee09b0" src="https://f.hubspotusercontent10.net/hubfs/1534169/hub_generated/resized/afa0bb8d-65e7-4148-bddb-02f6dcf325e2.jpeg" style="max-width:80%;height:auto;width:auto;"/></a><img height="1" id="pixel-91ae0282-4842-46a2-a64f-055310ee09b0-262dcaf9-2354-46c6-b31c-babe01409164" src="https://track.hubspot.com/__ptq.gif?k=12&amp;aij=%5B%2291ae0282-4842-46a2-a64f-055310ee09b0%22%2C%22262dcaf9-2354-46c6-b31c-babe01409164%22%5D&amp;rfc=8&amp;sd=1900x1080&amp;cd=24-bit&amp;cs=UTF-8&amp;ln=en-us&amp;bfp=98101046&amp;v=1.1&amp;a=1534169&amp;pi=69822655248&amp;ct=blog-post&amp;ccu=https%3A%2F%2Fblog.morphisec.com%2Fremcos-trojan-analyzing-attack-chain&amp;cpi=69822655248&amp;cgi=3742504875&amp;lpi=69822655248&amp;lvi=69822655248&amp;lvc=en-us&amp;pu=https%3A%2F%2Fblog.morphisec.com%2Fremcos-trojan-analyzing-attack-chain&amp;t=Remcos+Trojan%3A+Analyzing+the+Attack+Chain&amp;cts=1648652275441&amp;vi=95d45a3ea2e56313e198ebaf93ab0b87&amp;nc=true&amp;ce=false&amp;cc=0" width="1"/>
<h3>Search Our Site</h3>
<ul class="hs-search-field__suggestions"></ul>
</div>