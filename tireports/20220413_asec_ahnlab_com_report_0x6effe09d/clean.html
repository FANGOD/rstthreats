<div>
Posted on <a href="https://asec.ahnlab.com/en/33630/" rel="bookmark" title="9:52 am">April 13, 2022</a>
<h1 class="title">[Caution] Virus/XLS Xanpei Infecting Normal Excel Files</h1>
<p>The ASEC analysis team has recently discovered the constant distribution of malware strains that spread the infection when Excel file is opened. Besides infecting normal Excel files, they can also perform additional malicious behaviors such as acting as a downloader and performing DNS Spoofing, therefore, users need to take great caution.</p>
<p>The common trait of the malware strains is to spread the virus through the VBA (Visual Basic for Applications) codes included in Excel files. Upon opening the infected Excel file, the file containing virus VBA code is dropped to Excel startup path. And when any Excel file is opened, the malicious file dropped in Excel startup path is automatically executed to infect with virus and perform additional malicious behaviors. After the infection, malicious behaviors such as Downloader or DNS Spoofing occurs depending on the malware type.</p>
<p>[1] Downloader Type Malware
– MD5: f8886b0d734c5ddcccd2a0d57d383637
– Alias: Virus/X97M.Downloader</p>
<p>This Excel file is infected with virus, and as shown in the figure below, it has the VBA code defined for virus and additional malicious behaviors.</p>
<figure class="aligncenter"><img alt="" class="wp-image-33548 jetpack-lazy-image jetpack-lazy-image--handled" height="557" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-10.png?resize=944%2C557&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="944"/><img alt="" class="wp-image-33548" height="557" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-10.png?resize=944%2C557&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="944"/><figcaption>Figure 1. Malicious VBA code inside the file</figcaption></figure>
<p>The malicious code inside the file performs malicious activities by calling the “d2p” procedure for spreading malware and the “boosting” procedure including the Downloader logic in the Workbook_Open() procedure that is automatically run when an event for viewing a workbook occurs.</p>
<figure class="aligncenter"><img alt="" class="wp-image-33507 jetpack-lazy-image" height="107" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-1.png?w=1920&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="887"/><img alt="" class="wp-image-33507" height="107" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-1.png?w=1920&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="887"/><figcaption>Figure 2. Workbook_Open of the malicious VBA code</figcaption></figure>
<p>The d2p procedure containing the logic for spreading virus creates an Excel file with the name “boosting.xls” to spread the infection in the Excel startup path (see Figure 3). When opening a random document, the malware dropped in the path “%AppData%\Microsoft\Excel\XLSTART\boosting.xls” is automatically executed and infects the Excel file that is currently being viewed, and performs malicious behaviors.</p>
<figure class="aligncenter"><img alt="" class="wp-image-33509 jetpack-lazy-image" height="509" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-2.png?resize=926%2C509&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="926"/><img alt="" class="wp-image-33509" height="509" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-2.png?resize=926%2C509&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="926"/><figcaption>igure 3. Code for spreading malware</figcaption></figure>
<p>As shown in Figure 4, the “boosting.xls” file spreads malware after a certain time has passed. When the infection spreads, the original code defined in the file is deleted. The code then defines codes for infection and additional malicious behaviors in the Workbook_Open procedure of the Excel file.</p>
<figure class="aligncenter"><img alt="" class="wp-image-33544 jetpack-lazy-image" height="327" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-8.png?resize=913%2C319&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="933"/><img alt="" class="wp-image-33544" height="327" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-8.png?resize=913%2C319&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="933"/><figcaption>Figure 4. Code for spreading virus</figcaption></figure>
<p>Downloader-type malware downloads and runs Miner-related executables from the C2 after infection (see Figure 5).</p>
<figure class="aligncenter"><img alt="" class="wp-image-33513 jetpack-lazy-image" height="321" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-4.png?resize=784%2C268&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="935"/><img alt="" class="wp-image-33513" height="321" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-4.png?resize=784%2C268&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="935"/><figcaption>Figure 5. Downloader feature</figcaption></figure>
<p>The C2 URLs for downloading are as follows:
– hxxp://45.78.21.150/boost/boosting[.]exe
– hxxp://45.78.21.150/boost/config[.]txt</p>
<p>Additionally, Excel virus strains of this type scan for the existence of the “%AppData%\Microsoft\Excel\XLSTART\boosting.xls” file. If the file does not exist, they spread virus and perform additional malicious behaviors. This means that if a dummy file with a 0-byte size exists in the path, malicious behaviors can be prevented in advance.</p>
<p>[2] DNS Spoofing Type Malware
– MD5: 97841a3bf7ffec57a2586552b05c0ec5
– Alias: Virus/MSExcel.Xanpei</p>
<p>This type also has a normal Excel file infected with virus with the VBA code for virus and additional malicious behaviors defined. Unlike the Downloader type that was mentioned earlier, this type has a different name for the malicious Excel file dropped at the Excel startup path (accerlate.xls). Also, instead of downloading files, it performs DNS Spoofing by changing the host file.</p>
<figure class="aligncenter"><img alt="" class="wp-image-33545 jetpack-lazy-image" height="368" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-9.png?resize=938%2C367&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="939"/><img alt="" class="wp-image-33545" height="368" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/04/image-9.png?resize=938%2C367&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="939"/><figcaption>Figure 6. DNS Spoofing feature</figcaption></figure>
<p>The DNS Spoofing C2 URL is as follows:
– hxxp://45.78.21.150</p>
<p>AhnLab is detecting malicious document files and downloaded executables as shown below. Furthermore, AhnLab is using the ASD network to block the C2 URLs that malicious Excel file connects.</p>
<p>[File Detection]
– Virus/XLS.Xanpei (2022.03.14.02)
– Virus/X97M.Downloader (2018.12.11.07)
– Virus/MSExcel.Xanpei (2022.03.14.03)
– Trojan/Win64.BitMiner (2017.11.13.03)</p>
<p>Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to check related IOC and detailed analysis information.</p>
<p>
Categories:<a href="https://asec.ahnlab.com/en/category/malware-information/" rel="category tag">Malware Information</a> </p>
<p>Tagged as:<a href="https://asec.ahnlab.com/en/tag/excel-en/" rel="tag">excel</a>, <a href="https://asec.ahnlab.com/tag/excel-file/" rel="tag">Excel file</a>, <a href="https://asec.ahnlab.com/tag/excel-malware/" rel="tag">Excel Malware</a>, <a href="https://asec.ahnlab.com/en/tag/malware-en/" rel="tag">malware</a>, <a href="https://asec.ahnlab.com/tag/virus/" rel="tag">Virus</a></p>
</div>