[
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x4f06e62e",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0xaca6b8d7",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0xf5beca74",
            "title": "Kubernetes and CRI-O release patch for vulnerability today; CrowdStrike customers protected",
            "text": "March 15, 2022\nJohn Walker - Manoj Ahuje\nEndpoint & Cloud Security\nCrowdStrike cloud security researchers discovered a new vulnerability (dubbed cr8escape and tracked as CVE-2022-0811) in the Kubernetes container engine CRI-O.\nCrowdStrike disclosed the vulnerability to Kubernetes, which worked with CRI-O to issue a patch that was released today.\nIt is recommended that CRI-O users patch immediately.\nCrowdStrike customers are protected from this threat by the Falcon sensor for Linux or the Falcon Cloud Workload Protection module."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x987a7352",
            "title": "Summary",
            "text": "CrowdStrikes Cloud Threat Research team discovered a new vulnerability (CVE-2022-0811) in CRI-O (a container runtime engine underpinning Kubernetes). Dubbed cr8escape, when invoked, an attacker could escape from a Kubernetes container and gain root access to the host and be able to move anywhere in the cluster. Invocation of CVE-2022-0811 can allow an attacker to perform a variety of actions on objectives, including execution of malware, exfiltration of data and lateral movement across pods.\nAttempted exploits of this vulnerability can be detected by the Falcon sensor for Linux or the Falcon Cloud Workload Protection module. CrowdStrike disclosed the vulnerability to Kubernetes, which worked with CRI-O to issue a patch that was released today. The CVE score is 8.8 (High) and the potential impact is widespread, as many software and platforms use CRI-O by default. It is recommended that CRI-O users patch immediately. CrowdStrike customers can use Falcon Spotlight vulnerability management to see which hosts are affected and patch where recommended to aid against exploitation.\nKubernetes uses a container runtime like CRI-O or Docker to safely share each nodes kernel and resources with the various containerized applications running on it. The Linux kernel accepts runtime parameters that control its behavior. Some parameters are namespaced and can therefore be set in a single container without impacting the system at large. Kubernetes and the container runtimes it drives allow pods to update these safe kernel settings while blocking access to others.\nCrowdStrikes Cloud Threat Research team discovered a flaw introduced in CRI-O version 1.19 that allows an attacker to bypass these safeguards and set arbitrary kernel parameters on the host. As a result of CVE-2022-0811, anyone with rights to deploy a pod on a Kubernetes cluster that uses the CRI-O runtime can abuse the kernel.core_pattern parameter to achieve container escape and arbitrary code execution as root on any node in the cluster."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0xfa5b605",
            "title": "Impact",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x82c16bfe",
            "title": "Directly Affected Software",
            "text": "CRI-O version 1.19+\nTo determine if a host is affected: run crio version"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x7adaee3",
            "title": "Indirectly Affected Software and Platforms",
            "text": "While the vulnerability is in CRI-O, software and platforms that depend on it are also likely to be vulnerable, including:\nOpenShift 4+\nOracle Container Engine for Kubernetes"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0xdf15234f",
            "title": "Detection",
            "text": "The CrowdStrike Falcon sensor included in the CrowdStrike Falcon Cloud Workload Protection module, which protects Kubernetes and containers, will detect attempts to exploit CVE-2022-0811 as privilege escalation. The Falcon sensor for Linux is able to see the pinns utility command execution and detect and prevent this behavior during runtime.\n(Click to enlarge)"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x30063e1f",
            "title": "Indicator of Misconfiguration",
            "text": "The CrowdStrike Falcon Cloud Workload Protection module also includes a Kubernetes Protection Agent that scans all workload resource specs on the clusters and transmits it to the CrowdStrike Security Cloud for any misconfiguration analysis. Any discovered misconfiguration results in a detection that is displayed in Cloud Security > Kubernetes And Containers > Investigate. This module is helpful in scanning all of the existing running workloads on clusters that may have been already running with a bad sysctl value.\n(Click to enlarge)"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x602c8e63",
            "title": "Remediation",
            "text": "At the Kubernetes level:\nIdeal: Use policies to block pods that contain sysctl settings with + or = in their value.\nLess ideal alternative: Use the PodSecurityPolicy forbiddenSysctls field to block all sysctls (its necessary to block all sysctls as the malicious setting is smuggled in a value).\nAt the CRI-O level:\nUpgrade to a patched version of CRI-O.\nSet pinns_path in crio.conf to point to a pinns wrapper that strips the -s option before invoking the real pinns. This will prevent pods from updating any kernel parameters, including sensitive ones. Pinns, typically found at /usr/bin/pinns, is the utility CRI-O uses to set kernel parameters.\nPinns, typically found at /usr/bin/pinns, is the utility CRI-O uses to set kernel parameters.\nDowngrade to CRI-O version 1.18 or earlier. (Not recommended in most cases.)"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x9fad9541",
            "title": "Vulnerability Details",
            "text": "Starting with this commit, CRI-O uses the pinns utility to set kernel options for a pod. Pinns is most commonly invoked like this:\npinns -s kernel_parameter1=value1+kernel_parameter2=value2\nDue to the addition of sysctl support in version 1.19, pinns will now blindly set any kernel parameters its passed without validation.\nThe following function converts the map of sysctl settings passed to CRI-O into a pinns argument. Like pinns, it does not validate the settings.\nValidation does occur before this function is invoked. However, note that the value is not checked or sanitized. As long as the sysctl key is valid, it will be processed as is.\nThe result: A malicious user can pass in sysctl values with + and = characters allowing extra kernel settings to be set through pinns."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x20724b75",
            "title": "Proof of Concept: Leveraging CVE-2022-0811 to Compromise Kubernetes",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x462ca38",
            "title": "Overview",
            "text": "This proof of concept (POC) uses a malicious PodSpec to set the kernel.core_pattern kernel parameter, which specifies how the kernel should react to a core dump. In this case, well tell it to execute a binary hosted in another pod. That binary will be run as root outside of any container. Finally, well trigger a core dump causing the kernel to invoke the malicious executable."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x25fc5e69",
            "title": "Reproduction Environment for POC",
            "text": "Minikube cluster created via minikube start --kubernetes-version=v1.23.3 --driver=vmware --container-runtime=crio running: Kubernetes v1.23.3 CRI-O 1.22.0 (Later versions are vulnerable as well; this just happens to be the version of CRI-O Minikube installs.)\nKubernetes v1.23.3\nCRI-O 1.22.0 (Later versions are vulnerable as well; this just happens to be the version of CRI-O Minikube installs.)"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x85ef5906",
            "title": "Steps",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x641ddd2b",
            "title": "Startup Pod to Host Malicious Executable",
            "text": "This pod will host an executable that the kernel will invoke after a core dump. It will also be used to trigger a core dump."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0xf89e3c37",
            "title": "Determine Root Path From Host Mount Namespace",
            "text": "Ultimately the kernel will be invoking a script in this pod in response to a core dump. The kernel will be acting in the host mount namespace, so we need to determine the path to the container filesystem from this namespace.\n/var/lib/containers/storage/overlay/3ef1281bce79865599f673b476957be73f994d17c15109d2b6a426711cf753e6/diff is the path to the root of the container from the perspective of the kernel."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x36061a5e",
            "title": "Create a Malicious Script to Invoke on Core Dump",
            "text": "Within our malicious script host pod:\nWe now have a malicious script setup and we know its path in the host mount namespace."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x1dc464a5",
            "title": "Use Second Pod to Point Core Pattern to Malicious Script",
            "text": "Next is our attempt to create a second pod. Creation will stall, but as a result of the attempt, CRI-O daemon will update the value of the kernel.core_pattern setting, which controls what the kernel does in response to core dumps. In this case, well tell the kernel to send the core dump to our malicious script.\nNOTE: You must ensure this pod runs on the same node as the malicious script pod. There are multiple ways to do this depending on the exact cluster setup. A primitive, brute force method is to spin it up as a daemonset, which will update core_pattern for every node in the cluster.\nWhile the sysctl-set pod did not start, it successfully updated the node-wide core_pattern to point into our malicious-script-host container.\nThis works because both Kubernetes and CRI-O sysctl validation logic believe the user is updating only the safe kernel parameter kernel.shm_rmid_forced. When CRI-O actually applies this setting, though, its parser will expand it into two kernel parameter updates:\nkernel.shm_rmid_forced=1\nkernel.core_pattern=|<path to malicious script> #\nThis second option has not been validated or sanitized in any way. (NOTE: The trailing # is to ignore the single quote CRI-O adds to the end of the value.)"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x8c5b205",
            "title": "Trigger Core Dump",
            "text": "We need to trigger a core dump to cause the kernel to execute our malicious core dump handler.\nFirst enable core dumps:\nNow trigger one:"
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0x5620c77b",
            "title": "Verify Malicious Script Ran",
            "text": "This script was invoked by the kernel outside of the container namespace with root privileges. A real attacker could, as an example, run a reverse shell and gain full control of the node."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0xe55cd705",
            "title": "Notes",
            "text": "Kubernetes is not necessary to invoke CVE-2022-8011. An attacker on a machine with CRI-O installed can use it to set kernel parameters all by itself. We used Kubernetes in this POC to better illustrate the potential impact of the problem and to more closely simulate how this would likely be used in the wild."
        }
    },
    {
        "report": {
            "id": "report_0xf5634ded",
            "date": "20220320",
            "title": "cr8escape: New Vulnerability in CRI-O Container Engine Discovered by CrowdStrike (CVE-2022-0811)",
            "url": "https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811"
        },
        "chapter": {
            "id": "chapter_0xf97186c0",
            "title": "Additional Resources",
            "text": "Read more about how to block vulnerabilities before theyre exploited: How to Protect Cloud Workloads from Zero-day Vulnerabilities\nLearn how CrowdStrike Falcon Cloud Workload Protection provides robust protection for applications that run in the cloud and enables organizations to build, run and secure cloud-native applications with speed and confidence.\nLearn about the powerful, cloud-native CrowdStrike Falcon platform by visiting the product webpage.\nGet a full-featured free trial of CrowdStrike Falcon Prevent to see for yourself how true next-gen AV performs against todays most sophisticated threats.\nSee if a managed solution is right for you. Find out about Falcon Cloud Workload Protection Complete: Managed Detection and Response for Cloud Workloads.\nFor more resources of CVE-2022-8011 cr8escape from CrowdStrike, customers may access the tracking page in the Support Portal.\nReview our Prevention Policy Best Practices in the Support Portal.\nTweet\nShare"
        }
    }
]