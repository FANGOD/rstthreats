{
    "id": "<report_0x44833def>",
    "url": "https://blog.malwarebytes.com/threat-intelligence/2022/05/how-the-saitama-backdoor-uses-dns-tunnelling",
    "title": "How the Saitama backdoor uses DNS tunnelling",
    "meta": [],
    "chapters": [
        {
            "id": "<chapter_0xaed0a441>",
            "title": "How the Saitama backdoor uses DNS tunnelling",
            "title_level": 1,
            "sentences": [
                {
                    "id": "<sentence_0x4b38e168>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x94215a13>": "https://blog.malwarebytes.com/author/mstockley/"
                    },
                    "text": "Posted: May 25, 2022 by Mark Stockley",
                    "html": "<p class=\"small\">Posted: May 25, 2022 by <a href=\"https://blog.malwarebytes.com/author/mstockley/\" rel=\"author\" title=\"Posts by Mark Stockley\">Mark Stockley</a>\n</p>"
                },
                {
                    "id": "<sentence_0x23844e5c>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "A walkthrough of one of the stealthy communication techniques employed in a recent attack using APT34's Saitama backdoor.",
                    "html": "\nA walkthrough of one of the stealthy communication techniques employed in a recent attack using APT34's Saitama backdoor. \n"
                },
                {
                    "id": "<sentence_0x2266f0de>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Thanks to the Malwarebytes Threat Intelligence Team for the information they provided for this article.",
                    "html": "<p>Thanks to the Malwarebytes Threat Intelligence Team for the information they provided for this article.</p>"
                },
                {
                    "id": "<sentence_0x8ad445e2>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Understandably, a lot of cybersecurity research and commentary focuses on the act of breaking into computers undetected. But threat actors are often just as concerned with the act of breaking out of computers undetected too.",
                    "html": "<p>Understandably, a lot of cybersecurity research and commentary focuses on the act of breaking into computers undetected. But threat actors are often just as concerned with the act of breaking out of computers undetected too. </p>"
                },
                {
                    "id": "<sentence_0xb4b0399f>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Malware with the intent of surveillance or espionage needs to operate undetected, but the chances are it also needs to exfiltrate data or exchange messages with its command and control infrastructure, both of which could reveal its presence to threat hunters.",
                    "html": "<p>Malware with the intent of surveillance or espionage needs to operate undetected, but the chances are it also needs to exfiltrate data or exchange messages with its command and control infrastructure, both of which could reveal its presence to threat hunters.</p>"
                },
                {
                    "id": "<sentence_0x75a6d4df>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "One of the stealthy communication techniques employed by malware trying to avoid detection is DNS Tunnelling, which hides messages inside ordinary-looking DNS requests.",
                    "html": "<p>One of the stealthy communication techniques employed by malware trying to avoid detection is DNS Tunnelling, which hides messages inside ordinary-looking DNS requests.</p>"
                },
                {
                    "id": "<sentence_0x6cc609c8>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xddff68e8>": "https://blog.malwarebytes.com/threat-intelligence/2022/05/apt34-targets-jordan-government-using-new-saitama-backdoor/"
                    },
                    "text": "The Malwarebytes Threat Intelligence team recently published research about an attack on the Jordanian government by the Iranian Advanced Persistent Threat (APT) group APT34 that used its own innovative version of this method.",
                    "html": "<p>The Malwarebytes Threat Intelligence team recently published research about an <a href=\"https://blog.malwarebytes.com/threat-intelligence/2022/05/apt34-targets-jordan-government-using-new-saitama-backdoor/\">attack on the Jordanian government</a> by the Iranian Advanced Persistent Threat (APT) group APT34 that used its own innovative version of this method. </p>"
                },
                {
                    "id": "<sentence_0x5f8d9f47>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xa83d428e>": "https://en.wikipedia.org/wiki/Finite-state_machine"
                    },
                    "text": "The payload in the attack was a backdoor called Saitama, a finite state machine that used DNS to communicate. Our original article provides an educational deep dive into the operation of Saitama and is well worth a read.",
                    "html": "<p>The payload in the attack was a backdoor called Saitama, a <a href=\"https://en.wikipedia.org/wiki/Finite-state_machine\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">finite state machine</a> that used DNS to communicate. Our original article provides an educational deep dive into the operation of Saitama and is well worth a read.</p>"
                },
                {
                    "id": "<sentence_0x970d6e05>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Here we will expand on the tricks that Saitama used to keep its DNS tunelling hidden.",
                    "html": "<p>Here we will expand on the tricks that Saitama used to keep its DNS tunelling hidden.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x565d91c4>",
            "title": "How the Saitama backdoor uses DNS tunnelling",
            "title_level": 1,
            "sentences": [
                {
                    "id": "<sentence_0x9358f40a>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x1fd967ae>": "https://blog.malwarebytes.com/wp-content/uploads/2022/05/tunnel-900x506.jpg"
                    },
                    "text": "",
                    "html": "<p><img alt=\"How the Saitama backdoor uses DNS tunnelling\" src=\"https://blog.malwarebytes.com/wp-content/uploads/2022/05/tunnel-900x506.jpg\"/></p>"
                },
                {
                    "id": "<sentence_0xe29cefa8>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xd65fbdb8>": "https://blog.malwarebytes.com/category/explained/",
                        "<a_0xce9ac4fd>": "https://blog.malwarebytes.com/category/threat-intelligence/"
                    },
                    "text": "Explained | Threat Intelligence",
                    "html": "<p class=\"breadcrumbs hidden-xs\"><a href=\"https://blog.malwarebytes.com/category/explained/\" rel=\"category tag\">Explained</a> | <a href=\"https://blog.malwarebytes.com/category/threat-intelligence/\" rel=\"category tag\">Threat Intelligence</a></p>"
                }
            ]
        },
        {
            "id": "<chapter_0xe49cad64>",
            "title": "Saitamas DNS tunnelling",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0xd6ad2382>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0xffe6cf29>": "malwarebytes.com",
                        "<code_0xe3a5b269>": "54.192.137.126"
                    },
                    "text": "DNS is the Internets address book that allows computers to lookup human-readable domain names, like malwarebytes.com, and find their IP addresses, like 54.192.137.126.",
                    "html": "<p>DNS is the Internet\u2019s \u201caddress book\u201d that allows computers to lookup human-readable domain names, like <code>malwarebytes.com</code>, and find their IP addresses, like <code>54.192.137.126</code>.</p>"
                },
                {
                    "id": "<sentence_0xc8972d15>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "DNS information isnt held in a single database. Instead its distributed, and each domain has name servers that are responsible for answering questions about them. Threat actors can use DNS to communicate by having their malware make DNS lookups that are answered by name servers they control.",
                    "html": "<p>DNS information isn\u2019t held in a single database. Instead it\u2019s distributed, and each domain has name servers that are responsible for answering questions about them. Threat actors can use DNS to communicate by having their malware make DNS lookups that are answered by name servers they control. </p>"
                },
                {
                    "id": "<sentence_0xa1d71459>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "DNS is so important its almost never blocked by corporate firewalls, and the enormous volume of DNS traffic on corporate networks provides plenty of cover for malicious communication.",
                    "html": "<p>DNS is so important it\u2019s almost never blocked by corporate firewalls, and the enormous volume of DNS traffic on corporate networks provides plenty of cover for malicious communication.</p>"
                },
                {
                    "id": "<sentence_0xb56eba5a>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Saitamas messages are shaped by two important concerns: DNS traffic is still largely unencrypted, so messages have to be obscured so their purpose isnt obvious; and DNS records are often cached heavily, so identical messages have to look different to reach the APT-controlled name servers.",
                    "html": "<p>Saitama\u2019s messages are shaped by two important concerns: DNS traffic is still largely unencrypted, so messages have to be obscured so their purpose isn\u2019t obvious; and DNS records are often cached heavily, so identical messages have to look different to reach the APT-controlled name servers.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x7ddc0284>",
            "title": "Saitamas messages",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x5bb865c2>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "In the attack on the Jordanian foreign ministry, Saitamas domain lookups used the following syntax:",
                    "html": "<p>In the attack on the Jordanian foreign ministry, Saitama\u2019s domain lookups used the following syntax:</p>"
                },
                {
                    "id": "<sentence_0xbd11936f>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0xb86d7e73>": "domain = message, counter ",
                        "<code_0x882c2604>": "'.'"
                    },
                    "text": "domain = message, counter '.' root domain",
                    "html": "<p class=\"has-text-align-center\"><code>domain = message, counter </code><code>'.'</code> root domain</p>"
                },
                {
                    "id": "<sentence_0x3614e0c6>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0xa1eacdb1>": "uber-asia.com",
                        "<code_0xe9487014>": "asiaworldremit.com",
                        "<code_0x656c6a5d>": "joexpediagroup.com"
                    },
                    "text": "The root domain is always one of uber-asia.com, asiaworldremit.com or joexpediagroup.com, which are used interchangeably.",
                    "html": "<p>The root domain is always one of <code>uber-asia.com</code>, <code>asiaworldremit.com</code> or <code>joexpediagroup.com</code>, which are used interchangeably.</p>"
                },
                {
                    "id": "<sentence_0x8c64120b>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The sub-domain portion of each lookup consists of a message followed by a counter. The counter is used to encode the message, and is sent to the command and control (C2) server with each lookup so the C2 can decode the message.",
                    "html": "<p>The sub-domain portion of each lookup consists of a message followed by a counter. The counter is used to encode the message, and is sent to the command and control (C2) server with each lookup so the C2 can decode the message.</p>"
                },
                {
                    "id": "<sentence_0x3670fd55>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Four types of message can be sent:",
                    "html": "<p>Four types of message can be sent:</p>"
                }
            ]
        },
        {
            "id": "<chapter_0xfd1bcbd6>",
            "title": "1. Make contact",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0xaa392b13>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x9bcbf511>": "0",
                        "<code_0x6a2f65a>": "46655",
                        "<code_0x26e28810>": "7805"
                    },
                    "text": "The first time it is executed, Saitama starts its counter by choosing a random number between 0 and 46655. In this example our randomly-generated counter is 7805.",
                    "html": "<p>The first time it is executed, Saitama starts its counter by choosing a random number between <code>0</code> and <code>46655</code>. In this example our randomly-generated counter is <code>7805</code>.</p>"
                },
                {
                    "id": "<sentence_0x97119bd5>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The DNS lookup derived from that counter is:",
                    "html": "<p>The DNS lookup derived from that counter is:</p>"
                },
                {
                    "id": "<sentence_0x101727c6>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0xfbace2d5>": "nbn4vxanrj.joexpediagroup.com"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><code>nbn4vxanrj.joexpediagroup.com</code></p>"
                },
                {
                    "id": "<sentence_0x7f8f4b47>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x14070d6b>": "7805",
                        "<code_0xf42535eb>": "60t",
                        "<code_0xda77ded6>": "6",
                        "<code_0xb45b4958>": "1296",
                        "<code_0x6323985a>": "0",
                        "<code_0x77c0fc63>": "36",
                        "<code_0x4b95a453>": "1",
                        "<code_0x189e1721>": "7805",
                        "<code_0x175bae01>": "nrj"
                    },
                    "text": "The counter itself is encoded using a hard-coded base36 alphabet that is shared by the name server. In base36 each digit is represented by one of the 36 characters 0-9 and A-Z. In the standard base36, alphabet 7805 is written 60t (6 x 1296 + 0 x 36 + 30 x 1). However, in Saitamas custom alphabet 7805 is nrj.",
                    "html": "<p>The counter itself is encoded using a hard-coded base36 alphabet that is shared by the name server. In base36 each digit is represented by one of the 36 characters 0-9 and A-Z. In the standard base36, alphabet <code>7805</code> is written <code>60t</code> (<code>6</code> x <code>1296</code> + <code>0</code> x <code>36</code> + 30 x <code>1</code>). However, in Saitama\u2019s custom alphabet <code>7805</code> is <code>nrj</code>.</p>"
                },
                {
                    "id": "<sentence_0x15f7880c>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x83ca9d60>": "0",
                        "<code_0x50f434f2>": "a",
                        "<code_0xffcb78b6>": "haruto",
                        "<code_0x2edbe0b2>": "aharuto"
                    },
                    "text": "The counter is also used to generate a custom alphabet that will be used to encode the message using a simple substitution. The first message sent home is the command 0, base36-encoded to a, which tells the server it has a new victim, prepended to the string haruto, making aharuto.",
                    "html": "<p>The counter is also used to generate a custom alphabet that will be used to encode the message using a simple substitution. The first message sent home is the command <code>0</code>, base36-encoded to <code>a</code>, which tells the server it has a new victim, prepended to the string <code>haruto</code>, making <code>aharuto</code>.</p>"
                },
                {
                    "id": "<sentence_0xbee3be74>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0xbd6f4667>": "nbn4vxa"
                    },
                    "text": "A simple substitution using the alphabet generated by the counter yields the message nbn4vxa.",
                    "html": "<p>A simple substitution using the alphabet generated by the counter yields the message <code>nbn4vxa</code>.</p>"
                },
                {
                    "id": "<sentence_0x9c063347>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9<crlf><crlf>n j 1 6 9 k p b h d 0 7 y i a 2 g 4 u x v 3 e s w f 5 8 r o c q t l z m",
                    "html": "\na b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9\n\u2193 \u2193 \u2193 \u2193 \u2193 \u2193 \nn j 1 6 9 k p b h d 0 7 y i a 2 g 4 u x v 3 e s w f 5 8 r o c q t l z m\n"
                },
                {
                    "id": "<sentence_0xfac7e19e>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x8a1c9ff4>": "aharuto"
                    },
                    "text": "The C2 name server decodes the counter using the shared, hard-coded alphabet, and then uses the counter to derive the alphabet used to encode aharuto.",
                    "html": "<p>The C2 name server decodes the counter using the shared, hard-coded alphabet, and then uses the counter to derive the alphabet used to encode <code>aharuto</code>. </p>"
                },
                {
                    "id": "<sentence_0x1a282045>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x8f2bbf4e>": "203"
                    },
                    "text": "It responds to the contact request with an IP address that contains an ID for Saitama to use in future communications. The first three octets can be anything, and Saitama ignores them. The final octet contains the ID. In our example we will use the ID 203:",
                    "html": "<p>It responds to the contact request with an IP address that contains an ID for Saitama to use in future communications. The first three octets can be anything, and Saitama ignores them. The final octet contains the ID. In our example we will use the ID <code>203</code>:</p>"
                },
                {
                    "id": "<sentence_0xc0ffb791>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0x635b3342>": "75.99.87.203"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><code>75.99.87.203</code></p>"
                }
            ]
        },
        {
            "id": "<chapter_0x67c5409c>",
            "title": "2. Ask for a command",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0x32ed01ec>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x71e385e8>": "7806",
                        "<code_0x4255d19>": "203",
                        "<code_0xa99b589d>": "ao",
                        "<code_0x6c7c07e8>": "nrc"
                    },
                    "text": "Now that it has an ID from the C2 server, Saitama increments its counter to 7806 and signals its readiness to receive a command as follows: The counter is used to generate a new custom alaphabet, which encodes the ID, 203, as ao. The counter itself is encoded using the malwares hard-coded base36 alphabet, to nrc, and one of Saitamas three root domains is chosen at random, resulting in:",
                    "html": "<p>Now that it has an ID from the C2 server, Saitama increments its counter to <code>7806</code> and signals its readiness to receive a command as follows: The counter is used to generate a new custom alaphabet, which encodes the ID, <code>203</code>, as <code>ao</code>. The counter itself is encoded using the malware\u2019s hard-coded base36 alphabet, to <code>nrc</code>, and one of Saitama\u2019s three root domains is chosen at random, resulting in:</p>"
                },
                {
                    "id": "<sentence_0x6fcd2987>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0xec4a3637>": "aonrc.uber-asia.com"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><code>aonrc.uber-asia.com</code></p>"
                },
                {
                    "id": "<sentence_0x5d3a0439>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The C2 server responds to the request with the size of the payload Saitama should expect. Saitama will use this to determine how many requests it will need to make to retrieve the full payload.",
                    "html": "<p>The C2 server responds to the request with the size of the payload Saitama should expect. Saitama will use this to determine how many requests it will need to make to retrieve the full payload.</p>"
                },
                {
                    "id": "<sentence_0x1f140489>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The first octet of the IP address the C2 responds with is any number between 129 and 255, while the second, third and fourth octets signify the first, second, and third bytes of the size of the payload. In this case the payload will be four bytes.",
                    "html": "<p>The first octet of the IP address the C2 responds with is any number between 129 and 255, while the second, third and fourth octets signify the first, second, and third bytes of the size of the payload. In this case the payload will be four bytes.</p>"
                },
                {
                    "id": "<sentence_0xc3a6db22>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0x98690c7>": "129.0.0.4"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><code>129.0.0.4</code></p>"
                }
            ]
        },
        {
            "id": "<chapter_0xab6d4fc3>",
            "title": "3. Get a command",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0x86e92e09>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0xb93c703c>": "7807"
                    },
                    "text": "Now that it knows the size of the payload it will receive, Saitama makes one or more RECEIVE requests to the server to get its instructions. It increments its counter by one each time, starting at 7807. Multiple requests may be necessary in this step because some command names require more than the four bytes of information an IP address can carry. In this case it has been told to retrieve four bytes of information so it will only need to make one request.",
                    "html": "<p>Now that it knows the size of the payload it will receive, Saitama makes one or more RECEIVE requests to the server to get its instructions. It increments its counter by one each time, starting at <code>7807</code>. Multiple requests may be necessary in this step because some command names require more than the four bytes of information an IP address can carry. In this case it has been told to retrieve four bytes of information so it will only need to make one request.</p>"
                },
                {
                    "id": "<sentence_0x222644c1>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x9f1051ca>": "RECEIVE",
                        "<code_0x5f49f20>": "203",
                        "<code_0xc9d98704>": "7807",
                        "<code_0x2e4b7c55>": "k7myyy"
                    },
                    "text": "The message from Saitama consists of three parts: The digit 2, indicating the RECEIVE command; the ID 203; and an offset indicating which part of the payload is required. These are individually base36-encoded and concatenated together. The resulting string is encoded using a custom base36 alphabet derived from the counter 7807, giving us the message k7myyy.",
                    "html": "<p>The message from Saitama consists of three parts: The digit 2, indicating the <code>RECEIVE</code> command; the ID <code>203</code>; and an offset indicating which part of the payload is required. These are individually base36-encoded and concatenated together. The resulting string is encoded using a custom base36 alphabet derived from the counter <code>7807</code>, giving us the message <code>k7myyy</code>.</p>"
                },
                {
                    "id": "<sentence_0x1f4db674>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x536a3f01>": "nr6,"
                    },
                    "text": "The counter is encoded using the hard-coded alphabet to nr6, and one of Saitamas three root domains is chosen at random, giving us:",
                    "html": "<p>The counter is encoded using the hard-coded alphabet to <code>nr6,</code> and one of Saitama\u2019s three root domains is chosen at random, giving us:</p>"
                },
                {
                    "id": "<sentence_0x940788de>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0xcdb43b3b>": "k7myyynr6.asiaworldremit.com"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><code>k7myyynr6.asiaworldremit.com</code></p>"
                },
                {
                    "id": "<sentence_0xf6c9e91b>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The C2 indicates which function it wants to run using two-digit integers. It can ask Saitama to run any of five different functions:",
                    "html": "<p>The C2 indicates which function it wants to run using two-digit integers. It can ask Saitama to run any of five different functions:</p>"
                },
                {
                    "id": "<sentence_0x3081a48e>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<table_0xd0d6a40d>": {
                            "C2": {
                                "0": 43,
                                "1": 70,
                                "2": 71,
                                "3": 95,
                                "4": 96
                            },
                            "Saitama": {
                                "0": "Static",
                                "1": "Cmd",
                                "2": "CompressedCmd",
                                "3": "File",
                                "4": "CompressedFile"
                            }
                        },
                        "<code_0xe7d2f7e>": "43",
                        "<code_0x50f4b189>": "Static",
                        "<code_0x23ca8a73>": "70",
                        "<code_0xafd4dd32>": "Cmd",
                        "<code_0x958b94a4>": "71",
                        "<code_0x936aef7e>": "CompressedCmd",
                        "<code_0xbae891c>": "95",
                        "<code_0xd2f3226>": "File",
                        "<code_0x505e1831>": "96",
                        "<code_0x6de2b487>": "CompressedFile"
                    },
                    "text": "C2Saitama43Static70Cmd71CompressedCmd95File96CompressedFileSaitama functions",
                    "html": "<figure class=\"wp-block-table is-style-stripes\"><table><thead><tr><th>C2</th><th>Saitama</th></tr></thead><tbody><tr><td><code>43</code></td><td><code>Static</code></td></tr><tr><td><code>70</code></td><td><code>Cmd</code></td></tr><tr><td><code>71</code></td><td><code>CompressedCmd</code></td></tr><tr><td><code>95</code></td><td><code>File</code></td></tr><tr><td><code>96</code></td><td><code>CompressedFile</code></td></tr></tbody></table><figcaption>Saitama functions</figcaption></figure>"
                },
                {
                    "id": "<sentence_0xac6fc001>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0xd24d0a59>": "ver",
                        "<code_0xf2b21d8d>": "Cmd",
                        "<code_0x3194c74d>": "70",
                        "<code_0x1ac58c46>": "ver"
                    },
                    "text": "In this case the C2 wants to run the command ver using Saitamas Cmd function. (In the previous request the C2 indicated that it would be sending Saitama a four byte payload: One byte for 70, and three bytes for ver.)",
                    "html": "<p>In this case the C2 wants to run the command <code>ver</code> using Saitama\u2019s <code>Cmd</code> function. (In the previous request the C2 indicated that it would be sending Saitama a four byte payload: One byte for <code>70</code>, and three bytes for <code>ver</code>.)</p>"
                },
                {
                    "id": "<sentence_0xbe1f4dd0>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xee96ffbe>": "https://en.wikipedia.org/wiki/Ver_(command)",
                        "<a_0x78b3c475>": "https://en.wikipedia.org/wiki/ASCII",
                        "<code_0x103359f2>": "70",
                        "<code_0x13471eaa>": "ver"
                    },
                    "text": "In its response, the C2 uses the first octet of the IP address to indicate the function it wants to run, 70, and then the remaining three octets to spell out the command name ver using the ASCII codepoints for the lowercase characters v, e, and r:",
                    "html": "<p>In its response, the C2 uses the first octet of the IP address to indicate the function it wants to run, <code>70</code>, and then the remaining three octets to spell out the command name <code><a href=\"https://en.wikipedia.org/wiki/Ver_(command)\">ver</a></code> using the <a href=\"https://en.wikipedia.org/wiki/ASCII\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">ASCII</a> codepoints for the lowercase characters \u201cv\u201d, \u201ce\u201d, and \u201cr\u201d:</p>"
                },
                {
                    "id": "<sentence_0x588f52e7>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0x3ebae30f>": "70.118.101.114"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><code>70.118.101.114</code></p>"
                }
            ]
        },
        {
            "id": "<chapter_0xd30abe68>",
            "title": "4. Run the command",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0x5b5cb127>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x9fc0b7d6>": "7808"
                    },
                    "text": "Saitama runs the command it has been given and sends the resulting output to the C2 server in one or more DNS requests. The counter is incremented by one each time, starting at 7808 in our example. Multiple requests may be necessary in this step because some command names require more than the four bytes an IP address can carry.",
                    "html": "<p>Saitama runs the command it has been given and sends the resulting output to the C2 server in one or more DNS requests. The counter is incremented by one each time, starting at <code>7808</code> in our example. Multiple requests may be necessary in this step because some command names require more than the four bytes an IP address can carry.</p>"
                },
                {
                    "id": "<sentence_0xaa8168e3>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0x4c206e78>": "p6yqqqqp0b67gcj5c2r3gn3l9epztnrb.asiaworldremit.com"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><code>p6yqqqqp0b67gcj5c2r3gn3l9epztnrb.asiaworldremit.com</code></p>"
                },
                {
                    "id": "<sentence_0x7acd63e>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x42195959>": "nrb,"
                    },
                    "text": "The counter is encoded using the hard-coded alphabet to nrb, and one of Saitamas three root domains is chosen at random.",
                    "html": "<p>The counter is encoded using the hard-coded alphabet to <code>nrb,</code> and one of Saitama\u2019s three root domains is chosen at random.</p>"
                },
                {
                    "id": "<sentence_0x7c0d18d4>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<code_0x13f8050>": "203",
                        "<code_0x5ba70bb2>": "7808",
                        "<code_0x5cdd11d>": "p6yqqqqp0b67gcj5c2r3gn3l9epzt",
                        "<code_0xdce1882e>": "p6yqqqqp0b67gcj5c2r3gn3l9epzt"
                    },
                    "text": "In this case the message consists of five parts: The digit 2, indicating the RECEIVE command; the ID 203; and an offset indicating which part of the response is being sent; the size of the buffer; and a twelve-byte chunk of the output. These are individually base36-encoded and concatenated together. The resulting string is encoded using a custom base36 alphabet derived from the counter 7808, giving us the message p6yqqqqp0b67gcj5c2r3gn3l9epzt.",
                    "html": "<p>In this case the message consists of five parts: The digit 2, indicating the RECEIVE command; the ID <code>203</code>; and an offset indicating which part of the response is being sent; the size of the buffer; and a twelve-byte chunk of the output. These are individually base36-encoded and concatenated together. The resulting string is encoded using a custom base36 alphabet derived from the counter <code>7808</code>, giving us the message <code><code>p6yqqqqp0b67gcj5c2r3gn3l9epzt</code></code>.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x315d3ff6>",
            "title": "Detection",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x8979ffd4>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xddff68e8>": "https://blog.malwarebytes.com/threat-intelligence/2022/05/apt34-targets-jordan-government-using-new-saitama-backdoor/"
                    },
                    "text": "Malwarebytes customers are protected from this attack via our Anti-Exploit layer. To learn more about the recent attack involving Saitama, read APT34 targets Jordan Government using new Saitama backdoor.",
                    "html": "<p>Malwarebytes customers are protected from this attack via our Anti-Exploit layer. To learn more about the recent attack involving Saitama, read <a href=\"https://blog.malwarebytes.com/threat-intelligence/2022/05/apt34-targets-jordan-government-using-new-saitama-backdoor/\">APT34 targets Jordan Government using new Saitama backdoor</a>.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0xea5ff124>",
            "title": "IOCs",
            "title_level": 3,
            "sentences": []
        },
        {
            "id": "<chapter_0x68c957b4>",
            "title": "Maldoc",
            "title_level": 4,
            "sentences": [
                {
                    "id": "<sentence_0x133923a7>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Confirmation Receive Document.xls<crlf>26884f872f4fae13da21fa2a24c24e963ee1eb66da47e270246d6d9dc7204c2b",
                    "html": "<p>Confirmation Receive Document.xls\n26884f872f4fae13da21fa2a24c24e963ee1eb66da47e270246d6d9dc7204c2b</p>"
                }
            ]
        },
        {
            "id": "<chapter_0xde13d8ab>",
            "title": "Saitama backdoor",
            "title_level": 4,
            "sentences": [
                {
                    "id": "<sentence_0xa1563157>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "update.exe<crlf>e0872958b8d3824089e5e1cfab03d9d98d22b9bcb294463818d721380075a52d",
                    "html": "<p>update.exe\ne0872958b8d3824089e5e1cfab03d9d98d22b9bcb294463818d721380075a52d</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x1cadd456>",
            "title": "C2s",
            "title_level": 4,
            "sentences": [
                {
                    "id": "<sentence_0x75b2b7df>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "uber-asia.com<crlf>asiaworldremit.com<crlf>joexpediagroup.com",
                    "html": "<p>uber-asia.com\nasiaworldremit.com\njoexpediagroup.com</p>"
                },
                {
                    "id": "<sentence_0x46327657>",
                    "is_empty": true,
                    "have_tags": false,
                    "tags": {},
                    "text": "",
                    "html": "<p></p>"
                },
                {
                    "id": "<sentence_0xf58291f5>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "SHARE THIS ARTICLE",
                    "html": "<p>SHARE THIS ARTICLE</p>"
                },
                {
                    "id": "<sentence_0x8315860>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<a_0x4aaaf84a>": "http://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56676&t=How+the+Saitama+backdoor+uses+DNS+tunnelling"
                    },
                    "text": "",
                    "html": "<a class=\"socicon-facebook\" href=\"http://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56676&amp;t=How+the+Saitama+backdoor+uses+DNS+tunnelling\" id=\"social-share-facebook\" target=\"_blank\"></a>"
                },
                {
                    "id": "<sentence_0xfc356b72>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<a_0x215cc0a4>": "https://twitter.com/intent/tweet?text=How+the+Saitama+backdoor+uses+DNS+tunnelling+https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56676&via=Malwarebytes"
                    },
                    "text": "",
                    "html": "<a class=\"socicon-twitter\" href=\"https://twitter.com/intent/tweet?text=How+the+Saitama+backdoor+uses+DNS+tunnelling+https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56676&amp;via=Malwarebytes\" id=\"social-share-twitter\" target=\"_blank\"></a>"
                },
                {
                    "id": "<sentence_0x4b7a8697>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<a_0x3633e251>": "https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56676&title=How+the+Saitama+backdoor+uses+DNS+tunnelling&summary=&source="
                    },
                    "text": "",
                    "html": "<a class=\"socicon-linkedin\" href=\"https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56676&amp;title=How+the+Saitama+backdoor+uses+DNS+tunnelling&amp;summary=&amp;source=\" id=\"social-share-linkedin\" target=\"_blank\"></a>"
                },
                {
                    "id": "<sentence_0x6a8d9bb1>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "ABOUT THE AUTHOR",
                    "html": "<p>ABOUT THE AUTHOR</p>"
                },
                {
                    "id": "<sentence_0x5aa51701>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x73ddb887>": "https://secure.gravatar.com/avatar/a8ee41690458a4b98dd1d11ce4213912?s=96&d=identicon&r=g"
                    },
                    "text": "",
                    "html": "<img alt=\"\" class=\"avatar avatar-96 photo grav-hashed grav-hijack\" height=\"96\" id=\"grav-a8ee41690458a4b98dd1d11ce4213912-0\" src=\"https://secure.gravatar.com/avatar/a8ee41690458a4b98dd1d11ce4213912?s=96&amp;d=identicon&amp;r=g\" width=\"96\"/>"
                },
                {
                    "id": "<sentence_0xcfb8e9b0>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x94215a13>": "https://blog.malwarebytes.com/author/mstockley/"
                    },
                    "text": "Mark Stockley",
                    "html": "<p class=\"details\">\n<a href=\"https://blog.malwarebytes.com/author/mstockley/\" rel=\"author\" title=\"Posts by Mark Stockley\">Mark Stockley</a>\n</p>"
                },
                {
                    "id": "<sentence_0xeeb77c9c>",
                    "is_empty": true,
                    "have_tags": false,
                    "tags": {},
                    "text": "",
                    "html": "<p class=\"desc\"></p>"
                }
            ]
        }
    ]
}