<div> <p>Zscaler’s ThreatLabz research team has been closely monitoring a campaign targeting users in South Korea. This threat actor has been active for more than a year and continues to evolve its tactics, techniques, and procedures (TTPs); we believe with high confidence that the threat actor is associated with Lazarus Group, a sophisticated North Korean advanced persistent threat (APT) group.</p><p>In 2021, the main attack vector used by this threat actor was credential phishing attacks through emails, posing as Naver, the popular South Korean search engine and web portal. </p><p>In 2022, the same threat actor started spoofing various important entities in South Korea, including KRNIC (Korea Internet Information Center), Korean security vendors such as Ahnlab, cryptocurrency exchanges such as Binance, and others. Some details about this campaign were published <a href="https://blog.alyac.co.kr/4586" target="_blank">in this Korean blog,</a> however they did not perform the threat attribution.</p><p>Even though the TTPs of this threat actor evolved over time, there were critical parts of their infrastructure that were reused, allowing ThreatLabz to correlate the attacks and do the threat attribution with a high-confidence level. Our research led us to the discovery of command-and-control (C2) domains even before they were used in active attacks by the threat actor. This proactive discovery of attacker infrastructure helps us in preempting the attacks.</p><p>In this blog, we will share the technical details of the attack chains, and will explain how we correlated this threat actor to Lazarus.</p><p>We would like to thank Dropbox for their quick action in taking down the malicious accounts used by the threat actor, and for also sharing valuable threat intelligence that helped us with threat attribution.
 </p><h2>Attack chains</h2><p>This threat actor has frequently updated its attack chains over the last two months. We identified three unique attack chains used by the threat actor to distribute the malware in emails:</p><p><a class="fancybox-media" href="https://www.zscaler.com/cdn-cgi/image/format=auto/sites/default/files/images/blogs/Lazarus-SK-Naver/Attack%20Flow.png"><img alt="Attack Flow" class="lazyloaded" src="https://www.zscaler.com/cdn-cgi/image/format=auto/sites/default/files/images/blogs/Lazarus-SK-Naver/Attack%20Flow.png" style="max-width:80%;height:auto;width:auto;"/></a></p><p>Figure 1: Attack flow</p><p> </p><h2>Spear phishing emails distribution</h2><p>During our analysis, we discovered that at least one of the IP addresses (222.112.127[.]9) used by the threat actor to log in to the attacker-controlled Dropbox accounts was also used to send spear phishing emails to the victims in South Korea.</p><p>Below are examples of two such emails that were sent from the IP address 222.112.127[.]9. </p><p>Note: This IP address is related to KT Corporation, a Korean telecom provider. Multiple IP addresses related to KT Corporation were abused by this threat actor during the current attack.</p><p>Email #1</p><p>In this email, a macro-based document was sent to the victim.</p><p><a class="fancybox-media" href="https://www.zscaler.com/cdn-cgi/image/format=auto/sites/default/files/images/blogs/Lazarus-SK-Naver/Email%201.png"><img alt="Email-1" class="lazyloaded" src="https://www.zscaler.com/cdn-cgi/image/format=auto/sites/default/files/images/blogs/Lazarus-SK-Naver/Email%201.png" style="max-width:80%;height:auto;width:auto;"/></a></p><p>Figure 2: Email sent to the victim</p><p>Figure 3 below shows that the decoy content of the document is related to Menlo Security company. This is consistent with other decoy contents used by the threat actor. For instance, in the document with MD5 hash: 1a536709554860fcc2c147374556205d, the decoy content used was related to Ahnlab - a Korea-based computer security company. This is done for the purpose of social engineering.</p><p><img alt="Decoy" class="lazyload" style="max-width:80%;height:auto;width:auto;"/></p><p>Figure 3: Decoy content</p><p>Email #2</p><p>In this email, a password protected macro-based XLS file was sent to the victim. The password for the file was mentioned in the email body.</p><p>The theme of the file is related to cryptocurrency investments. This theme is consistent with other documents sent in this campaign as well. Lazarus Group is known to have a keen interest in attacking cryptocurrency users, asset managers, and companies.</p><p><img alt="Email-2" class="lazyload" style="max-width:80%;height:auto;width:auto;"/></p><p>Figure 4: Email sent to the victim</p><p>Figure 5 below shows the sender's IP address in the email headers as indicated by the X-Originating-IP field.</p><p><img alt="Email Header" class="lazyload" style="max-width:80%;height:auto;width:auto;"/></p><p>Figure 5: Email header showing originating IP, Sender and Recipient</p><p> </p><h2>Threat attribution</h2><p>In order to perform the threat actor attribution, we did a correlation of the below data points.</p><p>1. C2 IP addresses</p><p>2. Attacker-controlled Dropbox accounts’ registrant email addresses</p><p>3. C2 domains’ registrant email addresses</p><p>4. Passive DNS data</p><p>5. Sender's email address in credential phishing attacks</p><p>6. Sender's IP address in credential phishing attacks </p><p>Note: OSINT information related to the above data points was also used in correlation analysis.</p><p> </p><h3># Correlating different attacks to same threat actor</h3><p>As described in the network communication section later in the blog, the Stage-3 binary initially connects to an attacker-controlled Dropbox account to fetch a C2 domain which is used to perform further network communication.</p><p>In collaboration with Dropbox, we were able to discover the email addresses associated with the attacker-controlled Dropbox accounts used during this attack. One such email addresses was: peterstewart0326@gmail[.]com</p><p>This same email address was recently mentioned in Prevailion's<a href="https://www.prevailion.com/what-wicked-webs-we-unweave/" target="_blank"> blog</a>. It was linked to several domains which were used during Naver-themed phishing activity.</p><p>Also, according to this<a href="https://blog.naver.com/PostView.naver?blogId=mrs_english&amp;logNo=222289029970" target="_blank"> blog</a> from 2021, this same email address was also used to send Naver-themed credential phishing attack emails to users in South Korea.</p><p>Correlating the above data points, we can say with a high confidence level that the attack chains we have described in this blog are also related to the same threat actor.</p><p> </p><h3># Attribution to Lazarus APT</h3><p>According to the threat infrastructure mapping done in Prevailion<a href="https://www.prevailion.com/what-wicked-webs-we-unweave/" target="_blank"> blog</a>, the IP address 23.81.246[.]131 belongs to one of the critical nodes used by the threat actor during Naver-themed phishing activity. One of the domains linked to this IP address was navercorpservice[.]com. If we check the passive DNS data for this domain, we find two other IP address resolutions: 172.93.201[.]253 in November 2021 and 45.147.231[.]213 in September 2021. </p><p>The IP address 172.93.201[.]253 was recently used to host the domain - disneycareers[.]net which was attributed to Lazarus APT in Google TAG<a href="https://blog.google/threat-analysis-group/countering-threats-north-korea/" target="_blank"> blog</a>. </p><p>Further, what caught our attention was the IP address 45.147.231[.]213. This IP address was earlier used by North Korea-based APT threat actor. Recently, we also had a new domain resolution alert for this IP address as part of our C2 infrastructure tracking. If we pivot on the passive DNS data for this IP address, we can see that the domain: www.devguardmap[.]org was hosted on this IP address in Jan 2021 which was attributed to Lazarus APT as per this<a href="https://twitter.com/ESETresearch/status/1458438155149922312" target="_blank"> tweet</a> from ESET and Google TAG<a href="https://blog.google/threat-analysis-group/update-campaign-targeting-security-researchers/" target="_blank"> blog</a>.</p><p>Correlating all the above data points, we reached the conclusion that the attack-chains we discovered are related to Lazarus threat actor. To the best of our knowledge, at the time of writing, this threat actor attribution has not been publicly documented yet.</p><p> </p><h2>Technical analysis</h2><p>For the purpose of technical analysis we will consider the attack chain starting with a Compiled HTML file having MD5 210db61d1b11c1d233fd8a0645946074.</p><p> </p><h3>[+] Stage 1: Compiled HTML file</h3><p>The CHM file contains a malicious binary embedded inside it. At runtime, this will be dropped on the filesystem in the path: C:\\programdata\\chmtemp\\chmext.exe and executed.</p><p>The code responsible for extracting, dropping and executing the binary is present inside 1hh.html as shown below.</p><p><img alt="Compiled HTML" class="lazyload" style="max-width:80%;height:auto;width:auto;"/></p><p>Figure 6: HTML code dropping and executing the binary</p><p> </p><h3>[+] Stage 2: Dropper</h3><p>The dropper on execution performs the following operations:</p><p>1. Detects sleep patching to identify controlled execution environment such as Sandbox execution</p><p>2. Checks the name of all the running processes and terminates if it finds a process running with the name "v3l4sp.exe". This process name corresponds to the security software developed by Ahnlab (a popular and frequently used security vendor in South Korea).</p><p>3. Creates file in the path "C:\ProgramData\Intel\IntelRST.exe"</p><p>4. XOR decodes the embedded PE from a hardcoded address</p><p>5. Writes the decoded PE to the file created in Step-3</p><p>6. Modifies PEB to masquerade itself as explorer.exe</p><p>7. Executes IntelRST.exe</p><p>8. Creates RUN registry entry for persistence</p><p>Value: IntelCUI</p><p>Data: C:\ProgramData\Intel\IntelRST.exe</p><p> </p><h3>[+] Stage 3: Dropped binary</h3><p>The file IntelRST.exe dropped by the Stage-2 dropper is an ASpacked binary. On execution it performs the following operations:</p><p>1. Similar to the dropper binary it tries to detect sleep patching to identify controlled execution environment</p><p>2. Collects machine information and stores using the specified format which is later exfiltrated and used as machine identifier.</p><p>String format: </p><p>[decoded_string]_[username]_[volume_serial_number_post_8_bytes]</p><p>decoded_string: (encoded string) ^ (key) [encoded_string_byte_offset%keySize]</p><p>username: GetUserName()</p><p>volume_serial _number: Using DeviceIoControl with IOCTL_STORAGE_QUERY_PROPERTY (0x2d1400)</p><p>3. Checks name of all the running processes and terminates if there is some process running with the name "v3l4sp.exe" or "AYAgent.aye" or "IntelRST.exe"</p><p>4. If running with administrator privileges then it executes a PowerShell command using cmd.exe to add WindowsDefender exclusion.</p><p>PowerShell command: Powershell -Command Add-MpPreference -ExclusionPath "C:\ProgramData\Intel\IntelRST.exe</p><p>5. Finally it starts the network communication</p><p> </p><h3>[+] Network communication</h3><p>The network communication occurs in the following sequence:</p><p>1. Send a GET request to the URL "https://dl.dropboxusercontent.com/s/k288s9tu2o53v41/zs_url.txt?dl=0". </p><p>2. Query the file size and send another network request to read the file content.</p><p>Note: The file content points to the C2 domain to be used for rest of the network communication.</p><p>3. Using the extracted C2 domain, send a POST request to the path "/post.php" and exfiltrate collected user information.</p><p>Exfiltrated user information format:</p><p>uid={string_generated_in_Step-2_of_Stage-3_binary}&amp;avtype=%d&amp;majorv=%d&amp;minorv=%d</p><p>4. Finally send a GET request to the path "/{decoded_string_from_step-2_of_Stage-3_binary}/{formated_string_from_step-2_of_Stage-3_binary}/fecommand.acm"</p><p>Note: At the time of analysis we didn't get any active response from the C2 server for the above network request.</p><p> </p><h2>Zscaler Cloud Sandbox detection</h2><p># Document detection</p><p><img alt="Document - Sandbox Report" class="lazyload" style="max-width:80%;height:auto;width:auto;"/></p><p># Dropper detection</p><p><img alt="Dropper - Sandbox Report" class="lazyload" style="max-width:80%;height:auto;width:auto;"/>
</p><p> </p><h2>Indicators of compromise</h2><p>[+] Hashes</p><p> </p><table><tbody><tr><td><p>MD5</p></td><td><p>Description</p></td></tr><tr><td><p>37505b6ff02a679e70885ccd60c13f3b</p><p>c156572dd81c3b0072f62484e90e47a0</p></td><td><p>Document</p></td></tr><tr><td><p>d7f6b09775b8d90d79404eda715461b7</p><p>a0f565f7f579f0d397a42db5a95d4ae8</p><p>e2e5644e77e75e422bde075f409d882e</p><p>37b7415442ab8ca01e08b2d7bfe809e2</p><p>d19dd02cf375d0d03f557556d5207061</p><p>e3ffda448df223b240a20dae41e20cef</p><p>e732bc87033a935bd2d3d56c7772641b</p><p>825730d9dd22dbae7f2bd89131466415</p><p>c32f40f304777df7cfab428a54bb818b</p><p>b587851d8a42fc8c23f638bbc2eb866b</p><p>4382384feb5ad6b574f68e431006905e</p><p>493f59b6933e59029bf3106fd4a2998d</p><p>bdfb5071f5374f5c0a3714464b1fa5e6</p><p>1769a818548a0b52c7be2a0a213a9384</p><p>7b07cd6bb6b5d4ed6a2892a738fe892b</p><p>9775ef6514916977d73e39a6b09029bc</p><p>44be20c67a80af8066f9401c5bee43cb</p><p>15a7125fe9e629122e1d1389062af712</p><p>1fd8fef169bf48cfdcf506151264128c</p><p>9ad00e513364e9f44f1b6712907cba9b</p><p>1a536709554860fcc2c147374556205d</p><p>a2aca7b66f678b85fc7b4015af21c5ee</p><p>bd416ea51f94d815b5b5b66861cbdcc5</p><p>ecb2d07ede5a401c83a5fca8e00fa37a</p><p>db0483aced77a7db130a6100aef67967</p><p>c0b24dc8f53227ce0c64439b302ca930</p><p>bb9ee3a6504fbf6a5486af04dbbb5da5</p><p>ce00749c908de017010055a83ac0654f</p><p>2677f9871cb340750e582cb677d40e81</p></td><td><p>Document (Template based)</p></td></tr><tr><td><p>90f2b7845c203035f0d7096aa28dda83</p><p>044e701e8d288075b0fb6cd118aa94db</p><p>556abc167348fe96abfbf5079c3ad488</p><p>0ef32b48f6ca3a1a22ab87058b3d8aa0</p><p>4548c7f157d300ec39b1821db4daa970</p><p>430d944786e05042cdbe1d795ded2199</p><p>96d86472ff283f6959b7a779f004dfba</p><p>137910039cb94c0301154f3d1ec9ba29</p><p>728b908e90930c73edeb1bf58b6a3a64</p><p>1559aeb8e464759247e4588cb6a09877</p><p>6df608342938f0d30a058c48bb9d8d4d</p><p>78aa7e785a96f2826ee09a1aa9ab776e</p><p>0c2dde41d508941cf215fe8f1f7e03a7</p><p>783e7c3ba39daa28301b841785794d76</p><p>a225b7aff737dea737cd969fb307df23</p></td><td><p>Template</p></td></tr><tr><td><p>210db61d1b11c1d233fd8a0645946074</p><p>e25ac08833416b8c7191639b60edfa21</p><p>114f22f3dd6928bed5c779fa918a8f11</p></td><td><p>Compiled HTML (CHM)</p></td></tr></tbody></table><p> </p><p>[+] File names
 </p><table><tbody><tr><td><p>Original Name</p></td><td><p>Translated Name</p></td></tr><tr><td><p>확진자 및 동거인 안내문 (50).chm</p><p>메타콩즈가이드_1900002.chm</p><p>NFT Metakongz Minting.chm</p><p>202204_암호화폐_투자기획.docx</p><p>사건 경위서.docx</p><p>마산합포구 400억 대출요청.docx</p><p>40억_자금투자계약서.docx</p><p>긴급재난지원금신청서양식.docx</p><p>대한광산개발(주).docx</p><p>크립토스_로그인.docx</p></td><td><p>Guide to confirmed cases and living with them (50).chm</p><p>Meta Kong's Guide_190002.chm</p><p>NFT Metakongz Minting.chm</p><p>202204_Cryptocurrency_Investment Planning.docx</p><p>incident report.docx</p><p>Masanhappo-gu 40 billion loan request.docx</p><p>4 billion_fund investment contract.docx</p><p>Emergency Disaster Subsidy Application Form.docx</p><p>Daehan Mine Development Co., Ltd. docx</p><p>cryptos_login.docx</p></td></tr></tbody></table><p> </p><p>[+] C2 domains</p><p>naveicoipg[.]online
naveicoipf[.]online
naveicoipc[.]tech
naveicoipa[.]tech
naveicoipe[.]tech
naveicoipd[.]tech
naveicoipep[.]tech
naveicoiph[.]online
naveicoipg[.]tech
naveicoipf[.]tech
naveicoipb[.]tech
naveicoipj[.]online
naveicoipi[.]online
naveicoipe[.]online
naveicoipd[.]online
naveicoipc[.]online
naveicoipb[.]online
naveicoipa[.]online
naveicoipc[.]com
naveicoipa[.]com
naveicoip[.]com
naveicoiph[.]tech
naveicoip[.]tech
naveicorp[.]com
copycatfrag[.]store
knightsfrag[.]store
parfumeparlour[.]store</p><p># New domain resolutions for the IP 23.81.246[.]131</p><p>navernidb[.]link
navermailteam[.]online
navermailservice[.]com
mailservicecorp[.]online
mailhelp[.]online
mailcustomerservice[.]site
cloudcentre[.]xyz
naverservice[.]host
mailserviceteam[.]email
navermcorp[.]com
naverserviceteam[.]com
naversecurityteam[.]com
navermanageteam[.]com
navermailmanage[.]com
navercorpservice[.]com
navermailcorp[.]com
naversecurityservice[.]online
navermailservice[.]online
navercorp[.]live
navercscorp[.]com
navermanage[.]live
navermanage[.]com
navernidmail[.]com
noreplya[.]xyz</p><p>[+] Emails</p><p># Dropbox accounts associated email addresses</p><p>peterstewart0326@gmail[.]com
kimkl0222@hotmail[.]com
laris081007@hotmail[.]com</p><p>[+] PDB path</p><p>D:\Works\PC_2022\ACKS_2012\fengine\Release\fengine.pdb</p><p> </p><h2>About us</h2><p><a href="https://www.zscaler.com/threatlabz/">Zscaler ThreatLabz</a> is a global threat research team with a mission to protect customers from advanced cyberthreats. Made up of more than 100 security experts with decades of experience in tracking threat actors, malware reverse engineering, behavior analytics, and data science, the team operates 24/7 to identify and prevent emerging threats using insights from 300 trillion daily signals from the Zscaler Zero Trust Exchange.</p><p>Since its inception, ThreatLabz has been tracking the evolution of emerging threat vectors, campaigns, and groups, contributing critical findings and insights on zero-day vulnerabilities, —including active IOCs and TTPs for threat actors, malware, and ransomware families, phishing campaigns, and more.</p><p>ThreatLabz supports industry information sharing and plays an integral role in the development of world-class security solutions at Zscaler. See <a href="https://www.zscaler.com/blogs/security-research">the latest ThreatLabz threat research</a> on the Zscaler blog.</p><ul class="zp-0 zm-0 category-tags"><li class="d-block d-md-inline-block zmt-8 zmt-md-0 zmb-8 zmx-md-8"> <a class="h4 fw-400 fg-color-white bg-color-blue zpy-10 zpx-16 zmb-0 rounded d-inline-block category-tag" href="https://www.zscaler.com/blogs/security-research">Security Research</a></li><li class="d-block d-md-inline-block zmt-8 zmt-md-0 zmb-8 zmx-md-8"> <a class="h4 fw-400 fg-color-white bg-color-blue zpy-10 zpx-16 zmb-0 rounded d-inline-block category-tag" href="https://www.zscaler.com/blogs/insights-and-research">Insights and Research</a></li></ul><ul class="w-100 text-center text-md-left sharing-buttons zp-0 zm-0"><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="mailto:?subject=A%20%22Naver%22-ending%20game%20of%20Lazarus%20APT&amp;body=https://bit.ly/3jHwDlr" title="Share via email"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.facebook.com/sharer/sharer.php?u=https://bit.ly/3jHwDlr" target="_blank" title="Share on facebook"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.linkedin.com/sharing/share-offsite/?title=A%20%22Naver%22-ending%20game%20of%20Lazarus%20APT&amp;url=https://bit.ly/3jHwDlr" target="_blank" title="Share on linkedin"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://twitter.com/intent/tweet?text=https://bit.ly/3jHwDlr%20%E2%80%94%20A%20%22Naver%22-ending%20game%20of%20Lazarus%20APT" target="_blank" title="Tweet"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.zscaler.com/blogs/feeds/security-research" title="Check feeds"> </a></li></ul><h2 class="fw-400 fg-color-blue zmb-0 zmt-15 zmt-md-0">Authors</h2><h3 class="zp-12 zmb-4 drop-shadow-hover"> <a class="fg-color-black" href="https://www.zscaler.com/author/sahils" title="Read all blog by Sahil Antil">Sahil Antil</a> </h3><h3 class="zp-12 zmb-4 drop-shadow-hover"> <a class="fg-color-black" href="https://www.zscaler.com/author/sudeepsingh" title="Read all blog by Sudeep Singh">Sudeep Singh</a> </h3> <a class="zmx-12 author-social d-inline-block" href="https://www.linkedin.com/in/sudeep-singh-96559026/" target="_blank" title="Check linkedin profile"> </a><h2 class="fw-400 fg-color-blue zmb-md-24 zmb-0">Recommended for You</h2><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/zscaler-threatlabz-discovers-multiple-product-bugs-adobe-acrobat" title="Zscaler ThreatLabz Discovers Multiple Product Bugs in Adobe Acrobat">Zscaler ThreatLabz Discovers Multiple Product Bugs in Adobe Acrobat</a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/uncovering-new-techniques-and-phishing-attack-trends-cloud" title="Uncovering new techniques and phishing attack trends from the cloud">Uncovering new techniques and phishing attack trends from the cloud</a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/product-insights/latest-sandworm-botnet-attack-shows-why-firewalls-cant-do-zero-trust" title="The Latest Sandworm Botnet Attack Shows Why Firewalls Can’t Do Zero Trust">The Latest Sandworm Botnet Attack Shows Why Firewalls Can’t Do Zero Trust</a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/product-insights/top-5-benefits-cloud-native-application-protection-platform-cnapp" title="The Top 5 Benefits of a Cloud-Native Application Protection Platform (CNAPP) ">The Top 5 Benefits of a Cloud-Native Application Protection Platform (CNAPP) </a></h6></div>