<div>
<a href="https://avast.io/">
						More on
Avast Inside Out
 </a>
<a href="https://decoded.avast.io/" rel="home"><img alt="Avast Threat Labs" src="https://decoded.avast.io/wp-content/uploads/sites/2/2019/06/Asset-22ldpi.png" style="max-width:80%;height:auto;width:auto;"/></a>
<ul class="johannes-menu-action johannes-hamburger">
<li><a href="">Menu</a></li>
</ul>
<a href="https://decoded.avast.io/" rel="home"><img alt="Avast Threat Labs" src="https://decoded.avast.io/wp-content/uploads/sites/2/2019/06/Asset-22ldpi.png" style="max-width:80%;height:auto;width:auto;"/></a>
<a href="https://avast.io/">
More on Avast Inside Out
</a>
<a href="https://decoded.avast.io/?s="></a>
<ul class="johannes-menu-action johannes-hamburger">
<li><a href="">Menu</a></li>
</ul>
<img alt="" class="attachment-johannes-single-3 size-johannes-single-3 wp-post-image" height="500" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/GettyImages-984824408_edited-1920x500.jpg" style="max-width:800px;height:auto;width:auto;" width="1920"/>
<h1 class="entry-title">Avast Finds Compromised Philippine Navy Certificate Used in Remote Access Tool</h1> 
by <a href="https://decoded.avast.io/author/threatintel/">Threat Intelligence Team</a>March 28, 20224 min read 
<p>Avast Threat Intelligence Team has found a remote access tool (RAT) actively being used in the wild in the Philippines that uses what appears to be a compromised digital certificate belonging to the Philippine Navy. This certificate is now expired but we see evidence it was in use with this malware in June 2020. </p>
<p>Based on our research, we believe with a high level of confidence that the threat actor had access to the private key belonging to the certificate.</p>
<p>We got in touch with <a href="https://www.ncert.gov.ph" rel="noreferrer noopener" target="_blank">CERT-PH, the National Computer Emergency Response Team for the Philippines</a> to help us contact the navy. We have shared with them our findings. The navy security team later let us know that the incident has been resolved and no further assistance was necessary from our side.</p>
<p>Because this is being used in active attacks now, we are releasing our findings immediately so organizations can take steps to better protect themselves. We have found that this sample is now <a href="https://www.virustotal.com/gui/file/85fa43c3f84b31fbe34bf078af5a614612d32282d7b14523610a13944aadaacb" rel="noreferrer noopener" target="_blank">available on VirusTotal</a>.</p>
<h2>Compromised Expired Philippine Navy Digital Certificate</h2>
<p>In our analysis we found the sample connects to <code>dost[.]igov-service[.]net:8443</code> using TLS in a statically linked OpenSSL library.</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5627" height="266" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-22.png" style="max-width:800px;height:auto;width:auto;" width="1085"/></figure>
<p>A WHOIS lookup on the C&amp;C domain gave us the following:</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5628" height="428" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-23.png" width="393"/></figure>
<p>The digital certificate was pinned so that the malware requires the certificate to communicate.</p>
<p>When we checked the digital certificate used for the TLS channel we found the following information:</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5630" height="512" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-25.png" width="402"/></figure>
<p>Some important things to note:</p>
<ul><li>The certificate is a valid certificate with a subject of <code>*.navy.mil.ph</code>, the Philippine Navy.</li><li>The certificate has recently expired: it was valid for one year, from Sunday December 15, 2019 until Tuesday December 15, 2020.</li><li>Our research shows that <a href="https://censys.io" rel="noreferrer noopener" target="_blank">Censys</a> saw <a href="https://search.censys.io/certificates/992310ac9ea465cf62c6e93c1fd86ec5ae266364ef0b35acd2688063b1e59f25" rel="noreferrer noopener" target="_blank">this certificate employed by the actual navy.mil.ph website</a></li></ul>
<p>Based on our research, we believe with a high level of confidence that the threat actor had access to the private key belonging to the certificate.</p>
<p>While the digital certificate is now expired we see evidence it was in use with this malware in June 2020. </p>
<p>The malicious PE file was found with filename: <code>C:\Windows\System32\wlbsctrl.dll</code> and its hash is: <code>85FA43C3F84B31FBE34BF078AF5A614612D32282D7B14523610A13944AADAACB</code>.</p>
<p>In analyzing that malicious PE file itself, we found that the compilation timestamp is wrong or was edited. Specifically, the <code>TimeDateStamp</code> of the PE file was modified and set to the year 2004 in both the PE header and Debug Directory as shown below:</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5633" height="244" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-26.png" style="max-width:800px;height:auto;width:auto;" width="767"/></figure>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5634" height="163" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-27.png" width="592"/></figure>
<p>However, we found that the author used OpenSSL 1.1.1g and compiled it on April 21, 2020 as shown below:</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5635" height="138" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-28.png" width="611"/></figure>
<p>The username of the author was probably <code>udste</code>. This can be seen in the debug information left inside the used OpenSSL library.</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5636" height="224" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-29.png" style="max-width:800px;height:auto;width:auto;" width="704"/></figure>
<p>We found that the malware supported the following commands:</p>
<ul><li>run shellcode</li><li>read file</li><li>write file</li><li>cancel data transfer</li><li>list drives</li><li>rename a file</li><li>delete a file</li><li>list directory content</li></ul>
<figure class="aligncenter size-full"><img alt="" class="wp-image-5638" height="153" src="https://decoded.avast.io/wp-content/uploads/sites/2/2022/03/image-31.png" width="407"/></figure>
<p>Some additional items of note regarding the malicious PE file:</p>
<ul><li>All configuration strings in the malware are encrypted using <code>AES-CBC</code> with the exception of the mutex it uses.That mutex is used as-is without decryption: <code>t7As7y9I6EGwJOQkJz1oRvPUFx1CJTsjzgDlm0CxIa4=</code>.</li><li>When this string <a href="https://gchq.github.io/CyberChef/#recipe=From_Hex('Auto')From_Base64('A-Za-z0-9%2B/%3D',true)AES_Decrypt(%7B'option':'Hex','string':'40%206e%209c%20b6%20df%20e1%202a%2063%20f5%202f%203f%209a%2032%20ae%200a%20e0%20c8%2092%2087%208b%2028%20ec%2077%2048%204a%20b7%20f9%2019%20%2091%20cd%20c3%205f%20'%7D,%7B'option':'Hex','string':'03%20b5%2064%20f4%20ad%2087%20e4%20ea%20c0%2029%2026%20c4%208b%203c%20ce%204b%20'%7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D,%7B'option':'Hex','string':''%7D)&amp;input=NzQgMzcgNDEgNzMgMzcgNzkgMzkgNDkgMzYgNDUgNDcgNzcgNEEgNEYgNTEgNkIgNEEgN0EgMzEgNkYgNTIgNzYgNTAgNTUgNDYgNzggMzEgNDMgNEEgNTQgNzMgNkEgN0EgNjcgNDQgNkMgNkQgMzAgNDMgNzggNDkgNjEgMzQgM0QgMDA" rel="noreferrer noopener" target="_blank">is decrypted</a> using the hard-coded key it decrypts to <code>QSR_MUTEX_zGKwWAejTD9sDitYcK</code>. We suspect that this is a failed attempt to disguise this malware as the infamous Quasar RAT malware. But this cannot be the case because this sample is written in C++ and the Quasar RAT is written in C#.</li></ul>
<p>Avast customers are protected against this malware.</p>
<h2>Indicators of Compromise (IoC)</h2>
<ul><li>Repository: <a href="https://github.com/avast/ioc/tree/master/Philippine-Navy-Certificate" rel="noreferrer noopener" target="_blank">https://github.com/avast/ioc/tree/master/Philippine-Navy-Certificate</a></li></ul>
<figure class="wp-block-table"><table><tbody><tr><td>SHA256</td><td>File name</td></tr><tr><td>85FA43C3F84B31FBE34BF078AF5A614612D32282D7B14523610A13944AADAACB</td><td>C:\Windows\System32\wlbsctrl.dll</td></tr></tbody></table></figure>
<figure class="wp-block-table"><table><tbody><tr><td>Mutex</td></tr><tr><td>t7As7y9I6EGwJOQkJz1oRvPUFx1CJTsjzgDlm0CxIa4=</td></tr></tbody></table></figure>
<figure class="wp-block-table"><table><tbody><tr><td>C&amp;C server</td></tr><tr><td>dost[.]igov-service[.]net:8443</td></tr></tbody></table></figure>
Tagged as<a href="https://decoded.avast.io/tag/analysis/" rel="tag">analysis</a>, <a href="https://decoded.avast.io/tag/backdoor/" rel="tag">backdoor</a>, <a href="https://decoded.avast.io/tag/malware/" rel="tag">malware</a>, <a href="https://decoded.avast.io/tag/rat/" rel="tag">rat</a> 
Share:<a class="meks_ess-item socicon-twitter" href="#">Twitter</a><a class="meks_ess-item socicon-facebook" href="#">Facebook</a>
</div>