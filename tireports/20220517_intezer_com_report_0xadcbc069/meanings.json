{
    "title": "SOC Level Up: Threat Hunting and Detection With Sigma",
    "url": "https://www.intezer.com/blog/threat-hunting/threat-hunting-sigma-detection-rules",
    "threats": {
        "Threat": [
            {
                "token": {
                    "id": "<THREAT_0x8bd5383c>",
                    "type": "Threat",
                    "value": "emotet"
                },
                "references": {
                    "sentences": [
                        "Both rules are based on behavior that was seen in different samples of Emotet. We can make the first rule even more strict by using specific commands and file names in the commandline specification. The second rule is based on a file that is seen in Emotet samples while it might look like a false positive, based on our observations this file can be used as a good indication of malicious activity caused by Emotet.",
                        "Our goal is to have solid detection rules that will not produce false positive alerts and will help protect the organization. We need to make our Sigma rules more advanced, to catch variants within a malware family like Emotet.",
                        "Family page view for Emotet in an enterprise account, showing the relevant detection opportunities",
                        "Emotet detection rule based on indicators that are common in the Emotet family.",
                        "Emotet",
                        "Emotet is a threat that is constantly evolving not only its features but also its infrastructure which is based on botnets that deliver the malware to victims systems, allowing the attackers to constantly change the domains and the IP addresses of these servers. As described in the Pyramid of Pain, mentioned above, it is relatively easy for attackers to change the hashes and IP addresses once they are detected by security tools and organizations. This makes some of the detection rules useless as the indicators are not relevant anymore.",
                        "Analysis of Emotet",
                        "Emotet detection based on indicators that are common in the Emotet family",
                        "Lets examine another Excel file that delivers Emotet:",
                        "The file was executed in Intezers sandbox and its behavior was analyzed allowing the platform to extract detection indicators. In this file we have 24 indicators total and five of them were previously seen in other Emotet samples. The indicators of this file can produce good detection rules as they are based on the execution process, which is a key part of the malware. This reduces the chances of the threat actor changing these indicators (unlike file names or URLs that are easy to change).",
                        "To be able to detect Emotet and similar threats that evolve, we need to find the detection indicators that are shared among the malware family. This detection strategy will produce alerts that are specific for a certain threat, because we will use indicators that are part of the threats behavior and were used more than once."
                    ],
                    "titles": [
                        "Conclusion",
                        "There is a But",
                        "Take the Detection Opportunities a Step Further"
                    ]
                }
            }
        ]
    },
    "ttps": {},
    "meanings": {
        "Category": [
            {
                "token": {
                    "id": "<CATEGORY_0xd91561a2>",
                    "type": "Category",
                    "value": "botnet"
                },
                "references": {
                    "sentences": [
                        "Emotet is a threat that is constantly evolving not only its features but also its infrastructure which is based on botnets that deliver the malware to victims systems, allowing the attackers to constantly change the domains and the IP addresses of these servers. As described in the Pyramid of Pain, mentioned above, it is relatively easy for attackers to change the hashes and IP addresses once they are detected by security tools and organizations. This makes some of the detection rules useless as the indicators are not relevant anymore."
                    ],
                    "titles": [
                        "There is a But"
                    ]
                }
            },
            {
                "token": {
                    "id": "<CATEGORY_0xf1a480bb>",
                    "type": "Category",
                    "value": "malware"
                },
                "references": {
                    "sentences": [
                        "Both rules are based on behavior that was seen in different samples of Emotet. We can make the first rule even more strict by using specific commands and file names in the commandline specification. The second rule is based on a file that is seen in Emotet samples while it might look like a false positive, based on our observations this file can be used as a good indication of malicious activity caused by Emotet.",
                        "Our goal is to have solid detection rules that will not produce false positive alerts and will help protect the organization. We need to make our Sigma rules more advanced, to catch variants within a malware family like Emotet.",
                        "Nicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps.",
                        "Creating good and efficient detection rules is a form of art. There could be more than one correct way to write a rule from the same indicators. But at the end of the day, our goal is to detect threats and stop them and for that we need to know which indicators are unique to a specific threat and less likely to change among the variants of the malware.",
                        "Emotet is a threat that is constantly evolving not only its features but also its infrastructure which is based on botnets that deliver the malware to victims systems, allowing the attackers to constantly change the domains and the IP addresses of these servers. As described in the Pyramid of Pain, mentioned above, it is relatively easy for attackers to change the hashes and IP addresses once they are detected by security tools and organizations. This makes some of the detection rules useless as the indicators are not relevant anymore.",
                        "To implement this approach we will need to have information about the connections between samples of the same malware family, and identify detection indicators that are common in a specific malware family. Intezer offers this capability, with a proprietary code reuse database that also extracts valuable information about the detection indicators of different malware samples.<crlf>In the next section here, we will show how to build Sigma rules using detection indicators that are shared among several samples of the same threat.",
                        "The file was executed in Intezers sandbox and its behavior was analyzed allowing the platform to extract detection indicators. In this file we have 24 indicators total and five of them were previously seen in other Emotet samples. The indicators of this file can produce good detection rules as they are based on the execution process, which is a key part of the malware. This reduces the chances of the threat actor changing these indicators (unlike file names or URLs that are easy to change).",
                        "To be able to detect Emotet and similar threats that evolve, we need to find the detection indicators that are shared among the malware family. This detection strategy will produce alerts that are specific for a certain threat, because we will use indicators that are part of the threats behavior and were used more than once."
                    ],
                    "titles": [
                        "Conclusion",
                        "There is a But",
                        "Take the Detection Opportunities a Step Further"
                    ]
                }
            }
        ],
        "Geo": [
            {
                "token": {
                    "id": "<GEO_0x8c658494>",
                    "type": "Geo",
                    "value": "israel"
                },
                "references": {
                    "sentences": [
                        "Nicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps."
                    ],
                    "titles": [
                        "Conclusion"
                    ]
                }
            }
        ]
    },
    "iocs": {},
    "unknownwords": {
        "UnknownWord": [
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x50ccc5d7>",
                    "type": "UnknownWord",
                    "value": "pyramid"
                },
                "references": {
                    "sentences": [
                        "Emotet is a threat that is constantly evolving not only its features but also its infrastructure which is based on botnets that deliver the malware to victims systems, allowing the attackers to constantly change the domains and the IP addresses of these servers. As described in the Pyramid of Pain, mentioned above, it is relatively easy for attackers to change the hashes and IP addresses once they are detected by security tools and organizations. This makes some of the detection rules useless as the indicators are not relevant anymore.",
                        "pyramid of pain"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x192fefe1>",
                    "type": "UnknownWord",
                    "value": "pain"
                },
                "references": {
                    "sentences": [
                        "Emotet is a threat that is constantly evolving not only its features but also its infrastructure which is based on botnets that deliver the malware to victims systems, allowing the attackers to constantly change the domains and the IP addresses of these servers. As described in the Pyramid of Pain, mentioned above, it is relatively easy for attackers to change the hashes and IP addresses once they are detected by security tools and organizations. This makes some of the detection rules useless as the indicators are not relevant anymore.",
                        "pyramid of pain"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x98874a18>",
                    "type": "UnknownWord",
                    "value": "anymore"
                },
                "references": {
                    "sentences": [
                        "Emotet is a threat that is constantly evolving not only its features but also its infrastructure which is based on botnets that deliver the malware to victims systems, allowing the attackers to constantly change the domains and the IP addresses of these servers. As described in the Pyramid of Pain, mentioned above, it is relatively easy for attackers to change the hashes and IP addresses once they are detected by security tools and organizations. This makes some of the detection rules useless as the indicators are not relevant anymore."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x6b3873f>",
                    "type": "UnknownWord",
                    "value": "produce"
                },
                "references": {
                    "sentences": [
                        "We can use the information provided by Intezer to produce the following Sigma rule:",
                        "Our goal is to have solid detection rules that will not produce false positive alerts and will help protect the organization. We need to make our Sigma rules more advanced, to catch variants within a malware family like Emotet.",
                        "The file was executed in Intezers sandbox and its behavior was analyzed allowing the platform to extract detection indicators. In this file we have 24 indicators total and five of them were previously seen in other Emotet samples. The indicators of this file can produce good detection rules as they are based on the execution process, which is a key part of the malware. This reduces the chances of the threat actor changing these indicators (unlike file names or URLs that are easy to change).",
                        "To be able to detect Emotet and similar threats that evolve, we need to find the detection indicators that are shared among the malware family. This detection strategy will produce alerts that are specific for a certain threat, because we will use indicators that are part of the threats behavior and were used more than once."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xaa313688>",
                    "type": "UnknownWord",
                    "value": "strict"
                },
                "references": {
                    "sentences": [
                        "Both rules are based on behavior that was seen in different samples of Emotet. We can make the first rule even more strict by using specific commands and file names in the commandline specification. The second rule is based on a file that is seen in Emotet samples while it might look like a false positive, based on our observations this file can be used as a good indication of malicious activity caused by Emotet."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x4071cfc3>",
                    "type": "UnknownWord",
                    "value": "commandline"
                },
                "references": {
                    "sentences": [
                        "Both rules are based on behavior that was seen in different samples of Emotet. We can make the first rule even more strict by using specific commands and file names in the commandline specification. The second rule is based on a file that is seen in Emotet samples while it might look like a false positive, based on our observations this file can be used as a good indication of malicious activity caused by Emotet."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x8103e894>",
                    "type": "UnknownWord",
                    "value": "nicole"
                },
                "references": {
                    "sentences": [
                        "Nicole Fishbein",
                        "Nicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xf28d14e8>",
                    "type": "UnknownWord",
                    "value": "fishbein"
                },
                "references": {
                    "sentences": [
                        "Nicole Fishbein"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x2f9dfa08>",
                    "type": "UnknownWord",
                    "value": "she"
                },
                "references": {
                    "sentences": [
                        "Nicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x35841148>",
                    "type": "UnknownWord",
                    "value": "idf"
                },
                "references": {
                    "sentences": [
                        "Nicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps."
                    ],
                    "titles": []
                }
            }
        ]
    },
    "other_links": [],
    "info": {
        "potential_threats": {
            "<UNKNOWNWORD_0x50ccc5d7>": {
                "token": {
                    "id": "<UNKNOWNWORD_0x50ccc5d7>",
                    "type": "UnknownWord",
                    "value": "pyramid"
                },
                "references": {
                    "sentences": [
                        "Emotet is a threat that is constantly evolving not only its features but also its infrastructure which is based on botnets that deliver the malware to victims systems, allowing the attackers to constantly change the domains and the IP addresses of these servers. As described in the Pyramid of Pain, mentioned above, it is relatively easy for attackers to change the hashes and IP addresses once they are detected by security tools and organizations. This makes some of the detection rules useless as the indicators are not relevant anymore.",
                        "pyramid of pain"
                    ],
                    "titles": []
                }
            },
            "<UNKNOWNWORD_0xf28d14e8>": {
                "token": {
                    "id": "<UNKNOWNWORD_0xf28d14e8>",
                    "type": "UnknownWord",
                    "value": "fishbein"
                },
                "references": {
                    "sentences": [
                        "Nicole Fishbein"
                    ],
                    "titles": []
                }
            }
        },
        "sigma": true,
        "yara": false
    },
    "keywords": {
        "classified": [],
        "dubbed": [],
        "associated": [],
        "targets": [],
        "attributed": []
    },
    "resources": {
        "links": {
            "github": [],
            "pastebin": [],
            "text_files": [],
            "other": [
                "https://www.intezer.com/blog/malware-analysis/emotet-evolves-but-code-remains-mostly-the-same/",
                "https://analyze.intezer.com/files/12315dbe67fd3db9ce3c1f520fef14e10e946b7a1d8628583c2a26949312edc5/detect-hunt",
                "https://analyze.intezer.com/files/12315dbe67fd3db9ce3c1f520fef14e10e946b7a1d8628583c2a26949312edc5/detect-hunt",
                "https://analyze.intezer.com/api/docs/documentation",
                "https://analyze.intezer.com/families/db6abbcc-d292-4991-bc90-207c077f5e53",
                "https://analyze.intezer.com/",
                "https://twitter.com/NicoleFishi19",
                "https://www.intezer.com/tag/emotet/",
                "https://www.intezer.com/tag/pyramid-of-pain/",
                "https://www.intezer.com/tag/sigma-rules/",
                "https://www.intezer.com/tag/threat-hunting/"
            ]
        },
        "images": [
            "https://lh3.googleusercontent.com/WbRp7T2K3kafsL-Ew6UPGrPG0k_U3HS_248jLBIxA6GTuh7jMQngegsSt_ZLfbxaHemootB-1yNZsEDQROzjDiDc2hy9Ysona61WL6rugaHUBSw7RjiL1S412iW4zwiNg0_FL8-fLe8_0rcwTQ",
            "https://lh6.googleusercontent.com/TJaUi8MB3CtRCggWPwOf9s2j-nWSEZUcR3Kn7t-8v04PKp5hA0GjPvS3FYH4ABHr1bvQ2lBK66FBh__IVyr07Yuzqw8UUi506mnGXr7nLYJ3QR7S8cCPHw8pPYDK1qiu13R2EPxY3ziXN8m55g",
            "https://149520725.v2.pressablecdn.com/wp-content/uploads/2020/07/Screenshot_20200720-202117__01-60x60.png"
        ]
    }
}