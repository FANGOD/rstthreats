{"id": "sentence_0xf0937ce", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xd37b557e", "chapter_title": "Grandoreiro Banking Malware Resurfaces for Tax Season", "text": "access_timeMay 26, 2022 person_outlineBernard Bautista share"}
{"id": "sentence_0x4b1011d7", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xd37b557e", "chapter_title": "Grandoreiro Banking Malware Resurfaces for Tax Season", "text": "Trustwave SpiderLabs in early April observed a Grandoreiro malware campaign targeting bank users from Brazil, Spain, and Mexico. The campaign exploits the tax season in target countries by sending out tax-themed phishing emails."}
{"id": "sentence_0x10732d44", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xd37b557e", "chapter_title": "Grandoreiro Banking Malware Resurfaces for Tax Season", "text": "Grandoreiro was first detected in 2016 is one of the largest banking trojan families developed to strike targets Latin America. The malware can log keystrokes, capture clipboard data, steal cookies and other user information using malicious browser extensions, and monitor online banking activity."}
{"id": "sentence_0xe81f11d0", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x226b69da", "chapter_title": "Spam Delivery", "text": "An attack begins with threat actor distributing email spam in Portuguese. The email pretends to be a memo coming from Servio de Administrao Fiscal or Tax Administration Service as translated. It has a link that downloads a malicious PDF document hosted on a compromised website."}
{"id": "sentence_0xe58ae844", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x226b69da", "chapter_title": "Spam Delivery", "text": "Figure 1. Email spam in Portuguese"}
{"id": "sentence_0x3a600e11", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x226b69da", "chapter_title": "Spam Delivery", "text": "The PDF purports to come from DocuSign and tricks the user into clicking the link leading to a ZIP archive containing an MSI installer. The same compromised website as the PDF document also hosts the ZIP archive."}
{"id": "sentence_0x92e23679", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x226b69da", "chapter_title": "Spam Delivery", "text": "Figure 2. DocuSign-themed PDF file"}
{"id": "sentence_0x5dd9aad3", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "Digging deeper into the MSI installer using the Orca MSI Editor, we observed a suspicious code embedded in the CustomAction table. The CustomAction enables the author of an installation package to extend the capabilities of standard actions by including executables, dynamic-link libraries, and scripts."}
{"id": "sentence_0xe73faa1b", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "Figure 3. CustomAction table view in Orca MSI Editor"}
{"id": "sentence_0x297274a2", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "The block of the custom code written in JScript serves as a downloader of the final payload. The code will perform host and IP address location checks before it downloads, extracts, and executes the final payload."}
{"id": "sentence_0x3c5d677d", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "The JScript code avoids infecting a host with dx as the network username. It uses the geolocation service http[://]ip-api[.]com/json to gather the targets IP address location data. Distribution of the final payload is only limited to IP addresses located in Brazil, Spain, and Mexico. After passing the checks, the final payload will be downloaded from hxxp[://]167[.]114[.]43[.]27:4433/mrrrpx2503[.]zip and extracted at %AppData%\\Roaming\\RIPIOSDS in the background."}
{"id": "sentence_0xbd23d378", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "Figure 4. Code snippet of the JScript custom action"}
{"id": "sentence_0x229afc2e", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "Figure 5. JScript block that checks for IP address location"}
{"id": "sentence_0x332e2bb2", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "The downloader retrieves a ZIP package with an executable and multiple DLL components. The executable (kitbootnetsuuui.exe) appears to be legitimate software called the Advanced Installer Intune Tool used in the deployment of software packages and signed with a valid signature."}
{"id": "sentence_0x18a1ed44", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "The executable is bundled with three DLLs. Two of these are uires.dll, the resource module of the Advanced Installer tool, and the Zlib data compression library zlibai.dll, both of which are legitimate libraries. The third DLL masqueraded as a debug help library, dbghelp.dll, is the Grandoreiro banking trojan."}
{"id": "sentence_0xa258a24f", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "Table 1. Filenames and hashes of zip package"}
{"id": "sentence_0x901ed1ad", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xaf8b1b5c", "chapter_title": "The MSI Installer", "text": "Figure 6. Extracted files of the final payload"}
{"id": "sentence_0x3950b05d", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x6aebb5f3", "chapter_title": "Grandoreiro banking trojan", "text": "We have seen several common characteristics of Grandoreiro in this variant, as documented here. Written in Delphi, the threat actor inflated the DLL to 300MB by adding bitmap images to the resource section. This technique is known as binary padding and is used to evade detection. Other Latin American banking trojans like Javali have implemented a similar technique."}
{"id": "sentence_0x9bda83b9", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x6aebb5f3", "chapter_title": "Grandoreiro banking trojan", "text": "After running the signed executable, it will load the malicious DLL payload and perform the malicious routines. Grandoreiro leverages the DLL side-loading technique to conceal malicious actions under a legitimate software process. This method will likely evade detection by AV scanners since the benign executable used to side-load the DLL may not raise alerts during execution."}
{"id": "sentence_0xa52aae0f", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x6aebb5f3", "chapter_title": "Grandoreiro banking trojan", "text": "The trojan sets up persistence using the registry run key to enable automatic execution at every startup:"}
{"id": "sentence_0x9206455d", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x6aebb5f3", "chapter_title": "Grandoreiro banking trojan", "text": "Grandoreiro may gather host information such as operating system version, hostname, display monitor information, keyboard layout, and mouse type. Moreover, it is capable of enumerating installed security programs and web browsers. It can execute shell commands like pinging a domain or an IP address and kill running processes. Keylogging, monitoring users browsing activity, capturing clipboards, and stealing session cookies are part of its backdoor capabilities."}
{"id": "sentence_0xb6ecc939", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x6aebb5f3", "chapter_title": "Grandoreiro banking trojan", "text": "Target bank names, executable names, installation locations, and other internal strings are encrypted with the key \"F5454DNBVXCCEFD3EFMNBVDCMNXCEVXD3CMBKJHGFM\" using XOR-based encryption. Grandoreiro resolves these strings and API calls during execution to evade detection."}
{"id": "sentence_0x3019b3df", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x6aebb5f3", "chapter_title": "Grandoreiro banking trojan", "text": "Table 2. List of several encrypted strings with equivalent plaintext"}
{"id": "sentence_0x920e51cd", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x6aebb5f3", "chapter_title": "Grandoreiro banking trojan", "text": "We wrote a string decryptor and created a list of decrypted notable strings available at this link."}
{"id": "sentence_0x225c8081", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xc4269de4", "chapter_title": "Domain Generation Algorithm (DGA)", "text": "Grandoreiro's DGA implementation relies on the current date as a seed variable. It queries an NTP server, e.g., time.nist.gov, to retrieve the current date and time. The day combined with the letter corresponding to the month in Table 3 and the rightmost digit of the current year as a suffix will act as the initial value. For instance, the date 13/04/2022 will yield \"13W2\"."}
{"id": "sentence_0x6bfe916a", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xc4269de4", "chapter_title": "Domain Generation Algorithm (DGA)", "text": "Table 3. Monthly key"}
{"id": "sentence_0xaa662b63", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xc4269de4", "chapter_title": "Domain Generation Algorithm (DGA)", "text": "The initial value is XORed with the current date's key; refer to Table 4 below. The hex equivalent of the product of the XOR operation, all characters should be upper case, will be concatenated to the static string, nuu, serving as a prefix. The output is base64-encoded using the custom alphabet set, \"g-yA-Za-fz0-9+/=\", with the padding removed, generating the subdomain name."}
{"id": "sentence_0x42d563a1", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xc4269de4", "chapter_title": "Domain Generation Algorithm (DGA)", "text": "Table 4. Daily XOR keys for each month"}
{"id": "sentence_0xc2d6792e", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xc4269de4", "chapter_title": "Domain Generation Algorithm (DGA)", "text": "The subdomain is prefixed to free Dynamic DNS providers such as freedynamicdns[.]org to serve as command-and-control infrastructure for data retrieval and exfiltration. We have precalculated the domains and reported them to the DDNS service provider for a takedown action, but it has not yet responded to our request. Our Python code implementation of Grandoreiros DGA is available here:"}
{"id": "sentence_0x9bae28fe", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xc4269de4", "chapter_title": "Domain Generation Algorithm (DGA)", "text": "Figure 7. Process of Grandoreiro's domain generation algorithm"}
{"id": "sentence_0x3140df2e", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0xe2722784", "chapter_title": "Conclusion", "text": "In this recent campaign, Grandoreiro consistently exhibited a variety of tricks to evade detection, such as code obfuscation, binary padding, and the use of MSI's custom action to execute its payload, to name a few. The re-emergence of the Grandoreiro banking trojan indicates that it evolved and remains a threat in the Latin American and Portuguese/Spanish-speaking countries."}
{"id": "sentence_0xd88b8bd8", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x3b96175e", "chapter_title": "References", "text": "Grandoreiro Decryptor: https://github.com/SpiderLabs/Grandoreiro-decryptor/blob/main/grandoreiro_dga_gen.py"}
{"id": "sentence_0xd980000d", "report_id": "report_0x5b02b8c2", "report_date": "2022-05-26T00:00:00Z", "report_title": "SpiderLabs Blog. Grandoreiro Banking Malware Resurfaces for Tax Season", "report_url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/grandoreiro-banking-malware-resurfaces-for-tax-season", "chapter_id": "chapter_0x3b96175e", "chapter_title": "References", "text": "Grandoreiro DGA code: https://github.com/SpiderLabs/Grandoreiro-decryptor/blob/main/grandoreiro_string_decryptor.py"}
