<div>
<h1 id="h-latest-version-of-android-banking-trojan-targets-over-400-applications">Latest Version of Android Banking Trojan Targets over 400 Applications</h1>
<p></p>
<p>Cyble Research Labs came across a <a href="https://twitter.com/ESETresearch/status/1526897310231322630" rel="noreferrer noopener" target="_blank">Twitter</a> post wherein a researcher mentioned the distribution of ERMAC 2.0. ERMAC is an Android Banking Trojan that was first discovered in late August 2021, when it was found targeting Poland. ERMAC 1.0 was capable of stealing the credentials of 378 applications. The Threat Actor was renting it out for $3K/month on a cybercrime forum.</p>
<p>Recently, Cyble Research Labs observed that an upgraded version – ERMAC 2.0 – has been available on underground forums for rent at $5K/month and targets 467 applications for stealing credentials.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11048 jetpack-lazy-image" height="258" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-1-Cyber-Crime-Forum-selling-ERMAC-2.0.png?resize=602%2C258&amp;ssl=1" width="602"/><img alt="" class="wp-image-11048" height="258" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-1-Cyber-Crime-Forum-selling-ERMAC-2.0.png?resize=602%2C258&amp;ssl=1" width="602"/><figcaption>Figure 1 – Cyber Crime Forum selling ERMAC 2.0</figcaption></figure>
<p></p>
<p>We have observed that the ERMAC 2.0 is being delivered through fake sites. For example, via the Bolt Food site – a delivery platform that provides high-quality food delivery services. The fake app impersonates the Bolt Food Android application and targets Polish Bolt Food users.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11049 jetpack-lazy-image" height="190" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-2-Fake-Bolt-Food-site-distributing-malware.png?resize=752%2C190&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11049" height="190" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-2-Fake-Bolt-Food-site-distributing-malware.png?resize=752%2C190&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption>Figure 2 – Fake Bolt Food site distributing malware</figcaption></figure>
<p></p>
<p>Apart from the fake Bolt Food site, EMRAC 2.0 spreads through fake browser update sites, as shown in Figure 3.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11050 jetpack-lazy-image" height="503" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-3-Fake-browser-update-sitesource-MalwareHunterTeam.png?resize=435%2C503&amp;ssl=1" width="435"/><img alt="" class="wp-image-11050" height="503" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-3-Fake-browser-update-sitesource-MalwareHunterTeam.png?resize=435%2C503&amp;ssl=1" width="435"/><figcaption>Figure 3 – Fake browser update site (Source – MalwareHunterTeam)</figcaption></figure>
<p></p>
<p>The below image shows the Control Panel of ERMAC 2.0 Banking Trojan. In the UI, the Threat Actor (TA) has named it “ERMVC PVNEL.”</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11052 jetpack-lazy-image" height="362" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-4-Control-Panel.png?resize=752%2C362&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11052" height="362" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-4-Control-Panel.png?resize=752%2C362&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption> Figure 4 – Control Panel</figcaption></figure>
<p></p>
<h2>Technical Analysis   </h2>
<p></p>
<h3>APK Metadata Information   </h3>
<p></p>
<ul><li>App Name: Bolt Food </li><li>Package Name: com.kototomumeci.nacipiyi   </li><li>SHA256 Hash: 2cc727c4249235f36bbc5024d5a5cb708c0f6d3659151afc5ae5d42d55212cb5 </li></ul>
<p>   </p>
<p>Figure 5 shows the metadata information of an application.  </p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11054 jetpack-lazy-image" height="106" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-5-App-Metadata-Information.png?resize=752%2C106&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11054" height="106" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-5-App-Metadata-Information.png?resize=752%2C106&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption>Figure 5 – App Metadata Information </figcaption></figure>
<p></p>
<h3>Manifest Description  </h3>
<p></p>
<p>The malicious application asks for 43 permissions, of which the TA exploits 12. The malware’s harmful permission requests are listed below:  </p>
<figure class="wp-block-table"><table><tbody><tr><td>Permission   </td><td>Description  </td></tr><tr><td>REQUEST_INSTALL_PACKAGES </td><td>Allows an application to request installing packages </td></tr><tr><td>CALL_PHONE </td><td>Allows an application to initiate a phone call without going through the Dialer user interface for the user to confirm the call </td></tr><tr><td>RECEIVE_SMS </td><td>Allows an application to receive SMS messages </td></tr><tr><td>READ_SMS </td><td>Allows an application to read SMS messages </td></tr><tr><td>SEND_SMS </td><td>Allows an application to send SMS messages </td></tr><tr><td>READ_CONTACTS </td><td>Allows an application to read the user’s contacts data </td></tr><tr><td>READ_PHONE_STATE </td><td>Allows read access to the device’s phone number </td></tr><tr><td>SYSTEM_ALERT_WINDOW </td><td>Allows an app to create windows shown on top of all other apps. </td></tr><tr><td>READ_EXTERNAL_STORAGE </td><td>Allows an application to read from external storage   </td></tr><tr><td>RECORD_AUDIO </td><td>Allows an application to record audio   </td></tr><tr><td>WRITE_EXTERNAL_STORAGE </td><td>Allows an application to write to external storage </td></tr></tbody></table></figure>
<h3>Source Code Review  </h3>
<p></p>
<p>Apart from the application’s subclass, the rest of the components identified from the Manifest file are missing. We can thus infer that the application is packed.  </p>
<figure class="wp-block-image aligncenter size-large"><img alt="" class="wp-image-11055 jetpack-lazy-image" height="393" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-6-Manifest-File.png?resize=1024%2C393&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1024"/><img alt="" class="wp-image-11055" height="393" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-6-Manifest-File.png?resize=1024%2C393&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1024"/><figcaption>Figure 6 – Manifest File </figcaption></figure>
<p></p>
<p>Upon execution, the malicious application unpacks the DEX file present in the assets folder and then loads the classes.</p>
<p>In this case, the dropped dex file name is “pqiRsn.json,” which has all the missing classes</p>
<p>The strings present in the classes are encoded using base64 and encrypted using the AES-128-bit algorithm.</p>
<p>The Secret Key and IVparameter were dumped during dynamic analysis. Both Secret Key and IVparameter are used to decrypt hardcoded strings present in the file as well as encrypt the data sent to the C&amp;C server. The below image explains the decryption process.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11056 jetpack-lazy-image" height="305" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-7-Encryption-and-Decryption-Technique.png?resize=752%2C305&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11056" height="305" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-7-Encryption-and-Decryption-Technique.png?resize=752%2C305&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption>Figure 7 – Encryption and Decryption Technique</figcaption></figure>
<p></p>
<p>On installing the application, it prompts the user to turn on the Accessibility Service. When the victim grants this permission, it starts abusing services by auto-enabling overlay activity and auto-granting permissions.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11058 jetpack-lazy-image" height="383" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-8-Accessibility-Service.png?resize=752%2C383&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11058" height="383" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-8-Accessibility-Service.png?resize=752%2C383&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption>Figure 8 – Accessibility Service</figcaption></figure>
<p></p>
<p>After granting the Accessibility permission, the malware sends a list of installed applications on the victim’s Android device to the C&amp;C server. The malware then downloads and installs the injection modules of targeted applications based on this application list.</p>
<p>Figure 9 showcases the C&amp;C communications from the victim’s device, which sends the details of installed applications and receives a response, including a list of targeted applications to perform overlay activity. At the time of our analysis, it was observed that the “Unocoin” wallet was the targeted application by the attacker.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11059 jetpack-lazy-image" height="339" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-9-Sending-application-list-and-receiving-the-response-for-the-targeted-app.png?resize=752%2C339&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11059" height="339" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-9-Sending-application-list-and-receiving-the-response-for-the-targeted-app.png?resize=752%2C339&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption>Figure 9 – Sending application list and receiving the response for the targeted app</figcaption></figure>
<p></p>
<p>The malware then receives an encrypted HTML phishing page, which will be decrypted and stored into the Shared Preference file named “setting.xml” with the action status, as shown in the figure below.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11060 jetpack-lazy-image" height="292" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-10-Downloaded-injection-saved-in-Shared-Preference-file.png?resize=751%2C292&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="751"/><img alt="" class="wp-image-11060" height="292" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-10-Downloaded-injection-saved-in-Shared-Preference-file.png?resize=751%2C292&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="751"/><figcaption>Figure 10 – Downloaded injection saved in Shared Preference file</figcaption></figure>
<p></p>
<p>As soon as the victim interacts with a targeted genuine application, the injected phishing page is displayed through setting.xml that can be used for credential harvesting.</p>
<p>Figure 11 shows the phishing page for “Unocoin.” The malware sends the start_inject command to the C&amp;C server before sending the credentials.</p>
<figure class="wp-block-image aligncenter size-large"><img alt="" class="wp-image-11062 jetpack-lazy-image" height="446" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-11-Loading-phishing-page.png?resize=1024%2C446&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1024"/><img alt="" class="wp-image-11062" height="446" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-11-Loading-phishing-page.png?resize=1024%2C446&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="1024"/><figcaption>Figure 11 – Loading phishing page</figcaption></figure>
<p></p>
<p>The harvested credentials are sent to the same C&amp;C server in the encrypted format, as shown in Figure 12. ERMAC 2.0 uses the command logs for code injection as well as data exfiltration functionalities.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11063 jetpack-lazy-image" height="240" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-12-Sending-credentials-to-the-CC-server.png?resize=752%2C240&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11063" height="240" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-12-Sending-credentials-to-the-CC-server.png?resize=752%2C240&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption>Figure 12 – Sending credentials to the C&amp;C server</figcaption></figure>
<p></p>
<p>The TA can then use these credentials to steal cryptocurrency from the victim’s account.</p>
<p>The below image shows the TA’s phishing pages used to trick the victims into falling for a phishing scheme while attempting to access genuine applications.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11064 jetpack-lazy-image" height="224" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-13-Fake-injected-window-targeting-different-applications.png?resize=752%2C224&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><img alt="" class="wp-image-11064" height="224" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/05/Figure-13-Fake-injected-window-targeting-different-applications.png?resize=752%2C224&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="752"/><figcaption>Figure 13 – Fake injected window targeting different applications</figcaption></figure>
<p></p>
<p>Cyble Research Labs witnessed that the malware has functionalities to target various banking applications of several banks worldwide.</p>
<p>The commands used by ERMAC 2.0 to execute malicious operations are:</p>
<figure class="wp-block-table"><table><tbody><tr><td>Command </td><td>Description </td></tr><tr><td>downloadingInjections </td><td>Sends the application list to download injections</td></tr><tr><td>logs </td><td>Sends injection logs to the server</td></tr><tr><td>checkAP</td><td>Check the application status and send it to the server </td></tr><tr><td>registration</td><td>Sends device data </td></tr><tr><td>updateBotParams</td><td>Sends the updated bot parameters </td></tr><tr><td>downloadInjection</td><td>Used to receive the phishing HTML page </td></tr></tbody></table></figure>
<h2>Conclusion </h2>
<p></p>
<p>The Threat Actor behind ERMAC used the leaked code from a well-known malware variant named “Cerberus” and modified the code to sell the Android botnets in cybercrime forums. Interestingly, we observed that ERMAC 2.0 is distributed rapidly through various phishing sites, primarily targeting Polish users. </p>
<p>ERMAC 2.0 steals credentials from different crypto wallets and targets multiple banking applications worldwide. We foresee that the TA behind ERMAC 2.0 will continue to develop new versions with more targeted applications, new TTPs, and new delivery methods.</p>
<h2>Our Recommendations </h2>
<p></p>
<p>We have listed some essential cybersecurity best practices that create the first line of control against attackers. We recommend that our readers follow the best practices given below:   </p>
<h3>How to prevent malware infection? </h3>
<ul><li>Download and install software only from official app stores like Google Play Store or the iOS App Store. </li><li>Use a reputed anti-virus and internet security software package on your connected devices, such as PCs, laptops, and mobile devices. </li><li>Use strong passwords and enforce multi-factor authentication wherever possible. </li><li>Enable biometric security features such as fingerprint or facial recognition for unlocking the mobile device where possible. </li><li>Be wary of opening any links received via SMS or emails delivered to your phone. </li><li>Ensure that Google Play Protect is enabled on Android devices. </li><li>Be careful while enabling any permissions. </li><li>Keep your devices, operating systems, and applications updated. </li></ul>
<h3>How to identify whether you are infected? </h3>
<ul><li>Regularly check the Mobile/Wi-Fi data usage of applications installed on mobile devices. </li><li>Keep an eye on the alerts provided by Anti-viruses and Android OS and take necessary actions accordingly. </li></ul>
<h3>What to do when you are infected? </h3>
<ul><li>Disable Wi-Fi/Mobile data and remove SIM card – as in some cases, the malware can re-enable the Mobile Data. </li><li>Perform a factory reset. </li><li>Remove the application in case a factory reset is not possible. </li><li>Take a backup of personal media Files (excluding mobile applications) and perform a device reset. </li></ul>
<h3>What to do in case of any fraudulent transaction? </h3>
<ul><li>In case of a fraudulent transaction, immediately report it to the concerned bank. </li></ul>
<h3>What should banks do to protect their customers? </h3>
<ul><li>Banks and other financial entities should educate customers on safeguarding themselves from malware attacks via telephone, SMS, or emails. </li></ul>
<h2>MITRE ATT&amp;CK® Techniques </h2>
<figure class="wp-block-table"><table><tbody><tr><td>Tactic </td><td>Technique ID </td><td>Technique Name </td></tr><tr><td>Initial Access </td><td><a href="https://attack.mitre.org/versions/v7/techniques/T1476/" rel="noreferrer noopener" target="_blank">T1476</a> </td><td>Deliver Malicious App via Other Mean. </td></tr><tr><td>Initial Access </td><td><a href="https://attack.mitre.org/versions/v7/techniques/T1444" rel="noreferrer noopener" target="_blank">T1444</a> </td><td>Masquerade as Legitimate Application </td></tr><tr><td>Defense Evasion </td><td><a href="https://attack.mitre.org/techniques/T1406/" rel="noreferrer noopener" target="_blank">T1406</a> </td><td>Obfuscated Files or Information </td></tr><tr><td>Credential Access </td><td><a href="https://attack.mitre.org/techniques/T1636/004/" rel="noreferrer noopener" target="_blank">T1412</a> </td><td>Capture SMS Messages </td></tr><tr><td>Discovery </td><td><a href="https://attack.mitre.org/techniques/T1421/" rel="noreferrer noopener" target="_blank">T1421 </a> </td><td>System Network Connections Discovery </td></tr><tr><td>Command and Control  </td><td><a href="https://attack.mitre.org/techniques/T1571/" rel="noreferrer noopener" target="_blank">T1571</a> </td><td>Non-Standard Port  </td></tr><tr><td>Command and Control </td><td><a href="https://attack.mitre.org/techniques/T1573/" rel="noreferrer noopener" target="_blank">T1573</a> </td><td>Encrypted Chanel </td></tr><tr><td>Collection </td><td><a href="https://attack.mitre.org/techniques/T1432/" rel="noreferrer noopener" target="_blank">T1432</a> </td><td>Access Contact List </td></tr><tr><td>Collection </td><td><a href="https://attack.mitre.org/techniques/T1507" rel="noreferrer noopener" target="_blank">T1507</a> </td><td>Network Information Discovery </td></tr></tbody></table></figure>
<h2>Indicators of Compromise (IOCs) </h2>
<figure class="wp-block-table"><table><tbody><tr><td>Indicators</td><td>Indicator Type</td><td>Description</td></tr><tr><td>2cc727c4249235f36bbc5024d5a5cb708c0f6d3659151afc5ae5d42d55212cb5 </td><td>SHA256</td><td>Hash of the analyzed APK file</td></tr><tr><td>301e2ab9707abe193bb627c60f5e4b8736c86fe9 </td><td>SHA1</td><td>Hash of the analyzed APK file </td></tr><tr><td>1e0586aef0f106031260fecb412c5cdf </td><td>MD5</td><td>Hash of the analyzed APK file</td></tr><tr><td>hxxp://bolt-food[.]site</td><td>URL</td><td>Malware distribution site</td></tr><tr><td>hxxp://193[.]106.191[.]116</td><td>URL</td><td>C&amp;C Server</td></tr><tr><td>df298b0aba5aad2886ae720577557b3e48fba905055dcee0fd74336660bfd0a2</td><td>SHA256</td><td>Hash of the analyzed APK file</td></tr><tr><td>e2fb7981688060fc672f844c65e89d12f3e5cafe</td><td>SHA1</td><td>Hash of the analyzed APK file</td></tr><tr><td>1bb6da78e3c379afde1978aecfa067b8</td><td>MD5</td><td>Hash of the analyzed APK file</td></tr><tr><td>hxxp://boltfood[.]site</td><td>URL</td><td>Malware distribution site</td></tr><tr><td>df298b0aba5aad2886ae720577557b3e48fba905055dcee0fd74336660bfd0a2</td><td>SHA256</td><td>Hash of the analyzed APK file</td></tr><tr><td>fe4a7d079cc00e730412c7a6e0b177829ee58a73</td><td>SHA1</td><td>Hash of the analyzed APK file</td></tr><tr><td>65f634ef24fd686225aa4765fc63fe2b</td><td>MD5</td><td>Hash of the analyzed APK file</td></tr><tr><td>hxxp://apkphoto.[co].NZ</td><td>URL</td><td>Malware distribution site</td></tr><tr><td>hxxp://45[.]141.85[.]25</td><td>URL</td><td>C&amp;C Server</td></tr></tbody></table></figure>
<p><a id="_msocom_1"></a></p>
<p></p>
</div>