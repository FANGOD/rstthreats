<html lang="en-GB"><head>
    <!-- General meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    
      <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Rook Ransomware | Chuong Dong</title>
<meta name="generator" content="Jekyll v3.9.0">
<meta property="og:title" content="Rook Ransomware">
<meta name="author" content="Chuong Dong">
<meta property="og:locale" content="en_GB">
<meta name="description" content="Malware Analysis Report - Rook Ransomware">
<meta property="og:description" content="Malware Analysis Report - Rook Ransomware">
<link rel="canonical" href="https://cdong1012.github.io//reverse%20engineering/2022/01/06/RookRansomware/">
<meta property="og:url" content="https://cdong1012.github.io//reverse%20engineering/2022/01/06/RookRansomware/">
<meta property="og:site_name" content="Chuong Dong">
<meta property="og:image" content="https://cdong1012.github.io//assets/logos/kunal-logo.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-01-06T00:00:00-05:00">
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="https://cdong1012.github.io//assets/logos/kunal-logo.png">
<meta property="twitter:title" content="Rook Ransomware">
<meta name="twitter:site" content="@cPeterr">
<meta name="twitter:creator" content="@Chuong Dong">
<script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-Z0P8HMGL0N&amp;l=dataLayer&amp;cx=c"></script><script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Chuong Dong"},"dateModified":"2022-01-06T00:00:00-05:00","datePublished":"2022-01-06T00:00:00-05:00","description":"Malware Analysis Report - Rook Ransomware","headline":"Rook Ransomware","image":"https://cdong1012.github.io//assets/logos/kunal-logo.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://cdong1012.github.io//reverse%20engineering/2022/01/06/RookRansomware/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://cdong1012.github.io//assets/logos/logo-cdong.gif"},"name":"Chuong Dong"},"url":"https://cdong1012.github.io//reverse%20engineering/2022/01/06/RookRansomware/"}</script>
<!-- End Jekyll SEO tag -->

    

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#242e2b">

    
      
<style>/*! normalize.css v4.1.1 | MIT License | github.com/necolas/normalize.css */@import url("https://fonts.googleapis.com/css?family=Karla:700,700");@import url("https://fonts.googleapis.com/css?family=Space Mono:400,700");html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}template,[hidden]{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:0.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,select,textarea{font:inherit;margin:0}optgroup{font-weight:bold}button,input{overflow:visible}button,select{text-transform:none}button,html [type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:0.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}*{box-sizing:border-box}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}html,body{height:100%}a img{border:none}blockquote{quotes:none}blockquote:before,blockquote:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}caption,th,td{text-align:left;font-weight:normal;vertical-align:middle}html{font-size:75%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}@media screen and (min-width: 40em){html{font-size:87.5%}}@media screen and (min-width: 50em){html{font-size:93.75%}}@media screen and (min-width: 64em){html{font-size:106.25%}}@media screen and (min-width: 100em){html{font-size:118.75%}}body{font-size:1.3333333333rem;font-family:Space Mono, monospace;font-style:normal;font-weight:400;line-height:2rem}@media screen and (min-width: 40em){body{font-size:1.2142857143rem}}@media screen and (min-width: 50em){body{font-size:1.2rem}}@media screen and (min-width: 64em){body{font-size:1.1764705882rem}}@media screen and (min-width: 100em){body{font-size:1.1578947368rem}}a{color:#45a29e;text-decoration:none;transition:color .1s, background-color .1s}a:hover,a:active,a:focus{color:#66fcf1;text-decoration:none}.typeset p a,.typeset li a{background-image:linear-gradient(to bottom, transparent 50%, #45a29e 50%);background-position:0 93%;background-repeat:repeat-x;background-size:100% 0.15rem;text-shadow:0.1rem 0 #161820,0.15rem 0 #161820,-0.1rem 0 #161820,-0.15rem 0 #161820}.typeset p a:hover,.typeset p a:active,.typeset p a:focus,.typeset li a:hover,.typeset li a:active,.typeset li a:focus{background-image:linear-gradient(to bottom, transparent 50%, #66fcf1 50%)}.typeset p{line-height:2rem;margin-bottom:1.49999rem;padding-top:.50001rem;font-feature-settings:'kern', 'onum', 'liga'}@media screen and (min-width: 40em){.typeset p{margin-bottom:1.4553471429rem;padding-top:.5446528571rem}}@media screen and (min-width: 50em){.typeset p{margin-bottom:1.44999rem;padding-top:.55001rem}}@media screen and (min-width: 64em){.typeset p{margin-bottom:1.4411664706rem;padding-top:.5588335294rem}}@media screen and (min-width: 100em){.typeset p{margin-bottom:1.4342005263rem;padding-top:.5657994737rem}}.typeset h1,.typeset h2,.typeset h3,.typeset h4,.typeset h5,.typeset h6{color:#66fcf1;font-family:"Karla", monospace;font-feature-settings:'dlig', 'liga', 'lnum', 'kern';font-style:normal;font-weight:700}.typeset h1,.typeset .alpha{line-height:3rem;font-size:2.3333333333rem;margin-bottom:.37499rem;padding-top:.62501rem}@media screen and (min-width: 40em){.typeset h1,.typeset .alpha{font-size:2.1428571429rem;margin-bottom:.3035614286rem;padding-top:.6964385714rem}}@media screen and (min-width: 50em){.typeset h1,.typeset .alpha{font-size:2.1333333333rem;margin-bottom:.29999rem;padding-top:.70001rem}}@media screen and (min-width: 64em){.typeset h1,.typeset .alpha{font-size:2.3529411765rem;margin-bottom:.3823429412rem;padding-top:.6176570588rem}}@media screen and (min-width: 100em){.typeset h1,.typeset .alpha{font-size:2.6315789474rem;margin-bottom:.4868321053rem;padding-top:.5131678947rem}}.typeset h2,.typeset .beta{line-height:3rem;font-size:2.0833333333rem;margin-bottom:.28124rem;padding-top:.71876rem}@media screen and (min-width: 40em){.typeset h2,.typeset .beta{font-size:1.9rem;margin-bottom:.21249rem;padding-top:.78751rem}}@media screen and (min-width: 50em){.typeset h2,.typeset .beta{font-size:1.8733333333rem;margin-bottom:.20249rem;padding-top:.79751rem}}@media screen and (min-width: 64em){.typeset h2,.typeset .beta{font-size:2.0882352941rem;margin-bottom:.2830782353rem;padding-top:.7169217647rem}}@media screen and (min-width: 100em){.typeset h2,.typeset .beta{font-size:2.3105263158rem;margin-bottom:.3664373684rem;padding-top:.6335626316rem}}.typeset h3,.typeset .gamma{line-height:3rem;font-size:1.8666666667rem;margin-bottom:.19999rem;padding-top:.80001rem}@media screen and (min-width: 40em){.typeset h3,.typeset .gamma{font-size:1.7142857143rem;margin-bottom:.1428471429rem;padding-top:.8571528571rem}}@media screen and (min-width: 50em){.typeset h3,.typeset .gamma{font-size:1.7066666667rem;margin-bottom:.13999rem;padding-top:.86001rem}}@media screen and (min-width: 64em){.typeset h3,.typeset .gamma{font-size:1.7647058824rem;margin-bottom:.1617547059rem;padding-top:.8382452941rem}}@media screen and (min-width: 100em){.typeset h3,.typeset .gamma{font-size:1.8578947368rem;margin-bottom:.1967005263rem;padding-top:.8032994737rem}}.typeset h4,.typeset .delta{line-height:2rem;font-size:1.6666666667rem;margin-bottom:-.37501rem;padding-top:.37501rem}@media screen and (min-width: 40em){.typeset h4,.typeset .delta{font-size:1.5214285714rem;margin-bottom:-.4294742857rem;padding-top:.4294742857rem}}@media screen and (min-width: 50em){.typeset h4,.typeset .delta{font-size:1.5rem;margin-bottom:-.43751rem;padding-top:.43751rem}}@media screen and (min-width: 64em){.typeset h4,.typeset .delta{font-size:1.5705882353rem;margin-bottom:-.4110394118rem;padding-top:.4110394118rem}}@media screen and (min-width: 100em){.typeset h4,.typeset .delta{font-size:1.6368421053rem;margin-bottom:-.3861942105rem;padding-top:.3861942105rem}}.typeset h5,.typeset .epsilon{line-height:2rem;font-size:1.4916666667rem;margin-bottom:-.440635rem;padding-top:.440635rem}@media screen and (min-width: 40em){.typeset h5,.typeset .epsilon{font-size:1.3714285714rem;margin-bottom:-.4857242857rem;padding-top:.4857242857rem}}@media screen and (min-width: 50em){.typeset h5,.typeset .epsilon{font-size:1.3666666667rem;margin-bottom:-.48751rem;padding-top:.48751rem}}@media screen and (min-width: 64em){.typeset h5,.typeset .epsilon{font-size:1.3235294118rem;margin-bottom:-.5036864706rem;padding-top:.5036864706rem}}@media screen and (min-width: 100em){.typeset h5,.typeset .epsilon{font-size:1.3157894737rem;margin-bottom:-.5065889474rem;padding-top:.5065889474rem}}.typeset h6,.typeset .zeta{line-height:2rem;font-size:1.3333333333rem;margin-bottom:-.50001rem;padding-top:.50001rem}@media screen and (min-width: 40em){.typeset h6,.typeset .zeta{font-size:1.2142857143rem;margin-bottom:-.5446528571rem;padding-top:.5446528571rem}}@media screen and (min-width: 50em){.typeset h6,.typeset .zeta{font-size:1.2rem;margin-bottom:-.55001rem;padding-top:.55001rem}}@media screen and (min-width: 64em){.typeset h6,.typeset .zeta{font-size:1.1764705882rem;margin-bottom:-.5588335294rem;padding-top:.5588335294rem}}@media screen and (min-width: 100em){.typeset h6,.typeset .zeta{font-size:1.1578947368rem;margin-bottom:-.5657994737rem;padding-top:.5657994737rem}}.typeset ul,.typeset ol{line-height:2rem;margin-bottom:1.49999rem;padding-top:.50001rem}@media screen and (min-width: 40em){.typeset ul,.typeset ol{margin-bottom:1.4553471429rem;padding-top:.5446528571rem}}@media screen and (min-width: 50em){.typeset ul,.typeset ol{margin-bottom:1.44999rem;padding-top:.55001rem}}@media screen and (min-width: 64em){.typeset ul,.typeset ol{margin-bottom:1.4411664706rem;padding-top:.5588335294rem}}@media screen and (min-width: 100em){.typeset ul,.typeset ol{margin-bottom:1.4342005263rem;padding-top:.5657994737rem}}.typeset ul li,.typeset ol li{font-feature-settings:'kern', 'onum', 'liga';margin-left:2rem}@media screen and (min-width: 40em){.typeset ul li,.typeset ol li{margin-left:0}}.typeset ul li ol,.typeset ul li ul,.typeset ol li ol,.typeset ol li ul{padding-top:1rem;margin-bottom:1rem;margin-left:2rem}.typeset ol{list-style-type:none}.typeset ol li{counter-increment:top-level}.typeset ol li:before{content:counter(top-level) ".";font-feature-settings:'lnum', 'tnum';margin-left:-3rem;position:absolute;text-align:right;width:2em}.typeset ol li ul li:before{content:''}.typeset ol li ul li ol li{counter-increment:alt-level}.typeset ol li ul li ol li:before{content:counter(alt-level) "."}.typeset ol li ol li{counter-increment:sub-level}.typeset ol li ol li:before{content:counter(top-level) "." counter(sub-level)}.typeset ol li ol li ul li:before{content:''}.typeset ol li ol li ol li{counter-increment:sub-sub-level}.typeset ol li ol li ol li:before{content:counter(top-level) "." counter(sub-level) "." counter(sub-sub-level)}.typeset dl{line-height:2rem;margin-bottom:1.49999rem;padding-top:.50001rem}@media screen and (min-width: 40em){.typeset dl{margin-bottom:1.4553471429rem;padding-top:.5446528571rem}}@media screen and (min-width: 50em){.typeset dl{margin-bottom:1.44999rem;padding-top:.55001rem}}@media screen and (min-width: 64em){.typeset dl{margin-bottom:1.4411664706rem;padding-top:.5588335294rem}}@media screen and (min-width: 100em){.typeset dl{margin-bottom:1.4342005263rem;padding-top:.5657994737rem}}.typeset dl dt,.typeset dl dd{font-feature-settings:'kern', 'onum', 'liga';margin-left:2rem}@media screen and (min-width: 40em){.typeset dl dt,.typeset dl dd{margin-left:0}}.typeset dl dt{font-weight:700}.typeset dl dd+dt{padding-top:1rem}.typeset table{line-height:2rem;font-size:1.1916666667rem;margin-bottom:-.553135rem;padding-top:.553135rem;font-family:"Karla", monospace;font-feature-settings:'liga', 'lnum', 'tnum', 'kern';font-style:normal;font-weight:400;width:100%}@media screen and (min-width: 40em){.typeset table{font-size:1.0928571429rem;margin-bottom:-.5901885714rem;padding-top:.5901885714rem}}@media screen and (min-width: 50em){.typeset table{font-size:1.0866666667rem;margin-bottom:-.59251rem;padding-top:.59251rem}}@media screen and (min-width: 64em){.typeset table{font-size:.9941176471rem;margin-bottom:-.6272158824rem;padding-top:.6272158824rem}}@media screen and (min-width: 100em){.typeset table{font-size:.9263157895rem;margin-bottom:-.6526415789rem;padding-top:.6526415789rem}}.typeset table thead th{line-height:2rem;font-size:1.3333333333rem;margin-bottom:-.50001rem;padding-top:.50001rem;padding-bottom:1px}@media screen and (min-width: 40em){.typeset table thead th{font-size:1.2142857143rem;margin-bottom:-.5446528571rem;padding-top:.5446528571rem}}@media screen and (min-width: 50em){.typeset table thead th{font-size:1.2rem;margin-bottom:-.55001rem;padding-top:.55001rem}}@media screen and (min-width: 64em){.typeset table thead th{font-size:1.1764705882rem;margin-bottom:-.5588335294rem;padding-top:.5588335294rem}}@media screen and (min-width: 100em){.typeset table thead th{font-size:1.1578947368rem;margin-bottom:-.5657994737rem;padding-top:.5657994737rem}}.typeset b,.typeset strong,.typeset .bold{font-weight:700}.typeset em,.typeset i,.typeset .italic{font-style:italic}.typeset small,.typeset .caption{font-size:1.0666666667rem;font-family:"Karla", monospace;font-style:normal;font-weight:400}@media screen and (min-width: 40em){.typeset small,.typeset .caption{font-size:.9714285714rem}}@media screen and (min-width: 50em){.typeset small,.typeset .caption{font-size:.96rem}}@media screen and (min-width: 64em){.typeset small,.typeset .caption{font-size:.8823529412rem}}@media screen and (min-width: 100em){.typeset small,.typeset .caption{font-size:.8210526316rem}}.typeset small{line-height:1rem}.typeset .caption{line-height:2rem;margin-bottom:1.39999rem;padding-top:.60001rem;color:#529e99}@media screen and (min-width: 40em){.typeset .caption{margin-bottom:1.3642757143rem;padding-top:.6357242857rem}}@media screen and (min-width: 50em){.typeset .caption{margin-bottom:1.35999rem;padding-top:.64001rem}}@media screen and (min-width: 64em){.typeset .caption{margin-bottom:1.3308723529rem;padding-top:.6691276471rem}}@media screen and (min-width: 100em){.typeset .caption{margin-bottom:1.3078847368rem;padding-top:.6921152632rem}}.typeset h1+.caption,.typeset .alpha+.caption,.typeset h2+.caption,.typeset .beta+.caption,.typeset h3+.caption,.typeset .gamma+.caption{margin-top:-1rem}.typeset .delta+.caption,.typeset .epsilon+.caption,.typeset .zeta+.caption{margin-top:0rem}.typeset blockquote p{border-left:0.15rem solid #45a29e;font-style:italic;padding-left:1rem;margin-bottom:1.99999rem;padding-bottom:.50001rem}@media screen and (min-width: 40em){.typeset blockquote p{margin-bottom:1.9107042857rem;padding-bottom:.5446528571rem}}@media screen and (min-width: 50em){.typeset blockquote p{margin-bottom:1.89999rem;padding-bottom:.55001rem}}@media screen and (min-width: 64em){.typeset blockquote p{margin-bottom:1.8823429412rem;padding-bottom:.5588335294rem}}@media screen and (min-width: 100em){.typeset blockquote p{margin-bottom:1.8684110526rem;padding-bottom:.5657994737rem}}@media screen and (min-width: 40em){.typeset blockquote{margin-left:-1rem}}.typeset hr{background-image:linear-gradient(to bottom, transparent 50%, #529e99 50%);background-position:0 50%;background-repeat:repeat-x;background-size:100% 0.15rem;border:0;margin:0;padding-bottom:3rem;padding-top:0.5rem}.typeset code,.typeset pre{background-color:#1f2833;font-family:Menlo, monospace}.typeset pre{display:block;margin-bottom:2rem;padding:1rem;white-space:pre;white-space:pre-wrap;word-break:break-all;word-wrap:break-word}.typeset code{font-size:1.0666666667rem;line-height:1rem}@media screen and (min-width: 40em){.typeset code{font-size:.9714285714rem}}@media screen and (min-width: 50em){.typeset code{font-size:.96rem}}@media screen and (min-width: 64em){.typeset code{font-size:.8823529412rem}}@media screen and (min-width: 100em){.typeset code{font-size:.8210526316rem}}.typeset .upper{font-kerning:normal;letter-spacing:0.1rem;text-transform:uppercase}.typeset .small-caps{font-feature-settings:'smcp', 'kern';font-kerning:normal;letter-spacing:0.1rem}.typeset .lining-numerals{font-feature-settings:'lnum', 'kern'}.typeset .oldstyle-numerals{font-feature-settings:'onum', 'kern'}.hll{background-color:#c510bc}.c{color:#54dbf3;font-style:italic}.err{color:#a61717;background-color:#e3d2d2}.k{color:#c59659;font-weight:bold}.o{color:#c59659;font-weight:bold}.cm{color:#999988;font-style:italic}.cp{color:#999999;font-weight:bold;font-style:italic}.c1{color:#999988;font-style:italic}.cs{color:#999999;font-weight:bold;font-style:italic}.gd{color:#000000;background-color:#fdd}.ge{color:#000000;font-style:italic}.gr{color:#a00}.gh{color:#999}.gi{color:#000000;background-color:#dfd}.go{color:#888}.gp{color:#555}.gs{font-weight:bold}.gu{color:#aaa}.gt{color:#a00}.kc{color:#000000;font-weight:bold}.kd{color:#000000;font-weight:bold}.kn{color:#000000;font-weight:bold}.kp{color:#000000;font-weight:bold}.kr{color:#000000;font-weight:bold}.kt{color:#445588;font-weight:bold}.m{color:#099}.s{color:#fce773}.na{color:teal}.nb{color:#0086B3}.nc{color:#445588;font-weight:bold}.no{color:teal}.nd{color:#3c5d5d;font-weight:bold}.ni{color:purple}.ne{color:#99b898;font-weight:bold}.nf{color:#99b898;font-weight:bold}.nl{color:#99b898;font-weight:bold}.nn{color:#555}.nt{color:#ff847c}.nv{color:teal}.ow{color:#000000;font-weight:bold}.w{color:#bbb}.mf{color:#099}.mh{color:#099}.mi{color:#099}.mo{color:#099}.sb{color:#fce773}.sc{color:#fce773}.sd{color:#fce773}.s2{color:#fce773}.se{color:#fce773}.sh{color:#fce773}.si{color:#773f00}.sx{color:#fce773}.sr{color:#009926}.s1{color:#ff847c}.ss{color:#990073}.bp{color:#999}.vc{color:#2e878a}.vg{color:#2e878a}.vi{color:#2e878a}.il{color:#099}body{background:#161820;color:#efeff0;height:100%;display:flex;-webkit-box-direction:normal;-webkit-box-orient:vertical;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;overflow-x:hidden}.container{width:90%;max-width:1200px;margin:0 auto}.header .nav,.footer .nav{text-align:right}.header .logo,.footer .logo{-webkit-box-flex:0;-webkit-flex:0 0 auto;-moz-box-flex:0;-moz-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto}.header .container,.footer .container{display:-webkit-box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-direction:normal;-webkit-box-orient:horizontal;-webkit-flex-direction:row;-moz-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;-webkit-justify-content:space-between;-moz-justify-content:space-between;justify-content:space-between;padding:1rem 0}@media screen and (min-width: 40em){.header .container,.footer .container{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-moz-align-items:center;align-items:center}}.header .nav{display:flex;flex-direction:column-reverse;align-items:flex-end;justify-content:flex-end;overflow:hidden}.feature{padding-bottom:.4rem;margin-bottom:1.6rem;text-align:center;background:#c5c6c7;background-size:cover;background-position:center}.feature .container{min-height:40vh;max-width:60%;-webkit-box-direction:normal;-webkit-box-orient:vertical;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;-moz-justify-content:center;justify-content:center}.logo{display:inline-block;line-height:0;max-height:7rem;display:-webkit-box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-moz-align-items:center;align-items:center}.logo img{max-height:7rem}.nav a{padding:.2rem}.nav--social a{display:inline-block;line-height:1}.small{padding-top:.8rem;color:#529e99;display:inline-block}.footer{background:#161820;color:#529e99}.footer a{color:#529e99}.footer a:hover{color:#161820}.footer .container{-webkit-flex-wrap:wrap;-moz-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.footer .small{padding-top:0}.nav--paginator{display:-webkit-box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;-webkit-justify-content:space-between;-moz-justify-content:space-between;justify-content:space-between;color:#529e99;text-align:center}.pagination{min-width:20%}.main{display:-webkit-box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-direction:normal;-webkit-box-orient:vertical;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex:1 0 auto;-moz-box-flex:1;-moz-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;-moz-justify-content:flex-start;justify-content:flex-start;margin-bottom:1.6rem}@media screen and (min-width: 40em){.main{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;-moz-justify-content:center;justify-content:center;-webkit-box-direction:normal;-webkit-box-orient:horizontal;-webkit-flex-direction:row;-moz-flex-direction:row;-ms-flex-direction:row;flex-direction:row}}.header,.feature,.footer{-webkit-box-flex:0;-webkit-flex:0 0 auto;-moz-box-flex:0;-moz-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto}@media screen and (min-width: 40em){.content{width:85%}}.share .button{margin-right:.3rem}@media screen and (min-width: 40em){.aside{max-width:20%;margin-left:5%;-webkit-box-flex:1;-webkit-flex:1 0 auto;-moz-box-flex:1;-moz-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;opacity:0.7;transition:opacity .1s}.aside .section{position:sticky;top:0}.aside--left{margin-left:0;margin-right:5%;order:-1}.aside:hover{opacity:1}}.section{margin:0}.list{list-style:none}.list--nav{overflow:hidden;margin-bottom:var(--listHeight, 0)}.list .item--post,.list .item--result,.list .item--category{margin-left:0}@media screen and (min-width: 40em){.item--nav{margin-left:.4rem;display:inline-block}}.item--nav:first-of-type{margin-left:0}.item--current a{color:#529e99}a .icon{transition:fill .1s}a .icon:hover{fill:currentColor}.icon{vertical-align:middle;width:1.1em;height:1.1em;fill:CurrentColor}img{max-width:100%;height:auto}.figure{line-height:0}.figure--left{float:left;padding-right:.8rem}.figure--right{float:right;text-align:right;padding-left:.8rem}.figure--center{text-align:center;clear:both}.video,.map{position:relative;padding-bottom:56.25%;height:0}.video iframe,.map iframe{position:absolute;top:0;left:0;width:100%;height:100%}.map{padding-bottom:70%}.figure,.video,.map,.form{margin-bottom:.8rem}audio,video{width:100%}.form{position:relative}.form__legend{font-style:italic;color:#529e99;position:absolute;overflow:hidden;right:0;clip:rect(0 0 0 0)}button,.button,input[type="text"],input[type="email"],input[type="search"],input[type="submit"],input[type="color"],textarea,select{padding:.6rem 1.2rem;margin-bottom:.6rem;transition:color .1s, background-color .1s, border .1s;line-height:inherit;border:none;box-shadow:none;border-radius:0;-webkit-appearance:none}button .icon,.button .icon,input[type="text"] .icon,input[type="email"] .icon,input[type="search"] .icon,input[type="submit"] .icon,input[type="color"] .icon,textarea .icon,select .icon{margin:0 0 .35rem}input[type="submit"],button,.button{cursor:pointer;display:inline-block;color:#161820;background:#45a29e;transition:box-shadow .1s;will-change:box-shadow;box-shadow:inset 0 0 0 2rem transparent}input[type="submit"]:hover,button:hover,.button:hover{box-shadow:inset 0 0 0 2rem rgba(0,0,0,0.25)}input[type="submit"]:active,input[type="submit"]:focus,button:active,button:focus,.button:active,.button:focus{box-shadow:inset 0 0 0 2rem rgba(0,0,0,0.25)}.button--nav{background:none;color:#45a29e;margin-bottom:0;min-height:4rem;min-width:4rem}@media screen and (min-width: 40em){.button--nav{display:none}}.button--nav:hover,.button--nav:focus{box-shadow:none;color:#66fcf1}a:focus,a:hover:focus,button:focus,button:hover:focus,.button:focus,.button:hover:focus,input:focus,input:hover:focus,textarea:focus,textarea:hover:focus,select:focus,select:hover:focus{outline:solid 0.12rem #45a29e;outline-offset:-.12rem}a:hover:focus{outline:none}input[type="text"],input[type="email"],input[type="search"],input[type="color"],textarea,select{width:100%;border:1px solid #529e99}input[type="text"]:hover,input[type="email"]:hover,input[type="search"]:hover,input[type="color"]:hover,textarea:hover,select:hover{border-color:#efeff0}select{background:#1f2833}textarea{resize:vertical}label{line-height:2rem;margin-bottom:1.49999rem;padding-top:.50001rem}@media screen and (min-width: 40em){label{margin-bottom:1.4553471429rem;padding-top:.5446528571rem}}@media screen and (min-width: 50em){label{margin-bottom:1.44999rem;padding-top:.55001rem}}@media screen and (min-width: 64em){label{margin-bottom:1.4411664706rem;padding-top:.5588335294rem}}@media screen and (min-width: 100em){label{margin-bottom:1.4342005263rem;padding-top:.5657994737rem}}code{padding:.12rem .2rem;color:#66fcf1}pre code{padding:0}.required{color:#fff}::-webkit-input-placeholder{opacity:0.5}::-moz-placeholder{opacity:0.5}:-ms-input-placeholder{opacity:0.5}:-moz-placeholder{opacity:0.5}::selection{background:#66fcf1;color:#161820;text-shadow:none}.typeset a>code{text-shadow:none}.typeset .button,.typeset button{background-image:none;text-shadow:none;color:#161820}.typeset .button:hover,.typeset .button:active,.typeset .button:focus,.typeset button:hover,.typeset button:active,.typeset button:focus{background-image:none;color:#161820}.typeset hr{width:100%}.typeset li>p{padding:0;margin:0}.typeset .nav a{padding-left:0;padding-right:0;margin-left:.2rem;margin-right:.2rem}.typeset pre{white-space:pre;overflow-x:scroll}</style>


    

    
  
    <link rel="icon" type="image/png" href="/assets/logos/16x.png" sizes="16x16">
    <link rel="apple-touch-icon" sizes="16x16" href="/assets/logos/16x.png">
  
    <link rel="icon" type="image/png" href="/assets/logos/32x.png" sizes="32x32">
    <link rel="apple-touch-icon" sizes="32x32" href="/assets/logos/32x.png">
  
    <link rel="icon" type="image/png" href="/assets/logos/96x.png" sizes="96x96">
    <link rel="apple-touch-icon" sizes="96x96" href="/assets/logos/96x.png">
  
    <link rel="icon" type="image/png" href="/assets/logos/120.png" sizes="120x120">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/logos/120.png">
  
    <link rel="icon" type="image/png" href="/assets/logos/144.png" sizes="144x144">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/logos/144.png">
  
    <link rel="icon" type="image/png" href="/assets/logos/180.png" sizes="180x180">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/logos/180.png">
  
    <link rel="icon" type="image/png" href="/assets/logos/512.png" sizes="512x512">
    <link rel="apple-touch-icon" sizes="512x512" href="/assets/logos/512.png">
  
    <link rel="icon" type="image/png" href="/assets/logos/1024.png" sizes="1024x1024">
    <link rel="apple-touch-icon" sizes="1024x1024" href="/assets/logos/1024.png">
  

<link rel="shortcut icon" href="/assets/logos/logo-cdong.gif">


    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-168923617-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-168923617-1');
  gtag('config', 'UA-168923617-1', {
    'anonymize_ip': true
  });
</script>


    <!-- Overwrite this file with code you want before the closing head tag -->

    <meta name="google-site-verification" content="fhiMUAXjII16BlWNx0x4tY2MXKJwEcdDVjILoXGUXYA">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-168923617-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-168923617-1');
  </script></head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  
  


  <body class="layout-post  rook-ransomware">
    <svg xmlns="http://www.w3.org/2000/svg" style="height: 0; position: absolute" xmlns:xlink="http://www.w3.org/1999/xlink">
  <symbol id="codepen" viewBox="0 0 16 16"><path d="M15.988 5.443c-.004-.02-.007-.04-.012-.058l-.01-.033c-.006-.017-.012-.034-.02-.05-.003-.012-.01-.023-.014-.034l-.023-.045-.02-.032-.03-.04-.024-.03c-.01-.013-.022-.026-.034-.038l-.027-.027-.04-.032-.03-.024-.012-.01L8.38.117c-.23-.155-.53-.155-.76 0L.305 4.99.296 5c-.012.007-.022.015-.032.023-.014.01-.027.02-.04.032l-.027.027-.034.037-.024.03-.03.04c-.006.012-.013.022-.02.033l-.023.045-.015.034c-.007.016-.012.033-.018.05l-.01.032c-.005.02-.01.038-.012.058l-.006.03C.002 5.5 0 5.53 0 5.56v4.875c0 .03.002.06.006.09l.007.03c.003.02.006.04.013.058l.01.033c.006.018.01.035.018.05l.015.033c.006.016.014.03.023.047l.02.03c.008.016.018.03.03.042.007.01.014.02.023.03.01.012.02.025.034.036.01.01.018.02.028.026l.04.033.03.023.01.01 7.31 4.876c.116.078.248.117.382.116.134 0 .266-.04.38-.116l7.314-4.875.01-.01c.012-.007.022-.015.032-.023.014-.01.027-.02.04-.032l.027-.027.034-.037.024-.03.03-.04.02-.032.023-.046.015-.033.018-.052.01-.033c.005-.02.01-.038.013-.058 0-.01.003-.02.004-.03.004-.03.006-.06.006-.09V5.564c0-.03-.002-.06-.006-.09l-.007-.03zM8 9.626L5.568 8 8 6.374 10.432 8 8 9.626zM7.312 5.18l-2.98 1.993-2.406-1.61 5.386-3.59v3.206zM3.095 8l-1.72 1.15v-2.3L3.095 8zm1.237.828l2.98 1.993v3.208l-5.386-3.59 2.406-1.61zm4.355 1.993l2.98-1.993 2.407 1.61-5.387 3.59v-3.206zM12.905 8l1.72-1.15v2.3L12.905 8zm-1.237-.827L8.688 5.18V1.97l5.386 3.59-2.406 1.61z" fill-rule="nonzero"></path></symbol>
  <symbol id="dribbble" viewBox="0 0 16 16"><path d="M8 16c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm6.747-6.905c-.234-.074-2.115-.635-4.257-.292.894 2.456 1.258 4.456 1.328 4.872 1.533-1.037 2.624-2.68 2.93-4.58zM10.67 14.3c-.102-.6-.5-2.688-1.46-5.18l-.044.014C5.312 10.477 3.93 13.15 3.806 13.4c1.158.905 2.614 1.444 4.194 1.444.947 0 1.85-.194 2.67-.543zm-7.747-1.72c.155-.266 2.03-3.37 5.555-4.51.09-.03.18-.056.27-.08-.173-.39-.36-.778-.555-1.16C4.78 7.85 1.47 7.807 1.17 7.8l-.003.208c0 1.755.665 3.358 1.756 4.57zM1.31 6.61c.307.005 3.122.017 6.318-.832-1.132-2.012-2.353-3.705-2.533-3.952-1.912.902-3.34 2.664-3.784 4.785zM6.4 1.368c.188.253 1.43 1.943 2.548 4 2.43-.91 3.46-2.293 3.582-2.468C11.323 1.827 9.736 1.176 8 1.176c-.55 0-1.087.066-1.6.19zm6.89 2.322c-.145.194-1.29 1.662-3.816 2.694.16.325.31.656.453.99.05.117.1.235.147.352 2.274-.286 4.533.172 4.758.22-.015-1.613-.59-3.094-1.543-4.257z"></path></symbol>
  <symbol id="designernews" viewBox="0 0 16 16"><path d="M7.514 7.988c0-2.555-1.57-4.287-4.56-4.287H0v8.6h3.016c2.903 0 4.498-1.75 4.498-4.31zM5.37 8c0 1.844-.946 2.642-2.467 2.642H2.13V5.358h.773C4.36 5.358 5.37 6.193 5.37 8zM16 12.3V3.7h-1.98v4.81L10.853 3.7h-2.07v8.6h1.982V7.152l3.39 5.146H16z"></path></symbol>
  <symbol id="facebook" viewBox="0 0 16 16"><path d="M15.117 0H.883C.395 0 0 .395 0 .883v14.234c0 .488.395.883.883.883h7.663V9.804H6.46V7.39h2.086V5.607c0-2.066 1.262-3.19 3.106-3.19.883 0 1.642.064 1.863.094v2.16h-1.28c-1 0-1.195.476-1.195 1.176v1.54h2.39l-.31 2.416h-2.08V16h4.077c.488 0 .883-.395.883-.883V.883C16 .395 15.605 0 15.117 0" fill-rule="nonzero"></path></symbol>
  <symbol id="flickr" viewBox="0 0 16 16"><path d="M0 8c0 2.05 1.662 3.71 3.71 3.71 2.05 0 3.713-1.66 3.713-3.71S5.76 4.29 3.71 4.29C1.663 4.29 0 5.95 0 8zm8.577 0c0 2.05 1.662 3.71 3.712 3.71C14.337 11.71 16 10.05 16 8s-1.662-3.71-3.71-3.71c-2.05 0-3.713 1.66-3.713 3.71z"></path></symbol>
  <symbol id="github" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.083-.202-.358-1.015.077-2.117 0 0 .672-.215 2.2.82.638-.178 1.323-.266 2.003-.27.68.004 1.364.092 2.003.27 1.527-1.035 2.198-.82 2.198-.82.437 1.102.163 1.915.08 2.117.513.56.823 1.274.823 2.147 0 3.073-1.87 3.75-3.653 3.947.287.246.543.735.543 1.48 0 1.07-.01 1.933-.01 2.195 0 .215.144.463.55.385C13.71 14.53 16 11.534 16 8c0-4.418-3.582-8-8-8"></path></symbol>
  <symbol id="hackernews" viewBox="0 0 16 16"><path d="M0 0v16h16V0H0zm8.92 8.96v3H7.25v-3l-2.75-5h1.96l1.66 3.48L9.7 3.96h1.88l-2.66 5z"></path></symbol>
  <symbol id="instagram" viewBox="0 0 16 16"><path d="M8 0C5.827 0 5.555.01 4.702.048 3.85.088 3.27.222 2.76.42c-.526.204-.973.478-1.417.923-.445.444-.72.89-.923 1.417-.198.51-.333 1.09-.372 1.942C.008 5.555 0 5.827 0 8s.01 2.445.048 3.298c.04.852.174 1.433.372 1.942.204.526.478.973.923 1.417.444.445.89.72 1.417.923.51.198 1.09.333 1.942.372.853.04 1.125.048 3.298.048s2.445-.01 3.298-.048c.852-.04 1.433-.174 1.942-.372.526-.204.973-.478 1.417-.923.445-.444.72-.89.923-1.417.198-.51.333-1.09.372-1.942.04-.853.048-1.125.048-3.298s-.01-2.445-.048-3.298c-.04-.852-.174-1.433-.372-1.942-.204-.526-.478-.973-.923-1.417-.444-.445-.89-.72-1.417-.923-.51-.198-1.09-.333-1.942-.372C10.445.008 10.173 0 8 0zm0 1.44c2.136 0 2.39.01 3.233.048.78.036 1.203.166 1.485.276.374.145.64.318.92.598.28.28.453.546.598.92.11.282.24.705.276 1.485.038.844.047 1.097.047 3.233s-.01 2.39-.048 3.233c-.036.78-.166 1.203-.276 1.485-.145.374-.318.64-.598.92-.28.28-.546.453-.92.598-.282.11-.705.24-1.485.276-.844.038-1.097.047-3.233.047s-2.39-.01-3.233-.048c-.78-.036-1.203-.166-1.485-.276-.374-.145-.64-.318-.92-.598-.28-.28-.453-.546-.598-.92-.11-.282-.24-.705-.276-1.485C1.45 10.39 1.44 10.136 1.44 8s.01-2.39.048-3.233c.036-.78.166-1.203.276-1.485.145-.374.318-.64.598-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276C5.61 1.45 5.864 1.44 8 1.44zm0 2.452c-2.27 0-4.108 1.84-4.108 4.108 0 2.27 1.84 4.108 4.108 4.108 2.27 0 4.108-1.84 4.108-4.108 0-2.27-1.84-4.108-4.108-4.108zm0 6.775c-1.473 0-2.667-1.194-2.667-2.667 0-1.473 1.194-2.667 2.667-2.667 1.473 0 2.667 1.194 2.667 2.667 0 1.473-1.194 2.667-2.667 2.667zm5.23-6.937c0 .53-.43.96-.96.96s-.96-.43-.96-.96.43-.96.96-.96.96.43.96.96z"></path></symbol>
  <symbol id="linkedin" viewBox="0 0 16 16"><path d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51V7.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"></path></symbol>
  <symbol id="medium" viewBox="0 0 16 16"><path d="M11.824 12.628l-.276.45.798.398 2.744 1.372c.15.076.294.11.418.11.278 0 .467-.177.467-.492V5.883l-4.15 6.745zm4.096-8.67c-.004-.003 0-.01-.003-.012l-4.825-2.412c-.06-.03-.123-.038-.187-.044-.016 0-.03-.01-.047-.01-.184 0-.368.092-.467.254l-.24.39-.5.814-1.89 3.08 1.89 3.076.5.813.5.812.59.95 4.71-7.64c.02-.03.01-.06-.02-.08zm-6.27 7.045L7.17 6.97l-.295-.477-.294-.477-.25-.416v4.867l3.32 1.663.5.25.5.25-.5-.813-.5-.813zM.737 1.68L.59 1.608c-.085-.042-.166-.062-.24-.062-.206 0-.35.16-.35.427v10.162c0 .272.2.594.442.716l4.145 2.08c.107.06.208.08.3.08.257 0 .438-.2.438-.53V4.01c0-.02-.012-.04-.03-.047L.738 1.68z"></path></symbol>
  <symbol id="pinterest" viewBox="0 0 16 16"><path d="M8 0C3.582 0 0 3.582 0 8c0 3.39 2.108 6.285 5.084 7.45-.07-.633-.133-1.604.028-2.295.146-.625.938-3.977.938-3.977s-.24-.48-.24-1.188c0-1.11.646-1.943 1.448-1.943.683 0 1.012.513 1.012 1.127 0 .687-.436 1.713-.662 2.664-.19.797.4 1.445 1.185 1.445 1.42 0 2.514-1.498 2.514-3.662 0-1.915-1.376-3.254-3.342-3.254-2.276 0-3.61 1.707-3.61 3.472 0 .687.263 1.424.593 1.825.066.08.075.15.057.23-.06.252-.196.796-.223.907-.035.146-.115.178-.268.107-.998-.465-1.624-1.926-1.624-3.1 0-2.524 1.834-4.84 5.287-4.84 2.774 0 4.932 1.977 4.932 4.62 0 2.757-1.74 4.977-4.153 4.977-.81 0-1.572-.422-1.833-.92l-.5 1.902c-.18.695-.667 1.566-.994 2.097.75.232 1.545.357 2.37.357 4.417 0 8-3.582 8-8s-3.583-8-8-8z" fill-rule="nonzero"></path></symbol>
  <symbol id="rss" viewBox="0 0 16 16"><path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194 11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.985 2.194-2.196 2.194C.984 16 0 15.017 0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"></path></symbol>
  <symbol id="reddit" viewBox="0 0 16 16"><path d="M1.473 9.368c-.04.185-.06.374-.06.566 0 2.3 2.94 4.173 6.554 4.173 3.613 0 6.553-1.872 6.553-4.173 0-.183-.02-.364-.055-.54l-.01-.022c-.013-.036-.02-.073-.02-.11-.2-.784-.745-1.497-1.533-2.072-.03-.01-.058-.026-.084-.047-.017-.013-.03-.028-.044-.043-1.198-.824-2.91-1.34-4.807-1.34-1.88 0-3.576.506-4.772 1.315-.01.012-.02.023-.033.033-.026.022-.056.04-.087.05-.805.576-1.364 1.293-1.572 2.086 0 .038-.01.077-.025.114l-.005.01zM8 13.003c-1.198 0-2.042-.26-2.58-.8-.116-.116-.116-.305 0-.422.117-.11.307-.11.424 0 .42.42 1.125.63 2.155.63 1.03 0 1.73-.2 2.15-.62.11-.11.3-.11.42 0 .11.12.11.31 0 .43-.54.54-1.38.8-2.58.8zM5.592 7.945c-.61 0-1.12.51-1.12 1.12 0 .608.51 1.102 1.12 1.102.61 0 1.103-.494 1.103-1.102 0-.61-.494-1.12-1.103-1.12zm4.83 0c-.61 0-1.12.51-1.12 1.12 0 .608.51 1.102 1.12 1.102.61 0 1.103-.494 1.103-1.102 0-.61-.494-1.12-1.103-1.12zM13.46 6.88c.693.556 1.202 1.216 1.462 1.94.3-.225.48-.578.48-.968 0-.67-.545-1.214-1.214-1.214-.267 0-.52.087-.728.243zM1.812 6.64c-.67 0-1.214.545-1.214 1.214 0 .363.16.7.43.927.268-.72.782-1.37 1.478-1.92-.202-.14-.443-.22-.694-.22zm6.155 8.067c-3.944 0-7.152-2.14-7.152-4.77 0-.183.016-.363.046-.54-.53-.33-.86-.91-.86-1.545 0-1 .82-1.812 1.82-1.812.45 0 .87.164 1.2.455 1.24-.796 2.91-1.297 4.75-1.33l1.21-3.69.27.063s.01 0 .01.002l2.82.663c.23-.533.76-.908 1.38-.908.82 0 1.49.67 1.49 1.492 0 .823-.67 1.492-1.49 1.492s-1.49-.67-1.49-1.49L9.4 2.18l-.98 2.99c1.77.07 3.37.57 4.57 1.35.33-.31.764-.48 1.225-.48 1 0 1.814.81 1.814 1.81 0 .66-.36 1.26-.92 1.58.02.17.04.33.04.5-.01 2.63-3.21 4.77-7.16 4.77zM13.43 1.893c-.494 0-.895.4-.895.894 0 .493.4.894.894.894.49 0 .89-.4.89-.89s-.4-.89-.9-.89z"></path></symbol>
  <symbol id="skype" viewBox="0 0 16 16"><path d="M8.035 12.6c-2.685 0-3.885-1.322-3.885-2.313 0-.51.374-.865.89-.865 1.15 0 .85 1.653 2.995 1.653 1.096 0 1.703-.597 1.703-1.208 0-.368-.18-.775-.904-.954l-2.387-.597C4.524 7.833 4.175 6.79 4.175 5.812c0-2.034 1.91-2.798 3.704-2.798 1.65 0 3.6.916 3.6 2.136 0 .523-.452.827-.97.827-.98 0-.798-1.36-2.773-1.36-.98 0-1.523.444-1.523 1.08 0 .636.774.84 1.446.993l1.767.392c1.936.433 2.427 1.566 2.427 2.633 0 1.652-1.266 2.886-3.82 2.886m7.4-3.264l-.014.084-.028-.16c.015.024.028.05.042.076.082-.45.125-.912.125-1.373 0-1.023-.2-2.014-.595-2.948-.38-.902-.925-1.712-1.62-2.407-.692-.696-1.5-1.242-2.4-1.623C10.015.59 9.025.39 8.005.39c-.48 0-.963.045-1.43.135H6.57l.08.04-.16-.023.08-.016C5.927.183 5.205 0 4.472 0 3.278 0 2.155.466 1.31 1.313.465 2.16 0 3.286 0 4.483c0 .763.195 1.512.563 2.175l.013-.083.028.16c-.015-.026-.027-.052-.04-.077-.076.43-.115.867-.115 1.305 0 1.022.2 2.014.593 2.948.38.903.925 1.713 1.62 2.408.693.695 1.5 1.242 2.4 1.623.932.397 1.92.597 2.94.597.445 0 .89-.04 1.325-.118l-.077-.043.162.028-.084.014c.67.378 1.426.58 2.2.58 1.194 0 2.317-.466 3.162-1.313.845-.846 1.31-1.972 1.31-3.17 0-.765-.197-1.517-.566-2.18" fill-rule="nonzero"></path></symbol>
  <symbol id="tumblr" viewBox="0 0 16 16"><path d="M9.708 16c-3.396 0-4.687-2.504-4.687-4.274V6.498H3.403V4.432C5.83 3.557 6.412 1.368 6.55.12c.01-.086.077-.12.115-.12H9.01v4.076h3.2v2.422H8.997v4.98c.01.667.25 1.58 1.472 1.58h.067c.424-.012.994-.136 1.29-.278l.77 2.283c-.288.424-1.594.916-2.77.936h-.12z" fill-rule="nonzero"></path></symbol>
  <symbol id="twitch" viewBox="0 0 16 16"><g fill-rule="nonzero"><path d="M1.393 0L.35 2.783v11.13h3.824V16h2.088l2.085-2.088h3.13L15.65 9.74V0H1.394zm1.39 1.39H14.26v7.653l-2.435 2.435H8l-2.085 2.085v-2.085H2.783V1.39z"></path><path d="M6.61 8.348H8V4.175H6.61v4.173zm3.824 0h1.39V4.175h-1.39v4.173z"></path></g></symbol>
  <symbol id="twitter" viewBox="0 0 16 16"><path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.036-2.396-1.036-1.812 0-3.282 1.468-3.282 3.28 0 .258.03.51.085.75C5.152 5.39 2.733 4.084 1.114 2.1.83 2.583.67 3.147.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.416-.02-.617-.058.418 1.304 1.63 2.253 3.067 2.28-1.124.88-2.54 1.404-4.077 1.404-.265 0-.526-.015-.783-.045 1.453.93 3.178 1.474 5.032 1.474 6.038 0 9.34-5 9.34-9.338 0-.143-.004-.284-.01-.425.64-.463 1.198-1.04 1.638-1.7z" fill-rule="nonzero"></path></symbol>
  <symbol id="vimeo" viewBox="0 0 16 16"><path d="M15.992 4.275c-.07 1.56-1.16 3.697-3.263 6.41-2.176 2.832-4.017 4.248-5.522 4.248-.933 0-1.722-.862-2.367-2.588L3.55 7.6c-.48-1.724-.993-2.587-1.542-2.587-.12 0-.538.252-1.255.755L0 4.796C.79 4.1 1.568 3.406 2.335 2.71c1.053-.912 1.844-1.39 2.37-1.44 1.246-.12 2.012.733 2.3 2.56.31 1.97.526 3.194.647 3.673.36 1.634.754 2.45 1.185 2.45.335 0 .838-.53 1.51-1.59.67-1.06 1.028-1.866 1.076-2.42.096-.915-.263-1.374-1.077-1.374-.383 0-.778.087-1.185.262.788-2.58 2.29-3.834 4.508-3.762 1.644.048 2.42 1.116 2.324 3.205z" fill-rule="nonzero"></path></symbol>
  <symbol id="youtube" viewBox="0 0 16 16"><path d="M0 7.345c0-1.294.16-2.59.16-2.59s.156-1.1.636-1.587c.608-.637 1.408-.617 1.764-.684C3.84 2.36 8 2.324 8 2.324s3.362.004 5.6.166c.314.038.996.04 1.604.678.48.486.636 1.588.636 1.588S16 6.05 16 7.346v1.258c0 1.296-.16 2.59-.16 2.59s-.156 1.102-.636 1.588c-.608.638-1.29.64-1.604.678-2.238.162-5.6.166-5.6.166s-4.16-.037-5.44-.16c-.356-.067-1.156-.047-1.764-.684-.48-.487-.636-1.587-.636-1.587S0 9.9 0 8.605v-1.26zm6.348 2.73V5.58l4.323 2.255-4.32 2.24h-.002z"></path></symbol>
  <symbol id="link" viewBox="0 0 16 16"><path d="M5.86 12.7l-.81.8c-.7.7-1.84.7-2.54 0a1.75 1.75 0 0 1 0-2.5l2.98-2.96c.61-.61 1.77-1.52 2.62-.68a1 1 0 1 0 1.4-1.4c-1.44-1.43-3.57-1.17-5.42.67L1.1 9.6a3.72 3.72 0 0 0 0 5.32 3.78 3.78 0 0 0 5.34 0l.8-.8a1 1 0 1 0-1.39-1.42zm9.03-11.5c-1.55-1.53-3.7-1.6-5.14-.19l-1 1a1 1 0 1 0 1.39 1.41l1-1c.75-.74 1.72-.43 2.35.2a1.75 1.75 0 0 1 0 2.5l-3.17 3.15c-1.46 1.45-2.14.77-2.43.48a1 1 0 0 0-1.4 1.4c.67.67 1.43 1 2.23 1 .98 0 2.01-.5 3-1.47l3.17-3.15a3.72 3.72 0 0 0 0-5.32z"></path></symbol>
  <symbol id="email" viewBox="0 0 16 11"><path fill-rule="evenodd" d="M1.33 0h13.34L8 5 1.33 0zM16 0v11H0V0l8 6 8-6z"></path></symbol>
  <symbol id="nav" viewBox="0 0 16 11"><path d="M0 12h16v-2H0v2zm0-5h16V5H0v2zm0-7v2h16V0H0z"></path></symbol>
</svg>


    <header class="header">
  <div class="container">
    <a class="logo" href="/">
  <img src="/assets/logos/logo-cdong.gif" alt="">
</a>


    
<nav class="nav  nav--header">
  <ul class="list  list--nav">
    

      

      <li class="item  item--nav">
        <a href="/">Home</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/about/">About</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/blog/">Blog</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/search/">Search</a>
      </li>
    
  </ul>
  <button class="button  button--nav" aria-label="Menu toggle">
    <svg width="16" height="16" class="icon  icon--nav" role="img" alt="Menu"><title>Menu</title>
<use xlink:href="#nav" fill="CurrentColor"></use></svg>

  </button>
</nav>


<script type="text/javascript">
  // Get list and button
  const navList = document.querySelector('.header .list--nav')
  const button  = document.querySelector('.header .button--nav')

  // Hide nav and apply toggle
  const collapseNav = () => {
    if (document.body.clientWidth < 640) {
      navList.style.setProperty('--listHeight', `-${navList.offsetHeight}px`)
    } else {
      navList.removeAttribute('style')
    }

    button.onclick = () => {
      navList.style.setProperty('transition', `margin .1s`)
      if (navList.style.getPropertyValue('--listHeight')) {
        navList.style.removeProperty('--listHeight')
      } else {
        navList.style.setProperty('--listHeight', `-${navList.offsetHeight}px`)
      }
    }
  }

  collapseNav()

  // Check on resize if to collapse nav
  window.addEventListener('resize', () => {
    collapseNav()
  })
</script>

  </div>

  





  <meta name="google-site-verification" content="fhiMUAXjII16BlWNx0x4tY2MXKJwEcdDVjILoXGUXYA">
</header>


<main class="main  container">

  <article class="article  article--post  content  typeset">

    

<small class="small  post-meta">
  
  
    
      <span class="label  label--category"><a href="/categories/#reverse%20engineering">Reverse Engineering</a></span>
    
  &nbsp;·&nbsp;<time datetime="2022-01-06T00:00:00-05:00" class="time">06 Jan 2022</time>
</small>

    
    <h1 id="rook-ransomware">Rook Ransomware</h1>

<h2 id="contents">Contents</h2>

<ul>
  <li>
<a href="#rook-ransomware">Rook Ransomware</a>
    <ul>
      <li><a href="#contents">Contents</a></li>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#iocs">IOCS</a></li>
      <li><a href="#ransom-note">Ransom Note</a></li>
    </ul>
  </li>
  <li>
<a href="#static-code-analysis">Static Code Analysis</a>
    <ul>
      <li><a href="#rsa-key-generation">RSA Key Generation</a></li>
      <li><a href="#anti-detection-alternate-data-streams">Anti-Detection: Alternate Data Streams</a></li>
      <li><a href="#command-line-arguments">Command-line Arguments</a></li>
      <li><a href="#logging">Logging</a></li>
      <li><a href="#stopping-services">Stopping Services</a></li>
      <li><a href="#terminating-processes">Terminating Processes</a></li>
      <li><a href="#deleting-shadow-copies">Deleting Shadow Copies</a></li>
      <li><a href="#multithreading-setup">Multithreading Setup</a></li>
      <li><a href="#network-resource-traversal">Network Resource Traversal</a></li>
      <li><a href="#drives-traversal">Drives Traversal</a></li>
      <li><a href="#shares-traversal">Shares Traversal</a></li>
      <li><a href="#child-thread">Child Thread</a></li>
      <li><a href="#file-encryption">File Encryption</a></li>
      <li><a href="#references">References</a></li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>This is my analysis for <strong>ROOK Ransomware</strong>.</p>

<p><strong>ROOK</strong> is a relatively new ransomware that has been coming up in the last few months. With the <a href="https://github.com/ARMmbed/mbedtls">Mbed TLS library</a>, the malware uses a hybrid cryptography scheme to encrypt files using AES and protect its keys with RSA-2048.</p>

<p>For execution speed, <strong>ROOK</strong> is quite fast since it uses a decently good method of multithreading with two global lists for file and directory traversal.</p>

<p>As it has been claimed by other researchers, <strong>ROOK</strong> borrows some of the code from the leaked <strong>BABUK</strong> source code. To be more specific, the <strong>ROOK</strong> developers copied and pasted the code for services &amp; processes termination as well as deleting shadow copies. <strong>ROOK’s</strong> multithreading approach is a reimplementation and an upgrade from that of <strong>BABUK version 3</strong>, which is now more efficient for directory traversal.</p>

<p>However, unlike <strong>BABUK</strong> devs who are big fans of using ECDH curves and eSTREAM portfolio Profile 1 ciphers such as ChaCha and HC-128 for hybrid-encryption, <strong>ROOK</strong> devs stick with the traditional choice of RSA and AES.</p>

<p><img src="/uploads/rook01.PNG" alt="alt text"></p>

<p><em>Figure 1: ROOK Leak Site.</em></p>

<h2 id="iocs">IOCS</h2>

<p>The analyzed sample is a 64-bit Windows executable.</p>

<p><strong>MD5</strong>: 6d87be9212a1a0e92e58e1ed94c589f9</p>

<p><strong>SHA256</strong>: c2d46d256b8f9490c9599eea11ecef19fde7d4fdd2dea93604cee3cea8e172ac</p>

<p><strong>Sample</strong>: <a href="https://bazaar.abuse.ch/sample/c2d46d256b8f9490c9599eea11ecef19fde7d4fdd2dea93604cee3cea8e172ac/">MalwareBazaar</a></p>

<p><img src="/uploads/rook02.PNG" alt="alt text"></p>

<p><em>Figure 2: VirusTotal Result.</em></p>

<h2 id="ransom-note">Ransom Note</h2>

<p>The content of the default ransom note is stored in plaintext in <strong>ROOK’s</strong> executable.</p>

<p><strong>ROOK’s</strong> ransom note filename is <strong>“HowToRestoreYourFiles.txt”</strong>, which is really similar to <strong>BABUK’s “How To Restore Your Files.txt”</strong>.</p>

<p><img src="/uploads/rook03.PNG" alt="alt text"></p>

<p><em>Figure 3: ROOK’s Ransom Note.</em></p>

<h1 id="static-code-analysis">Static Code Analysis</h1>

<h2 id="rsa-key-generation">RSA Key Generation</h2>

<p>The first thing <strong>ROOK</strong> does upon execution is setting up the RSA keys for asymmetric encryption.</p>

<p>First, the malware initializes a <strong>CTR_DRBG</strong> <a href="https://tls.mbed.org/api/structmbedtls__ctr__drbg__context.html">context</a> using the <a href="https://tls.mbed.org/api/ctr__drbg_8h.html">Mbed TLS library</a>, which is used to build a pseudo-RNG to later randomly generate AES keys.</p>

<p><img src="/uploads/rook04.PNG" alt="alt text"></p>

<p><em>Figure 4: CTR_DRBG Initialization.</em></p>

<p>Next, it calls <a href="https://tls.mbed.org/api/pk_8h.html#ade680bf8e87df7ccc3bb36b52e43972b">mbedtls_pk_parse_public_key</a> to parse the TA’s RSA public key into a <strong>mbedtls_pk_context</strong> struct. The <strong>ROOK’s</strong> public key context is then extracted from the <strong>pk_ctx</strong> field on the newly populated <strong>mbedtls_pk_context</strong> struct.</p>

<p>Below is the raw content of the public key.</p>

<pre><code class="language-RSA">-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4g06WvN+BRr9GeeOkZ4y
nnK1uHreCPZyEsc43g3ftVXqsq2Kbdy7Z+XORqxmBi8D5nhDfw3eHRzH8wpcUos3
szWKyJLOeKhN6DM5M4FppD8hyuKDTcgsa70Nhapc1Oyjfh3kf3Kc/2CUhnPYEzHe
fHN3yOq9wxOVGc1S+bcTM3ez8gRuv0fB9ao2bJM0pKJphYq5dNkT0p2Ty923n+yZ
AOKELIWwwyOQgyfiv8ZwkdPL+UbNQq2dYZEWa1qSsGgN2655hvvD/pH/bggAFEqm
OybQFnRcdG9Fja9m/ZVp7jBYuX+4FaFq3DjD0oW/7imboVsEqcx7l7ym4tiKCz57
MwIDAQAB
-----END PUBLIC KEY-----
</code></pre>

<p><img src="/uploads/rook05.PNG" alt="alt text"></p>

<p><em>Figure 5: Parsing <strong>ROOK’s</strong> RSA Public Key.</em></p>

<p><strong>ROOK</strong> then calls <strong>RegCreateKeyExW</strong> to open the subkey <strong>Software</strong> in <strong>HKEY_CURRENT_USER</strong>. Using that, it calls <strong>RegQueryValueExW</strong> to check if the registry value <strong>RookPublicKey</strong> exists in there. If it does not, the malware generates a public-private key pair for the victim.</p>

<p><img src="/uploads/rook06.PNG" alt="alt text"></p>

<p><img src="/uploads/rook07.PNG" alt="alt text"></p>

<p><em>Figure 6, 7: Querying From Registry &amp; Generating Victim Public-Private Key Pair.</em></p>

<p>Next, <strong>ROOK</strong> encrypts the victim’s RSA private key using its own public key context.</p>

<p><img src="/uploads/rook08.PNG" alt="alt text"></p>

<p><em>Figure 8: Encrypting Victim Private Key Using TA’s Public Key.</em></p>

<p>The victim’s public key and encrypted private key are consecutively stored in the registry at the value <strong>RookPublicKey</strong> and <strong>RookPrivateKey</strong>.</p>

<p>If the victim’s public key was already generated before and the malware can query it directly from registry, the victim’s encrypted private key is pulled from the registry value <strong>RookPrivateKey</strong>.</p>

<p>Finally, the malware calls <strong>mbedtls_pk_parse_public_key</strong> to retrieve the victim’s public key context and wipes the victim’s raw private key from memory.</p>

<p><img src="/uploads/rook09.PNG" alt="alt text"></p>

<p><em>Figure 9: Writing Keys to Registry &amp; Cleaning Up.</em></p>

<h2 id="anti-detection-alternate-data-streams">Anti-Detection: Alternate Data Streams</h2>

<p><strong>Alternate Data Streams (ADS)</strong> is a file attribute on the NT File System (NTFS) which was designed for compatibility with Macintosh Hierarchical File System (HFS).</p>

<p>For normal files, there is typically one primary data stream that is known as the unnamed data stream since its name is an empty string. However, ADS allows files to have more than one data stream, with any stream with a name being considered alternate.</p>

<p>Because alternate data streams are hidden from <strong>Windows Explorer</strong> and the <strong>dir</strong> command on the command-line, they are a sneaky way to hide external executable from a seemingly harmless file.</p>

<p>To evade detection, <strong>ROOK</strong> uses ADS to hides its own executable. First, it calls <strong>GetModuleFileNameW</strong> with a NULL handle to retrieve its own executable path.</p>

<p>It then calls <strong>CreateFileW</strong> to retrieve its own handle and <strong>SetFileInformationByHandle</strong> to rename the file with a data stream named <strong>“:ask”</strong>. This ultimately puts the entire executable into the alternate <strong>“:ask”</strong> data stream, leaving an empty file on the primary stream.</p>

<p><img src="/uploads/rook10.PNG" alt="alt text"></p>

<p><em>Figure 10: Moving Executable to Data Stream.</em></p>

<p>Pausing the execution after the handle is released using the call to <strong>CloseHandle</strong>, we can examine how it looks in the system.</p>

<p>By running the command <strong>“dir /r”</strong>, we can examine what changes to the executable file.</p>

<p>To test this, I use two copies of the <strong>ROOK</strong> sample and have the <strong>ro0k.mal_</strong> one hide itself in the <strong>“:ask”</strong> data stream. As we can see in the command-line, that file shows up empty, but its alternate data stream contains the full malicious executable.</p>

<p><img src="/uploads/rook11.PNG" alt="alt text"></p>

<p><em>Figure 11: Examining Alternate Data Stream In Command-Line.</em></p>

<p>After doing this, the ransomware file will appear as empty in the file system until the end of execution.</p>

<p>After hiding itself, <strong>ROOK</strong> also calls <strong>SetFileInformationByHandle</strong> again to set the file to be deleted once all handles are closed at the end.</p>

<p><img src="/uploads/rook12.PNG" alt="alt text"></p>

<p><em>Figure 12: Set Up File for Self-Deletion.</em></p>

<h2 id="command-line-arguments">Command-line Arguments</h2>

<p><strong>ROOK</strong> can run with or without command-line arguments.</p>

<p>Below is the list of arguments that can be supplied by the operator.</p>

<table>
  <thead>
    <tr>
      <th>Argument</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>-debug &lt;log_filename&gt;</strong></td>
      <td>Enable logging to the specified log file</td>
    </tr>
    <tr>
      <td><strong>-shares &lt;share_list&gt;</strong></td>
      <td>List of network shares to be traversed</td>
    </tr>
    <tr>
      <td><strong>-paths &lt;drive_list&gt;</strong></td>
      <td>List of local &amp; network drives to be traversed</td>
    </tr>
  </tbody>
</table>

<h2 id="logging">Logging</h2>

<p>When the <strong>debug</strong> argument is provided on the command-line, <strong>ROOK</strong> enables debugging and calls <strong>CreateFileW</strong> to create the log file to later log into.</p>

<p>It also calls <strong>InitializeCriticalSection</strong> to initialize a critical section to prevent multiple threads from writing into the log file at the same time.</p>

<p><img src="/uploads/rook13.PNG" alt="alt text"></p>

<p><em>Figure 13: Logging Initialization.</em></p>

<h2 id="stopping-services">Stopping Services</h2>

<p>For stopping services, <strong>ROOK</strong> borrows this part from the leaked <strong>BABUK</strong> source code.</p>

<p>The malware first calls <strong>GetTickCount</strong> to get a tick count prior to stopping services. It then calls <strong>OpenSCManagerA</strong> to retrieve a service control manager handle.</p>

<p><img src="/uploads/rook14.PNG" alt="alt text"></p>

<p><em>Figure 14: Retrieving Service Control Manager.</em></p>

<p>Next, it iterates through a hard-coded list containing services to be stopped. For each of these service, the malware calls <strong>OpenServiceA</strong> to retrieve the service’s handle and <strong>QueryServiceStatusEx</strong> to query and checks if the service state is <strong>SERVICE_STOP_PENDING</strong>.</p>

<p>If it is not, <strong>ROOK</strong> calls <strong>EnumDependentServicesA</strong> to enumerate through all dependent services of the target service and stop them.</p>

<p><img src="/uploads/rook15.PNG" alt="alt text"></p>

<p><em>Figure 15: Iterating Through Service Stop List.</em></p>

<p>For each dependent service, the malware calls <strong>OpenServiceA</strong> to retrieve its handle and <strong>ControlService</strong> to send a control stop code to stop it. It also sleeps and calls <strong>QueryServiceStatusEx</strong> to wait until the service’s state is fully stopped.</p>

<p><img src="/uploads/rook16.PNG" alt="alt text"></p>

<p><em>Figure 16: Stopping Dependent Services.</em></p>

<p>After stopping all dependent services, <strong>ROOK</strong> calls <strong>ControlService</strong> send a control stop code to the main service and continuosly checks until the service is fully stopped.</p>

<p><img src="/uploads/rook17.PNG" alt="alt text"></p>

<p><em>Figure 17: Stopping Target Services.</em></p>

<p>For stopping all services, the maximum timeout is 30000ms or 30 seconds from the original tick count. If it takes more than 30 seconds to stop services, the malware aborts and exits the function.</p>

<p>Below is the list of services that are stopped.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"memtas"</span><span class="p">,</span> <span class="s">"mepocs"</span><span class="p">,</span> <span class="s">"vss"</span><span class="p">,</span> <span class="s">"sql"</span><span class="p">,</span> <span class="s">"svc$"</span><span class="p">,</span> <span class="s">"veeam"</span><span class="p">,</span> <span class="s">"backup"</span><span class="p">,</span> <span class="s">"GxVss"</span><span class="p">,</span> <span class="s">"GxBlr"</span><span class="p">,</span> <span class="s">"GxFWD"</span><span class="p">,</span> <span class="s">"GxCVD"</span><span class="p">,</span> <span class="s">"GxCIMgr"</span><span class="p">,</span> <span class="s">"DefWatch"</span><span class="p">,</span> <span class="s">"ccEvtMgr"</span><span class="p">,</span> <span class="s">"ccSetMgr"</span><span class="p">,</span> <span class="s">"SavRoam"</span><span class="p">,</span> <span class="s">"RTVscan"</span><span class="p">,</span> <span class="s">"QBFCService"</span><span class="p">,</span> <span class="s">"QBIDPService"</span><span class="p">,</span> <span class="s">"Intuit.QuickBooks.FCS"</span><span class="p">,</span> <span class="s">"QBCFMonitorService"</span><span class="p">,</span> <span class="s">"AcrSch2Svc"</span><span class="p">,</span> <span class="s">"AcronisAgent"</span><span class="p">,</span> <span class="s">"CASAD2DWebSvc"</span><span class="p">,</span> <span class="s">"CAARCUpdateSvc"</span>
</code></pre></div></div>

<h2 id="terminating-processes">Terminating Processes</h2>

<p>This part of code is also copied and pasted from the <strong>BABUK</strong> source code.</p>

<p><strong>ROOK</strong> calls <strong>CreateToolhelp32Snapshot</strong> to retrieve a snapshot of all processes and threads in the system. It then calls <strong>Process32FirstW</strong> and <strong>Process32NextW</strong> to enumerate through the snapshot.</p>

<p>For each process whose name is in the list of processes to be terminated, the malware calls <strong>OpenProcess</strong> to retrieve the process’s handle and <strong>TerminateProcess</strong> to terminate it.</p>

<p><img src="/uploads/rook18.PNG" alt="alt text"></p>

<p><em>Figure 18: Stopping Target Services.</em></p>

<p>Below is the list of processes that are stopped.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"sql.exe"</span><span class="p">,</span> <span class="s">"oracle.exe"</span><span class="p">,</span> <span class="s">"ocssd.exe"</span><span class="p">,</span> <span class="s">"dbsnmp.exe"</span><span class="p">,</span> <span class="s">"visio.exe"</span><span class="p">,</span> <span class="s">"winword.exe"</span><span class="p">,</span> <span class="s">"wordpad.exe"</span><span class="p">,</span> <span class="s">"notepad.exe"</span><span class="p">,</span> <span class="s">"excel.exe"</span><span class="p">,</span> <span class="s">"onenote.exe"</span><span class="p">,</span> <span class="s">"outlook.exe"</span><span class="p">,</span> <span class="s">"synctime.exe"</span><span class="p">,</span> <span class="s">"agntsvc.exe"</span><span class="p">,</span> <span class="s">"isqlplussvc.exe"</span><span class="p">,</span> <span class="s">"xfssvccon.exe"</span><span class="p">,</span> <span class="s">"mydesktopservice.exe"</span><span class="p">,</span> <span class="s">"ocautoupds.exe"</span><span class="p">,</span> <span class="s">"encsvc.exe"</span><span class="p">,</span> <span class="s">"firefox.exe"</span><span class="p">,</span> <span class="s">"tbirdconfig.exe"</span><span class="p">,</span> <span class="s">"mydesktopqos.exe"</span><span class="p">,</span> <span class="s">"ocomm.exe"</span><span class="p">,</span> <span class="s">"dbeng50.exe"</span><span class="p">,</span> <span class="s">"sqbcoreservice.exe"</span><span class="p">,</span> <span class="s">"infopath.exe"</span><span class="p">,</span> <span class="s">"msaccess.exe"</span><span class="p">,</span> <span class="s">"mspub.exe"</span><span class="p">,</span> <span class="s">"powerpnt.exe"</span><span class="p">,</span> <span class="s">"steam.exe"</span><span class="p">,</span> <span class="s">"thebat.exe"</span><span class="p">,</span> <span class="s">"thunderbird.exe"</span>
</code></pre></div></div>

<h2 id="deleting-shadow-copies">Deleting Shadow Copies</h2>

<p>This part of code is also copied and pasted from the <strong>BABUK</strong> source code.</p>

<p><strong>ROOK</strong> first checks if its process is running under a 64-bit processor by calling <strong>IsWow64Process</strong>.</p>

<p><img src="/uploads/rook19.PNG" alt="alt text"></p>

<p><em>Figure 19: Checking Process Architecture.</em></p>

<p>If it is, the malware calls <strong>Wow64DisableWow64FsRedirection</strong> to disable file system redirection for its process.</p>

<p>Then it executes <strong>ShellExecuteW</strong> to launch the following command in the command line to delete all shadow copies in the system.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vssadmin.exe</span><span class="w"> </span><span class="nx">delete</span><span class="w"> </span><span class="nx">shadows</span><span class="w"> </span><span class="nx">/all</span><span class="w"> </span><span class="nx">/quiet</span><span class="w">
</span></code></pre></div></div>

<p>Finally, if the malware’s process is running under a 64-bit architecture, it calls <strong>Wow64RevertWow64FsRedirection</strong> to enable file system redirection.</p>

<p><img src="/uploads/rook20.PNG" alt="alt text"></p>

<p><em>Figure 20: Deleting Shadow Copies.</em></p>

<h2 id="multithreading-setup">Multithreading Setup</h2>

<p>Prior to encrypting files, <strong>ROOK</strong> sets up its own multithreading system.</p>

<p>Initially, it calls <strong>GetSystemInfo</strong> to retrieve the number of processors in the system.</p>

<p>The multithreading structure is divided into two parts: file encryption and directory enumeration.</p>

<p>For file encryption, the malware calculates the maximum number of files to be encrypted by multiple threads at the same time is 24 times the number of processors. It then calls <strong>HeapAlloc</strong> to allocate a global array to store the files that are set to be encrypted and <strong>CreateSemaphoreA</strong> to create 2 semaphores that are used for synchronization among threads that access the file array. Finally, it also calls 
<strong>InitializeCriticalSection</strong> to initialize a critical section that allows one thread to add or remove a file from the global array at a time.</p>

<p><img src="/uploads/rook21.PNG" alt="alt text"></p>

<p><em>Figure 21: Threading Setup for File Encryption.</em></p>

<p>For directory enumeration, the malware calculates the maximum number of directories to be enumerated by multiple threads at the same time is 6 times the number of processors. It also creates a global array, 2 semaphores, and a critical section like to the file encryption part above.</p>

<p><img src="/uploads/rook22.PNG" alt="alt text"></p>

<p><em>Figure 22: Threading Setup for Directory Enumeration.</em></p>

<p>Next, the malware calls <strong>HeapAlloc</strong> to allocate two arrays to store child thread handles, one for file encryption and the other for directory enumeration.</p>

<p><strong>ROOK</strong> then calls <strong>CreateThread</strong> to spawn threads for double the number of processors for each thread array. The functionalities of these threads are later discussed in the <a href="#child-thread">Child Thread</a> section.</p>

<p><img src="/uploads/rook23.PNG" alt="alt text"></p>

<p><em>Figure 23: Spawning Child Threads.</em></p>

<h2 id="network-resource-traversal">Network Resource Traversal</h2>

<p>When the command-line argument <strong>“-paths”</strong> or <strong>“-shares”</strong> is not provided, <strong>ROOK</strong> recursively traverses through all resources in the network.</p>

<p>The malware calls <strong>WNetOpenEnumW</strong> to retrieve an enumeration handle for all network resources and <strong>WNetEnumResourceW</strong> to enumerate through them.</p>

<p>For each network resource, if it’s a container for other resources that can also be enumerated, <strong>ROOK</strong> recursively passes it back to the current function to traverse it.</p>

<p>If the resource is just a normal and connectable directory, the malware passes it into a recursive function to traverse it, which will be discussed in the <a href="#drives-traversal">Drives Traversal</a> section.</p>

<p><img src="/uploads/rook24.PNG" alt="alt text"></p>

<p><em>Figure 24: Traversing Network Resources.</em></p>

<h2 id="drives-traversal">Drives Traversal</h2>

<p>When the command-line argument <strong>“-paths”</strong> is provided, <strong>ROOK</strong> specifically enumerates them and exits upon completion.</p>

<p>The argument can come in the form of a list of paths, each separated by a comma. Instead of a normal directory path, <strong>ROOK</strong> also accepts a two-character string of a drive letter followed by a colon as a path to a drive.</p>

<p><img src="/uploads/rook25.PNG" alt="alt text"></p>

<p><em>Figure 25: Parsing “-paths” Command-Line Argument.</em></p>

<p>When traversing a drive, <strong>ROOK</strong> builds the following drive path.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">\\\\</span><span class="o">?</span><span class="err">\\</span><span class="o">&lt;</span><span class="n">drive_letter</span><span class="o">&gt;:</span>
</code></pre></div></div>

<p>With the path, the malware checks and avoids enumerating the drive if it’s a CD-ROM drive.</p>

<p>If the drive type is a remote drive, <strong>ROOK</strong> calls <strong>WNetGetConnectionW</strong> to retrieve the remote name of the drive and passes it to be traversed by the <strong>recursive_traverse_dir</strong> function.</p>

<p>If the drive type is not remote drive and CD-ROM drive, the malware simply passes it to the <strong>recursive_traverse_dir</strong> function.</p>

<p>In the <strong>recursive_traverse_dir</strong> function, <strong>ROOK</strong> begins by executing two nested while loop. The first one loops and waits until the <strong>END_ACCESS_DIR_SEMAPHORE</strong> semaphore’s count is reduced to zero, and its state is nonsignaled. When this happens, it means every directory in the global directory list is already traversed and no thread is extracting from it.</p>

<p>While waiting for this, the inner while loop waits until the <strong>BEGIN_ACCESS_FILE_SEMAPHORE</strong> semaphore is signaled, which allows the current process to access the global file list. After obtaining the ownership of the critical section for the global file list using <strong>EnterCriticalSection</strong>, <strong>ROOK</strong> extracts the file at the current index, increments the index, and encrypts it. The file encryption routine is later discussed at the <a href="#file-encryption">File Encryption</a> section.</p>

<p><img src="/uploads/rook27.PNG" alt="alt text"></p>

<p><em>Figure 27: Waiting for Directory List to Be Cleared &amp; Encrypting File in the Meantime.</em></p>

<p>Instead of just looping and waiting for the directory list to be cleared, <strong>ROOK</strong> extracts and encrypts files in the global file list during the wait time to increase efficiency and avoids wasting computing resources. This makes the overall enumeration and encryption process quite fast.</p>

<p>Next, the malware calls <strong>EnterCriticalSection</strong> to obtain the ownership of the global directory list and adds the directory path to be traversed in. Then, it calls <strong>ReleaseSemaphore</strong> to release the <strong>BEGIN_ACCESS_DIR_SEMAPHORE</strong> semaphore, which increments its count by one and signals other threads that another directory is available to be enumerated.</p>

<p><img src="/uploads/rook28.PNG" alt="alt text"></p>

<p><em>Figure 28: Adding Directory to Global List &amp; Signaling for Enumeration.</em></p>

<p>Then, the function begins enumerating the directory for all its sub-directories. <strong>ROOK</strong> builds the path **“<dir_path>\\\*"** and passes it to **FindFirstFileW** to start the enumeration.</dir_path></p>

<p><img src="/uploads/rook29.PNG" alt="alt text"></p>

<p><em>Figure 29: Enumerating Directory for Sub-Directories.</em></p>

<p>For each sub-directory found, the malware checks if the filename is not in the list of files and directories to avoid. If it’s not, the sub-directory full path is constructed and passed back to <strong>recursive_traverse_dir</strong> to be recursively traversed.</p>

<p>Below is the list of files and directories to avoid.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">log_filename</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">"Mozilla Firefox"</span><span class="p">,</span> <span class="s">"$Recycle.Bin"</span><span class="p">,</span> <span class="s">"ProgramData"</span><span class="p">,</span> <span class="s">"All Users"</span><span class="p">,</span> <span class="s">"autorun.inf"</span><span class="p">,</span> <span class="s">"boot.ini"</span><span class="p">,</span> <span class="s">"bootfont.bin"</span><span class="p">,</span> <span class="s">"bootsect.bak"</span><span class="p">,</span> <span class="s">"bootmgr"</span><span class="p">,</span> <span class="s">"bootmgr.efi"</span><span class="p">,</span> <span class="s">"bootmgfw.efi"</span><span class="p">,</span> <span class="s">"desktop.ini"</span><span class="p">,</span> <span class="s">"iconcache.db"</span><span class="p">,</span> <span class="s">"ntldr"</span><span class="p">,</span> <span class="s">"ntuser.dat"</span><span class="p">,</span> <span class="s">"ntuser.dat.log"</span><span class="p">,</span> <span class="s">"ntuser.ini"</span><span class="p">,</span> <span class="s">"thumbs.db"</span><span class="p">,</span> <span class="s">"Program Files"</span><span class="p">,</span> <span class="s">"Program Files (x86)"</span><span class="p">,</span> <span class="s">"AppData"</span><span class="p">,</span> <span class="s">"Boot"</span><span class="p">,</span> <span class="s">"Windows"</span><span class="p">,</span> <span class="s">"Windows.old"</span><span class="p">,</span> <span class="s">"Tor Browser"</span><span class="p">,</span> <span class="s">"Internet Explorer"</span><span class="p">,</span> <span class="s">"Google"</span><span class="p">,</span> <span class="s">"Opera"</span><span class="p">,</span> <span class="s">"Opera Software"</span><span class="p">,</span> <span class="s">"Mozilla"</span><span class="p">,</span> <span class="s">"#recycle"</span><span class="p">,</span> <span class="s">".."</span><span class="p">,</span> <span class="s">"."</span>
</code></pre></div></div>

<p><img src="/uploads/rook30.PNG" alt="alt text"></p>

<p><em>Figure 30: Recursively Traversing All Sub-Directories.</em></p>

<p>If the command-line argument <strong>“-paths”</strong> is not provided, <strong>ROOK</strong> manually mounts all drives that have no volume mounted and traverses through all of them.</p>

<p>First, it builds a list of all drive letters and iterates through it to find drives with type <strong>DRIVE_NO_ROOT_DIR</strong>. Those drives are then added to the end of the list.</p>

<p><img src="/uploads/rook31.PNG" alt="alt text"></p>

<p><em>Figure 31: Finding Drives with an Invalid Root Path.</em></p>

<p>Next, <strong>ROOK</strong> calls <strong>FindFirstVolumeW</strong> and <strong>FindNextVolumeW</strong> to scan for available volumes in the system. For each volume, the malware calls <strong>GetVolumePathNamesForVolumeNameW</strong> to retrieve the volume GUID path and <strong>SetVolumeMountPointW</strong> to set the path as the root path for the next no-root drive in the list.</p>

<p><img src="/uploads/rook32.PNG" alt="alt text"></p>

<p><em>Figure 32: Mounting All Unmounted Drives.</em></p>

<p>Finally, the malware calls <strong>GetLogicalDrives</strong> to iterate through all the drives in the system and traverse them.</p>

<p><img src="/uploads/rook33.PNG" alt="alt text"></p>

<p><em>Figure 33: Traversing All Mounted Drives.</em></p>

<h2 id="shares-traversal">Shares Traversal</h2>

<p>When the command-line argument <strong>“-shares”</strong> is provided, <strong>ROOK</strong> specifically enumerates them and exits upon completion.</p>

<p>The argument can come in the form of a list of network server paths, which each separated by a comma.</p>

<p><img src="/uploads/rook34.PNG" alt="alt text"></p>

<p><em>Figure 34: Parsing “-shares” Command-Line Argument.</em></p>

<p>To traverse each share server, the malware calls <strong>NetShareEnum</strong> to retrieve information about each shared resource on it.</p>

<p>For each shared resource, if its type is not a special share reserved for interprocess communication (IPC$) or remote administration of the server (ADMIN$), the shared resource is skipped.</p>

<p>If the share name is <strong>“ADMIN$”</strong>, the malware builds the path **”\\<server_name>\\ADMIN\$"** and passes it to **recursive_traverse_dir** to be traversed.</server_name></p>

<p><img src="/uploads/rook35.PNG" alt="alt text"></p>

<p><em>Figure 35: Traversing Shared Resources.</em></p>

<h2 id="child-thread">Child Thread</h2>

<p>For the spawn child threads, they have two different modes of execution depending on the flag passed in as parameter.</p>

<p>If the flag is 1, the thread will process a directory from the global directory list.</p>

<p>First, it enters a nested while loop like the one we have seen <a href="#drives-traversal">earlier</a>. The first loop waits until the <strong>BEGIN_ACCESS_DIR_SEMAPHORE</strong> semaphore enters a nonsignaled state, which means no thread is adding to the directory list.</p>

<p>While waiting for that, <strong>ROOK</strong> efficiently waits to retrieve access to the global file list, extract a file, and encrypts it similar to the previous nested while loop.</p>

<p><img src="/uploads/rook36.PNG" alt="alt text"></p>

<p><em>Figure 36: Waiting for Global Directory List Access.</em></p>

<p>After the directory list is full, the malware obtains ownership of the list’s critical section, extracts a directory out, and begins traversing it for sub-files.</p>

<p><img src="/uploads/rook37.PNG" alt="alt text"></p>

<p><em>Figure 37: Extracting Directory &amp; Enumerating for Sub-Files.</em></p>

<p>For the enumeration, <strong>ROOK</strong> first builds a path to a ransom note file in the directory, calls <strong>CreateFileW</strong> to create it and <strong>WriteFile</strong> to write the ransom note content to it.</p>

<p>Below is the raw content of the ransom note.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-----------Welcome</span><span class="o">.</span> <span class="nt">Again</span><span class="o">.</span> <span class="nt">--------------------</span>
<span class="o">[+]</span><span class="nt">Whats</span> <span class="nt">Happen</span><span class="o">?[+]</span>

<span class="nt">Your</span> <span class="nt">files</span> <span class="nt">are</span> <span class="nt">encrypted</span><span class="o">,</span><span class="nt">and</span> <span class="nt">currently</span> <span class="nt">unavailable</span><span class="o">.</span> <span class="nt">You</span> <span class="nt">can</span> <span class="nt">check</span> <span class="nt">it</span><span class="o">:</span> <span class="nt">all</span> <span class="nt">files</span> <span class="nt">on</span> <span class="nt">you</span> <span class="nt">computer</span> <span class="nt">has</span> <span class="nt">expansion</span> <span class="nt">robet</span><span class="o">.</span>

<span class="nt">By</span> <span class="nt">the</span> <span class="nt">way</span><span class="o">,</span><span class="nt">everything</span> <span class="nt">is</span> <span class="nt">possible</span> <span class="nt">to</span> <span class="nt">recover</span> <span class="o">(</span><span class="nt">restore</span><span class="o">),</span> <span class="nt">but</span> <span class="nt">you</span> <span class="nt">need</span> <span class="nt">to</span> <span class="nt">follow</span> <span class="nt">our</span> <span class="nt">instructions</span><span class="o">.</span> <span class="nt">Otherwise</span><span class="o">,</span> <span class="nt">you</span> <span class="nt">cant</span> <span class="nt">return</span> <span class="nt">your</span> <span class="nt">data</span> <span class="o">(</span><span class="nt">NEVER</span><span class="o">).</span>

<span class="o">[+]</span> <span class="nt">What</span> <span class="nt">guarantees</span><span class="o">?[+]</span>

<span class="nt">Its</span> <span class="nt">just</span> <span class="nt">a</span> <span class="nt">business</span><span class="o">.</span> <span class="nt">We</span> <span class="nt">absolutely</span> <span class="nt">do</span> <span class="nt">not</span> <span class="nt">care</span> <span class="nt">about</span> <span class="nt">you</span> <span class="nt">and</span> <span class="nt">your</span> <span class="nt">deals</span><span class="o">,</span> <span class="nt">except</span> <span class="nt">getting</span> <span class="nt">benefits</span><span class="o">.</span> <span class="nt">If</span> <span class="nt">we</span> <span class="nt">do</span> <span class="nt">not</span> <span class="nt">do</span> <span class="nt">our</span> <span class="nt">work</span> <span class="nt">and</span> <span class="nt">liabilities</span> <span class="nt">-</span> <span class="nt">nobody</span> <span class="nt">will</span> <span class="nt">not</span> <span class="nt">cooperate</span> <span class="nt">with</span> <span class="nt">us</span><span class="o">.</span> <span class="nt">Its</span> <span class="nt">not</span> <span class="nt">in</span> <span class="nt">our</span> <span class="nt">interests</span><span class="o">.</span>

<span class="nt">To</span> <span class="nt">check</span> <span class="nt">the</span> <span class="nt">file</span> <span class="nt">capacity</span><span class="o">,</span> <span class="nt">please</span> <span class="nt">send</span> <span class="err">3</span> <span class="nt">files</span> <span class="nt">not</span> <span class="nt">larger</span> <span class="nt">than</span> <span class="err">1</span><span class="nt">M</span> <span class="nt">to</span> <span class="nt">us</span><span class="o">,</span> <span class="nt">and</span> <span class="nt">we</span> <span class="nt">will</span> <span class="nt">prove</span> <span class="nt">that</span> <span class="nt">we</span> <span class="nt">are</span> <span class="nt">capable</span> <span class="nt">of</span> <span class="nt">restoring</span><span class="o">.</span>

<span class="nt">If</span> <span class="nt">you</span> <span class="nt">will</span> <span class="nt">not</span> <span class="nt">cooperate</span> <span class="nt">with</span> <span class="nt">our</span> <span class="nt">service</span> <span class="nt">-</span> <span class="nt">for</span> <span class="nt">us</span><span class="o">,</span> <span class="nt">its</span> <span class="nt">does</span> <span class="nt">not</span> <span class="nt">matter</span><span class="o">.</span> <span class="nt">But</span> <span class="nt">you</span> <span class="nt">will</span> <span class="nt">lose</span> <span class="nt">your</span> <span class="nt">time</span> <span class="nt">and</span> <span class="nt">data</span><span class="o">,</span><span class="nt">cause</span> <span class="nt">just</span> <span class="nt">we</span> <span class="nt">have</span> <span class="nt">the</span> <span class="nt">private</span> <span class="nt">key</span><span class="o">.</span> <span class="nt">In</span> <span class="nt">practise</span> <span class="nt">-</span> <span class="nt">time</span> <span class="nt">is</span> <span class="nt">much</span> <span class="nt">more</span> <span class="nt">valuable</span> <span class="nt">than</span> <span class="nt">money</span><span class="o">.</span>

<span class="nt">If</span> <span class="nt">we</span> <span class="nt">find</span> <span class="nt">that</span> <span class="nt">a</span> <span class="nt">security</span> <span class="nt">vendor</span> <span class="nt">or</span> <span class="nt">law</span> <span class="nt">enforcement</span> <span class="nt">agency</span> <span class="nt">pretends</span> <span class="nt">to</span> <span class="nt">be</span> <span class="nt">you</span> <span class="nt">to</span> <span class="nt">negotiate</span> <span class="nt">with</span> <span class="nt">us</span><span class="o">,</span> <span class="nt">we</span> <span class="nt">will</span> <span class="nt">directly</span> <span class="nt">destroy</span> <span class="nt">the</span> <span class="nt">private</span> <span class="nt">key</span> <span class="nt">and</span> <span class="nt">no</span> <span class="nt">longer</span> <span class="nt">provide</span> <span class="nt">you</span> <span class="nt">with</span> <span class="nt">decryption</span> <span class="nt">services</span><span class="o">.</span>

<span class="nt">You</span> <span class="nt">have</span> <span class="err">3</span> <span class="nt">days</span> <span class="nt">to</span> <span class="nt">contact</span> <span class="nt">us</span> <span class="nt">for</span> <span class="nt">negotiation</span><span class="o">.</span> <span class="nt">Within</span> <span class="err">3</span> <span class="nt">days</span><span class="o">,</span> <span class="nt">we</span> <span class="nt">will</span> <span class="nt">provide</span> <span class="nt">a</span> <span class="err">50</span><span class="o">%</span> <span class="nt">discount</span><span class="o">.</span> <span class="nt">If</span> <span class="nt">the</span> <span class="nt">discount</span> <span class="nt">service</span> <span class="nt">is</span> <span class="nt">not</span> <span class="nt">provided</span> <span class="nt">for</span> <span class="nt">more</span> <span class="nt">than</span> <span class="err">3</span> <span class="nt">days</span><span class="o">,</span> <span class="nt">the</span> <span class="nt">files</span> <span class="nt">will</span> <span class="nt">be</span> <span class="nt">leaked</span> <span class="nt">to</span> <span class="nt">our</span> <span class="nt">onion</span> <span class="nt">network</span><span class="o">.</span> <span class="nt">Every</span> <span class="nt">more</span> <span class="nt">than</span> <span class="err">3</span> <span class="nt">days</span> <span class="nt">will</span> <span class="nt">increase</span> <span class="nt">the</span> <span class="nt">number</span> <span class="nt">of</span> <span class="nt">leaked</span> <span class="nt">files</span><span class="o">.</span>

<span class="nt">Please</span> <span class="nt">use</span> <span class="nt">the</span> <span class="nt">company</span> <span class="nt">email</span> <span class="nt">to</span> <span class="nt">contact</span> <span class="nt">us</span><span class="o">,</span> <span class="nt">otherwise</span> <span class="nt">we</span> <span class="nt">will</span> <span class="nt">not</span> <span class="nt">reply</span><span class="o">.</span>

<span class="o">[+]</span> <span class="nt">How</span> <span class="nt">to</span> <span class="nt">get</span> <span class="nt">access</span> <span class="nt">on</span> <span class="nt">website</span><span class="o">?[+]</span> 

<span class="nt">You</span> <span class="nt">have</span> <span class="nt">two</span> <span class="nt">ways</span><span class="o">:</span>

<span class="err">1</span><span class="o">)</span> <span class="o">[</span><span class="nt">Recommended</span><span class="o">]</span> <span class="nt">Using</span> <span class="nt">a</span> <span class="nt">TOR</span> <span class="nt">browser</span><span class="o">!</span>
	<span class="nt">a</span><span class="o">)</span> <span class="nt">Download</span> <span class="nt">and</span> <span class="nt">install</span> <span class="nt">TOR</span> <span class="nt">browser</span> <span class="nt">from</span> <span class="nt">this</span> <span class="nt">site</span><span class="nd">:hxxps</span><span class="o">://</span><span class="nt">torproject</span><span class="o">[.]</span><span class="nt">org</span><span class="o">/</span>
	<span class="nt">b</span><span class="o">)</span> <span class="nt">Open</span> <span class="nt">our</span> <span class="nt">website</span><span class="o">:&lt;</span><span class="nt">redacted</span><span class="o">&gt;[.]</span><span class="nt">onion</span>

<span class="err">2</span><span class="o">)</span> <span class="nt">Our</span> <span class="nt">mail</span> <span class="nt">box</span><span class="o">:</span>
	<span class="nt">a</span><span class="o">)&lt;</span><span class="nt">redacted</span><span class="o">&gt;</span><span class="k">@onionmail</span><span class="p">[.]</span><span class="n">org</span>
	<span class="n">b</span><span class="p">)</span><span class="err">&lt;</span><span class="n">redacted</span><span class="err">&gt;@</span><span class="n">onionmail</span><span class="p">[.]</span><span class="n">org</span>
	<span class="n">c</span><span class="p">)</span><span class="n">If</span> <span class="n">the</span> <span class="n">mailbox</span> <span class="n">fails</span> <span class="n">or</span> <span class="n">is</span> <span class="n">taken</span> <span class="n">over</span><span class="p">,</span> <span class="n">please</span> <span class="n">open</span> <span class="n">Onion</span> <span class="n">Network</span> <span class="n">to</span> <span class="n">check</span> <span class="n">the</span> <span class="n">new</span> <span class="n">mailbox</span>
<span class="n">------------------------------------------------------------------------------------------------</span>
<span class="err">!!!</span><span class="n">DANGER</span><span class="err">!!!</span>
<span class="n">DONT</span> <span class="n">try</span> <span class="n">to</span> <span class="n">change</span> <span class="n">files</span> <span class="n">by</span> <span class="n">yourself</span><span class="p">,</span> <span class="n">DONT</span> <span class="n">use</span> <span class="n">any</span> <span class="n">third</span> <span class="n">party</span> <span class="n">software</span> <span class="n">for</span> <span class="n">restoring</span> <span class="n">your</span> <span class="n">data</span> <span class="n">or</span> <span class="n">antivirus</span> <span class="n">solutions</span> <span class="n">-</span> <span class="n">its</span> <span class="n">may</span> <span class="n">entail</span> <span class="n">damge</span> <span class="n">of</span> <span class="n">the</span> <span class="n">private</span> <span class="n">key</span> <span class="n">and</span><span class="p">,</span> <span class="n">as</span> <span class="n">result</span><span class="p">,</span> <span class="n">The</span> <span class="n">Loss</span> <span class="n">all</span> <span class="n">data</span><span class="p">.</span>
<span class="err">!!!!!!!</span>

<span class="n">AGAIN</span><span class="p">:</span> <span class="n">Its</span> <span class="n">in</span> <span class="n">your</span> <span class="n">interests</span> <span class="n">to</span> <span class="n">get</span> <span class="n">your</span> <span class="n">files</span> <span class="n">back</span><span class="p">.</span> <span class="n">From</span> <span class="n">our</span> <span class="n">side</span><span class="p">,</span> <span class="n">we</span> <span class="p">(</span><span class="n">the</span> <span class="n">best</span> <span class="n">specialists</span><span class="p">)</span> <span class="n">make</span> <span class="n">everything</span> <span class="n">for</span> <span class="n">restoring</span><span class="p">,</span> <span class="n">please</span> <span class="n">should</span> <span class="n">not</span> <span class="n">interfere</span><span class="p">.</span>
<span class="err">!!!!!!!</span>

<span class="n">ONE</span> <span class="n">MORE</span> <span class="n">TIME</span><span class="p">:</span> <span class="n">Security</span> <span class="n">vendors</span> <span class="n">and</span> <span class="n">law</span> <span class="n">enforcement</span> <span class="n">agencies</span><span class="p">,</span> <span class="n">please</span> <span class="n">be</span> <span class="n">aware</span> <span class="n">that</span> <span class="n">attacks</span> <span class="n">on</span> <span class="n">us</span> <span class="n">will</span> <span class="n">make</span> <span class="n">us</span> <span class="n">even</span> <span class="n">stronger</span><span class="p">.</span>

<span class="err">!!!!!!!</span>

</code></pre></div></div>

<p><img src="/uploads/rook38.PNG" alt="alt text"></p>

<p><em>Figure 38: Dropping Ransom Note.</em></p>

<p>Next, it builds the path **“<dir_path>\\*"** and passes it to **FindFirstFileW** to begin enumerating through files in the directory.</dir_path></p>

<p><img src="/uploads/rook39.PNG" alt="alt text"></p>

<p><em>Figure 39: Enumerating Files in Directory.</em></p>

<p>For each found file, <strong>ROOK</strong> checks to make sure its name is not in the files and directories to avoid list and is not <strong>HowToRestoreYourFiles.txt</strong>.</p>

<p><img src="/uploads/rook40.PNG" alt="alt text"></p>

<p><em>Figure 40: Checking for Invalid Filenames.</em></p>

<p><strong>ROOK</strong> also skips the file if its extension is <strong>“.exe”</strong>, <strong>“.dll”</strong>, or <strong>“.Rook”</strong>. After checking, the malware enters a nested while loop to wait until no thread can add to the global file list and extracts files to encrypt during the wait time.</p>

<p>After getting access to the file list, <strong>ROOK</strong> calls <strong>EnterCriticalSection</strong> to obtain the ownership of the file list’s critical section and 
adds the subfile to the list.</p>

<p><img src="/uploads/rook41.PNG" alt="alt text"></p>

<p><em>Figure 41: Adding Subfile to Global File List.</em></p>

<p>If the flag from parameter is 1, the child thread will continuously encrypt files from the global directory list until the list is completely empty.</p>

<p><img src="/uploads/rook42.PNG" alt="alt text"></p>

<p><em>Figure 42: Iterating &amp; Encrypting Files in Global List.</em></p>

<h2 id="file-encryption">File Encryption</h2>

<p>Prior to file encryption, <strong>ROOK</strong> calls <strong>SetFileAttributesW</strong> to set the file attribute to normal.</p>

<p>It builds the following path **“<file_path>.Rook"** and calls **MoveFileExW** to change the file name to have the encrypted extension **.Rook**.</file_path></p>

<p><img src="/uploads/rook43.PNG" alt="alt text"></p>

<p><em>Figure 43: Adding Encrypted Extension.</em></p>

<p>Next, the malware calls <strong>CreateFileW</strong> to retrieve the file handle for the target and begins the encryption.</p>

<p>First, it uses the Mbed TLS <strong>CTR_DRBG</strong> context to generates a random 16-byte AES key.</p>

<p><img src="/uploads/rook44.PNG" alt="alt text"></p>

<p><em>Figure 44: Randomly Generating AES Key for File.</em></p>

<p>Next, <strong>ROOK</strong> populates the following structures for the file footer.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">ROOK_FILE_FOOTER</span>
<span class="p">{</span>
  <span class="n">LARGE_INTEGER</span> <span class="n">file_size</span><span class="p">;</span>
  <span class="n">ROOK_CRYPT_METADATA</span> <span class="n">metadata</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">ROOK_CRYPT_METADATA</span>
<span class="p">{</span>
  <span class="n">_QWORD</span> <span class="n">encrypted_chunk_count</span><span class="p">;</span>
  <span class="n">_QWORD</span> <span class="n">unk</span><span class="p">;</span>
  <span class="n">BYTE</span> <span class="n">AES_key_encrypted_by_my_public</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
  <span class="n">BYTE</span> <span class="n">my_private_key_encrypted_by_Rook_public</span><span class="p">[</span><span class="mi">2304</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div></div>

<p>The malware begins by calling <strong>GetFileSizeEx</strong> to retrieve the size of the file and store it in the file footer. It then uses the victim’s RSA public key to encrypt the AES key and store it in the metadata’s <strong>AES_key_encrypted_by_my_public</strong> field.</p>

<p><img src="/uploads/rook45.PNG" alt="alt text"></p>

<p><em>Figure 45: Encrypting AES Key Using Victim’s Public Key.</em></p>

<p>Next, it copies the victim’s private key that is encrypted using <strong>ROOK’s</strong> public key during <a href="#rsa-key-generation">RSA Key Generation</a> into the metadata’s <strong>my_private_key_encrypted_by_Rook_public</strong> field.</p>

<p><img src="/uploads/rook46.PNG" alt="alt text"></p>

<p><em>Figure 46: Writing Victim’s Encrypted Private Key into File Footer.</em></p>

<p>If the file size is greater than 0x80000 bytes, the malware reads and encrypts at most three 0x80000-byte chunks at the beginning of the file using AES-128 ECB.</p>

<p><img src="/uploads/rook47.PNG" alt="alt text"></p>

<p><em>Figure 47: Encrypting Files Larger Than 0x80000 Bytes.</em></p>

<p>If the file size is less than 0x80000 bytes or is between 0x80000 and 0x180000 bytes, the entire file will be encrypted.</p>

<p><img src="/uploads/rook48.PNG" alt="alt text"></p>

<p><em>Figure 48: Calculating &amp; Encrypting the Last Chunk That Is Less Than 0x80000 Bytes.</em></p>

<p>Finally, the file footer is written to the end of the file, which ends the encryption routine.</p>

<p><img src="/uploads/rook49.PNG" alt="alt text"></p>

<p><em>Figure 49: Writing File Footer.</em></p>

<p>If <strong>ROOK</strong> is unable to open the file prior to encryption, the malware attempts to terminate the file owner’s process.</p>

<p>It first calls <strong>RmStartSession</strong> to starts a new Restart Manager session and <strong>WideCharToMultiByte</strong> to convert the file path to a multibyte buffer.</p>

<p><img src="/uploads/rook50.PNG" alt="alt text"></p>

<p><em>Figure 50: Starting A Restart Manager Session.</em></p>

<p>Using that session handle, the malware calls <strong>RmRegisterResources</strong> to register the target file as a resource to the RM.</p>

<p><img src="/uploads/rook51.PNG" alt="alt text"></p>

<p><em>Figure 51: Registering Target File as a Resource.</em></p>

<p>Next, it calls <strong>RmGetList</strong> to get a list of all applications that are using the file. For each of these applications, if the application’s type is Windows Explorer or a critical process, it is skipped.</p>

<p>Then, <strong>ROOK</strong> checks to make sure the application is not its own ransomware process through the process IDs. Finally, it calls <strong>OpenProcess</strong> to retrieve the process’s handle and terminate it using <strong>TerminateProcess</strong>.</p>

<p><img src="/uploads/rook52.PNG" alt="alt text"></p>

<p><em>Figure 52: Terminating File Owners.</em></p>

<p>After terminating all processes that are using the file, <strong>ROOK</strong> passes it back in to be encrypted.</p>

<p><img src="/uploads/rook53.PNG" alt="alt text"></p>

<p><em>Figure 53: Setting Up File to Be Encrypted Again.</em></p>

<h2 id="references">References</h2>

<p>https://infosecwriteups.com/alternate-data-streams-ads-54b144a831f1</p>

<p>https://www.sentinelone.com/labs/new-rook-ransomware-feeds-off-the-code-of-babuk/</p>

<p>https://chuongdong.com/reverse%20engineering/2021/01/03/BabukRansomware/</p>

<p>https://chuongdong.com/reverse%20engineering/2021/01/16/BabukRansomware-v3/</p>



    <div class="share">
  
    
      
      
      
      

      

      <a class="button" href="https://twitter.com/intent/tweet/?url=https://cdong1012.github.io//reverse%20engineering/2022/01/06/RookRansomware/&amp;text=Rook%20Ransomware&amp;via=cPeterr" style="background: #0d94e7">Twitter&nbsp; <svg width="16" height="16" class="icon  icon--twitter" role="img" alt="twitter"><title>twitter</title>
<use xlink:href="#twitter" fill="CurrentColor"></use></svg>
</a>

    
  
    
      
      
      
      

      

      <a class="button" href="https://facebook.com/sharer/sharer.php?u=https://cdong1012.github.io//reverse%20engineering/2022/01/06/RookRansomware/" style="background: #3B5998">Facebook&nbsp; <svg width="16" height="16" class="icon  icon--facebook" role="img" alt="facebook"><title>facebook</title>
<use xlink:href="#facebook" fill="CurrentColor"></use></svg>
</a>

    
  
    
      
      
      
      

      

      <a class="button" href="mailto:?subject=Rook%20Ransomware&amp;body=Hey,%20check%20out%20this:%20https://cdong1012.github.io//reverse%20engineering/2022/01/06/RookRansomware/" style="background: true">Email&nbsp; <svg width="16" height="16" class="icon  icon--email" role="img" alt="email"><title>email</title>
<use xlink:href="#email" fill="CurrentColor"></use></svg>
</a>

    
  
</div>


    


  </article>

  

</main>

<footer class="footer">
  <div class="container">
    <div class="copyright  typeset">
      <small class="small">© Chuong Dong 2022</small>
    </div>

    
<nav class="nav  nav--footer">
  <ul class="list list--nav">
    

      

      <li class="item  item--nav">
        <a href="https://cdong1012.github.io">Chuong's Security Blog</a>
      </li>
    
  </ul>
</nav>


  </div>
</footer>


    <script type="text/javascript">
(() => {
  const registerServiceWorker = () => {
    if (!navigator.serviceWorker) {
      return;
    }

    navigator.serviceWorker
      .register("/sw.js")
      .then(registration => {
        console.log("Service Worker: registered");
      })
      .catch(err => {
        console.log("Service Worker: registration failed ", err);
      });
  };

  registerServiceWorker();
})();
</script>


    <!-- Overwrite this file with code you want before the closing body tag -->

  


</body></html>