{"id": "sentence_0x9f022f5a", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xf44f28fa", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "About Cado Security"}
{"id": "sentence_0x1d4a23c6", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xf44f28fa", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Cado Security provides the cloud investigation platform that empowers security teams to respond to threats at cloud speed. By automating data capture and processing across cloud and container environments, Cado Response effortlessly delivers forensic-level detail and unprecedented context to simplify cloud investigation and response."}
{"id": "sentence_0xa2159ec9", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xf44f28fa", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Free Trial"}
{"id": "sentence_0x8c5dce3d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xf44f28fa", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Demo"}
{"id": "sentence_0x7894e1c9", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xf44f28fa", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Twitter Linkedin Amazon"}
{"id": "sentence_0x7c76f2ef", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xf44f28fa", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Copyright 2022 Cado Security"}
{"id": "sentence_0xaedbf64d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xf44f28fa", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Sitemap | Privacy Policy"}
{"id": "sentence_0x6b72df6e", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Summary"}
{"id": "sentence_0xd4d4d5d2", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Cado Labs honeypot infrastructure was recently compromised by a complex and multi-stage cryptojacking attack Although the attack utilised many TeamTNT TTPs, we assess with high confidence that the group WatchDog is continuing to repurpose TeamTNT payloads as theyve done in the past The attack targets exposed Docker Engine API endpoints and Redis servers, and can propagate in a worm-like fashion Several sophisticated techniques were employed, including timestomping, process hiding and exploitation of a misconfigured Redis database that leaves it vulnerable to remote code execution"}
{"id": "sentence_0x66fd1a11", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Introduction"}
{"id": "sentence_0x3e7164ba", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Cado Labs regularly analyses attacks targeting services running within our honeypot infrastructure. One recent attack caught our eye as it involved a complex, multi-stage lifecycle, with several payloads leveraged at our honeypot machine. As well discuss, this new attack involved some familiar and distinctive TTPs, but attempts by the attacker to foil attribution were obvious."}
{"id": "sentence_0xf271f250", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "A Note on Attribution"}
{"id": "sentence_0x2ca0828d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Back in October 2021, Palo Altos Unit42 security research team documented a cryptojacking malware campaign that they originally attributed to TeamTNT. Upon further research, they discovered that the attack was not actually carried out by TeamTNT, but instead by a rival cryptojacking group named WatchDog."}
{"id": "sentence_0xf1072e1e", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The Unit42 article goes into further detail about their reasoning in regards to why they believe WatchDog, and not TeamTNT, were behind that particular campaign. Weve included a table below summarising their points and whether or not they appear in this campaign, which we believe is an evolution of the one Unit42 discovered in 2021."}
{"id": "sentence_0x233c97ff", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "As can be seen from the above, several characteristics from the October 2021 campaign also appear in this most recent campaign, with some key differences."}
{"id": "sentence_0x63063e94", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Throughout the attack lifecycle, the oracle.zzhreceive[.]top is utilised heavily for delivery of additional payloads. This domain was previously attributed to TeamTNT due to the presence of the zzhreceive string. This domain is now associated with WatchDog, based on Unit42s research. We also observed the b2f628 directory being used in payload URLs throughout the attack. However, we also noticed an additional URL path, with s3f815 being used in place of b2f628."}
{"id": "sentence_0xff6c32aa", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Example of s3f815 appearing in payload URL"}
{"id": "sentence_0xaa601a3d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This suggests that WatchDog have updated their C2 infrastructure since 2021, which is plausible given this is likely a new campaign."}
{"id": "sentence_0xe37cc1f", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Our analysis also observed the 43Xbg mining address embedded in the payloads leveraged at our honeypot infrastructure. This address was attributed to WatchDog back in 2021 and is a clear indicator that theyre behind this campaign despite heavy use of TeamTNT ASCII art throughout."}
{"id": "sentence_0xd56e17af", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "We also observed the 1.0.4.tar.gz payload (C code for the scanning utility masscan) being downloaded and compiled on the machine. Although Unit42 mentioned that Zgrab hadnt been used in the campaign they analysed, we did observe it in use in this campaign. We suspect that WatchDog have decided to utilise it as part of their toolkit for propagation, due to its performant and open source nature."}
{"id": "sentence_0x6cb93c66", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Overview of Attack Lifecycle"}
{"id": "sentence_0xeffcb5ee", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Since this particular attack involved several payloads, some executed depending on whether certain conditions were met, a brief overview of the execution flow is included in the following diagram:"}
{"id": "sentence_0x4b2919cf", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Initial Access"}
{"id": "sentence_0xc123478c", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Initial access for this campaign was via misconfigured Docker Engine API endpoints, a common method of initial access for cryptojacking malware. The attackers used a scanning tool to enumerate large portions of the internet, looking for servers with port 2375 open. In the Docker Engines default state, this port provides unauthenticated access to the Docker daemon, allowing an attacker to list, create and delete running containers, while also allowing arbitrary shell commands to be run on the containers themselves."}
{"id": "sentence_0x6942afc7", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "After receiving notification that the honeypot machine had been compromised, we retrieved the relevant logs and noticed some unusual activity from the IP 218.76.246[.]69."}
{"id": "sentence_0x1e62055f", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Snippet of honeypot log showing suspicious traffic from 218.76.246[.]69"}
{"id": "sentence_0x3c95906a", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "As we can see from the first line of the snippet above, the attacker likely encountered our honeypot via an internet scan using the scanner Zgrab. A subsequent Docker ping command was issued to check if the API endpoint was responsive, after which the attackers created a new container based on the Alpine Linux image and ran a malicious command on it to kickstart the infection chain."}
{"id": "sentence_0x8fc2aa72", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "JSON request body showing malicious initial access command"}
{"id": "sentence_0xb90a1bfe", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "As the above demonstrates, this malicious command first ensures cURL is installed on the Alpine container. It then goes on to register a cron job under root, which will ensure that the first payload is kept running, by executing a command that retrieves it from a remote server and pipes it through bash."}
{"id": "sentence_0x39c318cf", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Stage 1 cronb.sh"}
{"id": "sentence_0xdf65424b", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This shell script was the first payload implanted by the attacker. The script is fairly straightforward, it runs a check to see if an executable file exists at the path /bin/ps.lanigiro or /usr/bin/ps.lanigiro. If this file exists, an environment variable (envar) $PS_CMD is set to the path of the file. If it doesnt, the envar is set to /bin/ps. Incidentally, the ps.lanigiro file turned out to be a modified version of the UNIX ps utility more on this later."}
{"id": "sentence_0xec628f5b", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The script then goes on to enumerate running processes, searching for a process named ddns. If this process is running, a log statement is echoed and the script exits. This appears to be a check to see whether the machine has been previously compromised."}
{"id": "sentence_0x6596d031", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "In a similar vein, the latter half of the script checks for the existence of renamed versions of the cURL data transfer utility. Cloud-focused malware groups, such as TeamTNT, often rename the cURL binary to obfuscate its usage. If a renamed version of cURL is found, its a fairly reliable indicator that the machine (or container) has already been compromised in a similar campaign."}
{"id": "sentence_0x4d5bee98", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Existence checks for renamed versions of the cURL data transfer utility"}
{"id": "sentence_0x62ff7844", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "A function named clmo(), which is dedicated to removing files and killing processes associated with Alibaba Cloud Security agents, is defined and invoked. The function also logs whether the machine is running under Alibaba Cloud, if these agents are found."}
{"id": "sentence_0xc0287090", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The clmo() function is interesting as it seems unlikely that the Alibaba Security agents would be running within a newly-created container built from the Alpine Linux image. This suggests that the code has been repurposed from another, potentially more generic, campaign one that targets Linux servers rather than containers specifically. The checks for whether the machine has been previously compromised are also indicative of code reuse, and make little sense given the method of initial access."}
{"id": "sentence_0x20fde769", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Finally, the script creates a directory at the path /var/tmp/ and retrieves a second stage payload using a renamed version of cURL (if it exists). The payload differs depending on whether the current user is root."}
{"id": "sentence_0x1759ecb3", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Stage 2 ar.sh (retrieved if current user is root)"}
{"id": "sentence_0x7066225e", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Since the attack covered by this blog relies on compromised Docker containers, well focus on the stage 2 payload thats retrieved if the current user is root. Both of the potential Stage 2 payloads are similar, with some differences in persistence mechanisms for the payload run as root. The ar.sh script is particularly long, so weve summarised notable techniques from our analysis of it in this section."}
{"id": "sentence_0x66adeb2e", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Timestomping and Process Hiding"}
{"id": "sentence_0x1427bee7", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "In the previous section, we mentioned that the cronb.sh script began by checking for the existence of a modified version of the ps utility. Analysis of this second stage payload revealed how this modified version was implanted and gave us some insight into how it works."}
{"id": "sentence_0xedfe328a", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Shortly after the script begins, a check to determine the size of the ps binary is performed and the output is saved to the variable pssize. If the value of pssize is less than or equal to 8000 bytes, another check is performed to determine the name of the ps binary. If its not named ps.lanigiro then whatever is located at /bin/ps is renamed ps.lanigiro."}
{"id": "sentence_0xb75f25a8", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Renaming of ps utility"}
{"id": "sentence_0xdb3c00c", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The script then goes on to create a simple shell script and saves it as /bin/ps. This script is actually a very rudimentary (albeit effective) process hider. When a user issues the ps command, instead of the ps binary being executed, the process hiding shell script is instead executed. This shell script calls the actual ps binary (now named ps.lanigiro) and pipes the output through grep, which is then used to filter out lines containing the words ddns or scan. These are both associated with malicious processes run by the attacker at a later stage."}
{"id": "sentence_0xa8f00b1b", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The script also uses the touch command to modify the file access and modification times of the shell script at /bin/ps, setting them to 25-08-2016. This method of timestamp manipulation is known as timestomping and is typically used as an anti-forensics measure. Weve observed timestomping in use by other cloud-focused malware campaigns."}
{"id": "sentence_0x1ae57547", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Creation of process hiding script and subsequent timestomping"}
{"id": "sentence_0x4e76d117", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The attacker uses the same procedure to modify the top and pstree utilities, hiding malicious processes from their outputs."}
{"id": "sentence_0xe1d0322c", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Alibaba Cloud Agent Removal"}
{"id": "sentence_0x152abce", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Continuing from the process hiding procedure described above, the script goes on to determine whether its running on Gentoo or CoreOS. After the Linux distribution is identified, subsequent functions are dedicated to removing monitoring tools typically found in Alibaba Cloud."}
{"id": "sentence_0x35ba91c2", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This is interesting as it suggests targeting of Alibaba Cloud Linux servers rather than Docker containers, something which doesnt add up given the method of initial access discussed previously. This was another indicator that the payload in question wasnt developed with this particular campaign in mind."}
{"id": "sentence_0xd5575787", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Code snippet for removal of Alibaba monitoring software"}
{"id": "sentence_0xc86d6a40", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Remainder of script"}
{"id": "sentence_0x8d7d5747", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The rest of the script focuses on removing processes from competing miners and downloading then persisting the XMRig payload. Persistence is achieved via a systemd service unit, requiring the user to be root in order to register it."}
{"id": "sentence_0xf79ef2a2", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Persistence via a systemd service unit"}
{"id": "sentence_0xada2e5f1", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Finally, the script ends by printing out some TeamTNT ASCII art before proceeding to propagate a copy of itself by enumerating known_hosts and connecting to each host in turn. This is a technique that weve seen in prior cryptojacking campaigns, including from TeamTNT."}
{"id": "sentence_0x53395ee8", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "TeamTNT ASCII art"}
{"id": "sentence_0x6d134565", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Before finishing, the script performs a check to see whether the machine has been previously targeted by this malware campaign and outputs a log statement if it has. The third stage payload is then retrieved via cURL before the terminal output is cleared."}
{"id": "sentence_0x8f5a0787", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Stage 3 b.sh"}
{"id": "sentence_0x7a669b01", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "With the main objectives of implanting XMRig and establishing persistence complete, the attackers proceed to download and install the internet scanning utilities: zgrab, masscan and pnscan. Since these utilities are being compiled on the target machine, the script begins by ensuring that various compilation tools and dependencies are installed. The most interesting of which is Redis. It seems unlikely that Redis is a dependency of any of the scanning tools so we assumed that it must be used at a later stage."}
{"id": "sentence_0x4e9f5448", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Non-interactive install of various compilation tools and dependencies"}
{"id": "sentence_0x4fae8af8", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Compilation of masscan and pnscan"}
{"id": "sentence_0x762d63a5", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The script then finishes by downloading two additional payloads and persisting them as service units."}
{"id": "sentence_0x478fa698", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Installation and persistence of additional payloads"}
{"id": "sentence_0xbe687d80", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "One interesting technique seen throughout this attack chain is the creation of directories with as their name. For example, in the screenshot above we see the path /etc/.httpd//httpd referenced. We suspect that this is an attempt to disguise the directory, as any files or directories starting with a full stop are hidden from directory listings."}
{"id": "sentence_0x45aa4500", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Not only that, but when you do a directory listing with a command such as ls -la, a file or directory with an ellipsis as its name looks very similar to the alias for the parent directory, which is represented by ... This makes it more likely to be overlooked by a user and demonstrates the attackers knowledge of the Linux command line."}
{"id": "sentence_0x6c069669", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Appearance of ellipsis directory in long listing"}
{"id": "sentence_0xafe1902e", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Stage 4 c.sh & d.sh"}
{"id": "sentence_0x83f2f1f7", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "c.sh"}
{"id": "sentence_0x40a7224d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This payload begins to answer some of the questions raised from analysis of the earlier stages. Bearing in mind that the script is persisted by systemd and is configured to automatically restart if its killed, it first begins by disabling SELinux before going on to configure ulimit and iptables. For the latter, a rule is added to drop external ingress traffic to port 6379 the default port used by Redis. Another rule is added to accept traffic to this same port, if the source address is 127.0.0.1."}
{"id": "sentence_0x1baa169d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This suggests that the attacker intends to interact with the Redis server locally (presumably via redis-cli), but wishes to prevent external access i.e. from a panicked admin attempting to kill the service after discovering whats going on."}
{"id": "sentence_0x291ad652", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "SELinux, ulimit and iptables configuration"}
{"id": "sentence_0xffe163a5", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Our suspicions about Redis are confirmed in the subsequent lines, where the attacker writes various Redis and cron commands to a file named .dat."}
{"id": "sentence_0xf9a94d4d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Writing Redis commands and cron jobs to .dat file"}
{"id": "sentence_0x661a94b9", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "As can be seen from the above, these commands are used to register persistence via cron. The base64 encoded data includes a payload URL for the shell script used in the first stage of the campaign and each line attempts to use a different data transfer utility to retrieve it. These findings are consistent with those of Intezer, who covered a similar campaign."}
{"id": "sentence_0x66b12548", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "You might be wondering how the shell commands within the .dat file are actually executed. For quite some time misconfigured deployments of Redis have been vulnerable to remote command execution. Redis themselves are quite open about the risks of exposing the data store to an untrusted network, yet it seems to be an effective method of achieving initial access and persistence for this campaign."}
{"id": "sentence_0x73f8ace5", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Scanning and Propagation"}
{"id": "sentence_0xc41551c3", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The c.sh payload next performs an existence check for the pnscan binary and proceeds to use the seq and sort utilities to build a random list of IP subnets to scan. The scanning is then conducted in a loop and a hex-encoded response string of os:Linux is searched for. The attacker also uses the -W flag of pnscan to send a hex-encoded request string of:"}
{"id": "sentence_0x1390c3a2", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "*1"}
{"id": "sentence_0x69d5320c", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "$4"}
{"id": "sentence_0x8eb9b842", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "info"}
{"id": "sentence_0xf5843ba1", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This effectively runs the info CLI command against the Redis server, probing it to determine if its accepting commands from remote clients. IP and port information for machines running Linux and responding to the Redis probing are then extracted and the commands saved in the .dat file mentioned previously are remotely run on them via redis-cli."}
{"id": "sentence_0x95eca93f", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Scanning random IP address spaces for Redis servers"}
{"id": "sentence_0xf63ade69", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The script concludes by using a similar scanning process with the masscan utility before removing the files created at this stage."}
{"id": "sentence_0x9317a1ae", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "d.sh"}
{"id": "sentence_0x63a60015", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This payload performs a similar function to the previous in that its responsible for propagating the malware this time via exposed Docker Engine API endpoints. The script begins by printing out some base64-encoded ASCII art which says TeamTNT likes the Borg. This is not the first time weve seen Borg mentioned in TeamTNT scripts."}
{"id": "sentence_0xc947b5b", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "ASCII art printed by d.sh"}
{"id": "sentence_0x34c6e2fd", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "In a function named dAPIpwn(), the masscan utility is used to build up an IP address range and save it as a file named .bat. Zgrab is then used to determine if any of these IPs are hosting an instance of Docker Engine. The list of hosts that are is then saved to a variable aabbcc and each host is used by the docker run command to spin up an Alpine Linux container and run the initial access script we mentioned at the beginning."}
{"id": "sentence_0xb4d7e0b1", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "dAPIpwn function (truncated)"}
{"id": "sentence_0xb67cbb19", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "The script ends by building up a list of random subnets and calling dAPIpwn() in a loop so that the docker run command is attempted on each Docker Engine API endpoint in those subnets."}
{"id": "sentence_0x2de39a54", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Calling dAPIpwn over random IP address ranges"}
{"id": "sentence_0x6278db7b", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This is likely the method used to compromise our honeypot and it ensures that the malware is propagated in a worm-like fashion."}
{"id": "sentence_0x2b2cea81", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Conclusion"}
{"id": "sentence_0x982b6138", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "This is a sophisticated and extensive cloud-focused cryptojacking attack from a group that is well-established in this area. The profitability and ease of conducting cryptojacking at scale makes this type of attack low-hanging fruit for groups such as WatchDog, and this will likely continue for as long as users continue to expose services such as Docker and Redis to untrusted networks."}
{"id": "sentence_0x875c266f", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Despite many attempts to foil attribution, its clear that this attack was conducted by the WatchDog group and not TeamTNT since their infrastructure and Monero wallets were used. TeamTNT have publicly declared their retirement for some time now, so perhaps theres some truth in that. Well continue to be sceptical about any future campaigns we analyse which make use of TeamTNT TTPs."}
{"id": "sentence_0x68465afc", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Cado Response Analysis"}
{"id": "sentence_0x1a15e9a0", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Indicators of Compromise (IoCs)"}
{"id": "sentence_0x5a37dd4d", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "About The Author"}
{"id": "sentence_0x3b871cb7", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xb5bf8f18", "chapter_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "text": "Matt Muir Matt is a security researcher with a passion for UNIX and UNIX-like operating systems. He previously worked as a macOS malware analyst and his background includes experience in the areas of digital forensics, DevOps, and operational cyber security. Matt enjoys technical writing and has published research including pieces on TOR browser forensics, an emerging cloud-focused botnet, and the exploitation of the Log4Shell vulnerability."}
{"id": "sentence_0x79df876a", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xa67f2335", "chapter_title": "About Cado Security", "text": "Cado Security provides the cloud investigation platform that empowers security teams to respond to threats at cloud speed. By automating data capture and processing across cloud and container environments, Cado Response effortlessly delivers forensic-level detail and unprecedented context to simplify cloud investigation and response. Backed by Blossom Capital and Ten Eleven Ventures, Cado Security has offices in the United States and United Kingdom. For more information, please visit or follow us on Twitter @cadosecurity."}
{"id": "sentence_0x25d206e1", "report_id": "report_0x20ea61f6", "report_date": "2022-06-02T00:00:00Z", "report_title": "Tales From the Honeypot: WatchDog Evolves With a New Multi-Stage Cryptojacking Attack", "report_url": "https://www.cadosecurity.com/tales-from-the-honeypot-watchdog-evolves-with-a-new-multi-stage-cryptojacking-attack", "chapter_id": "chapter_0xa67f2335", "chapter_title": "About Cado Security", "text": "Prev Post"}
