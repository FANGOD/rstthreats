{"id": "sentence_0xc57a6aec", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xdd25712f", "chapter_title": "Metastealer filling the Racoon void", "text": "RIFT: Research and Intelligence Fusion Team"}
{"id": "sentence_0xbbd7d6a6", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xdd25712f", "chapter_title": "Metastealer filling the Racoon void", "text": "Threat Intelligence"}
{"id": "sentence_0x9a2a9919", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xdd25712f", "chapter_title": "Metastealer filling the Racoon void", "text": "May 20, 2022 5 Minutes"}
{"id": "sentence_0x96d17222", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xdd25712f", "chapter_title": "Metastealer filling the Racoon void", "text": "Author: Peter Gurney"}
{"id": "sentence_0x6e739421", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xa95eeaaf", "chapter_title": "tl;dr", "text": "MetaStealer is a new information stealer variant designed to fill the void following Racoon stealer suspending operations in March of this year. Analysts at Israeli dark web intelligence firm Kela first identified its emergence on underground marketplaces [1] and later as being used in a spam campaign by SANS Internet Storm Centre Handler Brad Duncan [2], where the initial stages and traffic were detailed. This analysis further describes the final MetaStealer payload detailing its functionality."}
{"id": "sentence_0x93ffdced", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xa95eeaaf", "chapter_title": "tl;dr", "text": "Significant findings include:"}
{"id": "sentence_0xf4f9f635", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xa95eeaaf", "chapter_title": "tl;dr", "text": "Heavy reliance on open-source libraries Microsoft Defender Bypass Scheduled Task Persistence Password Stealer Keylogger Hidden VNC server"}
{"id": "sentence_0x838d215c", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xa95eeaaf", "chapter_title": "tl;dr", "text": "Figure 1 MetaStealer Loader Execution"}
{"id": "sentence_0x790f1fd9", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xe04f9aaa", "chapter_title": "Defender Bypass", "text": "Early on in execution, the below command is executed using PowerShell:"}
{"id": "sentence_0x205bf66f", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xe04f9aaa", "chapter_title": "Defender Bypass", "text": "As can be seen below in Figure 2 the command adds an exclusion rule to Microsoft Defender, effectively turning off scanning of files with .exe extension. This decreases the chances of the main payload being detected as well as any subsequent payloads that may be delivered to the target host post infection."}
{"id": "sentence_0xb9c96a9d", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xe04f9aaa", "chapter_title": "Defender Bypass", "text": "Figure 2 Defender Exclusion"}
{"id": "sentence_0x8c40b7f9", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xe04f9aaa", "chapter_title": "Defender Bypass", "text": "With the Microsoft Defender exclusion in place another PowerShell command is issued that proceeds to rename the original file to a hardcoded value with an .exe extension. In this case {Original filename}.xyz to"}
{"id": "sentence_0x5e1ad10", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x3428e137", "chapter_title": "Persistence", "text": "To maintain persistence, a scheduled task is created using The Component Object Model (COM), a task named sys is created in the folder \\Microsoft\\Windows The task is set to trigger at user login, ensuring the malware remains persistent across reboots."}
{"id": "sentence_0x2217f59", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x3428e137", "chapter_title": "Persistence", "text": "Figure 3 String de-obfuscation example"}
{"id": "sentence_0xfa793245", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x3f2d3992", "chapter_title": "String Obfuscation", "text": "While several strings from included libraries are visible within the sample, the majority of strings within MetaStealers main code are encrypted and only decrypted as needed during runtime. To achieve this, the encrypted strings are moved onto the stack and decrypted with a bitwise XOR operation for use during execution. A Python representation of the routing can be seen below with an example seen below in Figure 4"}
{"id": "sentence_0x14139391", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x3f2d3992", "chapter_title": "String Obfuscation", "text": "Figure 4 String de-obfuscation example"}
{"id": "sentence_0x2678a9fa", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "PCAPs from the SANS Internet Storm Centre report show that while initial C2 registration traffic was successful, later requests resulted in an HTTP 400 error code reply. Our own tests confirm this behaviour indicating this specific campaign was short-lived with commands no longer issued to new infections. This is likely a direct attempt to limit further analysis of the command and control communication protocol by analysts."}
{"id": "sentence_0x31ebd531", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "The sample contains a hardcoded Command and Control server, in this case, 193.106.191[.]162:1775, which is decrypted by the standard string decryption routine described in the previous section."}
{"id": "sentence_0x9660e1fc", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "Connection to the command and control infrastructure is performed over HTTP using the library cpp-httplib [3], resulting in the user agent cpp-httplib/0.10.1 being used."}
{"id": "sentence_0x8dfe464f", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "The initial connection is performed to the URL path /api/client/new, decrypted using the XOR routine detailed earlier. This connection is simply a get request with no further information included and expects a reply in JSON format, as can be seen in Figure 5"}
{"id": "sentence_0x452f22fd", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "Figure 5 Registration connection"}
{"id": "sentence_0xd71b999d", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "The UUID in the ok key is used as a BotId and changes on each new registration request."}
{"id": "sentence_0xd80068d3", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "To parse the JSON string, another open-source library is utilised (Nlohmann JSON [4]), extracting the BotId, which is subsequently written to the file %localappdata%\\hyper-v.ver in plaintext allowing the BotId to remain persistent across reboots."}
{"id": "sentence_0xec3f8d97", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "The second request to the command and control server begins with a new JSON object being created utilising the Nlohmann JSON library. The UUID key is populated with the UUID received from the earlier registration request."}
{"id": "sentence_0xceb87b1c", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "Figure 6 get worker request body"}
{"id": "sentence_0x72559562", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "The URL path /tasks/get_worker is decrypted and used to make a POST request to the command and control server, including the UUID JSON string. At the time of writing, the server replies to this command with a HTTP 400 error code as seen in Figure 7."}
{"id": "sentence_0x60ffca99", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "Figure 7 get worker request"}
{"id": "sentence_0x1777937c", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd8105b02", "chapter_title": "Command and Control", "text": "The final identified command and control request uses the URL path /tasks/collect following the completion of any tasks issued. A POST request is made detailing the success or failure of the task along with additional data such as stolen information or command output."}
{"id": "sentence_0x2ac73720", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x1be266b3", "chapter_title": "Command and Control Commands", "text": "Command IDFunctionDescription1001System InformationSpawn cmd.exe process with the command line system info and read output using attached pipes.1002Cookie StealerAccess Cookie data from the following locations (location can change based on a currently installed version check): Chrome C:\\Users\\{user}\\AppData\\Local\\Google\\Chrome\\User Data\\Default{\\Network (depending on version check) }\\Cookies Firefox C:\\Users\\{user}\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\cookies.sqlite Edge C:\\Users\\{user}\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default{\\Network (depending on version check) }\\Cookies1003Password StealerAccess saved password data from the following locations: Chrome C:\\Users\\{user}\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Login Data Firefox C:\\Users\\{user}\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\ logins.json / signons.sqlite C:\\Users\\{user}\\AppData\\Local\\Microsoft\\Edge\\User Data\\Default\\LoginData 1004Start keyloggerStart keylogger on the following applications: ChromeFirefoxNotepad1005Stop keyloggerStop Keylogger1006Start HVNCSetup Hidden Virtual Network Connection by creating a hidden desktop and network connectivity using sockets through the open-source library Kissnet [5]1007Stop HVNCStop HNVC1008Execute CommandExecute the given command using a spawned cmd.exe process and read the result using connected pipes.Table 1 Command and Control Commands"}
{"id": "sentence_0xe69afad6", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xd81e8f0a", "chapter_title": "IOCs", "text": "193.106.191[.]162:1775 cpp-httplib/0.10.1 hyper-v.exe"}
{"id": "sentence_0x54f54d00", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x4f99a37e", "chapter_title": "References", "text": "[1]"}
{"id": "sentence_0x2fceba19", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x4f99a37e", "chapter_title": "References", "text": "[2]"}
{"id": "sentence_0xf9ca6d7f", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x4f99a37e", "chapter_title": "References", "text": "[3]"}
{"id": "sentence_0x803449d1", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x4f99a37e", "chapter_title": "References", "text": "[4]"}
{"id": "sentence_0x909b14b3", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0x4f99a37e", "chapter_title": "References", "text": "[5]"}
{"id": "sentence_0x9766786f", "report_id": "report_0x1715d2e6", "report_date": "2022-05-23T00:00:00Z", "report_title": "Metastealer filling the Racoon void. tl;dr", "report_url": "https://research.nccgroup.com/2022/05/20/metastealer-filling-the-racoon-void", "chapter_id": "chapter_0xed1df474", "chapter_title": "Like this:", "text": "Like Loading..."}
