{
    "title": "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)",
    "url": "https://www.microsoft.com/security/blog/2022/05/25/detecting-and-preventing-privilege-escalation-attacks-leveraging-kerberos-relaying-krbrelayup",
    "threats": {
        "Threat": [
            {
                "token": {
                    "id": "<THREAT_0x480ee163>",
                    "type": "Threat",
                    "value": "krbrelayup_tool"
                },
                "references": {
                    "sentences": [
                        "Its important to note that KrbRelayUp cannot be used in attacks against organizations that are only using Azure AD. However, in hybrid identity environments where organizations synchronize their domain controllers with Azure AD, if an attacker compromises an Azure virtual machine using a synchronized account, theyll receive SYSTEM privileges on the virtual machine.",
                        "Protecting against KrbRelayUp attacks through coordinated threat defense",
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks.",
                        "Suspicious Kerberos delegation attempt by a newly created computer.<crlf>Suspicious edit of the Resource Based Constrained Delegation Attribute by a machine account (KrbRelayUp).",
                        "Microsoft Defender for Endpoint includes new and enhanced network inspection capabilities to correlate network and endpoint signals and emit high-confidence alerts. Defender for Endpoint leverages these network signals and looks for suspicious LDAP and Kerberos requests to Active Directory domain controllers to accurately detect attacks using KrbRelayUp. Defender for Endpoint also detects suspicious Kerberos sign-ins and service creations.",
                        "Microsoft Defender Antivirus detects a threat from the KrbRelayUp tool as the following malware:",
                        "The new KrbRelayUp tool implements this step with these two smaller consecutive actions:",
                        "For the RBCD method of the KrbRelayUp tool to work, the LDAP protocol must not use signing to communicate between LDAP clients and domain controllers. While this setting is still the default on Windows, as of 2019 Microsoft recommends configuring LDAP to use LDAP channel binding and signing.",
                        "Originally, KrbRelayUp supported only one method thats based on taking advantage of resource-based constrained delegation (RBCD); it later added several additional attack methods. In this blog, we discuss RBCD to provide further insights into how the initial KrbRelayUp attack method works. We also detail the stages that make up the said attack. Finally, we provide recommendations and guidelines that can help organizations strengthen their device configurations and defend their networks from attacks that use this tool.",
                        "KrbRelayUp attack flow",
                        "To launch an attack using the RBCD method of KrbRelayUp, an attacker performs four main steps:",
                        "The final key concept behind the RBCD method of KrbRelayUp tool is the ms-DS-MachineAccountQuota attribute, which all User Active Directory objects have. This attribute is set to 10 by default, which means that any user in Active Directory can create up to 10 computer accounts associated with them. The legitimate usage of this attribute is to allow users to have multiple devices on a network that belong to them that they can then manage. However, if a compromised user doesnt have 10 actual devices associated with their account, an attacker can create an account for a non-existing device that will be an object in Active Directory. This fake computer account isnt associated with a real device but can perform Active Directory authentication requests as if it were."
                    ],
                    "titles": [
                        "Protecting against KrbRelayUp attacks through coordinated threat defense",
                        "Step 2: Modification of the msDS-AllowedToActOnBehalfOfOtherIdentity attribute",
                        "Ms-DS-MachineAccountQuota",
                        "Unsigned LDAP and relay attacks",
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)",
                        "KrbRelayUp attack flow",
                        "Detection details"
                    ]
                },
                "links": [
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<CATEGORY_0xf1a480bb>",
                            "type": "Category",
                            "value": "malware"
                        },
                        "relation": "has_category",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    }
                ]
            },
            {
                "token": {
                    "id": "<THREAT_0x691252f3>",
                    "type": "Threat",
                    "value": "rubeus_tool"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": [
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)"
                    ]
                },
                "links": [
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    }
                ]
            },
            {
                "token": {
                    "id": "<THREAT_0xe2f62606>",
                    "type": "Threat",
                    "value": "krbrelay_tool"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": [
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)"
                    ]
                },
                "links": [
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        }
                    }
                ]
            },
            {
                "token": {
                    "id": "<THREAT_0x13af29f>",
                    "type": "Threat",
                    "value": "scmuacbypass_tool"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": [
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)"
                    ]
                },
                "links": [
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    }
                ]
            },
            {
                "token": {
                    "id": "<THREAT_0x89c62d0a>",
                    "type": "Threat",
                    "value": "whisker_tool"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": [
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)"
                    ]
                },
                "links": [
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        }
                    }
                ]
            },
            {
                "token": {
                    "id": "<THREAT_0x78145ce0>",
                    "type": "Threat",
                    "value": "adcspwn_tool"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": [
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)"
                    ]
                },
                "links": [
                    {
                        "src": {
                            "id": "<THREAT_0x691252f3>",
                            "type": "Threat",
                            "value": "rubeus_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x89c62d0a>",
                            "type": "Threat",
                            "value": "whisker_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0xe2f62606>",
                            "type": "Threat",
                            "value": "krbrelay_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    },
                    {
                        "src": {
                            "id": "<THREAT_0x13af29f>",
                            "type": "Threat",
                            "value": "scmuacbypass_tool"
                        },
                        "relation": "related",
                        "dst": {
                            "id": "<THREAT_0x78145ce0>",
                            "type": "Threat",
                            "value": "adcspwn_tool"
                        }
                    }
                ]
            }
        ]
    },
    "ttps": {},
    "meanings": {
        "Category": [
            {
                "token": {
                    "id": "<CATEGORY_0xf1a480bb>",
                    "type": "Category",
                    "value": "malware"
                },
                "references": {
                    "sentences": [
                        "Microsoft Defender Antivirus detects a threat from the KrbRelayUp tool as the following malware:",
                        "Although this attack wont function for Azure Active Directory (Azure AD) joined devices, hybrid joined devices with on-premises domain controllers remain vulnerable. Microsoft Defender for Identity detects activity from the early stages of the attack chain by monitoring anomalous behavior as seen by the domain controller. In addition, signals from Defender for Identity also feed into Microsoft 365 Defender, providing organizations with a comprehensive solution that detects and blocks suspicious network activities, malicious files, and other related components of this attack. Microsoft Defender Antivirus detects this attack tool as the malware family HackTool:MSIL/KrbUpRly."
                    ],
                    "titles": [
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)",
                        "Detection details"
                    ]
                },
                "links": [
                    {
                        "src": {
                            "id": "<CATEGORY_0xf1a480bb>",
                            "type": "Category",
                            "value": "malware"
                        },
                        "relation": "has_category",
                        "dst": {
                            "id": "<THREAT_0x480ee163>",
                            "type": "Threat",
                            "value": "krbrelayup_tool"
                        }
                    }
                ]
            }
        ]
    },
    "iocs": {},
    "unknownwords": {
        "UnknownWord": [
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xc1d87aa9>",
                    "type": "UnknownWord",
                    "value": "relaying"
                },
                "references": {
                    "sentences": [
                        "LDAP is one of the main protocols that directory services tools, such as Active Directory, use to query and access directory information. By default, LDAP is vulnerable to credential relaying attacks. For example, in a credential relaying attack, a web server requesting a password to sign in would have its request relayed by an attacker to an authorized client. The attacker then relays the client reply containing the correct password back to the server, thus signing in. Once the attacker is signed in, they have the same permissions as the user whose credentials were relayed."
                    ],
                    "titles": [
                        "Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp)"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x22f17682>",
                    "type": "UnknownWord",
                    "value": "resource-based"
                },
                "references": {
                    "sentences": [
                        "Resource-based constrained delegation",
                        "However, as organizations expanded, administrators struggled to manage all the delegation requirements, raising the need for a new type of delegation: resource-based. For instance, in an organization with several file servers that all trust a web server for delegation, an admin would have to change the msDS-AllowedToDelegateTo priority in all of the different file servers to introduce a second web server. With resource-based delegation, the list of trusted computers is held on the receiving end. Thus, in our example, only the newly created server would require a change of settings.",
                        "Understanding the attack: What is resource-based constrained delegation?",
                        "Originally, KrbRelayUp supported only one method thats based on taking advantage of resource-based constrained delegation (RBCD); it later added several additional attack methods. In this blog, we discuss RBCD to provide further insights into how the initial KrbRelayUp attack method works. We also detail the stages that make up the said attack. Finally, we provide recommendations and guidelines that can help organizations strengthen their device configurations and defend their networks from attacks that use this tool.",
                        "Resource-based constrained delegation (RBCD) represents the key to this attack method, enabling the tool to impersonate an administrator and eventually run a code as the SYSTEM account of a compromised device."
                    ],
                    "titles": [
                        "Understanding the attack: What is resource-based constrained delegation?",
                        "Resource-based constrained delegation"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x5bdb839a>",
                    "type": "UnknownWord",
                    "value": "constrained"
                },
                "references": {
                    "sentences": [
                        "Resource-based constrained delegation",
                        "Suspicious Kerberos delegation attempt by a newly created computer.<crlf>Suspicious edit of the Resource Based Constrained Delegation Attribute by a machine account (KrbRelayUp).",
                        "Understanding the attack: What is resource-based constrained delegation?",
                        "Originally, KrbRelayUp supported only one method thats based on taking advantage of resource-based constrained delegation (RBCD); it later added several additional attack methods. In this blog, we discuss RBCD to provide further insights into how the initial KrbRelayUp attack method works. We also detail the stages that make up the said attack. Finally, we provide recommendations and guidelines that can help organizations strengthen their device configurations and defend their networks from attacks that use this tool.",
                        "Resource-based constrained delegation (RBCD) represents the key to this attack method, enabling the tool to impersonate an administrator and eventually run a code as the SYSTEM account of a compromised device."
                    ],
                    "titles": [
                        "Understanding the attack: What is resource-based constrained delegation?",
                        "Resource-based constrained delegation"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x98fd3fd8>",
                    "type": "UnknownWord",
                    "value": "delegation"
                },
                "references": {
                    "sentences": [
                        "Resource-based constrained delegation",
                        "Suspicious Kerberos delegation attempt by a newly created computer.<crlf>Suspicious edit of the Resource Based Constrained Delegation Attribute by a machine account (KrbRelayUp).",
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of.",
                        "However, as organizations expanded, administrators struggled to manage all the delegation requirements, raising the need for a new type of delegation: resource-based. For instance, in an organization with several file servers that all trust a web server for delegation, an admin would have to change the msDS-AllowedToDelegateTo priority in all of the different file servers to introduce a second web server. With resource-based delegation, the list of trusted computers is held on the receiving end. Thus, in our example, only the newly created server would require a change of settings.",
                        "Understanding the attack: What is resource-based constrained delegation?",
                        "Figure 1. Suspicious Kerberos delegation attempt by a newly created computer alert in Microsoft Defender for Identity",
                        "Originally, KrbRelayUp supported only one method thats based on taking advantage of resource-based constrained delegation (RBCD); it later added several additional attack methods. In this blog, we discuss RBCD to provide further insights into how the initial KrbRelayUp attack method works. We also detail the stages that make up the said attack. Finally, we provide recommendations and guidelines that can help organizations strengthen their device configurations and defend their networks from attacks that use this tool.",
                        "Delegation",
                        "Sometimes, however, a resource needs to request access to another resource on behalf of a different identity. A common example of this is mail delegation, wherein executives often give delegation rights to their executive assistants to send and receive emails on their behalf without providing the assistant with the executives password. The executive assistant isnt authenticating as the executive; the executive has just allowed the assistants account to pretend that they are.",
                        "Resource-based constrained delegation (RBCD) represents the key to this attack method, enabling the tool to impersonate an administrator and eventually run a code as the SYSTEM account of a compromised device."
                    ],
                    "titles": [
                        "Understanding the attack: What is resource-based constrained delegation?",
                        "Resource-based constrained delegation",
                        "Delegation"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xee11a3b2>",
                    "type": "UnknownWord",
                    "value": "ldap"
                },
                "references": {
                    "sentences": [
                        "Next, the attacker adds their resource to the current devices list of trusted resources. To do this, the attacker starts an LDAP session and relays the credentials of the current device to the LDAP server.",
                        "Microsoft encourages customers to update Domain Controller: LDAP server signing requirements to Require signing as detailed in this advisory and enable Extended Protection for Authentication (EPA) as detailed in this blog.",
                        "LDAP is one of the main protocols that directory services tools, such as Active Directory, use to query and access directory information. By default, LDAP is vulnerable to credential relaying attacks. For example, in a credential relaying attack, a web server requesting a password to sign in would have its request relayed by an attacker to an authorized client. The attacker then relays the client reply containing the correct password back to the server, thus signing in. Once the attacker is signed in, they have the same permissions as the user whose credentials were relayed.",
                        "Microsoft Defender for Endpoint includes new and enhanced network inspection capabilities to correlate network and endpoint signals and emit high-confidence alerts. Defender for Endpoint leverages these network signals and looks for suspicious LDAP and Kerberos requests to Active Directory domain controllers to accurately detect attacks using KrbRelayUp. Defender for Endpoint also detects suspicious Kerberos sign-ins and service creations.",
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource.",
                        "If LDAP signing is required, each request to the server needs to be cryptographically signed. In this case, the attacker would still be able to relay the sign-in request and reply, but all further requests from the attacker would be disregarded because each request must be signed, and the attacker doesnt have the proper keys to do the signing.",
                        "For the RBCD method of the KrbRelayUp tool to work, the LDAP protocol must not use signing to communicate between LDAP clients and domain controllers. While this setting is still the default on Windows, as of 2019 Microsoft recommends configuring LDAP to use LDAP channel binding and signing.",
                        "Unsigned LDAP and relay attacks",
                        "Authenticates to the LDAP service by triggering and performing a Kerberos relay attack<crlf>Edits the msDS-AllowedToActOnBehalfOfOtherIdentity attribute to add the attackers resource to the list of entities permitted to delegate the target device."
                    ],
                    "titles": [
                        "Unsigned LDAP and relay attacks"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xb4309405>",
                    "type": "UnknownWord",
                    "value": "ms-ds-machineaccountquota"
                },
                "references": {
                    "sentences": [
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource.",
                        "The final key concept behind the RBCD method of KrbRelayUp tool is the ms-DS-MachineAccountQuota attribute, which all User Active Directory objects have. This attribute is set to 10 by default, which means that any user in Active Directory can create up to 10 computer accounts associated with them. The legitimate usage of this attribute is to allow users to have multiple devices on a network that belong to them that they can then manage. However, if a compromised user doesnt have 10 actual devices associated with their account, an attacker can create an account for a non-existing device that will be an object in Active Directory. This fake computer account isnt associated with a real device but can perform Active Directory authentication requests as if it were.",
                        "Ms-DS-MachineAccountQuota"
                    ],
                    "titles": [
                        "Ms-DS-MachineAccountQuota"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xcc8d4662>",
                    "type": "UnknownWord",
                    "value": "suitable"
                },
                "references": {
                    "sentences": [
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource.",
                        "Step 1: Acquisition of a suitable resource",
                        "The attacker first obtains a resource suitable to be the source of an RBCD. There are several ways to obtain such a resource; the most straightforward way is to create a new computer account as discussed above."
                    ],
                    "titles": [
                        "Step 1: Acquisition of a suitable resource"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x90af6de8>",
                    "type": "UnknownWord",
                    "value": "msds-allowedtoactonbehalfofotheridentity"
                },
                "references": {
                    "sentences": [
                        "Authenticates to the LDAP service by triggering and performing a Kerberos relay attack<crlf>Edits the msDS-AllowedToActOnBehalfOfOtherIdentity attribute to add the attackers resource to the list of entities permitted to delegate the target device.",
                        "Step 2: Modification of the msDS-AllowedToActOnBehalfOfOtherIdentity attribute"
                    ],
                    "titles": [
                        "Step 2: Modification of the msDS-AllowedToActOnBehalfOfOtherIdentity attribute"
                    ]
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xd1252c27>",
                    "type": "UnknownWord",
                    "value": "mor"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x1593c6c8>",
                    "type": "UnknownWord",
                    "value": "davidovich"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x5e0be0bf>",
                    "type": "UnknownWord",
                    "value": "streamline"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xd3f6f5ba>",
                    "type": "UnknownWord",
                    "value": "powermad"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x79380df5>",
                    "type": "UnknownWord",
                    "value": "sharpmad"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x2cdbc13e>",
                    "type": "UnknownWord",
                    "value": "hybrid"
                },
                "references": {
                    "sentences": [
                        "Its important to note that KrbRelayUp cannot be used in attacks against organizations that are only using Azure AD. However, in hybrid identity environments where organizations synchronize their domain controllers with Azure AD, if an attacker compromises an Azure virtual machine using a synchronized account, theyll receive SYSTEM privileges on the virtual machine.",
                        "Although this attack wont function for Azure Active Directory (Azure AD) joined devices, hybrid joined devices with on-premises domain controllers remain vulnerable. Microsoft Defender for Identity detects activity from the early stages of the attack chain by monitoring anomalous behavior as seen by the domain controller. In addition, signals from Defender for Identity also feed into Microsoft 365 Defender, providing organizations with a comprehensive solution that detects and blocks suspicious network activities, malicious files, and other related components of this attack. Microsoft Defender Antivirus detects this attack tool as the malware family HackTool:MSIL/KrbUpRly."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x4f3b5b5b>",
                    "type": "UnknownWord",
                    "value": "on-premises"
                },
                "references": {
                    "sentences": [
                        "Although this attack wont function for Azure Active Directory (Azure AD) joined devices, hybrid joined devices with on-premises domain controllers remain vulnerable. Microsoft Defender for Identity detects activity from the early stages of the attack chain by monitoring anomalous behavior as seen by the domain controller. In addition, signals from Defender for Identity also feed into Microsoft 365 Defender, providing organizations with a comprehensive solution that detects and blocks suspicious network activities, malicious files, and other related components of this attack. Microsoft Defender Antivirus detects this attack tool as the malware family HackTool:MSIL/KrbUpRly.",
                        "An authentication protocol verifies the legitimacy of a resource or identity. When a user signs into a website, that website uses a methodology to confirm the authenticity of the resource requesting access. In simpler terms, the authentication process involves signing in with a passwordmade possible by the user knowing the password anticipated by the website. The Kerberos protocol serves as the main authentication framework for this process in on-premises Active Directory."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xd27f08e7>",
                    "type": "UnknownWord",
                    "value": "hacktool"
                },
                "references": {
                    "sentences": [
                        "HackTool:MSIL/KrbUpRly.A<crlf>HackTool:MSIL/KrbUpRly.C<crlf>HackTool:MSIL/KrbUpRly.D",
                        "Although this attack wont function for Azure Active Directory (Azure AD) joined devices, hybrid joined devices with on-premises domain controllers remain vulnerable. Microsoft Defender for Identity detects activity from the early stages of the attack chain by monitoring anomalous behavior as seen by the domain controller. In addition, signals from Defender for Identity also feed into Microsoft 365 Defender, providing organizations with a comprehensive solution that detects and blocks suspicious network activities, malicious files, and other related components of this attack. Microsoft Defender Antivirus detects this attack tool as the malware family HackTool:MSIL/KrbUpRly."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xb54c14c9>",
                    "type": "UnknownWord",
                    "value": "msil"
                },
                "references": {
                    "sentences": [
                        "Although this attack wont function for Azure Active Directory (Azure AD) joined devices, hybrid joined devices with on-premises domain controllers remain vulnerable. Microsoft Defender for Identity detects activity from the early stages of the attack chain by monitoring anomalous behavior as seen by the domain controller. In addition, signals from Defender for Identity also feed into Microsoft 365 Defender, providing organizations with a comprehensive solution that detects and blocks suspicious network activities, malicious files, and other related components of this attack. Microsoft Defender Antivirus detects this attack tool as the malware family HackTool:MSIL/KrbUpRly."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xb34b3427>",
                    "type": "UnknownWord",
                    "value": "krbuprly"
                },
                "references": {
                    "sentences": [
                        "Although this attack wont function for Azure Active Directory (Azure AD) joined devices, hybrid joined devices with on-premises domain controllers remain vulnerable. Microsoft Defender for Identity detects activity from the early stages of the attack chain by monitoring anomalous behavior as seen by the domain controller. In addition, signals from Defender for Identity also feed into Microsoft 365 Defender, providing organizations with a comprehensive solution that detects and blocks suspicious network activities, malicious files, and other related components of this attack. Microsoft Defender Antivirus detects this attack tool as the malware family HackTool:MSIL/KrbUpRly."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x86c1096d>",
                    "type": "UnknownWord",
                    "value": "epa"
                },
                "references": {
                    "sentences": [
                        "Microsoft encourages customers to update Domain Controller: LDAP server signing requirements to Require signing as detailed in this advisory and enable Extended Protection for Authentication (EPA) as detailed in this blog."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xea64ff44>",
                    "type": "UnknownWord",
                    "value": "rbcd"
                },
                "references": {
                    "sentences": [
                        "For the RBCD method of the KrbRelayUp tool to work, the LDAP protocol must not use signing to communicate between LDAP clients and domain controllers. While this setting is still the default on Windows, as of 2019 Microsoft recommends configuring LDAP to use LDAP channel binding and signing.",
                        "Originally, KrbRelayUp supported only one method thats based on taking advantage of resource-based constrained delegation (RBCD); it later added several additional attack methods. In this blog, we discuss RBCD to provide further insights into how the initial KrbRelayUp attack method works. We also detail the stages that make up the said attack. Finally, we provide recommendations and guidelines that can help organizations strengthen their device configurations and defend their networks from attacks that use this tool.",
                        "Resource-based constrained delegation (RBCD) represents the key to this attack method, enabling the tool to impersonate an administrator and eventually run a code as the SYSTEM account of a compromised device.",
                        "The attacker first obtains a resource suitable to be the source of an RBCD. There are several ways to obtain such a resource; the most straightforward way is to create a new computer account as discussed above.",
                        "To launch an attack using the RBCD method of KrbRelayUp, an attacker performs four main steps:",
                        "The final key concept behind the RBCD method of KrbRelayUp tool is the ms-DS-MachineAccountQuota attribute, which all User Active Directory objects have. This attribute is set to 10 by default, which means that any user in Active Directory can create up to 10 computer accounts associated with them. The legitimate usage of this attribute is to allow users to have multiple devices on a network that belong to them that they can then manage. However, if a compromised user doesnt have 10 actual devices associated with their account, an attacker can create an account for a non-existing device that will be an object in Active Directory. This fake computer account isnt associated with a real device but can perform Active Directory authentication requests as if it were."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x3bfc4a27>",
                    "type": "UnknownWord",
                    "value": "legitimacy"
                },
                "references": {
                    "sentences": [
                        "An authentication protocol verifies the legitimacy of a resource or identity. When a user signs into a website, that website uses a methodology to confirm the authenticity of the resource requesting access. In simpler terms, the authentication process involves signing in with a passwordmade possible by the user knowing the password anticipated by the website. The Kerberos protocol serves as the main authentication framework for this process in on-premises Active Directory."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x4f1d307d>",
                    "type": "UnknownWord",
                    "value": "methodology"
                },
                "references": {
                    "sentences": [
                        "An authentication protocol verifies the legitimacy of a resource or identity. When a user signs into a website, that website uses a methodology to confirm the authenticity of the resource requesting access. In simpler terms, the authentication process involves signing in with a passwordmade possible by the user knowing the password anticipated by the website. The Kerberos protocol serves as the main authentication framework for this process in on-premises Active Directory."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xe50ec6ad>",
                    "type": "UnknownWord",
                    "value": "simpler"
                },
                "references": {
                    "sentences": [
                        "An authentication protocol verifies the legitimacy of a resource or identity. When a user signs into a website, that website uses a methodology to confirm the authenticity of the resource requesting access. In simpler terms, the authentication process involves signing in with a passwordmade possible by the user knowing the password anticipated by the website. The Kerberos protocol serves as the main authentication framework for this process in on-premises Active Directory."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x425e3572>",
                    "type": "UnknownWord",
                    "value": "passwordmade"
                },
                "references": {
                    "sentences": [
                        "An authentication protocol verifies the legitimacy of a resource or identity. When a user signs into a website, that website uses a methodology to confirm the authenticity of the resource requesting access. In simpler terms, the authentication process involves signing in with a passwordmade possible by the user knowing the password anticipated by the website. The Kerberos protocol serves as the main authentication framework for this process in on-premises Active Directory."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xa5999d10>",
                    "type": "UnknownWord",
                    "value": "anticipated"
                },
                "references": {
                    "sentences": [
                        "An authentication protocol verifies the legitimacy of a resource or identity. When a user signs into a website, that website uses a methodology to confirm the authenticity of the resource requesting access. In simpler terms, the authentication process involves signing in with a passwordmade possible by the user knowing the password anticipated by the website. The Kerberos protocol serves as the main authentication framework for this process in on-premises Active Directory."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xb4c956cd>",
                    "type": "UnknownWord",
                    "value": "wherein"
                },
                "references": {
                    "sentences": [
                        "Sometimes, however, a resource needs to request access to another resource on behalf of a different identity. A common example of this is mail delegation, wherein executives often give delegation rights to their executive assistants to send and receive emails on their behalf without providing the assistant with the executives password. The executive assistant isnt authenticating as the executive; the executive has just allowed the assistants account to pretend that they are."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x40f60ef9>",
                    "type": "UnknownWord",
                    "value": "authenticating"
                },
                "references": {
                    "sentences": [
                        "Sometimes, however, a resource needs to request access to another resource on behalf of a different identity. A common example of this is mail delegation, wherein executives often give delegation rights to their executive assistants to send and receive emails on their behalf without providing the assistant with the executives password. The executive assistant isnt authenticating as the executive; the executive has just allowed the assistants account to pretend that they are."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xde7f6a4b>",
                    "type": "UnknownWord",
                    "value": "pretend"
                },
                "references": {
                    "sentences": [
                        "Sometimes, however, a resource needs to request access to another resource on behalf of a different identity. A common example of this is mail delegation, wherein executives often give delegation rights to their executive assistants to send and receive emails on their behalf without providing the assistant with the executives password. The executive assistant isnt authenticating as the executive; the executive has just allowed the assistants account to pretend that they are."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x719c812b>",
                    "type": "UnknownWord",
                    "value": "seenabledelegation"
                },
                "references": {
                    "sentences": [
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x7847628a>",
                    "type": "UnknownWord",
                    "value": "configure"
                },
                "references": {
                    "sentences": [
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of.",
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xff0137d9>",
                    "type": "UnknownWord",
                    "value": "dictate"
                },
                "references": {
                    "sentences": [
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x1aa6bcdc>",
                    "type": "UnknownWord",
                    "value": "msds-allowedtodelegateto"
                },
                "references": {
                    "sentences": [
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of.",
                        "However, as organizations expanded, administrators struggled to manage all the delegation requirements, raising the need for a new type of delegation: resource-based. For instance, in an organization with several file servers that all trust a web server for delegation, an admin would have to change the msDS-AllowedToDelegateTo priority in all of the different file servers to introduce a second web server. With resource-based delegation, the list of trusted computers is held on the receiving end. Thus, in our example, only the newly created server would require a change of settings."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x27b3257d>",
                    "type": "UnknownWord",
                    "value": "spns"
                },
                "references": {
                    "sentences": [
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x3cac7434>",
                    "type": "UnknownWord",
                    "value": "struggled"
                },
                "references": {
                    "sentences": [
                        "However, as organizations expanded, administrators struggled to manage all the delegation requirements, raising the need for a new type of delegation: resource-based. For instance, in an organization with several file servers that all trust a web server for delegation, an admin would have to change the msDS-AllowedToDelegateTo priority in all of the different file servers to introduce a second web server. With resource-based delegation, the list of trusted computers is held on the receiving end. Thus, in our example, only the newly created server would require a change of settings."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x91b07d2d>",
                    "type": "UnknownWord",
                    "value": "configuring"
                },
                "references": {
                    "sentences": [
                        "For the RBCD method of the KrbRelayUp tool to work, the LDAP protocol must not use signing to communicate between LDAP clients and domain controllers. While this setting is still the default on Windows, as of 2019 Microsoft recommends configuring LDAP to use LDAP channel binding and signing."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x243e225a>",
                    "type": "UnknownWord",
                    "value": "binding"
                },
                "references": {
                    "sentences": [
                        "For the RBCD method of the KrbRelayUp tool to work, the LDAP protocol must not use signing to communicate between LDAP clients and domain controllers. While this setting is still the default on Windows, as of 2019 Microsoft recommends configuring LDAP to use LDAP channel binding and signing.",
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xea14db3e>",
                    "type": "UnknownWord",
                    "value": "relayed"
                },
                "references": {
                    "sentences": [
                        "LDAP is one of the main protocols that directory services tools, such as Active Directory, use to query and access directory information. By default, LDAP is vulnerable to credential relaying attacks. For example, in a credential relaying attack, a web server requesting a password to sign in would have its request relayed by an attacker to an authorized client. The attacker then relays the client reply containing the correct password back to the server, thus signing in. Once the attacker is signed in, they have the same permissions as the user whose credentials were relayed."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xde3611ae>",
                    "type": "UnknownWord",
                    "value": "cryptographically"
                },
                "references": {
                    "sentences": [
                        "If LDAP signing is required, each request to the server needs to be cryptographically signed. In this case, the attacker would still be able to relay the sign-in request and reply, but all further requests from the attacker would be disregarded because each request must be signed, and the attacker doesnt have the proper keys to do the signing."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xa125349b>",
                    "type": "UnknownWord",
                    "value": "disregarded"
                },
                "references": {
                    "sentences": [
                        "If LDAP signing is required, each request to the server needs to be cryptographically signed. In this case, the attacker would still be able to relay the sign-in request and reply, but all further requests from the attacker would be disregarded because each request must be signed, and the attacker doesnt have the proper keys to do the signing."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xb2d2c5f8>",
                    "type": "UnknownWord",
                    "value": "non-existing"
                },
                "references": {
                    "sentences": [
                        "The final key concept behind the RBCD method of KrbRelayUp tool is the ms-DS-MachineAccountQuota attribute, which all User Active Directory objects have. This attribute is set to 10 by default, which means that any user in Active Directory can create up to 10 computer accounts associated with them. The legitimate usage of this attribute is to allow users to have multiple devices on a network that belong to them that they can then manage. However, if a compromised user doesnt have 10 actual devices associated with their account, an attacker can create an account for a non-existing device that will be an object in Active Directory. This fake computer account isnt associated with a real device but can perform Active Directory authentication requests as if it were."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x845bc7d6>",
                    "type": "UnknownWord",
                    "value": "prerequisite"
                },
                "references": {
                    "sentences": [
                        "Initially, the ability to obtain such an account was a prerequisite for this attack method, but since the release of the tool, other security researchers found ways to get around this requirement."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xa4da2da9>",
                    "type": "UnknownWord",
                    "value": "consecutive"
                },
                "references": {
                    "sentences": [
                        "The new KrbRelayUp tool implements this step with these two smaller consecutive actions:"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x2dadf48d>",
                    "type": "UnknownWord",
                    "value": "authenticates"
                },
                "references": {
                    "sentences": [
                        "Authenticates to the LDAP service by triggering and performing a Kerberos relay attack<crlf>Edits the msDS-AllowedToActOnBehalfOfOtherIdentity attribute to add the attackers resource to the list of entities permitted to delegate the target device."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x15d0f330>",
                    "type": "UnknownWord",
                    "value": "permitted"
                },
                "references": {
                    "sentences": [
                        "Authenticates to the LDAP service by triggering and performing a Kerberos relay attack<crlf>Edits the msDS-AllowedToActOnBehalfOfOtherIdentity attribute to add the attackers resource to the list of entities permitted to delegate the target device."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xa2af4207>",
                    "type": "UnknownWord",
                    "value": "spn"
                },
                "references": {
                    "sentences": [
                        "AS-Req A request to generate a Ticket Granting Ticket (TGT) for the attackers impersonated resource.<crlf>S4U2self A request to generate a Ticket Granting Service (TGS) ticket from an administrator to the resource.<crlf>S4U2proxy A request to generate a TGS ticket for the host SPN as an administrator delegating their access via the impersonated resource.",
                        "Here, the attacker leverages their control over their resource gained through the first step with the trust for their resource gained through the second step. As such, the local device trusts the attackers resource to request a ticket addressed to the host SPN as the domain administrator. The request is made by first pretending to be the attackers resource and consists of three requests:"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x58971289>",
                    "type": "UnknownWord",
                    "value": "pretending"
                },
                "references": {
                    "sentences": [
                        "Here, the attacker leverages their control over their resource gained through the first step with the trust for their resource gained through the second step. As such, the local device trusts the attackers resource to request a ticket addressed to the host SPN as the domain administrator. The request is made by first pretending to be the attackers resource and consists of three requests:"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xbdeb60f0>",
                    "type": "UnknownWord",
                    "value": "as-req"
                },
                "references": {
                    "sentences": [
                        "AS-Req A request to generate a Ticket Granting Ticket (TGT) for the attackers impersonated resource.<crlf>S4U2self A request to generate a Ticket Granting Service (TGS) ticket from an administrator to the resource.<crlf>S4U2proxy A request to generate a TGS ticket for the host SPN as an administrator delegating their access via the impersonated resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x2fd7aa1d>",
                    "type": "UnknownWord",
                    "value": "tgt"
                },
                "references": {
                    "sentences": [
                        "AS-Req A request to generate a Ticket Granting Ticket (TGT) for the attackers impersonated resource.<crlf>S4U2self A request to generate a Ticket Granting Service (TGS) ticket from an administrator to the resource.<crlf>S4U2proxy A request to generate a TGS ticket for the host SPN as an administrator delegating their access via the impersonated resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x23350997>",
                    "type": "UnknownWord",
                    "value": "s4u2self"
                },
                "references": {
                    "sentences": [
                        "AS-Req A request to generate a Ticket Granting Ticket (TGT) for the attackers impersonated resource.<crlf>S4U2self A request to generate a Ticket Granting Service (TGS) ticket from an administrator to the resource.<crlf>S4U2proxy A request to generate a TGS ticket for the host SPN as an administrator delegating their access via the impersonated resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x8c10e7c5>",
                    "type": "UnknownWord",
                    "value": "tgs"
                },
                "references": {
                    "sentences": [
                        "AS-Req A request to generate a Ticket Granting Ticket (TGT) for the attackers impersonated resource.<crlf>S4U2self A request to generate a Ticket Granting Service (TGS) ticket from an administrator to the resource.<crlf>S4U2proxy A request to generate a TGS ticket for the host SPN as an administrator delegating their access via the impersonated resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x7196bccb>",
                    "type": "UnknownWord",
                    "value": "s4u2proxy"
                },
                "references": {
                    "sentences": [
                        "AS-Req A request to generate a Ticket Granting Ticket (TGT) for the attackers impersonated resource.<crlf>S4U2self A request to generate a Ticket Granting Service (TGS) ticket from an administrator to the resource.<crlf>S4U2proxy A request to generate a TGS ticket for the host SPN as an administrator delegating their access via the impersonated resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x14429a42>",
                    "type": "UnknownWord",
                    "value": "delegating"
                },
                "references": {
                    "sentences": [
                        "AS-Req A request to generate a Ticket Granting Ticket (TGT) for the attackers impersonated resource.<crlf>S4U2self A request to generate a Ticket Granting Service (TGS) ticket from an administrator to the resource.<crlf>S4U2proxy A request to generate a TGS ticket for the host SPN as an administrator delegating their access via the impersonated resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xd0a44faf>",
                    "type": "UnknownWord",
                    "value": "scm"
                },
                "references": {
                    "sentences": [
                        "The last step leverages the attackers newly acquired ticket to run code on the device. In the attack, as its published online, the Service Control Manager (SCM) is asked to create a new service with SYSTEM permissions."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x614c6319>",
                    "type": "UnknownWord",
                    "value": "synchronize"
                },
                "references": {
                    "sentences": [
                        "Its important to note that KrbRelayUp cannot be used in attacks against organizations that are only using Azure AD. However, in hybrid identity environments where organizations synchronize their domain controllers with Azure AD, if an attacker compromises an Azure virtual machine using a synchronized account, theyll receive SYSTEM privileges on the virtual machine."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xa9a40e>",
                    "type": "UnknownWord",
                    "value": "synchronized"
                },
                "references": {
                    "sentences": [
                        "Its important to note that KrbRelayUp cannot be used in attacks against organizations that are only using Azure AD. However, in hybrid identity environments where organizations synchronize their domain controllers with Azure AD, if an attacker compromises an Azure virtual machine using a synchronized account, theyll receive SYSTEM privileges on the virtual machine."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xb1e7af3f>",
                    "type": "UnknownWord",
                    "value": "kb4520412"
                },
                "references": {
                    "sentences": [
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x78f0c1c2>",
                    "type": "UnknownWord",
                    "value": "non-admin"
                },
                "references": {
                    "sentences": [
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x72d44b5e>",
                    "type": "UnknownWord",
                    "value": "learning-based"
                },
                "references": {
                    "sentences": [
                        "Organizations should also deploy a comprehensive security solution like Microsoft 365 Defender to detect and block this threat across the stages of the attack chain. Microsoft 365 Defender has multiple layers of dynamic protection technologies, including machine learning-based protection, and correlates threat data from email, endpoints, identities, and cloud apps to provide in-depth and coordinated threat defense. All of these are backed by threat experts who continuously monitor the threat landscape for new attacker tools and techniques."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xfa5d033f>",
                    "type": "UnknownWord",
                    "value": "emit"
                },
                "references": {
                    "sentences": [
                        "Microsoft Defender for Endpoint includes new and enhanced network inspection capabilities to correlate network and endpoint signals and emit high-confidence alerts. Defender for Endpoint leverages these network signals and looks for suspicious LDAP and Kerberos requests to Active Directory domain controllers to accurately detect attacks using KrbRelayUp. Defender for Endpoint also detects suspicious Kerberos sign-ins and service creations."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x6e524620>",
                    "type": "UnknownWord",
                    "value": "high-confidence"
                },
                "references": {
                    "sentences": [
                        "Microsoft Defender for Endpoint includes new and enhanced network inspection capabilities to correlate network and endpoint signals and emit high-confidence alerts. Defender for Endpoint leverages these network signals and looks for suspicious LDAP and Kerberos requests to Active Directory domain controllers to accurately detect attacks using KrbRelayUp. Defender for Endpoint also detects suspicious Kerberos sign-ins and service creations."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xfaa7879f>",
                    "type": "UnknownWord",
                    "value": "msil krbuprly"
                },
                "references": {
                    "sentences": [
                        "HackTool:MSIL/KrbUpRly.A<crlf>HackTool:MSIL/KrbUpRly.C<crlf>HackTool:MSIL/KrbUpRly.D"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x773d4d5a>",
                    "type": "UnknownWord",
                    "value": "resilience"
                },
                "references": {
                    "sentences": [
                        "Microsoft 365 Defender customers may refer to the threat analytics report to determine if this threat is present in their network and to get additional details and recommendations. Threat analytics enables organizations to assess the impact of a threat to their network, review exposure and resilience, and perform mitigation, recovery, or prevention actions to stop or contain active attacks."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xf71197e5>",
                    "type": "UnknownWord",
                    "value": "cross-domain"
                },
                "references": {
                    "sentences": [
                        "Learn how you can stop attacks through automated, cross-domain security with Microsoft 365 Defender."
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xafc6055d>",
                    "type": "UnknownWord",
                    "value": "zeev"
                },
                "references": {
                    "sentences": [
                        "Zeev Rabinovich and Ofir Shlomo<crlf>Microsoft 365 Defender Research Team"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x37d4f999>",
                    "type": "UnknownWord",
                    "value": "rabinovich"
                },
                "references": {
                    "sentences": [
                        "Zeev Rabinovich and Ofir Shlomo<crlf>Microsoft 365 Defender Research Team"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0xefce4d81>",
                    "type": "UnknownWord",
                    "value": "ofir"
                },
                "references": {
                    "sentences": [
                        "Zeev Rabinovich and Ofir Shlomo<crlf>Microsoft 365 Defender Research Team"
                    ],
                    "titles": []
                }
            },
            {
                "token": {
                    "id": "<UNKNOWNWORD_0x5bf95d08>",
                    "type": "UnknownWord",
                    "value": "shlomo"
                },
                "references": {
                    "sentences": [
                        "Zeev Rabinovich and Ofir Shlomo<crlf>Microsoft 365 Defender Research Team"
                    ],
                    "titles": []
                }
            }
        ]
    },
    "other_links": [],
    "info": {
        "potential_threats": {
            "<UNKNOWNWORD_0x90af6de8>": {
                "token": {
                    "id": "<UNKNOWNWORD_0x90af6de8>",
                    "type": "UnknownWord",
                    "value": "msds-allowedtoactonbehalfofotheridentity"
                },
                "references": {
                    "sentences": [
                        "Authenticates to the LDAP service by triggering and performing a Kerberos relay attack<crlf>Edits the msDS-AllowedToActOnBehalfOfOtherIdentity attribute to add the attackers resource to the list of entities permitted to delegate the target device.",
                        "Step 2: Modification of the msDS-AllowedToActOnBehalfOfOtherIdentity attribute"
                    ],
                    "titles": [
                        "Step 2: Modification of the msDS-AllowedToActOnBehalfOfOtherIdentity attribute"
                    ]
                }
            },
            "<UNKNOWNWORD_0x1593c6c8>": {
                "token": {
                    "id": "<UNKNOWNWORD_0x1593c6c8>",
                    "type": "UnknownWord",
                    "value": "davidovich"
                },
                "references": {
                    "sentences": [
                        "On April 24, 2022, a privilege escalation hacking tool, KrbRelayUp, was publicly disclosed on GitHub by security researcher Mor Davidovich. KrbRelayUp is a wrapper that can streamline the use of some features in Rubeus, KrbRelay, SCMUACBypass, PowerMad/SharpMad, Whisker, and ADCSPwn tools in attacks."
                    ],
                    "titles": []
                }
            },
            "<UNKNOWNWORD_0x719c812b>": {
                "token": {
                    "id": "<UNKNOWNWORD_0x719c812b>",
                    "type": "UnknownWord",
                    "value": "seenabledelegation"
                },
                "references": {
                    "sentences": [
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of."
                    ],
                    "titles": []
                }
            },
            "<UNKNOWNWORD_0x1aa6bcdc>": {
                "token": {
                    "id": "<UNKNOWNWORD_0x1aa6bcdc>",
                    "type": "UnknownWord",
                    "value": "msds-allowedtodelegateto"
                },
                "references": {
                    "sentences": [
                        "Initially, only users with the SeEnableDelegation role could configure delegation, typically domain admins. These domain admins can manage resources and dictate which identities can act on behalf of a different resource. They achieve this by updating the msDS-AllowedToDelegateTo property of a user account or device. This property contains a list of all the unique identifiers (service principal names, or SPNs) to which this object can delegate or act on behalf of.",
                        "However, as organizations expanded, administrators struggled to manage all the delegation requirements, raising the need for a new type of delegation: resource-based. For instance, in an organization with several file servers that all trust a web server for delegation, an admin would have to change the msDS-AllowedToDelegateTo priority in all of the different file servers to introduce a second web server. With resource-based delegation, the list of trusted computers is held on the receiving end. Thus, in our example, only the newly created server would require a change of settings."
                    ],
                    "titles": []
                }
            },
            "<UNKNOWNWORD_0xb1e7af3f>": {
                "token": {
                    "id": "<UNKNOWNWORD_0xb1e7af3f>",
                    "type": "UnknownWord",
                    "value": "kb4520412"
                },
                "references": {
                    "sentences": [
                        "Microsoft has provided guidance for enabling LDAP channel binding and LDAP signing. Microsoft recommends that administrators configure LDAP signing and LDAP channel binding as recommended in the said advisory and described in detail in 2020 LDAP channel binding and LDAP signing requirements for Windows (KB4520412).<crlf>Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks. Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource."
                    ],
                    "titles": []
                }
            },
            "<UNKNOWNWORD_0x37d4f999>": {
                "token": {
                    "id": "<UNKNOWNWORD_0x37d4f999>",
                    "type": "UnknownWord",
                    "value": "rabinovich"
                },
                "references": {
                    "sentences": [
                        "Zeev Rabinovich and Ofir Shlomo<crlf>Microsoft 365 Defender Research Team"
                    ],
                    "titles": []
                }
            },
            "<UNKNOWNWORD_0x5bf95d08>": {
                "token": {
                    "id": "<UNKNOWNWORD_0x5bf95d08>",
                    "type": "UnknownWord",
                    "value": "shlomo"
                },
                "references": {
                    "sentences": [
                        "Zeev Rabinovich and Ofir Shlomo<crlf>Microsoft 365 Defender Research Team"
                    ],
                    "titles": []
                }
            }
        },
        "sigma": false,
        "yara": false
    },
    "keywords": {
        "classified": [],
        "dubbed": [],
        "associated": [
            "This attribute is set to 10 by default, which means that any user in Active Directory can create up to 10 computer accounts associated with them",
            "However, if a compromised user doesnt have 10 actual devices associated with their account, an attacker can create an account for a non-existing device that will be an object in Active Directory",
            "This fake computer account isnt associated with a real device but can perform Active Directory authentication requests as if it were"
        ],
        "targets": [
            "Protecting against KrbRelayUp attacks through coordinated threat defense",
            "protecting against krbrelayup attacks through coordinated threat defense",
            "Its important to note that KrbRelayUp cannot be used in attacks against organizations that are only using Azure AD"
        ],
        "attributed": [
            "Step 2: Modification of the msDS-AllowedToActOnBehalfOfOtherIdentity attribute",
            "The final key concept behind the RBCD method of KrbRelayUp tool is the ms-DS-MachineAccountQuota attribute, which all User Active Directory objects have",
            "This attribute is set to 10 by default, which means that any user in Active Directory can create up to 10 computer accounts associated with them",
            "The legitimate usage of this attribute is to allow users to have multiple devices on a network that belong to them that they can then manage",
            "step 2: modification of the msds-allowedtoactonbehalfofotheridentity attribute",
            "Authenticates to the LDAP service by triggering and performing a Kerberos relay attack<crlf>Edits the msDS-AllowedToActOnBehalfOfOtherIdentity attribute to add the attackers resource to the list of entities permitted to delegate the target device.",
            "Organizations should also consider setting the ms-DS-MachineAccountQuota attribute to 0 to make it more difficult for an attacker to leverage the attribute for attacks",
            "Setting the attribute to 0 stops non-admin users from adding new devices to the domain, blocking the most effective method to carry out the attacks first step and forcing attackers to choose more complex methods to acquire a suitable resource",
            "Suspicious edit of the Resource Based Constrained Delegation Attribute by a machine account (KrbRelayUp)"
        ]
    },
    "resources": {
        "links": {
            "github": [
                "https://github.com/Dec0ne/KrbRelayUp"
            ],
            "pastebin": [],
            "text_files": [],
            "other": [
                "https://www.microsoft.com/security/business/threat-protection/identity-defender",
                "https://www.microsoft.com/security/business/threat-protection/microsoft-365-defender",
                "https://www.microsoft.com/en-us/wdsi/threats/threat-search?query=HackTool:MSIL/KrbUpRly",
                "https://msrc.microsoft.com/update-guide/vulnerability/ADV190023",
                "https://msrc-blog.microsoft.com/2009/12/08/extended-protection-for-authentication/",
                "https://msrc.microsoft.com/update-guide/vulnerability/ADV190023",
                "https://docs.microsoft.com/windows/win32/adschema/a-ms-ds-machineaccountquota?msclkid=a8456d5cce8b11ec9d1f0e37d0870e17",
                "https://www.microsoft.com/security/business/threat-protection/microsoft-365-defender",
                "https://msrc.microsoft.com/update-guide/vulnerability/ADV190023",
                "https://support.microsoft.com/topic/2020-ldap-channel-binding-and-ldap-signing-requirements-for-windows-kb4520412-ef185fb8-00f7-167d-744c-f299a66fc00a",
                "https://docs.microsoft.com/windows/win32/adschema/a-ms-ds-machineaccountquota?msclkid=a8456d5cce8b11ec9d1f0e37d0870e17",
                "https://www.microsoft.com/security/business/threat-protection/identity-defender",
                "https://www.microsoft.com/security/business/threat-protection/endpoint-defender",
                "https://docs.microsoft.com/microsoft-365/security/defender-endpoint/microsoft-defender-antivirus-windows?view=o365-worldwide",
                "https://docs.microsoft.com/microsoft-365/security/defender/threat-analytics?view=o365-worldwide",
                "https://www.microsoft.com/microsoft-365/security/microsoft-365-defender"
            ]
        },
        "images": [
            "https://www.microsoft.com/security/blog/uploads/securityprod/2022/05/Fig1-Microsoft-Defender-for-Identity-suspicious-Kerberos-delegation-attempt-1024x617.png",
            "https://www.microsoft.com/security/blog/uploads/securityprod/2022/05/Fig2-Microsoft-Defender-for-Endpoint-Kerberos-local-privilege-escalation-attack-alert-1024x525.png"
        ]
    }
}