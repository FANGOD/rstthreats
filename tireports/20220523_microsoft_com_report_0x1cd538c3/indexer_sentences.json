{"id": "sentence_0x9d8a8bda", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Microsoft 365 Defender Research Team"}
{"id": "sentence_0xde61e0a", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "How web skimming works"}
{"id": "sentence_0x23c26423", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Recent developments"}
{"id": "sentence_0xfafef486", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Malicious images with obfuscated script"}
{"id": "sentence_0x6898514b", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Concatenated and encoded skimming host URL"}
{"id": "sentence_0x39e1be6d", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Google Analytics and Meta Pixel script spoofing"}
{"id": "sentence_0xe3909e20", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Defending against web skimming"}
{"id": "sentence_0x4c5293fd", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Appendix"}
{"id": "sentence_0x9569f3e7", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Indicators of compromise"}
{"id": "sentence_0xe5705226", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "File hashes (SHA-256)"}
{"id": "sentence_0x33cfe2de", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Encoded URLs"}
{"id": "sentence_0xa86efca0", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Microsoft 365 Defender detections"}
{"id": "sentence_0x184b4d06", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xc7ec92c5", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Microsoft Defender Antivirus"}
{"id": "sentence_0xc56b3090", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x72c20d1d", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Microsoft security researchers recently observed that web skimming campaigns now employ various obfuscation techniques to deliver and hide skimming scripts. Its a shift from earlier tactics where attackers conspicuously injected malicious scripts into e-commerce platforms and content management systems (CMSs) via vulnerability exploitation, making this threat highly evasive to traditional security solutions. As of this writing, some of the latest skimming HTML and JavaScript files uploaded in VirusTotal have very low detection rates."}
{"id": "sentence_0x5051162d", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x72c20d1d", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Web skimming typically targets platforms like Magento, PrestaShop, and WordPress, which are popular choices for online shops because of their ease of use and portability with third-party plugins. Unfortunately, these platforms and plugins come with vulnerabilities that the attackers have constantly attempted to leverage. One notable web skimming campaign/group is Magecart, which gained media coverage over the years for affecting thousands of websites, including several popular brands."}
{"id": "sentence_0xddca8092", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x72c20d1d", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "In one of the campaigns weve observed, attackers obfuscated the skimming script by encoding it in PHP, which, in turn, was embedded inside an image filea likely attempt to leverage PHP calls when a websites index page is loaded. Recently, weve also seen compromised web applications injected with malicious JavaScript masquerading as Google Analytics and Meta Pixel (formerly Facebook Pixel) scripts. Some skimming scripts even had anti-debugging mechanisms, in that they first checked if the browsers developer tools were open."}
{"id": "sentence_0x53672185", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x72c20d1d", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "Given the scale of web skimming campaigns and the impact they have on organizations and their customers, a comprehensive security solution is needed to detect and block this threat. Microsoft 365 Defender provides a coordinated defense thats enriched by our visibility into attacker infrastructure and continuous monitoring of the threat landscape."}
{"id": "sentence_0xba2ef76e", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x72c20d1d", "chapter_title": "Beneath the surface: Uncovering the shift in web skimming", "text": "In this blog, we provide the technical details of the recent skimming campaigns obfuscation techniques. We also offer steps for defenders and users to protect themselves and their organizations from such attacks."}
{"id": "sentence_0x1e46bdb4", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xf72cd38c", "chapter_title": "How web skimming works", "text": "This primary goal of web skimming campaigns is to harvest and later exfiltrate users payment information, such as credit card details, during checkout. To achieve this, attackers typically take advantage of vulnerabilities in e-commerce platforms and CMSs to gain access to pages they want to inject the skimming script into. Another common method is web-based supply chain attacks, where attackers use vulnerabilities in installed third-party plugins and themes or compromise ad networks that may inevitably serve malicious ads without the site owners knowledge or consent."}
{"id": "sentence_0xda812d27", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xf72cd38c", "chapter_title": "How web skimming works", "text": "Figure 1. Overview of a web skimming attack"}
{"id": "sentence_0x1e1b4419", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xf72cd38c", "chapter_title": "How web skimming works", "text": "As mentioned earlier, one notable skimming campaign is Magecart. First observed in 2010, Magecart campaigns have increased in number and become stealthier through heavy obfuscation techniques, new injection points, and delivery methods. In the last five years, popular organizations or brands have been affected by Magecartfrom an airline company and online ticketing services to a sports brand and personal transporter. In 2019, tens of thousands of websites got compromised because of a misconfiguration in the cloud service provider where these sites were hosted. Such an increase in these types of attacks prompted the Payment Card Industry Security Standards Council (PCI SSC) to release a bulletin that warns users about the threat. In April 2022, PCI also released a major revision in its Data Security Standard (DSS), which now includes additional requirements for e-commerce environments to help prevent skimming."}
{"id": "sentence_0x146eab5b", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ed57b92", "chapter_title": "Recent developments", "text": "In their earlier iterations, most web skimming campaigns directly targeted unpatched e-commerce platforms like Magento. Also, the malicious JavaScript they injected were very conspicuous. However, as the campaigns attack vectors and routines evolved, attackers also started using different techniques to hide their skimming scripts."}
{"id": "sentence_0x560055c5", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "During our research, we came across two instances of malicious image files being uploaded to a Magento-hosted server. Both images contained a PHP script with a Base64-encoded JavaScript, and while they had identical JavaScript code, they slightly differed in their PHP implementation. The first image, disguised as a favicon (also known as a shortcut or URL icon), was available on VirusTotal, while the other one was a typical web image file discovered by our team. Their hashes are included in the section below."}
{"id": "sentence_0x36197c7a", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "We first observed the malicious favicon in November 2021, when a few campaigns started dropping remote access trojans (RATs) on target web servers, in addition to injecting scripts into web pages. This delivery method moves away from the usual modus; it appears that attackers are now targeting the server side to inject their scripts, enabling them to bypass conventional browser protections like Content Security Policy (CSP), which prevents the loading of any external scripts. Meanwhile, the more recent image file was uploaded on the /media/wysiwyg/ directory, most likely by leveraging a vulnerability in the Magento CMS."}
{"id": "sentence_0x789553a", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "The insertion of the PHP script in an image file is interesting because, by default, the web server wouldnt run the said code. Based on previous similar attacks, we believe that the attacker used a PHP include expression to include the image (that contains the PHP code) in the websites index page, so that it automatically loads at every webpage visit."}
{"id": "sentence_0xcbae3ba6", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "In both images cases, once the embedded PHP script was run, it first retrieved the current pages URL and looked for the checkout and onepage keywords, both of which are mapped to Magentos checkout page."}
{"id": "sentence_0x81d6b784", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 2. Screenshot of a Magento shopping cart page with the checkout keyword in the URL"}
{"id": "sentence_0x57e18fb2", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Before serving the skimming script, the PHP script also checked that administrator cookies werent set to ensure that a web admin isnt currently signed in. Such a check ensured that the script only targeted the site visitors (online shoppers)."}
{"id": "sentence_0x60c3dbe1", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 3. Portion of the PHP script that checks for admin cookies"}
{"id": "sentence_0x63a34aa7", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "The skimming script was encoded multiple times using hexadecimal (Base16) and then Base64. When decoded, it had an array of strings that were referenced and substituted further to construct a complete JavaScript code. Below are snippets of the decoded skimming script."}
{"id": "sentence_0x2d29fc66", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "The boms() function (Figure 4) was responsible for creating and serving the fake checkout payment form (Figure 5) that collected target users payment details."}
{"id": "sentence_0x42e3f1b5", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 4. Portion of the skimming script that creates and serves the fake checkout payment form"}
{"id": "sentence_0x7644c9b0", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 5. Sample screenshot of the fake checkout form that collects user payment details"}
{"id": "sentence_0x6de93e81", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "The said function is only triggered if the __ffse cookie value wasnt set to 236232342323626326most probably a check to ensure that the website isnt already infected."}
{"id": "sentence_0x69c39c83", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 6. Portion of the skimming script that checks for a specific cookie value"}
{"id": "sentence_0x239ad181", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "When the user submitted their details in the fake form, the glob_snsd() function is triggered (Figure 7), which then collected the said details in the form elements (input, select), encoded them in hex and Base64, and finally added them to the cookies (Figure 8)."}
{"id": "sentence_0xe5cd0f8f", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 7. Portion of the skimming script that launches the credential theft and exfiltration routines"}
{"id": "sentence_0x2525e224", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 8. Portion of the skimming script that performs the credential theft routine"}
{"id": "sentence_0x79eaa2a8", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "The encoded stolen information was then exfiltrated to an attacker-controlled C2 via PHP curl requests."}
{"id": "sentence_0x131cebb0", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xb5a7d1d1", "chapter_title": "Malicious images with obfuscated script", "text": "Figure 9. Portion of the skimming script that performs the exfiltration routine"}
{"id": "sentence_0xe4f858ee", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x6d075f98", "chapter_title": "Concatenated and encoded skimming host URL", "text": "We also came across four lines of JavaScript injected into a compromised webpage. Like the malicious images we previously analyzed, the script in this scenario would run only when it finds the checkout keyword in the target web page URL. It would then fetch the skimming script hosted on an attacker-controlled domain to load a fake checkout form."}
{"id": "sentence_0xee3b328c", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x6d075f98", "chapter_title": "Concatenated and encoded skimming host URL", "text": "The attacker-controlled domain was encoded in Base64 and concatenated from several strings. As of this writing, the said domain is still active."}
{"id": "sentence_0xe964cd40", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x6d075f98", "chapter_title": "Concatenated and encoded skimming host URL", "text": "Figure 10. Code snippet containing the concatenated and encoded URL that hosts the skimming script"}
{"id": "sentence_0x5bce2d7a", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x6d075f98", "chapter_title": "Concatenated and encoded skimming host URL", "text": "The skimming script itself wasnt obfuscated and had two main functions: getData() and __send(). getData() was responsible for getting form data on the web page, converting them to JSON, and passing it onto __send(). Interestingly, this function also checked for crawlers and other possible debugging attempts before skimming data. It specifically checked if the user had opened the browser developer tool, as seen in the snippet below:"}
{"id": "sentence_0x7080168e", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x6d075f98", "chapter_title": "Concatenated and encoded skimming host URL", "text": "if (devtools.open) return; if (/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)) return;"}
{"id": "sentence_0xd2da84d1", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x6d075f98", "chapter_title": "Concatenated and encoded skimming host URL", "text": "The __send() function, in turn, created an image object and prepared the URL for exfiltration. Note that while it formed the image, this function loaded the URL with the captured data in the dataparameter. The parameter value was also encoded in Base64."}
{"id": "sentence_0x7bc1b4fc", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x6d075f98", "chapter_title": "Concatenated and encoded skimming host URL", "text": "Figure 11. Snippet of the hosted script that exfiltrates web page data"}
{"id": "sentence_0x26d2272c", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "Attackers have also started masquerading as Google Analytics and Meta Pixel (formerly Facebook Pixel) scripts to trick site administrators or developers into thinking theyre looking at non-malicious codes, thus evading detection."}
{"id": "sentence_0x36390014", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "The screenshot below illustrates how a Base64-encoded string was placed inside a spoofed Google Tag Manager code. This string decoded to trafficapps[.]business/data[.]php?p=form."}
{"id": "sentence_0x7f775575", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "Figure 12. Encoded skimming script in a spoofed Google Analytics code"}
{"id": "sentence_0x384c5347", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "We also observed a similar technique where the skimming script mimicked Meta Pixels function parameters and JavaScript file name to avoid detection. Like the example in the previous section, the URL in this technique was encoded in Base64 and split into several strings. The concatenated string decoded to //sotech[.]fun/identity[.]js, and it contained obfuscated code. Interestingly, the decoded URL also had the query string d=GTM-34PX2SO, which is specific to Google Tag Manager and not Meta Pixel."}
{"id": "sentence_0xa4c38dcd", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "Figure 13. Encoded skimming script in a spoofed Meta Pixel code"}
{"id": "sentence_0xbae6cc3b", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "The attackers behind the Meta Pixel spoofing used newly registered domains (NRDs) hosted on HTTPS to carry out their attacks. All the domains we saw associated with this skimming campaign were registered around the same time via a popular budget hosting provider, as seen in the list below. However, the actual hosting sites were hidden behind Cloudflares infrastructure."}
{"id": "sentence_0x674b8022", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "sotech[.]fun created August 30, 2021 techlok[.]bar created September 3, 2021 dratserv[.]bar created September 15, 2021"}
{"id": "sentence_0xeef74c0a", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "The hosted script had multiple layers of obfuscation. Based on what we were able to partially de-obfuscate, not only did the code serve the skimming script, but it also did the following:"}
{"id": "sentence_0x4ef3fbc5", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "steal passwords input[name=billing[customer_password]] perform an anti-debugging technique function isDebugEnabled()"}
{"id": "sentence_0x2e1c64f9", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x4ff0a555", "chapter_title": "Google Analytics and Meta Pixel script spoofing", "text": "Figure 14. Snippet of the encoded skimming script"}
{"id": "sentence_0xb7b5ae6c", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xd27e41f5", "chapter_title": "Defending against web skimming", "text": "For organizations, the impact of web skimming campaigns could translate into monetary loss, reputation damage, and loss of customer trust. Web administrators and other defenders should therefore keep a close eye on such attacks. As it is, web skimming scripts closely resemble other JavaScript code used to perform legitimate business functions like web analytics. In addition, skimming scripts arent only found in HTML files; CSS, SVG, and other file types can also embed code that runs JavaScript once the related web pages load."}
{"id": "sentence_0x22e6dd9e", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xd27e41f5", "chapter_title": "Defending against web skimming", "text": "Given the increasingly evasive tactics employed in skimming campaigns, organizations should ensure that their e-commerce platforms, CMSs, and installed plugins are up to date with the latest security patches and that they only download and use third-party plugins and services from trusted sources. They must also perform a regular and thorough check of their web assets for any compromised or suspicious content. Among the similarities we found in these recent skimming scripts include the presence of Base64-encoded strings such as checkout and onepage and the presence of the atob() JavaScript function in compromised pages. Such clues could help defenders surface these malicious scripts."}
{"id": "sentence_0xa70d3707", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xd27e41f5", "chapter_title": "Defending against web skimming", "text": "Organizations should also complement best practices with a comprehensive security solution like Microsoft 365 Defender, which can detect and block skimming scripts on endpoints and servers by coordinating threat defense across various domains. Its also backed by threat experts whose continuous monitoring of the computing landscape for new attacker tools and techniques enriches our protection technologies. For example, in the case of Magecart, RiskIQ published a report that profiled the attacker groups behind it. Updates about the latest skimming campaigns observed are also provided."}
{"id": "sentence_0x68b73edc", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xd27e41f5", "chapter_title": "Defending against web skimming", "text": "Figure 15. Microsoft Defender for Endpoint detecting a web skimming malware"}
{"id": "sentence_0x4e905a1b", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xd27e41f5", "chapter_title": "Defending against web skimming", "text": "Meanwhile, online shoppers can protect themselves from web skimming attacks by ensuring their browser sessions are secure, especially during the checkout process. They should be wary of any unexpected or suspicious pop-ups that ask for payment details. Finally, users should turn on cloud-delivered protection and automatic sample submission on Microsoft Defender Antivirus (or a similar feature in their security product). This capability utilizes artificial intelligence and machine learning to quickly identify and stop new and unknown threats."}
{"id": "sentence_0x9d4b2a71", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xd27e41f5", "chapter_title": "Defending against web skimming", "text": "Learn how you can stop attacks through automated, cross-domain security with Microsoft 365 Defender."}
{"id": "sentence_0x1b4f2438", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xd27e41f5", "chapter_title": "Defending against web skimming", "text": "Microsoft 365 Defender Research Team"}
{"id": "sentence_0xaf118e2", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0xf21acbc9", "chapter_title": "File hashes (SHA-256)", "text": "a6fc14a7bb5e05c1d271add5b38744523fed01a18ce5578b965ee02e19589e77 b397e7ad2d00dcef4cf4ba5df363684b1fefcc64c23ab110032a7b2ebb77ab4a 88e9d5eddd24546ab78ce8db1eb474a20b9694f52d4c7ad976fbfa683b7ce635"}
{"id": "sentence_0x3d930583", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x279a53ea", "chapter_title": "Encoded URLs", "text": "Below is a list of Base64-encoded URLs injected in affected CMSs and their corresponding decoded values. These URLs host the malicious JavaScript the attackers use for web skimming."}
{"id": "sentence_0xf0be8682", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x30084fcb", "chapter_title": "Microsoft Defender Antivirus", "text": "Below are Microsoft detections that detect malicious JavaScript skimmers in web servers."}
{"id": "sentence_0x43178777", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x30084fcb", "chapter_title": "Microsoft Defender Antivirus", "text": "Magento skimmers"}
{"id": "sentence_0xaf0f58", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x30084fcb", "chapter_title": "Microsoft Defender Antivirus", "text": "TrojanSpy:JS/Banker.AA TrojanSpy:JS/SuspBanker.AA TrojanSpy:JS/MageBanker.CC TrojanSpy:JS/GTagManagerBanker.A TrojanSpy:JS/GTagManagerBanker.B TrojanSpy:JS/GenWebBanker.A TrojanSpy:JS/FbPixelSkimming.A TrojanSpy:JS/Banker.BB TrojanSpy:JS/PossibleSkimmer.A"}
{"id": "sentence_0xcc2ce774", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x30084fcb", "chapter_title": "Microsoft Defender Antivirus", "text": "WordPress WooCommerce skimmer"}
{"id": "sentence_0x7158f719", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x30084fcb", "chapter_title": "Microsoft Defender Antivirus", "text": "TrojanSpy:JS/WooCommBanker.BB"}
{"id": "sentence_0x798dc1d8", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x30084fcb", "chapter_title": "Microsoft Defender Antivirus", "text": "PrestaShop skimmer"}
{"id": "sentence_0xb90d58b7", "report_id": "report_0x1cd538c3", "report_date": "2022-05-23T00:00:00Z", "report_title": "Beneath the surface: Uncovering the shift in web skimming", "report_url": "https://www.microsoft.com/security/blog/2022/05/23/beneath-the-surface-uncovering-the-shift-in-web-skimming", "chapter_id": "chapter_0x30084fcb", "chapter_title": "Microsoft Defender Antivirus", "text": "TrojanSpy:JS/PrestaBanker.BB"}
