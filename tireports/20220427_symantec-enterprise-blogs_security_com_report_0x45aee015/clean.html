<div><figure class="author__image"><img alt="" src="https://symantec-enterprise-blogs.security.com/sites/default/files/styles/blogs_author_avatar_small/public/2017-10/author-profile-default.jpg.webp?h=6386ac74&amp;itok=yMcB1DYB" style="max-width:80%;height:auto;width:auto;"/></figure>Threat Hunter TeamSymantec<a class="twitter" href="https://twitter.com/intent/tweet?text=Stonefly%3A%20North%20Korea-linked%20Spying%20Operation%20Continues%20to%20Hit%20High-value%20Targets&amp;url=https%3A%2F%2Fsymantec-enterprise-blogs.security.com%2Fblogs%2Fthreat-intelligence%2Fstonefly-north-korea-espionage" rel="noopener" target="_blank" title="Twitter">Twitter</a><a class="linkedin" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fsymantec-enterprise-blogs.security.com%2Fblogs%2Fthreat-intelligence%2Fstonefly-north-korea-espionage&amp;token=&amp;isFramed=true" rel="noopener" target="_blank" title="LinkedIn">LinkedIn</a>SHAREPosted: 27 Apr, 20225 Min Read<a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence">Threat Intelligence</a>Follow<a href="https://twitter.com/threatintel" title="twitter">twitter</a><a href="https://www.linkedin.com/company/broadcomsoftware" title="linkedin">linkedin</a><h1 class="blog-post__title" id="page-title">Stonefly: North Korea-linked Spying Operation Continues to Hit High-value Targets</h1><h2 class="blog-post__subtitle">Espionage group focuses on obtaining classified or sensitive intellectual property that has civilian and military applications.</h2><p>The North Korean-linked Stonefly group is continuing to mount espionage attacks against highly specialized engineering companies with a likely goal of obtaining sensitive intellectual property.</p>
<p>Stonefly specializes in mounting highly selective targeted attacks against targets that could yield intelligence to assist strategically important sectors such as energy, aerospace, and military equipment. Virtually all of the technologies it appears to be interested in have military as well as civilian uses and some could have applications in the development of advanced weaponry.</p>
<h2>History of ambitious attacks</h2>
<p>Stonefly (aka DarkSeoul, BlackMine, Operation Troy, and Silent Chollima) first came to notice in July 2009, when it mounted distributed denial-of-service (DDoS) attacks against a number of South Korean, U.S. government, and financial websites.</p>
<p><a href="https://www.symantec.com/connect/blogs/backdoorprioxerinf-accidentally-stealthiest-file-infector-ever">It reappeared again in 2011</a>, when it launched more DDoS attacks, but also revealed an espionage element to its attacks when it was found to be using a sophisticated backdoor Trojan (Backdoor.Prioxer) against selected targets.</p>
<p><a href="https://www.symantec.com/connect/blogs/south-korean-banks-and-broadcasting-organizations-suffer-major-damage-cyberattack">In March 2013</a>, the group was linked to the Jokra (Tojan.Jokra) disk-wiping attacks against a number of South Korean banks and broadcasters. Three months later, the group was involved in a string of <a href="https://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war">DDoS attacks against South Korean government websites</a>.</p>
<p>In recent years, the group’s capabilities have grown markedly and, since at least 2019 Symantec has seen its focus shift solely to espionage operations against select, high-value targets. It now appears to specialize in targeting organizations that hold classified or highly sensitive information or intellectual property. Stonefly’s operations appear to be part of a broader North Korean-sponsored campaign to acquire information and intellectual property, with Operation Dream Job, a more wider-ranging trawl across multiple sectors, being carried out by another North Korean group, Pompilus.</p>
<h2>Latest target</h2>
<p>The most recent attack discovered by Symantec, a division of <a href="https://software.broadcom.com/">Broadcom Software</a>, was against an engineering firm that works in the energy and military sectors. The attackers breached the organization in February 2022, most likely by exploiting the <a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/apache-log4j-zero-day">Log4j vulnerability</a> (CVE-2021-44228) vulnerability on a public-facing VMware View server. The attackers then moved across the network and compromised 18 other computers.</p>
<p>17 hours later: Shortly after compromising the initial server, the attackers installed an updated version of Stonefly’s Backdoor.Preft malware (aka Dtrack, Valefor). The attackers then used a masqueraded version (file name: pvhost.exe) of <a href="https://www.putty.org/">PuTTY’s PSCP command line application</a>, presumably to exfiltrate data from the infected machine. Shortly after PSCP was executed, the credential-dumping tool Mimikatz (masquerading under the file name pl.exe) was run.</p>
<p>Day 2: Malicious activity resumed when <a href="https://github.com/3proxy/3proxy">3proxy tiny proxy server</a>, a publicly available proxy tool (file name: svhost.exe) was executed. Use of this tool continued for the next four days. A second suspected proxy tool was installed two days into this four day period (file name: tapi.exe). Several hours afterwards, a copy of the Preft backdoor (file name: svchost.exe) was installed. Two days later, <a href="https://winscp.net/">WinSCP</a>, an open-source SSH file-transfer tool was used, presumably to exfiltrate or upload data to the compromised computer.</p>
<p>Day 3: The next phase of the intrusion began on the following day, when Preft was executed and the attackers began moving latterly across the organization’s network, using <a href="https://github.com/Kevin-Robertson/Invoke-TheHash">Invoke-TheHash</a>, a publicly available PowerShell pass-the-hash utility (file name: rev.ps1), and wmiexec.py, <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py">a publicly available Impacket tool</a> used to run WMI commands (file name: notepad.exe).</p>
<h2>Updated Preft backdoor</h2>
<p>The attackers used an updated version of Stonefly’s custom Preft backdoor. Analysis of the backdoor revealed that it is a multistage tool:</p>
<p>Stage 1 is the main binary. A python script is used to unpack the binary and shellcode.</p>
<p>Stage 2 is shellcode. It performs the following actions:</p>
<ul>
<li>Sleeps for 19,999 seconds, probably in an attempt to evade sandbox detection</li>
<li>Opens a mutex, with the name specified in the Stage 3 shellcode</li>
<li>Instead of loading an executable file, it starts Internet Explorer (iexplore.exe) or explorer.exe and injects the Stage 3 shellcode into either. It sets up a named pipe ("\.\pipe\pipe") for communication. The file name of the main binary is sent over the pipe.</li>
</ul>
<p>Stage 3 is more shellcode.</p>
<p>Stage 4 is the payload. It is an HTTP remote access tool (RAT) that supports various commands, including:</p>
<ol>
<li>Download (Download a file and save locally)</li>
<li>Upload (Upload a file to a C&amp;C server)</li>
<li>Set Interval (Change C&amp;C server query interval - in minutes)</li>
<li>Shell Execute (Execute a command in the shell)</li>
<li>Download Plugin</li>
<li>Update (Download a new version and replace)</li>
<li>Info (Return debug information about the current infection)</li>
<li>Uninstall</li>
<li>Download Executable</li>
</ol>
<p>The malware can support four different kinds of plugins: executable files, VBS, BAT, and shellcode. It supports three different persistence modes: Startup_LNK, Service, Registry, and Task Scheduler.</p>
<h2>Custom information stealer</h2>
<p>Along with the Preft backdoor, Stonefly also deployed what appears to be a custom developed information stealer (infostealer). Analysis of this malware revealed that it is a three-staged threat. The main binary extracts and decrypts the encrypted shellcode with a modified RC4 algorithm.</p>
<p>Stage 2 is shellcode which retrieves the payload and decrypts it with the same modified RC4 algorithm. The decrypted payload is an executable file that is loaded in-memory. It is designed to search the infected computer for files using pre-configured parameters. These are then copied to temporary files before being copied to a single .zip file and the temporary files are removed. The ZIP file path is %TEMP/~[XXXXXXXX].tmp, where XXXXXXXX is a simple hash of the computer name (eight uppercase hex digits).</p>
<p>Curiously, this ZIP file is not automatically exfiltrated. It is possible that the exfiltration functionality was removed and the attackers planned to use an alternative means of exfiltration.</p>
<h2>High-value targets</h2>
<p>While Stonefly’s tools and tactics continue to evolve, there are some common threads between this recent activity and previous attacks, such as its ongoing development of the Preft backdoor and heavy reliance on open-source tools.</p>
<p>The group’s capabilities and its narrow focus on acquiring sensitive information make it one of the most potent North Korean cyber threat actors operating today.</p>
<h2>Protection/Mitigation</h2>
<p>For the latest protection updates, please visit the <a href="https://www.broadcom.com/support/security-center/protection-bulletin">Symantec Protection Bulletin</a>.</p>
<h2>Indicators of Compromise</h2>
<p>If an IOC is malicious and the file is available to us, Symantec Endpoint products will detect and block that file.</p>
<table><thead><tr><th>SHA256</th><th>	Description</th><th>	File name(s)</th></tr></thead><tbody><tr><td> 3b779a84c17a3a2b588241676ec372c543b592473dae9d6b14db0d0d33522f34 </td><td> 	3proxy tiny proxy server </td><td> svhost.exe </td></tr><tr><td> 7ab3f076e70350f06ad19863fdd9e794648020f621c0b1bd20ad4d80f0745142 </td><td> 	Backdoor.Preft </td><td> mf.exe, mp_updt.exe </td></tr><tr><td> 537dee22d8bc4867f45deddfa26c6d08a12c09e4fb5b539422e9b4d8fb0dff4a </td><td> 	Backdoor.Preft </td><td> 	svchost.exe </td></tr><tr><td> 586f30907c3849c363145bfdcdabe3e2e4688cbd5688ff968e984b201b474730 </td><td> 	Backdoor.Preft </td><td> 	svchost.exe </td></tr><tr><td> 453014da94a1382f9f11535b3d90a44d67f43c02ffe8688465956a3ed7e71743 </td><td> 	Backdoor.Preft </td><td> 	svchost.exe </td></tr><tr><td> d824eb45247f9b8e0266dc739425d80af4145062687d7e825e03adfac1b7e03b </td><td> 	Backdoor.Preft </td><td> 	svchost.exe </td></tr><tr><td> 414ed95d14964477bebf86dced0306714c497cde14dede67b0c1425ce451d3d7 </td><td> 	Backdoor.Preft </td><td> credit.exe, credits.exe </td></tr><tr><td> 30cd61f13d64562a41eb5e8a3d30cd46d8678acd9eef4c73386c3ea4adb50101 </td><td> 	Infostealer </td><td> 	mf.exe </td></tr><tr><td> 8637a4286d87a4fa3b6a102446f437058812be0d4ebb361ac8827ea4f186df23 </td><td> 	Infostealer </td><td> 	mf.exe </td></tr><tr><td> 551653deddb8d9a78c1a239cc2da99ea403ce203c5843384c986149d4c17f26c </td><td> 	Infostealer </td><td> 	mf.exe </td></tr><tr><td> b3458b3d0bb80029de30f41ffc8e318176cca650d76b75549089b8a436e8862a </td><td> 	Infostealer </td><td> 	mp_updt.exe </td></tr><tr><td> 9ca9f414b689fc903afb314016155814885966b0e30b21b642819d53ba94533c </td><td> 	Invoke-TheHash </td><td> 	rev.ps1 </td></tr><tr><td> 07b1b9d46a926084019c9e1a22ef724d7dd20fd85d144012dd4855ca66ad96fe </td><td> 	Mimikatz </td><td> 	pl.exe </td></tr><tr><td> 68d8f895135aab32f0b0f2520f1dd3ea791a0e0fec3e4e21d94040015bbbf096 </td><td> 	Mimikatz </td><td> 	pl.exe </td></tr><tr><td> 5a73fdd0c4d0deea80fa13121503b477597761d82cf2cfb0e9d8df469357e3f8 </td><td> 	PuTTY PSCP </td><td> 	pvhost.exe </td></tr><tr><td> 28d0e945f0648bed7b7b2a2139f2b9bf1901feec39ff4f6c0315fa58e054f44e </td><td> 	Real VNC Bypass Authentication Scanner </td><td> vnc.exe, aa.exe </td></tr><tr><td> 1a0e33a0e434e22e25a17b5d40fbef4fe900f075fcfa0dadd473010d03185e4a </td><td> 	Runasuser privilege escalation tool </td><td> 	sepm.exe </td></tr><tr><td> b4a85ef01b5d8058cf94f3e96c48d86ce89b20295e8d1125dc3fc1c799a75789 </td><td> 	Suspected proxy tool </td><td> 	tapi.exe </td></tr><tr><td> 0e20819e5584a31f00d242782c2071734d7e2377306e9ebd20dd435ce9c7d43a </td><td> 	Keylogger </td><td> avg.exe, wkeylogger.exe </td></tr><tr><td> 147187d4ca823187724205a7dbd6502a9409674e6602363d796218503c960e2f </td><td> 	Suspected SOCKS proxy tool </td><td> 	svhost.exe </td></tr><tr><td> 5e62d4851596e3fb939525fa4437c553ab5c6b9d12920af7740a3473102ccd1a </td><td> 	Unknown file </td><td> 	protect.exe </td></tr><tr><td> 7399605f47be3d8ed021c9189b6b102461d5dd98a9d9082c71ff368e13cf8541 </td><td> 	Unknown file </td><td> 	wax4315.tmp </td></tr><tr><td> cb6769bd80d5a234387bdaa907857ae478e2e693a157f29d97b8ce2db07856c1 </td><td> 	Unknown file </td><td> 	N/A </td></tr><tr><td> dda85ee1e0b4916ebd2eb7cbaeaa969843a19e7b8a9bb5d360a4bbc0bad91877 </td><td> 	Unknown file </td><td> 	smssvc.exe </td></tr><tr><td> bfa7adeda4597b70bf74a9f2032df2f87e07f2dbb46e85cb7c091b83161d6b0a </td><td> 	WinRAR (old version) </td><td> 	ra.exe </td></tr><tr><td> b7de7187f0f0281c17ae349b692f70892689ddf27b6b418142c809b41dfe3ce7 </td><td> 	WinSCP </td><td> 	winscp.com </td></tr><tr><td> de00c0111a561e88d62fd84f425a6febc72e01e2e927fb76d01603319a34b4b3 </td><td> 	WinSCP </td><td> 	winscp.exe </td></tr><tr><td> 14f0c4ce32821a7d25ea5e016ea26067d6615e3336c3baa854ea37a290a462a8 </td><td> 	wmiexec.py </td><td> 	notepad.exe </td></tr><tr><td> tecnojournals[.]com </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> semiconductboard[.]com </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> cyancow[.]com </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> bluedragon[.]com </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> hxxps://tecnojournals[.]com/review </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> hxxps://tecnojournals[.]com/general </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> hxxps://semiconductboard[.]com/xml </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> hxxps://semiconductboard[.]com/xcror </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> hxxp://cyancow[.]com/find </td><td> 	Domain </td><td> 	N/A </td></tr><tr><td> hxxps://bluedragon[.]com/login </td><td> 	Domain </td><td> 	N/A </td></tr></tbody></table><img alt="" src="https://symantec-enterprise-blogs.security.com/sites/default/files/styles/blogs_author_bio_small/public/2017-10/author-profile-default.jpg.webp?h=6386ac74&amp;itok=w8Rg1PQZ" style="max-width:80%;height:auto;width:auto;"/><h2 class="blog-author__title">About the Author</h2><h3 class="blog-author__name">Threat Hunter Team</h3><h4 class="blog-author__position">Symantec</h4><p>The Threat Hunter Team is a group of security experts within Symantec whose mission is to investigate targeted attacks, drive enhanced protection in Symantec products, and offer analysis that helps customers respond to attacks.</p><h2 class="blog-post__comment-title">Want to comment on this post?</h2><p>We encourage you to share your thoughts on your favorite social platform.</p><a class="twitter" href="https://twitter.com/intent/tweet?text=Stonefly%3A%20North%20Korea-linked%20Spying%20Operation%20Continues%20to%20Hit%20High-value%20Targets&amp;url=https%3A%2F%2Fsymantec-enterprise-blogs.security.com%2Fblogs%2Fthreat-intelligence%2Fstonefly-north-korea-espionage" rel="noopener" target="_blank" title="Twitter">Twitter</a><a class="linkedin" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fsymantec-enterprise-blogs.security.com%2Fblogs%2Fthreat-intelligence%2Fstonefly-north-korea-espionage&amp;token=&amp;isFramed=true" rel="noopener" target="_blank" title="LinkedIn">LinkedIn</a></div>