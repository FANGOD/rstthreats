<div>
<img alt="" class="hidden-social-img" src="https://labs.k7computing.com/wp-content/uploads/2022/04/VajraSpy-1.png" style="max-width:80%;height:auto;width:auto;"/>
<a class="uncategorized" href="https://labs.k7computing.com/index.php/category/android/">Android</a><a class="uncategorized" href="https://labs.k7computing.com/index.php/category/deceptive-apps/">Deceptive Apps</a>
<h1 class="entry-title">VajraSpy – An Android RAT</h1>
By DhanalakshmiApril 19, 2022
 
<p></p><p>Collecting high profile users’ private information is the trend in recent times. We came across a twitter post that described one such incident involving VajraSpy, an Android RAT that uses a designated Google Cloud Storage to store the data stolen from the user. <a href="https://twitter.com/LukasStefanko/status/1509451238366236674" rel="noopener" target="_blank">VajraSpy is used by APT-Q-43 (#VajraEleph) group targeting Pakistani military personnel</a>. VajraSpy appeared new and it disguises itself as a chat app called “Crazy Talk”. </p>
<p>Let’s get into the details of how this VajraSpy works. </p>
<p>Unzipping the CrazyTalk.apk sample showed that this is a Spy and includes more than one classes.dex as shown in Figure 1 and the other classes.dex files are loaded using Multidex support.</p>
<figure class="wp-caption aligncenter" id="attachment_23796"><img alt="" class="wp-image-23796 size-full" height="494" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_1.png" width="254"/><figcaption class="wp-caption-text" id="caption-attachment-23796">Figure 1: Spy with many classes.dex</figcaption></figure>
<p>This malware uses Firebase cloud Storage to store the data collected from a compromised device. </p>
<p>Analysis starts with the MainActivity of classes2.dex, the app’s entry point. MainActivity’s onCreate() function confirms that the app has “Notification Access” and “Accessibility Service” allowed and collects the Firebase Cloud Messaging (FCM) token as shown in Figure 2. </p>
<figure class="wp-caption aligncenter" id="attachment_23797"><img alt="" class="wp-image-23797 size-full" height="585" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_2.png" style="max-width:800px;height:auto;width:auto;" width="653"/><figcaption class="wp-caption-text" id="caption-attachment-23797">Figure 2: onCreate() confirming Notification Access and Accessibility Service</figcaption></figure>
<p>This app “CrazyTalk” impersonates a chat app and requests for the permissions as shown in Figure 3.</p>
<figure class="wp-caption aligncenter" id="attachment_23798"><img alt="" class="wp-image-23798 size-full" height="387" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_3.png" style="max-width:800px;height:auto;width:auto;" width="748"/><figcaption class="wp-caption-text" id="caption-attachment-23798">Figure 3: Permissions requested by the malware</figcaption></figure>
<p>This malware initializes the Firebase Storage as shown in Figure 4.</p>
<figure class="wp-caption aligncenter" id="attachment_23799"><img alt="" class="wp-image-23799 size-full" height="184" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_4.png" width="608"/><figcaption class="wp-caption-text" id="caption-attachment-23799">Figure 4: Firebase Storage initialization</figcaption></figure>
<p>After the FirebaseStorage initialization, this app collects the victim’s personal information by initiating an instance of the StorageReference object as shown in Figure 5. </p>
<figure class="wp-caption aligncenter" id="attachment_23800"><img alt="" class="wp-image-23800 size-full" height="483" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_5.png" style="max-width:800px;height:auto;width:auto;" width="948"/><figcaption class="wp-caption-text" id="caption-attachment-23800">Figure 5: StorageReference initialization to upload collected victim’s information</figcaption></figure>
<p>As shown in Figure 5, “putBytes()” function uploads the data (in our case here, it is contacts.json) to the Firebase Storage via the StorageReference object. </p>
<p>In addition to the above contacts.json, this malicious app also collects other user data like SMS messages, call logs, WhatsApp (including business accounts) messages, Signal app messages, device details, apps listed from the victims’ device as shown in Figure 6.</p>
<figure class="wp-caption aligncenter" id="attachment_23801"><img alt="" class="wp-image-23801 size-full" height="497" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_6.png" style="max-width:800px;height:auto;width:auto;" width="787"/><figcaption class="wp-caption-text" id="caption-attachment-23801">Figure 6: Collecting WhatsApp Business account and Signal app messages in JSON format</figcaption></figure>
<p>WhatsApp or WhatsAppBusiness or Signal messages are collected from a victim’s device and stored in a designated table in the SQLite DB which is then uploaded to the designated Firebase Cloud Storage as shown in Figures 7, 8 and 9. </p>
<figure class="wp-caption aligncenter" id="attachment_23802"><img alt="" class="wp-image-23802 size-full" height="562" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_7.png" style="max-width:800px;height:auto;width:auto;" width="943"/><figcaption class="wp-caption-text" id="caption-attachment-23802">Figure 7: Collecting WhatsAppBusiness messages</figcaption></figure>
<figure class="wp-caption aligncenter" id="attachment_23803"><img alt="" class="wp-image-23803 size-full" height="307" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_8_updated.png" style="max-width:800px;height:auto;width:auto;" width="865"/><figcaption class="wp-caption-text" id="caption-attachment-23803">Figure 8: Uploading collected WhatsApp messages metadata to entrywb table in FeedReaderwb.db</figcaption></figure>
<figure class="wp-caption aligncenter" id="attachment_23804"><img alt="" class="wp-image-23804 size-full" height="536" src="https://labs.k7computing.com/wp-content/uploads/2022/04/Figure_9.png" style="max-width:800px;height:auto;width:auto;" width="1013"/><figcaption class="wp-caption-text" id="caption-attachment-23804">Figure 9: WAB.json array creation from entrywb table in FeedReaderwb.db</figcaption></figure>
<p>One of the common ways to curtail the activity of a Spyware or any malware includes the detection of “C2” or the “URL” which the malware communicates to. Affirming the maliciousness of such applications that communicates and copies the user’s data to a legitimate hosting service or a server using the standard protocols and frameworks, becomes a knotty procedure. In recent times, Android malware’s poisoning of available standard frameworks and globally accepted services for malicious purposes is increasing. Users of “K7 Mobile Security” are protected against VajraSpy.</p>
<h2>Indicators of Compromise (IoCs)</h2>
<p>MD5: 0C980F475766F3A57F35D19F44B07666</p>
<p>Detection name: Spyware ( 005893111 )</p>
<p></p>
<h3 class="comment-reply-title">Like what you're reading? Subscribe to our top stories.</h3>
<p>If you want to subscribe to our monthly newsletter, please submit the form below.</p> Email* : 
<ul class="controls">
<li class="previous-post mouse-leaving">
<h3>Previous Post« <a href="https://labs.k7computing.com/index.php/cryptoclip-hijacker/" rel="prev">CryptoClip Hijacker</a>
</h3>
</li>
<li class="next-post mouse-leaving">
<h3>Next Post
</h3>
</li>
</ul>
<h3 class="related-title">More Posts</h3>
</div>