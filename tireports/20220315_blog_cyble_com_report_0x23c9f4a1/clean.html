<div>
<h1>A Possible Re-brand of Rook Ransomware</h1>
<p>Pandora ransomware came into the spotlight in March 2022 after targeting some high-profile victims on its leak site. The ransomware group announced its first victim on 21 Feb 2022 and has posted around five victims to date.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-10085 jetpack-lazy-image" height="387" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-1-Pandora-ransomware-data-leak-site.png" style="max-width:80%;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-10085" height="387" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-1-Pandora-ransomware-data-leak-site.png" style="max-width:80%;height:auto;width:auto;" width="936"/><figcaption>Figure 1: Pandora ransomware data leak site</figcaption></figure>
<p>During a routine threat hunting exercise, Cyble Research Labs came across the sample for this ransomware. Upon execution, the file encrypts the victim’s system and drops the ransom note in each folder named “Restore_My_Files.txt.” After encryption, the file is renamed with the extension “.Pandora“.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-10086 jetpack-lazy-image" height="385" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-2-Encrypted-Files.png" style="max-width:80%;height:auto;width:auto;" width="787"/><img alt="" class="wp-image-10086" height="385" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-2-Encrypted-Files.png" style="max-width:80%;height:auto;width:auto;" width="787"/><figcaption>Figure 2: Encrypted Files</figcaption></figure>
<h2 id="h-technical-analysis">Technical Analysis</h2>
<p>The malware (SHA 256: 5b56c5d86347e164c6e571c86dbf5b1535eae6b979fede6ed66b01e79ea33b7b) is packed using the UPX packer. After unpacking, the payload is compiled using Visual C++. The file has encrypted strings and several jumps and calls that can make debugging difficult, as shown below.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-10087 jetpack-lazy-image" height="372" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-3-Code-flow-of-Pandora-Ransomware.png" width="399"/><img alt="" class="wp-image-10087" height="372" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-3-Code-flow-of-Pandora-Ransomware.png" width="399"/><figcaption>Figure 3: Code flow of Pandora Ransomware</figcaption></figure>
<p>The malware runs a decryption loop that decrypts the strings present in the file, as shown in Figure 4. </p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-10088 jetpack-lazy-image" height="159" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-4-Decryption-Loop.png" width="451"/><img alt="" class="wp-image-10088" height="159" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-4-Decryption-Loop.png" width="451"/><figcaption>Figure 4: Decryption Loop</figcaption></figure>
<p>Initially, the malware creates a mutex named “ThisIsMutexa” using CreateMutexA() API to ensure that only one instance of the malware is running in the system.</p>
<figure class="wp-block-image aligncenter size-full is-resized"><img alt="" class="wp-image-10089 jetpack-lazy-image" height="114" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-5-Creates-Mutex.png" width="462"/><img alt="" class="wp-image-10089" height="114" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-5-Creates-Mutex.png" width="462"/><figcaption>Figure 5: Creates Mutex</figcaption></figure>
<p>The malware then loads ntdll.dll and calls the NtSetInformationProcess () API, which changes the privilege level and sets the malware file as a critical process. The malware then disables the Event Tracing for Windows (ETW) by patching the EtwEventWrite() function and further bypasses Antimalware Scan Interface (AMSI) to evade detection by Anti-Virus products.</p>
<p>The AMSI allows the integration of applications and processes with the anti-malware solution present on a system. AMSI scans files that are executed through PowerShell, Jscript, VBA, VBScript, etc.</p>
<p>The malware also calls SetProcessShutdownParameters() to reduce the process’s priority, i.e., set it to zero. This means that malware will be terminated last before the system shutdown so that the malware gets the maximum amount of time possible to execute in the compromised machine.</p>
<p>After altering the priority, the malware calls SHEmptyRecycleBinA() API to empty the recycle bin to ensure no deleted files are restored after encryption.</p>
<p>Like other ransomware, the malware deletes shadow copies using vssadmin using ShellExecuteW() API, as shown in Figure 6.</p>
<figure class="wp-block-image aligncenter size-full is-resized"><img alt="" class="wp-image-10091 jetpack-lazy-image" height="95" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-6-Deletes-shadow-copies.png" width="639"/><img alt="" class="wp-image-10091" height="95" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-6-Deletes-shadow-copies.png" width="639"/><figcaption>Figure 6: Deletes shadow copies</figcaption></figure>
<p>Before encrypting the machine, the malware gets the Volume details by calling the APIs such as:</p>
<ul><li>GetDriveTypeW()</li><li>FindFirstVolumeW()</li><li>FindNextVolumeW()</li><li>GetVolumePathNamesForVolumeNameW()</li><li>GetLogicalDrives()</li></ul>
<p>Before initiating encryption, the ransomware checks and excludes specific folders from encryption – such as AppData, Boot, Windows, Windows.old, Tor Browser, Internet Explorer, Google, Opera, Opera Software, Mozilla, Mozilla Firefox, ProgramData, Program Files, Program Files (x86).</p>
<p>The Ransomware also excludes certain files from encryption such as autorun.inf, boot.ini, bootfont.bin, bootsect.bak, bootmgr, bootmgr.efi, bootmgfw.efi, desktop.ini, iconcache.db, ntldr, ntuser.dat.</p>
<p>Additionally, specific extensions are also exempted from encryption – such as .pandora, .hta, .exe, .dll, .cpl, .ini, .cab, .cur, .drv, .hlp, .icl, .icns, .ico, .idx, .sys, .spl, .ocx.</p>
<p>Finally, the ransomware searches for files using FindFirstFileW() and FindNextFileW () APIs and then proceeds to encrypt them.</p>
<p>The malware uses multithreading approach for faster encryption. It calls CreateThread(), SetThreadAffinityMask(), ResumeThread(), CreteIOCompletionPort() and GetQueuedCompletionStatus() APIs for multithreading.</p>
<p>Finally, the ransom note is displayed, as shown in Figure 7.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-10092 jetpack-lazy-image" height="427" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-7-Ransom-note.png" style="max-width:80%;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-10092" height="427" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-7-Ransom-note.png" style="max-width:80%;height:auto;width:auto;" width="936"/><figcaption>Figure 7: Ransom note</figcaption></figure>
<h2>Possible ROOK ransomware re-brand:</h2>
<p>During our analysis, we found that the Tactic Technique and Procedures (TTPs) of the Pandora and ROOK ransomware shared a lot of similarities.</p>
<p>In Dec 2021, ROOK ransomware posted on their leak site claiming to have attacked one of the world’s largest automotive suppliers of technology and components. Following this, their leak site went down around the end of Jan 2022.</p>
<p>Pandora ransomware in March 2022 posted the same victim on their leak site. Due to this incident and the similarities in how they operate, it is suspected that Pandora might be a re-brand of ROOK ransomware.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-10094 jetpack-lazy-image" height="363" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-8-Pandora-ransomware-leak-site.png" style="max-width:80%;height:auto;width:auto;" width="911"/><img alt="" class="wp-image-10094" height="363" src="https://blog.cyble.com/wp-content/uploads/2022/03/Figure-8-Pandora-ransomware-leak-site.png" style="max-width:80%;height:auto;width:auto;" width="911"/><figcaption>Figure 8: Pandora ransomware leak site</figcaption></figure>
<h2>Conclusion </h2>
<p>There’s a good chance that Pandora ransomware is a re-brand of ROOK ransomware. We had observed similar behavior in the past when ransomware groups were coming up with new aliases when they were under scrutiny.</p>
<p>Pandora ransomware gang is suspected of leveraging the double extortion method where the TAs exfiltrate the victim’s data followed by data encryption. Then, they threaten to leak the exfiltrated data on their leak site or on cybercrime forums.</p>
<p>Organizations can mitigate such attacks by monitoring the darkweb and acting upon early warning indicators such as compromised credentials, data breaches, and identifying vulnerabilities traded on cybercrime forums.</p>
<h2>Our Recommendations: </h2>
<ul><li>Enforce password change policies for the network and critical business applications or consider implementing multi-factor authentication for all remote network access points.</li><li>Reduce the attack surface by ensuring that sensitive ports are not exposed on the Internet.</li><li>Conduct cybersecurity awareness programs for employees and contractors.</li><li>Implement a risk-based vulnerability management process for IT infrastructure to ensure that critical vulnerabilities and security misconfigurations are identified and prioritized for remediation.</li><li>Instruct users to refrain from opening untrusted links and email attachments without verifying their authenticity.</li><li>Deploy reputed anti-virus and internet security software package on your company-managed devices, including PCs, laptops, and mobile devices.</li><li>Turn on the automatic software update features on computers, mobiles, and other connected devices wherever possible and pragmatic.</li><li>Define and implement a backup process and secure those backup copies by keeping them offline or on a separate network </li></ul>
<h2>MITRE ATT&amp;CK® Techniques  </h2>
<figure class="wp-block-table"><table><tbody><tr><td>Tactic</td><td>Technique ID</td><td>Technique Name</td></tr><tr><td>Execution</td><td><a href="https://attack.mitre.org/techniques/T1059/" rel="noreferrer noopener" target="_blank">T1059</a></td><td>Command and Scripting Interpreter</td></tr><tr><td>Privilege Escalation</td><td><a href="https://attack.mitre.org/techniques/T1548">T1548</a>
<a href="https://attack.mitre.org/techniques/T1134">T1134</a></td><td>Abuse Elevation Control Mechanism 
Access Token Manipulation</td></tr><tr><td>Defense Evasion</td><td><a href="https://attack.mitre.org/techniques/T1112">T1112</a>
<a href="https://attack.mitre.org/techniques/T1027">T1027</a>
<a href="https://attack.mitre.org/techniques/T1562/001/">T1562.001</a></td><td>Modify Registry
 Obfuscated Files or Information 
Impair Defenses: Disable or Modify Tools</td></tr><tr><td>Discovery</td><td><a href="https://attack.mitre.org/techniques/T1082/">T1082</a>
<a href="https://attack.mitre.org/techniques/T1083">T1083</a></td><td>System Information Discovery
File and Directory Discovery</td></tr><tr><td>Impact</td><td><a href="https://attack.mitre.org/techniques/T1490/" rel="noreferrer noopener" target="_blank">T1490</a>
<a href="https://attack.mitre.org/techniques/T1489/" rel="noreferrer noopener" target="_blank">T1489</a>
<a href="https://attack.mitre.org/techniques/T1486/" rel="noreferrer noopener" target="_blank">T1486</a></td><td>Inhibit System Recovery 
Service Stop 
Data Encrypted for Impact</td></tr></tbody></table></figure>
<h2>Indicators of Compromise (IoCs):   </h2>
<figure class="wp-block-table"><table><tbody><tr><td>Indicators </td><td>Indicator type </td><td>Description </td></tr><tr><td>0c4a84b66832a08dccc42b478d9d5e1b 160320b920a5ef22ac17b48146152ffbef60461f 5b56c5d86347e164c6e571c86dbf5b1535eae6b979fede6ed66b01e79ea33b7b</td><td>Md5 SHA-1 SHA-256 </td><td>Executable binary</td></tr></tbody></table></figure>
<h2>About Us  </h2>
<p><a href="https://cyble.com/" rel="noreferrer noopener" target="_blank">Cyble</a> is a global threat intelligence SaaS provider that helps enterprises protect themselves from cybercrimes and exposure in the Darkweb. Its prime focus is to provide organizations with real-time visibility to their digital risk footprint. Backed by Y Combinator as part of the 2021 winter cohort, Cyble has also been recognized by Forbes as one of the top 20 Best Cybersecurity Start-ups To Watch In 2020. Headquartered in Alpharetta, Georgia, and with offices in Australia, Singapore, and India, Cyble has a global presence. To learn more about Cyble, visit <a href="https://cyble.com/" rel="noreferrer noopener" target="_blank">www.cyble.com</a>.   </p>
</div>