[
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x8c5a94e4",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "text": "DoubleZero is a newly emerging destructive malware targeting Ukrainian enterprises. The initial access vector is unknown, but eSentire Threat Intelligence assesses with medium confidence that the threat actor(s) was able to gain access to the infected machine(s) and escalate, or use, the existing administrative privileges to manually execute the malware.\nAs the Russia-Ukraine crisis continues, we assess that destructive malware will continue to be actively deployed to disrupt the operations of Ukrainian infrastructure.\nKey Takeaways:\nDoubleZero is the fifth wiper malware targeting Ukrainian organizations (previously we have observed WhisperGate, HermeticWiper, IsaacWiper and CaddyWiper samples).\nThe malware destroys the components responsible for Windows boot process and overwrites the files will null bytes.\nThe compilation timestamp was changed by the threat actor(s) to confuse the researchers and make it harder to evaluate how long ago the malware sample was written.\nTo achieve the full-scale disruption, the threat actor(s) would need to escalate their privileges or bypass the user account control (UAC) to fully compromise the system.\neSentire Threat Intelligence team has observed that the malware fails to run on Windows Servers."
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x9dd18ef4",
            "title": "Case Study",
            "text": "On March 22, 2022, the Computer Emergency Response Team of Ukraine (CERT-UA) released an advisory warning about the destructive DoubleZero malware found on March 17, 2022. The malicious activity is tracked under UAC-0088 and aimed to disrupt the operations of Ukrainian organizations."
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x6c40329f",
            "title": "DoubleZero Analysis",
            "text": "The ZIP archives are named ... !!!.zip which means Virusextremely dangerous!!!.zip and csrss.zip. The archives contain two files:\ncpcrs.exe\ncsrss.exe\nThe 32-bit executables are compiled with .NET and both executables have the same impash, or import hash, 2916dda3c80b39a540b60c072a91a915\n(the hash that is calculated based on the library/APIs used and their order within the executable file). It means that both files have the same functionality.\nThe compilation timestamp dates to May 28, 2071, which is not valid."
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x613694e7",
            "title": "Obfuscation",
            "text": "The .NET malware sample appears to be highly obfuscated (Exhibit 1).\nExhibit 1: Initial obfuscated .NET sample\nAfter the first round of de-obfuscation, we discovered that DoubleZero implements AES (block size 128-bit) encryption in EBC mode with PKCS padding, control flow and switch statements for additional code obfuscation as shown in Exhibit 2.\nExhibit 2: Obfuscation algorithm"
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x819a3f49",
            "title": "Enumeration",
            "text": "The sample enumerates the HKEY_CURRENT_USER, HKEY_USERS, HKEY_LOCAL_MACHINE registry keys including HKEY_LOCAL_MACHINE\\BCD00000000 (the key contains the boot configuration data that is required to boot up the Windows system) and subkeys using GetSubKeyNames, Registry.LocalMachine\nand Registry.CurrentUser properties to remove them later.\nThe malware also enumerates on the paths listed in Exhibit 3 using Regex to match as few characters as possible with (.*?), also known as lazy mode, and .* to match any character except for line terminators.\nThe paths queried:\n\\\\Users\\\\\\\\.*?\\\\\\\\Local Settings.*\n\\\\Users\\\\\\\\.*?\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Application Data.*\n\\\\Users\\\\\\\\.*?\\\\\\\\Start Menu.*\n\\\\Users\\\\\\\\.*?\\\\\\\\Application Data.*\n\\\\ProgramData\\\\\\\\Microsoft.*\n\\\\Users\\\\\\\\.*?\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Microsoft.*\n\\\\Users\\\\\\\\.*?\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\Microsoft.*\nExhibit 3: Enumerating the folders using regex\nThe following folders get concatenated together forming a path (Exhibit 4):\nProgramFiles(x86)\\Documents and Settings\nProgramFiles(x86)\\ProgramData\\Application Data\nProgramFiles(x86)\\Users\\All Users\nProgramFiles(x86)\\Users\\Default User\nExhibit 4: Folder concatenation\nIt is notable that the sample also enumerates through drivers (Exhibit 4) and C:\\Windows\\NTDS path. The NTDS file contains a database that stores Active Directory data, including information groups, group membership and user objects. It also includes the password hashes for all users in the domain. eSentire Threat Intelligence team observed that the malware does not run on the Windows Server.\nThe malware gets the root drive of the infected device and Operating System information using Environment.SystemDirectory\nand Environment.OSVersion properties (Exhibit 5).\nExhibit 5: Enumerating system directory and OS version\nDoubleZero attempts to get all logical drives on the infected computers (Exhibits 6-7).\nExhibit 6: GetLogicalDrives gets a bitmask representing the currently available disk drives\nExhibit 7: Checks if the drive name is valid\nThree DLLs (Dynamic Link Library) will be used in this sample (Exhibit 8):\nntdll.dll\nkernel32.dll\nuser32.dll\nExhibit 8: DLLs used in DoubleZero\nIn Exhibit 9, the variables highlighted in orange are some of the API calls available for use by DoubleZero:\nNtOpenFile: this function opens an existing file, directory, device or volume then returns a handle for the file object.\nNtFsControlFile: sends a control code to the specified file system or driver to perform specific action.\nRtlNtStatusToDosError: returns the system error code.\nRtlAdjustPrivilege: disables or enables a privilege from the calling thread or process.\nCloseHandle: closes handles to objects mention in Microsoft MSDN.\nGetFileSizeEx: gets the size of a file.\nGetLastError: receives the calling thread's last-error code value.\nExitWindowsEx: logs interactive user off, shuts down the system, or shuts down and restarts the system.\nExhibit 9: API calls via the appropriate DLLs\nIn addition to the API calls, the malware attempts to set the appropriate access control or full access rights to the following files to fill them with zeroes (Exhibit 10):\nBOOTMGR (boot manager) including BCD (Boot Configuration Data) file, which are responsible for Windows startup process.\nBOOTSECT.BAK, which is a backup of the BOOTSECT.DOS. that is created by default by old Windows operating systems when any boot modifications take place.\npagefile.sys, which supports system crash dumps and used to manage virtual memory.\nswapfile.sys, which is used in conjunction with pagefile.sys to free up the memory in RAM.\nExhibit 10: Modifying access control rights"
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x46715c43",
            "title": "Data Destruction",
            "text": "The NtFsControlFile is responsible for zeroing the data out with the IOCTL code FSCTL_SET_ZERO_DATA\n(0x980c8) if it was able to open the file with NtOpenFile API (Exhibit 11). The number of bytes to be zeroed out are equal to the size of the file.\nExhibit 11: API responsible for wiping the data\nAfter the sample finishes executing, the system will automatically restart, and the user will get a prompt that the BCD\nfile is missing or corrupted (Exhibit 12). The executables need to be run as an Administrator for it to gain the full access to the system files and registry keys to proceed with deletion/wiping process. If the executables are opened as a user without UAC privilege elevation the malware only wipes the files under C:\\Users and the system shuts down after.\nExhibit 12: Missing \\Boot\\BCD file (error)"
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0xcf528717",
            "title": "What eSentire is doing about it",
            "text": "Our Threat Response Unit (TRU) combines threat intelligence gleaned from research, security incidents, and the external threat landscape to create actionable outcomes for our customers. We are taking a holistic response approach to combat modern destructive malware by deploying countermeasures, such as:\nDetections to identify and prevent Double Zero Wiper are in place across eSentire MDR for Endpoint and Log products\nThreat hunts have been performed for indicators associated with DoubleZero malware"
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x1e442319",
            "title": "Recommendations from eSentires Threat Response Unit (TRU)",
            "text": "We recommend implementing the following controls to help secure your organization against the DoubleZero malware:\nConfirm that all devices are protected with Endpoint Detection and Response (EDR) solutions\nImplement a Cyber Security Awareness Training Program that educates the employees about the threat landscape\nEnsure the role-based access control (RBAC) that restricts system access to authorized users is in place\nImplement a Vulnerability Management Program that helps identify and prioritize high severity vulnerabilities.\nPatch any external-facing applications and devices as well as enforce strong password policies\nWhile the Tactics, Techniques, and Procedures (TTPs) used by adversaries grow in sophistication, they lead to a limited set of choke points at which critical business decisions must be made. Intercepting the various attack paths utilized by the modern threat actor requires actively monitoring the threat landscape, developing, and deploying endpoint detection, and the ability to investigate logs & network data during active intrusions.\neSentires Threat Response Unit (TRU) is a world-class team of threat researchers who develop new detections enriched by original threat intelligence and leverage new machine learning models that correlate multi-signal data and automate rapid response to advanced threats.\nIf youre not currently engaged with an MDR provider, eSentire MDR can help you reclaim the advantage and put your business ahead of disruption.\nLearn what it means to have an elite team of Threat Hunters and Researchers that works for you. Connect with an eSentire Security Specialist."
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x14d6fee0",
            "title": "Appendix",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0xf46f43ac",
            "title": "Sources",
            "text": "https://cert.gov.ua/article/38088"
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0xf74d2f6d",
            "title": "Indicators of Compromise",
            "text": "",
            "table": "0;1\nName;File Hash (SHA-256)\n\u0412\u0438\u0440\u0443\u0441... \u043a\u0440\u0430\u0439\u043d\u0435 \u043e\u043f\u0430\u0441\u043d\u043e!!!.zip;d897f07ae6f42de8f35e2b05f5ef5733d7ec599d5e786d3225e66ca605a48f53\ncsrss.zip;8dd8b9bd94de1e72f0c400c5f32dcefc114cc0a5bf14b74ba6edc19fd4aeb2a5\ncpcrs.exe (DoubleZero);3b2e708eaa4744c76a633391cf2c983f4a098b46436525619e5ea44e105355fe\ncsrss.exe (DoubleZero);30b3cbe8817ed75d8221059e4be35d5624bd6b5dc921d4991a7adc4c3eb5de4a\n"
        }
    },
    {
        "report": {
            "id": "report_0xcdd20d2",
            "date": "20220406",
            "title": "eSentire Threat Intelligence Malware Analysis: DoubleZero",
            "url": "https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-doublezero"
        },
        "chapter": {
            "id": "chapter_0x5b39fa74",
            "title": "Yara Rules",
            "text": "import \"pe\"\nimport \"math\"\nrule DoubleZero {\nmeta:\nauthor = \"eSentire TI\"\ndate = \"03/24/2022\"\nversion = \"1.0\"\nstrings:\n$file = \"Microsoft.NET\" wide fullword nocase // .NET binary\n$api1 = \"NtFsControlFile\" // send a control code to the file system\n$api2 = \"CreateDecryptor\" // create the AES decryptor\n$api3 = \"set_UseShellExecute\" // use OS shell to start the process\n$api4 = \"FsctlSetZeroData\" // zero out the data\n$access_api1 = \"RtlAdjustPrivilege\" // modify the privileges\n$access_api2 = \"AddAccessRule\" // add a rule to the list of rules within a FileSystemSecurity object\ncondition:\nfor any i in (0..pe.number_of_sections - 1): (\nmath.entropy(pe.sections[i].raw_data_offset, pe.sections[i].raw_data_size) >=4\nand pe.sections[i].name == \".text\" ) and\nall of ($api*) and all of ($access_api*) and $file and\n(uint16(0) == 0x5A4D or uint32(0) == 0x4464c457f)\nand filesize < 500KB\n}"
        }
    }
]