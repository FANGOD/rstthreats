{
    "id": "<report_0xb8e09889>",
    "url": "https://blog.lumen.com/windows-subsystem-for-linux-wsl-threats/?utm_source=rss&utm_medium=rss&utm_campaign=windows-subsystem-for-linux-wsl-threats",
    "title": "Windows Subsystem for Linux (WSL): Threats Still Lurk Below the (Sub)Surface",
    "meta": [
        {
            "id": "<chapter_0xd17fb494>",
            "title": "Windows Subsystem for Linux (WSL): Threats Still Lurk Below the (Sub)Surface",
            "title_level": 1,
            "sentences": [
                {
                    "id": "<sentence_0xa55f77a9>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x3aea237b>": "https://blog.lumen.com/author/black-lotus-labs/",
                        "<img_0xbd51f919>": "https://blog.lumen.com/wp-content/uploads/2021/01/BLL-Square-No-Border-65x65.png"
                    },
                    "text": "Black Lotus Labs",
                    "html": "<a href=\"https://blog.lumen.com/author/black-lotus-labs/\"><img alt=\"\" class=\"avatar pp-user-avatar avatar-60 photo\" height=\"60\" src=\"https://blog.lumen.com/wp-content/uploads/2021/01/BLL-Square-No-Border-65x65.png\" width=\"60\"/>Black Lotus Labs</a>"
                },
                {
                    "id": "<sentence_0x11fc49c2>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Posted On March 24, 2022",
                    "html": "\n\t\t\t \t\t\tPosted On March 24, 2022\t\t\t \t\t\n"
                },
                {
                    "id": "<sentence_0xbf02127>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xdd0982ec>": "https://blog.lumen.com/windows-subsystem-for-linux-wsl-threats/#respond"
                    },
                    "text": "0",
                    "html": "<a href=\"https://blog.lumen.com/windows-subsystem-for-linux-wsl-threats/#respond\">0</a>"
                }
            ]
        }
    ],
    "chapters": [
        {
            "id": "<chapter_0x4c88b3ea>",
            "title": "Windows Subsystem for Linux (WSL): Threats Still Lurk Below the (Sub)Surface",
            "title_level": 1,
            "sentences": [
                {
                    "id": "<sentence_0x2766ae20>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xe791ede5>": "https://blog.lumen.com/#facebook"
                    },
                    "text": "Facebook",
                    "html": "<a class=\"a2a_button_facebook\" href=\"/#facebook\" rel=\"nofollow noopener\" target=\"_blank\" title=\"Facebook\">Facebook</a>"
                },
                {
                    "id": "<sentence_0x40859d9b>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x16e422b6>": "https://blog.lumen.com/#twitter"
                    },
                    "text": "Twitter",
                    "html": "<a class=\"a2a_button_twitter\" href=\"/#twitter\" rel=\"nofollow noopener\" target=\"_blank\" title=\"Twitter\">Twitter</a>"
                },
                {
                    "id": "<sentence_0xb7932907>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x2ca29426>": "https://blog.lumen.com/#linkedin"
                    },
                    "text": "LinkedIn",
                    "html": "<a class=\"a2a_button_linkedin\" href=\"/#linkedin\" rel=\"nofollow noopener\" target=\"_blank\" title=\"LinkedIn\">LinkedIn</a>"
                },
                {
                    "id": "<sentence_0x58f88460>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xffcf04cf>": "https://blog.lumen.com/#pinterest"
                    },
                    "text": "Pinterest",
                    "html": "<a class=\"a2a_button_pinterest\" href=\"/#pinterest\" rel=\"nofollow noopener\" target=\"_blank\" title=\"Pinterest\">Pinterest</a>"
                },
                {
                    "id": "<sentence_0xaae76d01>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x7e4167cf>": "https://blog.lumen.com/#email"
                    },
                    "text": "Email",
                    "html": "<a class=\"a2a_button_email\" href=\"/#email\" rel=\"nofollow noopener\" target=\"_blank\" title=\"Email\">Email</a>"
                },
                {
                    "id": "<sentence_0x316f189d>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xf2225f08>": "https://www.addtoany.com/share#url=https%3A%2F%2Fblog.lumen.com%2Fwindows-subsystem-for-linux-wsl-threats%2F&title=Windows%20Subsystem%20for%20Linux%20(WSL)%3A%20Threats%20Still%20Lurk%20Below%20the%20(Sub)Surface"
                    },
                    "text": "Share",
                    "html": "<a class=\"a2a_dd addtoany_share_save addtoany_share\" href=\"https://www.addtoany.com/share#url=https%3A%2F%2Fblog.lumen.com%2Fwindows-subsystem-for-linux-wsl-threats%2F&amp;title=Windows%20Subsystem%20for%20Linux%20(WSL)%3A%20Threats%20Still%20Lurk%20Below%20the%20(Sub)Surface\">Share</a>"
                }
            ]
        },
        {
            "id": "<chapter_0x5affa1b7>",
            "title": "Executive Summary",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x9f14b5f3>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x8487bb76>": "https://blog.lumen.com/no-longer-just-theory-black-lotus-labs-uncovers-linux-executables-deployed-as-stealth-windows-loaders/"
                    },
                    "text": "Last fall, Black Lotus Labs discovered in the wild what had until then only been theorized: Linux binaries were being used as loaders in Windows Subsystem for Linux (WSL). Since our initial report, Black Lotus Labs continues to monitor the WSL attack surface for new developments. In the last few months, we have identified several different samples that indicate the capability is evolving. Custom developed and open-source tools (OSTs) have added functionality ranging from shellcode injection to keylogging and password stealing that could be used by actors to evade detection while gaining access into endpoints and computer networks. Given the demonstrated interest and the fact that even the samples with valid command and control (C2) infrastructure are evading general detection by AV providers, it is clear this newly proven type of attack remains one to be watched. In particular, because the types of users running WSL tend to have greater network privileges, organizations that utilize WSL as part of their day-to-day operations should take note to better bolster defenses.",
                    "html": "<p>Last fall, Black Lotus Labs discovered in the wild what had until then only been theorized: Linux binaries were being used as loaders in Windows Subsystem for Linux (WSL). Since our <a href=\"https://blog.lumen.com/no-longer-just-theory-black-lotus-labs-uncovers-linux-executables-deployed-as-stealth-windows-loaders/\" rel=\"noopener\" target=\"_blank\">initial report</a>, Black Lotus Labs continues to monitor the WSL attack surface for new developments. In the last few months, we have identified several different samples that indicate the capability is evolving. Custom developed and open-source tools (OSTs) have added functionality ranging from shellcode injection to keylogging and password stealing that could be used by actors to evade detection while gaining access into endpoints and computer networks. Given the demonstrated interest and the fact that even the samples with valid command and control (C2) infrastructure are evading general detection by AV providers, it is clear this newly proven type of attack remains one to be watched. In particular, because the types of users running WSL tend to have greater network privileges, organizations that utilize WSL as part of their day-to-day operations should take note to better bolster defenses.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x2c699442>",
            "title": "Introduction",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0xd57b0694>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Since September 2021, as part of our proactive threat hunting process, Black Lotus Labs has been monitoring malware repositories for compiled ELF binaries that utilize either Windows API calls or file paths embedded in the executable. Because they were obtained through these repositories, the initial access vectors into the machines or networks are not yet known. As WSL requires domain administrative access to install, it is likely the targeted environments already had WSL loaded prior to the attacks.",
                    "html": "<p>Since September 2021, as part of our proactive threat hunting process, Black Lotus Labs has been monitoring malware repositories for compiled ELF binaries that utilize either Windows API calls or file paths embedded in the executable. Because they were obtained through these repositories, the initial access vectors into the machines or networks are not yet known. As WSL requires domain administrative access to install, it is likely the targeted environments already had WSL loaded prior to the attacks.</p>"
                },
                {
                    "id": "<sentence_0x547aa609>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Of the roughly 100 samples weve inspected over the last six months, we grouped a subset of the most noteworthy into two categories: the first group is comprised of custom developed tools and the second group consists of tools either taken completely from open-source frameworks or very lightly modified versions of open-source tools. By sharing how these samples work, how they persist and how they leverage C2 channels, we hope to keep the industry updated on the evolution of this attack vector and to aid in network-based detection, where possible. Some of the samples contained non-routable, or private IP addresses: we included them to showcase the techniques that are being developed for broader awareness.",
                    "html": "<p>Of the roughly 100 samples we\u2019ve inspected over the last six months, we grouped a subset of the most noteworthy into two categories: the first group is comprised of custom developed tools and the second group consists of tools either taken completely from open-source frameworks or very lightly modified versions of open-source tools. By sharing how these samples work, how they persist and how they leverage C2 channels, we hope to keep the industry updated on the evolution of this attack vector and to aid in network-based detection, where possible. Some of the samples contained non-routable, or private IP addresses: we included them to showcase the techniques that are being developed for broader awareness.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x63441220>",
            "title": "Custom Modules",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x6cd07951>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Several samples we analyzed were custom-built modules exhibiting a range of functionality that included keylogging, shellcode injection, a stager and even a cross-platform agent that worked in both Windows and Linux. The increase in custom modules suggests the WSL attack surface is a growing area of interest. While many of the samples did not yet appear to be fully functional due to the use of internal or non-routable IPs, they demonstrate attack methods that are actively being tested and refined.",
                    "html": "<p>Several samples we analyzed were custom-built modules exhibiting a range of functionality that included keylogging, shellcode injection, a stager and even a cross-platform agent that worked in both Windows and Linux. The increase in custom modules suggests the WSL attack surface is a growing area of interest. While many of the samples did not yet appear to be fully functional due to the use of internal or non-routable IPs, they demonstrate attack methods that are actively being tested and refined.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x32ead128>",
            "title": "Keyjeek Keylogger Utilizing Gmail",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0xdb72fc47>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "One of the payloads we analyzed was a keylogger written in Python that the developer named Keyjeeklogger. This sample wrote the recorded keyboard and mouse events to a text file named LogFile.txt. It then used hard-coded credentials for the email account nomotikag33n@gmail[.]com and a predefined password to transfer the LogFile.txt file to the actor. One function it displayed was the ability to edit a registry key (HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run), a common method used by threat actors to persist on an infected machine past reboot. This sample appeared to be the most developed of those in the custom modules and is likely active in the wild given its routable C2 mechanism. This sample had a detection rate of only 1/60 on VirusTotal when it was found.",
                    "html": "<p>One of the payloads we analyzed was a keylogger written in Python that the developer named \u201cKeyjeeklogger.\u201d This sample wrote the recorded keyboard and mouse events to a text file named \u201cLogFile.txt.\u201d It then used hard-coded credentials for the email account nomotikag33n@gmail[.]com and a predefined password to transfer the LogFile.txt file to the actor. One function it displayed was the ability to edit a registry key (HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run), a common method used by threat actors to persist on an infected machine past reboot. This sample appeared to be the most developed of those in the custom modules and is likely active in the wild given its routable C2 mechanism. This sample had a detection rate of only 1/60 on VirusTotal when it was found.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0xc8adecdc>",
            "title": "Shellcode Injector",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0xe37acd47>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "One of the samples we analyzed included a shellcode injector. This malware created a new thread to download shellcode from a remote resource such as a domain or IP address, and then execute the shellcode. While the sample we analyzed was only comprised of a stager with a non-routable IP address, it could easily be augmented to download a more sophisticated in-memory agent such as Cobalt Strike or a custom framework. The method of injecting the payload directly into memory can be elusive and complicate host-based detection since the agent is not written to disk.",
                    "html": "<p>One of the samples we analyzed included a shellcode injector. This malware created a new thread to download shellcode from a remote resource such as a domain or IP address, and then execute the shellcode. While the sample we analyzed was only comprised of a stager with a non-routable IP address, it could easily be augmented to download a more sophisticated in-memory agent such as Cobalt Strike or a custom framework. The method of injecting the payload directly into memory can be elusive and complicate host-based detection since the agent is not written to disk.</p>"
                },
                {
                    "id": "<sentence_0x5dc479e0>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<img_0xd303181c>": "https://blog.lumen.com/wp-content/uploads/2022/03/xFigure1_shellcode-injector.jpg.pagespeed.ic.HkZEn88bpA.webp"
                    },
                    "text": "Figure 1: Shellcode injector sample screenshot",
                    "html": "<p><img alt=\"Figure1\" class=\"aligncenter wp-image-13541 size-full\" height=\"586\" src=\"https://blog.lumen.com/wp-content/uploads/2022/03/xFigure1_shellcode-injector.jpg.pagespeed.ic.HkZEn88bpA.webp\" width=\"936\"/>Figure 1: Shellcode injector sample screenshot</p>"
                }
            ]
        },
        {
            "id": "<chapter_0xf31ef97d>",
            "title": "Stub.py Stager",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0x3c5b334c>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Among the samples we analyzed was a more traditional stager the actor named stub.py. This sample launched a Python script using the bash terminal and reached out for a remote resource. If it was unable to retrieve the next payload, it went to sleep for one second and then tried again. To further evade detection, the next agent was downloaded as a Python file, rather than an executable. Once downloaded onto the infected host Python file decrypted the data using a hard-coded key, and the script changed the file extension from Python to an executable. It then copied the payload to the \\Microsoft\\Windows\\Start Menu\\Programs\\Startup folder, granting persistence by initiating the executable whenever the machine was powered on. Lastly, it executed the payload via the command shell. This sample contained a non-routable IP address suggesting it is still in development.",
                    "html": "<p>Among the samples we analyzed was a more traditional stager the actor named \u201cstub.py.\u201d This sample launched a Python script using the bash terminal and reached out for a remote resource. If it was unable to retrieve the next payload, it went to sleep for one second and then tried again. To further evade detection, the next agent was downloaded as a Python file, rather than an executable. Once downloaded onto the infected host Python file decrypted the data using a hard-coded key, and the script changed the file extension from Python to an executable. It then copied the payload to the \\Microsoft\\Windows\\Start Menu\\Programs\\Startup folder, granting persistence by initiating the executable whenever the machine was powered on. Lastly, it executed the payload via the command shell. This sample contained a non-routable IP address suggesting it is still in development.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x435c0d65>",
            "title": "Windows and Linux Cross-Platform Lee Agent",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0xc27cda41>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "One malware sample that stood out from the rest contained logic to run on either Linux or WSL machines. This sample appeared to be the closest to a fully functional agent, with the ability to remotely upload and download files, as well as run arbitrary commands. However, as it did not contain a routable C2 mechanism, it appeared to still be in the development phase. Notably, it was the only sample Black Lotus Labs analyzed that was written in Python 2, whereas all the other samples were compiled in Python 3. Additionally, the Lee agent contained a PDB path from the developers machine: /home/dirty/Desktop/lee/master/agent/d/agent.py.",
                    "html": "<p>One malware sample that stood out from the rest contained logic to run on either Linux or WSL machines. This sample appeared to be the closest to a fully functional agent, with the ability to remotely upload and download files, as well as run arbitrary commands. However, as it did not contain a routable C2 mechanism, it appeared to still be in the development phase. Notably, it was the only sample Black Lotus Labs analyzed that was written in Python 2, whereas all the other samples were compiled in Python 3. Additionally, the Lee agent contained a PDB path from the developer\u2019s machine: /home/dirty/Desktop/lee/master/agent/d/agent.py.</p>"
                },
                {
                    "id": "<sentence_0x21979821>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "This agent contained predefined logic to perform the following functions:",
                    "html": "<p>This agent contained predefined logic to perform the following functions:</p>"
                },
                {
                    "id": "<sentence_0x8cc1f01>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x31b9e056>": "https://blog.lumen.com/wp-content/uploads/2022/03/xTable1_Lee-agent_REV.png.pagespeed.ic.bWBCHJJ811.webp"
                    },
                    "text": "",
                    "html": "<p><img alt=\"Table1\" class=\"aligncenter wp-image-13553 size-full\" height=\"208\" src=\"https://blog.lumen.com/wp-content/uploads/2022/03/xTable1_Lee-agent_REV.png.pagespeed.ic.bWBCHJJ811.webp\" width=\"698\"/></p>"
                },
                {
                    "id": "<sentence_0xbf11bb5a>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The Lee agent also had the ability to persist on Linux and Windows machines. In Linux machines it edited the AutoStart directory path: ~/.config/autostart/gedit.desktop.",
                    "html": "<p>The Lee agent also had the ability to persist on Linux and Windows machines. In Linux machines it edited the AutoStart directory path: ~/.config/autostart/gedit.desktop.</p>"
                },
                {
                    "id": "<sentence_0xa6cc292d>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "In a Windows machine, it modified the run key in the Windows registry to add a task named lee:<crlf>reg add HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /f /v lee /t REG_SZ /d %s.",
                    "html": "<p>In a Windows machine, it modified the run key in the Windows registry to add a task named \u201clee\u201d:\nreg add HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /f /v lee /t REG_SZ /d \u201c%s\u201d.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x39f8cfd3>",
            "title": "Open-Source Tools and Modules",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0xe6d40ad9>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "While we were evaluating samples, we found several agents that were largely based on OSTs found on websites like GitHub. OSTs offer tooling that minimizes the need for actors to develop their own, which can increase the cost. One interesting observation was that all of the OST-based samples also relied upon third-party services such as Discord and Telegram. We suspect that by using third-party network services and operating in a nebulous subsystem space, threat actors may be trying to evade some standard detection mechanisms.",
                    "html": "<p>While we were evaluating samples, we found several agents that were largely based on OSTs found on websites like GitHub. OSTs offer tooling that minimizes the need for actors to develop their own, which can increase the cost. One interesting observation was that all of the OST-based samples also relied upon third-party services such as Discord and Telegram. We suspect that by using third-party network services and operating in a nebulous subsystem space, threat actors may be trying to evade some standard detection mechanisms.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x889b3d34>",
            "title": "DiscordRAT",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0xd11da127>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xb416dd11>": "https://github.com/Sp00p64/DiscordRAT"
                    },
                    "text": "One of the samples leveraged a project called DiscordRAT, a remote administration tool (RAT) that is controlled over Discord and contains more than 20 post-exploitation modules. This sample exhibited a range of functions that appear to have been copied straight from the tool, such as:",
                    "html": "<p>One of the samples leveraged a project called <a href=\"https://github.com/Sp00p64/DiscordRAT\" rel=\"noopener\" target=\"_blank\">DiscordRAT</a>, a remote administration tool (RAT) that is controlled over Discord and contains more than 20 post-exploitation modules. This sample exhibited a range of functions that appear to have been copied straight from the tool, such as:</p>"
                },
                {
                    "id": "<sentence_0xe9d60330>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Check if running as admin<crlf>Execute arbitrary commands<crlf>Upload/download files<crlf>Take screenshots and access webcam<crlf>Start/stop a keylogger<crlf>Copy the contents of the clipboard<crlf>Kill the current session with the RAT",
                    "html": "<ul>\n<li>Check if running as admin</li>\n<li>Execute arbitrary commands</li>\n<li>Upload/download files</li>\n<li>Take screenshots and access webcam</li>\n<li>Start/stop a keylogger</li>\n<li>Copy the contents of the clipboard</li>\n<li>Kill the current session with the RAT</li>\n</ul>"
                },
                {
                    "id": "<sentence_0x519d16e>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "This was one of the two fully functional RATs that we observed using WSL and signals that at least some actors are now capable of leveraging OSTs to execute a WSL-based attack. The detection rate of this sample on VirusTotal was 3/61.",
                    "html": "<p>This was one of the two fully functional RATs that we observed using WSL and signals that at least some actors are now capable of leveraging OSTs to execute a WSL-based attack. The detection rate of this sample on VirusTotal was 3/61.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x29ddbbbc>",
            "title": "Discord Token Grabber",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0xa08e8e7e>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x24cc3937>": "https://github.com/wodxgod/Discord-Token-Grabber/blob/master/token-grabber.py"
                    },
                    "text": "Some of files that Black Lotus Labs detected performed more limited functions. The Discord token grabber module was designed to harvest authentication tokens saved to disk from various web browsers, including: Discord, Google Chrome, Opera, Brave and Yandex. The functionality and file paths correlate to the Discord Token Grabber GitHub project. Once the authentication token was obtained, it sent the information from the infected Windows device to an actor-controlled Discord account with a hard-coded Linux-based User-Agent string. This module had the highest detection rate of 9/62 when it was found on VirusTotal.",
                    "html": "<p>Some of files that Black Lotus Labs detected performed more limited functions. The Discord token grabber module was designed to harvest authentication tokens saved to disk from various web browsers, including: Discord, Google Chrome, Opera, Brave and Yandex. The functionality and file paths correlate to the <a href=\"https://github.com/wodxgod/Discord-Token-Grabber/blob/master/token-grabber.py\" rel=\"noopener\" target=\"_blank\">Discord Token Grabber</a> GitHub project. Once the authentication token was obtained, it sent the information from the infected Windows device to an actor-controlled Discord account with a hard-coded Linux-based User-Agent string. This module had the highest detection rate of 9/62 when it was found on VirusTotal.</p>"
                },
                {
                    "id": "<sentence_0xc8452f84>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<img_0x6914e793>": "https://blog.lumen.com/wp-content/uploads/2022/03/Figure2_token-grabber.jpg"
                    },
                    "text": "Figure 2: Token grabber sample screenshot",
                    "html": "<p><img alt=\"Figure2\" class=\"aligncenter size-full wp-image-13543\" height=\"642\" src=\"https://blog.lumen.com/wp-content/uploads/2022/03/Figure2_token-grabber.jpg\" width=\"936\"/>Figure 2: Token grabber sample screenshot</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x399b7f7c>",
            "title": "Keylogger",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0x913ca63e>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x4f4e7634>": "https://github.com/3ct0s/discord-keylogger/blob/main/keylogger.py"
                    },
                    "text": "We observed one module that communicated via Discord and functioned as a keylogger. This sample was different than the Keyjeek logger covered previously, as it would just send the data from the infected machine to the C2 via the URL: https[:]//discord[.]com/api/webhooks/928513925610352650/iC7G5SFTzUmf4qQYyzXIhTSuA0bBrsME6cWwBnxvV-qa3inFESh3F4iF6Nkq05crHn5J. With this method, the data was not written to disk, making it harder to detect from a host-based prospective. Like the other Discord modules, it had a detection rate of 9/62 when first discovered.",
                    "html": "<p>We observed one module that communicated via Discord and functioned as a <a href=\"https://github.com/3ct0s/discord-keylogger/blob/main/keylogger.py\" rel=\"noopener\" target=\"_blank\">keylogger</a>. This sample was different than the Keyjeek logger covered previously, as it would just send the data from the infected machine to the C2 via the URL: https[:]//discord[.]com/api/webhooks/928513925610352650/iC7G5SFTzUmf4qQYyzXIhTSuA0bBrsME6cWwBnxvV-qa3inFESh3F4iF6Nkq05crHn5J. With this method, the data was not written to disk, making it harder to detect from a host-based prospective. Like the other Discord modules, it had a detection rate of 9/62 when first discovered.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x483f65ac>",
            "title": "Telegram-Based Bot",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0x5fbb2bf2>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xae5053b2>": "https://github.com/Bainky/Telegram-RAT"
                    },
                    "text": "Discord was not the only third-party service we observed being utilized for C2s. One RAT communicated via the Telegram API, which we suspect was used to better blend in with the target environment. This appeared to be a lightly modified version of Telegram-RAT. As with the other RATs, this GitHub project included the ability to run commands, upload/download files and retrieve stored credentials, among other functions. We extracted the Rat.py file which acts as the configuration file by identifying the Telegram token, designating the ChatID for C2, determining the task name and designating the location to place the trojan itself. The contents of that file can be found below:",
                    "html": "<p>Discord was not the only third-party service we observed being utilized for C2s. One RAT communicated via the Telegram API, which we suspect was used to better blend in with the target environment. This appeared to be a lightly modified version of <a href=\"https://github.com/Bainky/Telegram-RAT\" rel=\"noopener\" target=\"_blank\">Telegram-RAT</a>. As with the other RATs, this GitHub project included the ability to run commands, upload/download files and retrieve stored credentials, among other functions. We extracted the \u201cRat.py\u201d file which acts as the configuration file by identifying the Telegram token, designating the ChatID for C2, determining the task name and designating the location to place the trojan itself. The contents of that file can be found below:</p>"
                },
                {
                    "id": "<sentence_0x76e01de2>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "# Token/ID<crlf>TelegramToken = 2064338791:AAHUdTkYnC38Igw7Rrf9PWRRcZGS03-Bx0g<crlf>TelegramChatID = 1987910945",
                    "html": "<p>\u2014\n# Token/ID\nTelegramToken = \u20182064338791:AAHUdTkYnC38Igw7Rrf9PWRRcZGS03-Bx0g\u2019\nTelegramChatID = \u20181987910945\u2019</p>"
                },
                {
                    "id": "<sentence_0xe4c51a7d>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "#Haha<crlf># Run the script as administrator<crlf>AdminRightsRequired = False",
                    "html": "<p>#Haha\n# Run the script as administrator\nAdminRightsRequired = False</p>"
                },
                {
                    "id": "<sentence_0xbf6576c7>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "# Disable Task Manager at first start<crlf>DisableTaskManager = False<crlf># Disable Registry Editor at first start<crlf>DisableRegistryTools = False\\3<crlf>#HEEHEHEHEHRGREF<crlf># Process protection from termination and deletion<crlf>ProcessBSODProtectionEnabled = True",
                    "html": "<p># Disable Task Manager at first start\nDisableTaskManager = False\n# Disable Registry Editor at first start\nDisableRegistryTools = False\\3\n#HEEHEHEHEHRGREF\n# Process protection from termination and deletion\nProcessBSODProtectionEnabled = True</p>"
                },
                {
                    "id": "<sentence_0x78eb0d1b>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "#efrgGgrg<crlf># Add to startup at first start<crlf>AutorunEnabled = True<crlf># Installation directory<crlf>InstallPath = C:\\\\ProgramData\\\\<crlf># Task name in Task Scheduler<crlf>AutorunName = OneDrive Update<crlf># The name of the process in the Task Manager<crlf>ProcessName = System.exe<crlf>#fdgdfgeghhthth",
                    "html": "<p>#efrgGgrg\n# Add to startup at first start\nAutorunEnabled = True\n# Installation directory\nInstallPath = \u2018C:\\\\ProgramData\\\\\u2019\n# Task name in Task Scheduler\nAutorunName = \u2018OneDrive Update\u2019\n# The name of the process in the Task Manager\nProcessName = \u2018System.exe\u2019\n#fdgdfgeghhthth</p>"
                },
                {
                    "id": "<sentence_0x418e31c3>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "# Display a message at first start<crlf>DisplayMessageBox = True<crlf># Your Message (will be displayed at start)<crlf>Message = Done<crlf>#lololololo<crlf>#danksDFdsf<crlf># Directory for saving trojan temporary files<crlf>Directory = C:\\\\Windows\\\\Temp\\\\Temp_data\\\\",
                    "html": "<p># Display a message at first start\nDisplayMessageBox = True\n# Your Message (will be displayed at start)\nMessage = \u2018Done\u2019\n#lololololo\n#danksDFdsf\n# Directory for saving trojan temporary files\nDirectory = \u2018C:\\\\Windows\\\\Temp\\\\Temp_data\\\\\u2019\n\u2014</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x93b16c45>",
            "title": "Password Dumper Module",
            "title_level": 3,
            "sentences": [
                {
                    "id": "<sentence_0x27a71785>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x55d17e1>": "https://www.thepythoncode.com/article/extract-chrome-passwords-python"
                    },
                    "text": "One other sample that piqued our interest was named dump-passwords.py. We assess that at least part of the code was based upon a Proof-of-Concept (PoC) to retrieve stored passwords. While this particular sample did not contain a mechanism for external communications, it allowed the threat actor to harvest stored credentials on the infected machine in this case from the Chrome login database. These stored credentials could be used later to retrieve information or help the actor move laterally if the victim reused passwords. One benefit to this approach over the Discord token grabber is that this module had a detection rate of zero.",
                    "html": "<p>One other sample that piqued our interest was named \u201cdump-passwords.py.\u201d We assess that at least part of the code was based upon a <a href=\"https://www.thepythoncode.com/article/extract-chrome-passwords-python\" rel=\"noopener\" target=\"_blank\">Proof-of-Concept (PoC) to retrieve stored passwords</a>. While this particular sample did not contain a mechanism for external communications, it allowed the threat actor to harvest stored credentials on the infected machine \u2013 in this case from the Chrome login database. These stored credentials could be used later to retrieve information or help the actor move laterally if the victim reused passwords. One benefit to this approach over the Discord token grabber is that this module had a detection rate of zero.</p>"
                },
                {
                    "id": "<sentence_0xd2317fbe>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<img_0x3f183514>": "https://blog.lumen.com/wp-content/uploads/2022/03/Figure3_password-dumper.jpg"
                    },
                    "text": "Figure 3: Password dumper sample screenshot",
                    "html": "<p><img alt=\"Figure3\" class=\"aligncenter size-full wp-image-13544\" height=\"644\" src=\"https://blog.lumen.com/wp-content/uploads/2022/03/Figure3_password-dumper.jpg\" width=\"936\"/>Figure 3: Password dumper sample screenshot</p>"
                }
            ]
        },
        {
            "id": "<chapter_0x9beca758>",
            "title": "Conclusion",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x30368841>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xcb1f7575>": "https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon#usage",
                        "<a_0x12979d9f>": "https://www.sans.org/white-papers/39330/"
                    },
                    "text": "Threat actors are continuing to take advantage of the blurring boundaries between operating systems by developing this new class of WSL-based attack. If your corporate environment uses WSL, we recommend that you enable system monitoring (Sysmon) tools to help audit commands run via the WSL terminal. To learn more about how to monitor a Windows system with WSL installed for indicators of malicious activity, read this SANS whitepaper.",
                    "html": "<p>Threat actors are continuing to take advantage of the blurring boundaries between operating systems by developing this new class of WSL-based attack. If your corporate environment uses WSL, we recommend that you enable <a href=\"https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon#usage\" rel=\"noopener\" target=\"_blank\">system monitoring (Sysmon)</a> tools to help audit commands run via the WSL terminal. To learn more about how to monitor a Windows system with WSL installed for indicators of malicious activity, read this <a href=\"https://www.sans.org/white-papers/39330/\" rel=\"noopener\" target=\"_blank\">SANS whitepaper</a>.</p>"
                },
                {
                    "id": "<sentence_0x433a7bf8>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Black Lotus Labs will continue to follow the WSL attack surface to detect similar campaigns. As new and potent samples become available, we will continue to alert the information security community to these developments. We encourage other organizations to alert on this and similar activity in their environments.",
                    "html": "<p>Black Lotus Labs will continue to follow the WSL attack surface to detect similar campaigns. As new and potent samples become available, we will continue to alert the information security community to these developments. We encourage other organizations to alert on this and similar activity in their environments.</p>"
                },
                {
                    "id": "<sentence_0x4cdaf4cd>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x269f6d6>": "https://github.com/blacklotuslabs/IOCs/blob/main/WSL_IoCs_March2022.txt"
                    },
                    "text": "For additional IOCs such as file hashes associated with these campaigns, please visit our GitHub page.",
                    "html": "<p>For additional IOCs such as file hashes associated with these campaigns, please visit our <a href=\"https://github.com/blacklotuslabs/IOCs/blob/main/WSL_IoCs_March2022.txt\" rel=\"noopener\" target=\"_blank\">GitHub page</a>.</p>"
                },
                {
                    "id": "<sentence_0x983dbb72>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xae759cb5>": "https://twitter.com/BlackLotusLabs"
                    },
                    "text": "If you would like to collaborate on similar research, please contact us on Twitter @BlackLotusLabs.",
                    "html": "<p>If you would like to collaborate on similar research, please contact us on Twitter <a href=\"https://twitter.com/BlackLotusLabs\" rel=\"noopener\" target=\"_blank\">@BlackLotusLabs</a>.</p>"
                },
                {
                    "id": "<sentence_0xc09dddd5>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "This analysis was performed by Danny Adamitis and Steve Rudd.",
                    "html": "<p>This analysis was performed by Danny Adamitis and Steve Rudd.</p>"
                },
                {
                    "id": "<sentence_0xe334ff48>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "This information is provided as is without any warranty or condition of any kind, either express or implied. Use of this information is at the end users own risk.",
                    "html": "<p>This information is provided \u201cas is\u201d without any warranty or condition of any kind, either express or implied. Use of this information is at the end user\u2019s own risk.</p>"
                }
            ]
        }
    ]
}