<div>
<p><img alt="Custom PowerShell RAT targets Germans seeking information about the Ukraine crisis" src="https://blog.malwarebytes.com/wp-content/uploads/2020/11/shutterstock_421820056.png" style="max-width:80%;height:auto;width:auto;"/></p>
<p><a href="https://blog.malwarebytes.com/category/threat-intelligence/" rel="category tag">Threat Intelligence</a></p>
<h1 class="entry-title p-name">
					Custom PowerShell RAT targets Germans seeking information about the Ukraine crisis				</h1>
<p>Posted: May 16, 2022 by <a href="https://blog.malwarebytes.com/author/threatintelligence/" rel="author" title="Posts by Threat Intelligence Team">Threat Intelligence Team</a>
Last updated: May 13, 2022
</p>
Malwarebytes Threat Intelligence has uncovered an attack using the lure of information about the war in Ukraine to target people in Germany.
<p>This blog post was authored by Hossein Jazi and Jérôme Segura</p>
<p>Populations around the world—and in Europe in particular—are following the crisis in Ukraine very closely, and with events unfolding on a daily basis, people are hungry for information.</p>
<p>Although all countries have reasons to be concerned, the situation is Germany is more complicated than most. It is one of the few European countries to have received criticism for its attitude to the Ukraine-Russia conflict, as it struggles to end its <a href="https://www.bbc.com/news/business-61164894" rel="noreferrer noopener nofollow" target="_blank">reliance on Russian energy</a>, and Moscow recently imposed sanctions on Gazprom Germania, further increasing economic tensions.</p>
<p>This week our analysts discovered a new campaign that plays on these concerns by trying to lure Germans with a promise of updates on the current threat situation in Ukraine. The downloaded document is in fact decoy for a Remote Access Trojan (RAT) capable of stealing data and executing other malicious commands on a victim’s computer.</p>
<h2>Decoy site lures victims with Ukraine situation</h2>
<p>Threat actors registered an expired German domain name at collaboration-bw[.]de that was formally used as a collaboration platform to develop new ideas for the Baden-Württemberg state.</p>
<figure class="aligncenter size-full is-resized"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/old_site.png" title=""><img alt="" class="wp-image-56609" height="409" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/old_site.png" style="max-width:800px;height:auto;width:auto;" width="839"/></a><figcaption>Threat actors registered an expired domain associated with Baden-Württemberg</figcaption></figure>
<p>The threat actors used the domain to host a website that looked like the official Baden-Württemberg website, baden-wuerttemberg.de.</p>
<figure class="aligncenter size-full"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/compare.png" title=""><img alt="" class="wp-image-56610" height="751" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/compare.png" style="max-width:800px;height:auto;width:auto;" width="1353"/></a><figcaption>A comparison of the real baden-wuerttemberg.de (top) and the malicious fake (bottom)</figcaption></figure>
<p>With this copycat, the attackers created the perfect placeholder for the lure they wanted their victims to download: A file tantalising called <code>2022-Q2-Bedrohungslage-Ukraine</code> (threat situation in Ukraine for Q2), offered via a prominent blue download button.</p>
<figure class="aligncenter size-full is-resized"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/lure_site.png" title=""><img alt="" class="wp-image-56608" height="690" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/lure_site.png" style="max-width:800px;height:auto;width:auto;" width="681"/></a><figcaption>The website promises important information and tips about the Ukraine crisis</figcaption></figure>
<p>An English translation of the page reads:</p>
Important, current threat situation regarding the Ukraine crisis
On this website you will always find the most important information and tips for dealing with the current threat posed by the Ukraine crisis. Please download the document now and read through the current information. The document is constantly updated and is up to date. Our suggested tips can be practically implemented in everyday work and you should already implement them today. Thanks for your support.
<h2>File analysis</h2>
<p>The archive file called <code>2022-Q2-Bedrohungslage-Ukraine</code> contains a file named <code>2022-Q2-Bedrohungslage-Ukraine.chm</code>. The CHM format is Microsoft’s HTML help file format, which consists of a number of compiled HTML files.</p>
<figure class="aligncenter size-full"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/chm.png" title=""><img alt="" class="wp-image-56611" height="410" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/chm.png" width="616"/></a><figcaption>The CHM file displays a fake error message</figcaption></figure>
<p>Victims will get a fake error message when they open up that file, while PowerShell quietly runs a Base64 command.</p>
<figure class="aligncenter size-large"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/b64.png" title=""><img alt="" class="wp-image-56619" height="73" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/b64-600x73.png" width="600"/></a><figcaption>PowerShell executes a Base64-encoded command</figcaption></figure>
<p>After de-obfuscating the command we can see it is designed to execute a script downloaded from the fake Baden-Württemberg website, using Invoke-Expression (IEX).</p>
<figure class="aligncenter size-full"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/iex.png" title=""><img alt="" class="wp-image-56620" height="135" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/iex.png" width="600"/></a><figcaption>The PowerShell code fetches and executes a malicious script</figcaption></figure>
<figure class="aligncenter size-full"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/powershell.png" title=""><img alt="" class="wp-image-56612" height="472" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/powershell.png" style="max-width:800px;height:auto;width:auto;" width="764"/></a><figcaption>The malicious script downloaded from the fake Baden-Württemberg website</figcaption></figure>
<p>The downloaded script creates a folder called <code>SecuriyHealthService</code> in the current user directory and drops two files into it: <code>MonitorHealth.cmd</code> and a script called <code>Status.txt</code>. The <code>.cmd</code> file is very simple and just executes <code>Status.txt</code> through PowerShell.</p>
<p>Finally, the downloaded script makes <code>MonitorHealth.cmd</code> persistent by creating a scheduled task that will execute it each day at a specific time. </p>
<h2>PowerShell RAT (Status.txt)</h2>
<p><code>Status.txt</code> is a RAT written in PowerShell. It starts its activities by collecting some information about the victim’s computer, such as the current username and working directory, and the computer’s hostname. It also builds a unique id for the victim, the <code>clientid</code>.</p>
<p>This data is exfiltrated as a JSON data structure sent to the server via a POST request:</p>
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter">12345678910</td><td class="code"><code class="powershell variable">$json</code> <code class="powershell plain">= </code><code class="powershell string single">'{</code><code class="powershell spaces"> </code><code class="powershell string single">"type": "newclient",</code><code class="powershell spaces"> </code><code class="powershell string single">"result": "",</code><code class="powershell spaces"> </code><code class="powershell string single">"pwd": "'</code> <code class="powershell plain">+ </code><code class="powershell variable">$pwd_b64</code> <code class="powershell plain">+ </code><code class="powershell string single">'",</code><code class="powershell spaces"> </code><code class="powershell string single">"cuser": "'</code> <code class="powershell plain">+ </code><code class="powershell variable">$cuser</code> <code class="powershell plain">+ </code><code class="powershell string single">'",</code><code class="powershell spaces"> </code><code class="powershell string single">"hostname": "'</code> <code class="powershell plain">+ </code><code class="powershell variable">$hname</code> <code class="powershell plain">+ </code><code class="powershell string single">'",</code><code class="powershell spaces"> </code><code class="powershell string single">"clientid": "'</code> <code class="powershell plain">+ </code><code class="powershell variable">$clientid</code> <code class="powershell plain">+ </code><code class="powershell string single">'"</code><code class="powershell string single">}'</code><code class="powershell plain">;</code> <code class="powershell variable">$headers</code> <code class="powershell plain">= @{</code><code class="powershell string single">'X-Request-ID'</code> <code class="powershell plain">= </code><code class="powershell variable">$strhash</code><code class="powershell plain">;}</code></td></tr></tbody></table>
<p>However, before executing this requests the script will first bypass the Windows Antimalware Scan Interface (<a href="https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal" rel="noreferrer noopener nofollow" target="_blank">AMSI</a>) using an AES-encrypted function called <code>bypass</code>. It is decrypted using a generated key and IV before execution.</p>
<figure class="aligncenter size-full"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/bypass.png" title=""><img alt="" class="wp-image-56618" height="638" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/bypass.png" style="max-width:800px;height:auto;width:auto;" width="1862"/></a><figcaption>The bypass function that contains the encrypted script to bypass AMSI.</figcaption></figure>
<figure class="aligncenter size-full"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/amsi.png" title=""><img alt="" class="wp-image-56613" height="815" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/amsi.png" style="max-width:800px;height:auto;width:auto;" width="786"/></a><figcaption>The content of the AMSI bypass script after decryption</figcaption></figure>
<p>This RAT has the following capabilities: </p>
<ul><li>Download (type: D0WNl04D): Download files from server</li><li>Upload (type: UPL04D): Upload file to the server</li><li>LoadPS1 (type: L04DPS1): Load and execute a PowerShell script</li><li>Command (type: C0MM4ND): Execute a specific command </li></ul>
<h2>German command and control server</h2>
<p>The attack was thoughtfully carried out—even ensuring that the stolen data was sent to a German domain name, kleinm[.]de, to avoid suspicion.</p>
<figure class="aligncenter size-full"><a href="https://blog.malwarebytes.com/wp-content/uploads/2022/05/POST.png" title=""><img alt="" class="wp-image-56614" height="315" src="https://blog.malwarebytes.com/wp-content/uploads/2022/05/POST.png" width="577"/></a></figure>
<p>It is not easy to attribute this activity to a specific actor, and there are no solid indicators to support attribution. Based on motivation alone, we hypothesise that a Russian threat actor could be targeting German users, but without clear connections in infrastructure or similarities to known TTPs, such attribution is weak.</p>
<p>The Malwarebytes Threat Intelligence team continues to monitor <a href="https://blog.malwarebytes.com/threat-intelligence/2022/03/hermeticwiper-a-detailed-analysis-of-the-destructive-malware-that-targeted-ukraine/">attacks taking advantage of the war</a> in Ukraine while ensuring our customers are protected.</p>
<h2>Indicators of Compromise (IOCs)</h2>
<p>Phishing site</p>
<p>collaboration-bw[.]de/bedrohung-ukr.html</p>
<p>Lure</p>
<p>2022-Q2-Bedrohungslage-Ukraine.zip
2430f68285120686233569e51e2147914dc87f82c7dbdf07fe0c34dbb1aca77c
2022-Q2-Bedrohungslage-Ukraine.chm
80bad7e0d5a5d2782674bb8334dcca03534aa831c37aebb5962da1cd1bec4130</p>
<p>Status.txt
a5d8beaa832832576ca97809be4eee9441eb6907752a7e1f9a390b29bbb9fe1f</p>
<p>MonitorHealth.cmd
fc71522a4125ca4bdc5e5deca4a6498e7f2da4408614c2e1284c3ae8c083a5fd</p>
<p>C2</p>
<p>kleinm[.]de</p>
<h2>MITRE ATT&amp;CK</h2>
<figure class="wp-block-table aligncenter is-style-stripes has-small-font-size"><table class="has-fixed-layout"><thead><tr><th>Tactic</th><th>ID</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>Execution</td><td><a href="https://attack.mitre.org/techniques/T1059" rel="noreferrer noopener" target="_blank">T1059</a> </td><td>Command and Scripting Interpreter</td><td>Starts cmd.exe to run hh.exe</td></tr><tr><td></td><td></td><td></td><td>Executes PowerShell script to download and execute a script</td></tr><tr><td>Persistence</td><td><a href="https://attack.mitre.org/techniques/T1053" rel="noreferrer noopener" target="_blank">T1053</a></td><td>Scheduled Task/Job</td><td>Executes task scheduler to add MonitorHealth.cmd as a daily task</td></tr><tr><td>Defense evasion</td><td><a href="https://attack.mitre.org/techniques/T1222" rel="noreferrer noopener" target="_blank">T1222</a></td><td>File and Directory Permissions Modification</td><td>Uses attrib.exe to hide SecuriyHealthService folder</td></tr></tbody></table></figure>
<p>SHARE THIS ARTICLE</p>
<a class="socicon-facebook" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56607&amp;t=Custom+PowerShell+RAT+targets+Germans+seeking+information+about+the+Ukraine+crisis" id="social-share-facebook" target="_blank"></a>
<a class="socicon-twitter" href="https://twitter.com/intent/tweet?text=Custom+PowerShell+RAT+targets+Germans+seeking+information+about+the+Ukraine+crisis+https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56607&amp;via=Malwarebytes" id="social-share-twitter" target="_blank"></a>
<a class="socicon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D56607&amp;title=Custom+PowerShell+RAT+targets+Germans+seeking+information+about+the+Ukraine+crisis&amp;summary=&amp;source=" id="social-share-linkedin" target="_blank"></a>
<p>ABOUT THE AUTHOR</p>
<img alt="" class="avatar avatar-96 photo grav-hashed grav-hijack" height="96" id="grav-147cd7280d6ece931e4488a3a10809d9-0" src="https://secure.gravatar.com/avatar/147cd7280d6ece931e4488a3a10809d9?s=96&amp;d=identicon&amp;r=g" width="96"/>
<p>
<a href="https://blog.malwarebytes.com/author/threatintelligence/" rel="author" title="Posts by Threat Intelligence Team">Threat Intelligence Team</a>
</p>
<p></p>
</div>