<div>
<p><img alt="Double header: IsaacWiper and CaddyWiper" src="https://blog.malwarebytes.com/wp-content/uploads/2016/04/night-computer-hdd-hard-drive-feature.jpg"/></p>
<p><a href="https://blog.malwarebytes.com/category/threat-intelligence/" rel="category tag">Threat Intelligence</a></p>
<h1 class="entry-title p-name">
					Double header: IsaacWiper and CaddyWiper				</h1>
<p>Posted: March 18, 2022 by <a href="https://blog.malwarebytes.com/author/threatintelligence/" rel="author" title="Posts by Threat Intelligence Team">Threat Intelligence Team</a>
</p>
We review two of the latest wipers that have targeted Ukraine recently.
<p>As war in Ukraine rages, new destructive malware continues to be discovered. In this short blog post, we will review IsaacWiper and CaddyWiper, two new wipers that do not have much in common based on their source code, but with the same intent of destroying targeted Ukrainian computer systems.</p>
<h2>IsaacWiper</h2>
<p>IsaacWiper was one of the artifacts security company ESET reported to be targeting Ukraine. Other artifacts were named as HermeticWiper (wiper), HermeticWizard (spreader) and HermeticRansom (ransomware). IsaacWiper is far less advanced than HermeticWiper, the first wiper that was found which we analyzed <a href="https://blog.malwarebytes.com/threat-intelligence/2022/03/hermeticwiper-a-detailed-analysis-of-the-destructive-malware-that-targeted-ukraine/" rel="noreferrer noopener" target="_blank">here</a>.</p>
<p>IsaacWiper is made of an executable, compiled with Visual Studio. The executable has imported functions like DeviceIoControl, WriteFile, MoveFile, GetDiskFreeSpaceEx, FindNextFileW. Although these functions are legitimate, the combination of all these imports could be suspicious. Sections analysis, on other hand, is perfectly normal. No strange segments are found, and entropy has the expected values:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55176" height="264" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/1.png" style="max-width:80%;height:auto;width:auto;" width="800"/></figure>
<p>The sample is presented in DLL form with just one export, named _Start@4 that contains the main functionality of the malware:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55177" height="377" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/2.png" width="544"/></figure>
<p>The malware will iterate through all system disks, overwriting the first bytes of these disks:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55178" height="115" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/3.png" style="max-width:80%;height:auto;width:auto;" width="800"/></figure>
<p>The following chunk shows an extract of the code responsible for that behavior. Also, it can be seen how the volume is unlocked after write operations:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55179" height="178" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/4.png" width="635"/></figure>
<p>We have found that not only the physicalDrive but also partitions are wiped in the process. The wiper will iterate through the filesystem, enumerating files and overwriting them. This behavior is similar to ransomware activity, but in this case there is no decryption key. Once the data has been overwritten, it is lost:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55181" height="325" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/5.png" style="max-width:80%;height:auto;width:auto;" width="800"/></figure>
<p>The attackers left in the code various log strings. An example of one of these debug strings, being referenced inline is presented below:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55182" height="228" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/6.png" width="548"/></figure>
<p>In fact, these debug strings describe pretty well the malware functionality. All debug strings are presented below:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55183" height="270" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/7.png" width="629"/></figure>
<p>As it can be seen, the attackers’ goal is destroying data on victims systems. Affected users will lose their files, and their computers will be unbootable, forcing them to reinstall the OS.</p>
<h2>CaddyWiper</h2>
<p>CaddyWiper is a 3rd Wipper (after HermeticWiper and IzaakWiper) that was observed in this year’s attack on Ukraine. In contrast to HermeticWiper, this one is very small, and has less complex capabilities.</p>
<p>The sample is not signed and its compilation date is: 14 March 2022 07:19:36 UTC. The executable is dedicated to destroying files and partition information for each available disk.</p>
<p>The main function of the wiper can be seen below:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55184" height="745" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/8.png" style="max-width:80%;height:auto;width:auto;" width="681"/></figure>
<p>First, the wiper checks if it is running on the Primary Domain Controller. The malware will avoid trashing Domain Controllers, probably because it wants to keep them alive for the purpose of propagation.</p>
<p>If the current machine is not a Domain Controller, the wiping starts. It recursively wipes files in the <code>C:\Users</code> directory. Then, it iterates over available hard disks, starting from “<code>D:</code>” and wipes recursively all the files it can access.</p>
<p>The wiping is done in the following way:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55185" height="664" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/9.png" style="max-width:80%;height:auto;width:auto;" width="749"/></figure>
<p>It tries to grant access to the files before writing:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55186" height="720" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/10.png" style="max-width:80%;height:auto;width:auto;" width="800"/></figure>
<p>All the files/directories are enumerated by well-known APIs: <code>FindFirstFileA</code>/<code>FindNextFileA</code>. If the found element is a directory, the function is called recursively. And if it is a file, a new buffer filled with 0s is allocated, and the file content is overwritten with it. The buffer is limited to 10 Mb max, so if the file is bigger than this, only the beginning of it will be wiped.</p>
<p>Interestingly, this enumeration starts from the drive letter <code>D</code> (treating <code>C</code> as a separate case), so if there are any disks mounted as <code>A</code> or <code>B</code>, they are skipped. Finally the malware wipes layout information of the available disks/partitions:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55187" height="574" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/11.png" style="max-width:80%;height:auto;width:auto;" width="798"/></figure>
<p>It starts from the <code>\\.\PHYSICALDRIVE9</code>, and at each iteration decrements the partition number by one.</p>
<p>The wiping of the partition layout is implemented via IOCTL sent to the drive device: <code>IOCTL_DISK_SET_DRIVE_LAYOUT_EX</code>. The malware sets an empty buffer as the new layout.</p>
<p>The sample is very mildly obfuscated and most of the used strings are stack-based. Also the Import Table is very small, containing only one function. All the needed functions are dynamically retrieved, with the help of a custom lookup routine:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55188" height="431" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/12.png" width="419"/></figure>
<p>CaddyWiper is extremely light in comparison to HermeticWiper, which was the most complex from all the wipers that have been associated with those attacks. There is no code overlap between each of them, and most likely they have been written by different authors.</p>
<h2>Protection</h2>
<p>Malwarebytes clients are protected against both of these wipers:</p>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55189" height="303" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/13.png" width="463"/></figure>
<figure class="wp-block-image size-full"><img alt="" class="wp-image-55190" height="306" src="https://blog.malwarebytes.com/wp-content/uploads/2022/03/14.png" width="469"/></figure>
<h2>References</h2>
<ol><li><a href="https://www.welivesecurity.com/2022/03/01/isaacwiper-hermeticwizard-wiper-worm-targeting-ukraine/">https://www.welivesecurity.com/2022/03/01/isaacwiper-hermeticwizard-wiper-worm-targeting-ukraine/</a></li><li><a href="https://www.eset.com/int/about/newsroom/press-releases/research/eset-research-ukraine-hit-by-destructive-attacks-before-and-during-the-russian-invasion-with-hermet/">https://www.eset.com/int/about/newsroom/press-releases/research/eset-research-ukraine-hit-by-destructive-attacks-before-and-during-the-russian-invasion-with-hermet/</a></li></ol>
<h2>Indicators of Compromise</h2>
<p>IsaacWiper</p>
<p>13037b749aa4b1eda538fda26d6ac41c8f7b1d02d83f47b0d187dd645154e033</p>
<p>CaddyWiper</p>
<p>a294620543334a721a2ae8eaaf9680a0786f4b9a216d75b55cfd28f39e9430ea</p>
<p>SHARE THIS ARTICLE</p>
<a class="socicon-facebook" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D55173&amp;t=Double+header%3A+IsaacWiper+and+CaddyWiper" id="social-share-facebook" target="_blank"></a>
<a class="socicon-twitter" href="https://twitter.com/intent/tweet?text=Double+header%3A+IsaacWiper+and+CaddyWiper+https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D55173&amp;via=Malwarebytes" id="social-share-twitter" target="_blank"></a>
<a class="socicon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D55173&amp;title=Double+header%3A+IsaacWiper+and+CaddyWiper&amp;summary=&amp;source=" id="social-share-linkedin" target="_blank"></a>
<p>COMMENTS</p>
<p>RELATED ARTICLES</p>
<p>ABOUT THE AUTHOR</p>
<img alt="" class="avatar avatar-96 photo grav-hashed grav-hijack" height="96" id="grav-147cd7280d6ece931e4488a3a10809d9-0" src="https://secure.gravatar.com/avatar/147cd7280d6ece931e4488a3a10809d9?s=96&amp;d=identicon&amp;r=g" width="96"/>
<p>
<a href="https://blog.malwarebytes.com/author/threatintelligence/" rel="author" title="Posts by Threat Intelligence Team">Threat Intelligence Team</a>
</p>
<p></p>
</div>