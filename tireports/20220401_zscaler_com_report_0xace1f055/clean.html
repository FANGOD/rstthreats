<div> <p>Background:</p><p>Over the past few days, the Zscaler ThreatLabz team has been closely monitoring the reports of potential RCEs in Spring Cloud Framework and Spring Cloud Function.</p><p>Spring is an open-source lightweight Java platform which many developers use as their application development framework. As part of the Spring echo system, Spring Cloud is a component using which one can write cloud agnostics code or develop applications and make them working on well known cloud services such as AWS, Azure, Alibaba etc. The Spring Cloud Function is one of the subcomponents of Spring Cloud Function which enables developers to do serverless programming.</p><p>Leveraging from our internal research and the published articles, github posts and POCs, at the moment our understanding is that there could potentially be more than one issue in Spring Cloud Framework and sub-component Spring Cloud Function.</p><p>At the moment, we are discussing two issues/vulnerabilities here.</p><ol><li><a href="https://spring.io/blog/2022/03/29/cve-report-published-for-spring-cloud-function" target="_blank">CVE-2022-22963</a> - Spring Expression Resource Access Vulnerability which can provide access to the critical systems/resources to the unauthenticated adversary. At the moment it is categorized as a medium severity issue.</li><li><a href="https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement" target="_blank">CVE-2022-22965</a> aka Spring4Shell or SpringShell - Spring Framework RCE via Data Binding on JDK 9+. This vulnerability is categorized as Critical.</li></ol><p>What are the issues?</p><p>1. CVE-2022-22963</p><p>Spring Expression Resource Access Vulnerability was found in Spring Cloud Function versions 3.1.6 and 3.2.2 or prior. The adversaries can exploit this vulnerability by sending a crafted HTTP request packet with the specific HTTP header named, spring.cloud.function.routing-expression, in the HTTP request packet. This parameter is treated as SpEL expression when the routing is in use. Vulnerable version of the Spring Cloud Function, while parsing this specific HTTP header, spring.cloud.function.routing-expression, along with the malformed SpEL expression, can allow an adversary to gain access to the critical resources on servers, systems which can allow adversary to perform further malicious activities. The vulnerability has been classified as “medium” at the moment. However, the actual impact of exploiting this vulnerability is unknown.</p><p>Vulnerable versions for CVE-2022-22963:
Spring Cloud Function versions between 3.1.6 or prior and 3.2.2 or prior seem to be vulnerable to the Expression Resource Access Vulnerability.</p><p>Spring Foundation Version Patched for CVE-2022-22963:
The Spring Foundation version 3.1.7 and 3.2.3 have been released to patch this critical vulnerability.</p><p>Zsclaer strongly recommends upgrading to these versions depending on what current version of Spring Foundation is deployed.
2. CVE-2022-22965 [Spring4Shell OR SpringShell]</p><p>There is a severe Remote Code Execution vulnerability in Spring Core JDK9+. This vulnerability can allow an unauthenticated attacker to execute arbitrary code on the target system. As per the sources available publicly, exploiting this vulnerability in certain configurations is relatively easier because it can be exploited with just simple crafted HTTP requests when sent to a vulnerable server. While in other configurations, it may not be that easy for an adversary to exploit and may require him/her to perform additional research.</p><p>To exploit this vulnerability, the vulnerable system should have DataBinder enabled, and exploitation depends majorly on the Servlet container of the application. As per the researcher who confirmed the exploitation, when Spring is deployed to Apache Tomcat, the WebAppClassLoader is accessible, which allows an attacker to call getters and setters and can write a malicious file to disk. However, if Spring is deployed using the Embedded Tomcat Servlet Container, the classloader is a LaunchedURLClassLoader which has limited access.</p><p>The details on the vulnerability and possible exploitation through a proof-of-concept is described <a href="https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/#exploit-scenario-overview" target="_blank">here</a>.</p><p>Mitigations</p><ul><li>CVE-2022-22963
Users of affected versions should upgrade to 3.1.7, 3.2.3. Releases that have fixed this issue include:
Spring Cloud Function
- 3.1.7
- 3.2.3
 </li><li>CVE-2022-22965
Users of affected versions should apply the following mitigation: 5.3.x users should upgrade to 5.3.18+, 5.2.x users should upgrade to 5.2.20+. There are <a href="https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement" target="_blank">other mitigation steps</a> for applications that cannot upgrade to the above versions. Releases that have fixed this issue include:
Spring Framework
- 5.3.18+
- 5.2.20+</li></ul><p>Best Practices/Guidelines To follow:</p><ul><li>Limit the impact from a potential compromise by restricting lateral movement with identity-based micro-segmentation (Zscaler Workload Segmentation) and a Zero Trust architecture.</li><li>Safeguard crown jewel applications by limiting lateral movement using Zscaler Private Access, especially with application security modules turned on.</li><li>Route all server traffic through Zscaler Private Access with additional application security module enabled and Zscaler Internet Access, which will provide the right visibility to identify and stop malicious activity from compromised systems/servers.</li><li>Restrict traffic to the critical infrastructure from the allowed list of known-good destinations.</li><li>Ensure you are inspecting all SSL traffic.</li><li>Turn on Advanced Threat Protection to block all known command-and-control domains. This will provide additional protection in case the adversary exploits this vulnerability to implant malware.</li><li>Extend command-and-control protection to all ports and protocols with the Advanced Cloud Firewall (Cloud IPS module), including emerging C2 destinations. Again, this will provide additional protection in case if the adversary exploits this vulnerability to implant malware.</li><li>Use Advanced Cloud Sandbox to prevent unknown malware delivered as part of a second stage payload.</li></ul><p>Zscaler Coverage:</p><p>Zscaler’s ThreatLabZ team has deployed protection for all known POCs for these vulnerabilities. </p><p>Advanced Threat Protection</p><ul><li>HTML.Exploit.Spring4Shell</li><li>HTML.Exploit.CVE-2022-22963</li></ul><p>Zscaler Private Access w/ Application Security</p><ul><li>HTML.Exploit.CVE-2022-22963</li><li>HTML.Exploit.Spring4Shell</li></ul><p>Additional References:</p><p>1. <a href="https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/#exploit-scenario-overview" target="_blank">https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/#exploit-scenario-overview</a>
2. <a href="https://www.praetorian.com/blog/spring-core-jdk9-rce/" target="_blank">https://www.praetorian.com/blog/spring-core-jdk9-rce/</a>
3. <a href="https://github.com/spring-projects/spring-framework/commit/7f7fb58dd0dae86d22268a4b59ac7c72a6c22529" target="_blank">https://github.com/spring-projects/spring-framework/commit/7f7fb58dd0dae86d22268a4b59ac7c72a6c22529</a>
4. <a href="https://spring.io/blog/2022/03/29/cve-report-published-for-spring-cloud-function" target="_blank">https://spring.io/blog/2022/03/29/cve-report-published-for-spring-cloud-function</a>
5. <a href="https://tanzu.vmware.com/security/cve-2022-22963" target="_blank">https://tanzu.vmware.com/security/cve-2022-22963</a>
6. <a href="https://www.cyberkendra.com/2022/03/rce-0-day-exploit-found-in-spring-cloud.html" target="_blank">https://www.cyberkendra.com/2022/03/rce-0-day-exploit-found-in-spring-cloud.html</a>
7. <a href="https://www.cyberkendra.com/2022/03/springshell-rce-0-day-vulnerability.html" target="_blank">https://www.cyberkendra.com/2022/03/springshell-rce-0-day-vulnerability.html</a></p><p> </p><p>About ThreatLabz
ThreatLabz is the security research arm of Zscaler. This world-class team is responsible for hunting new threats and ensuring that the thousands of organizations using the global Zscaler platform are always protected. In addition to malware research and behavioral analysis, team members are involved in the research and development of new prototype modules for advanced threat protection on the Zscaler platform, and regularly conduct internal security audits to ensure that Zscaler products and infrastructure meet security compliance standards. ThreatLabz regularly publishes in-depth analyses of new and emerging threats on its portal, <a class="c-link" href="https://research.zscaler.com/" target="_blank">research.zscaler.com</a>.</p><ul class="zp-0 zm-0 category-tags"><li class="d-block d-md-inline-block zmt-8 zmt-md-0 zmb-8 zmx-md-8"> <a class="h4 fw-400 fg-color-white bg-color-blue zpy-10 zpx-16 zmb-0 rounded d-inline-block category-tag" href="https://www.zscaler.com/blogs/security-research">Security Research</a></li><li class="d-block d-md-inline-block zmt-8 zmt-md-0 zmb-8 zmx-md-8"> <a class="h4 fw-400 fg-color-white bg-color-blue zpy-10 zpx-16 zmb-0 rounded d-inline-block category-tag" href="https://www.zscaler.com/blogs/insights-and-research">Insights and Research</a></li></ul><ul class="w-100 text-center text-md-left sharing-buttons zp-0 zm-0"><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="mailto:?subject=Security%20Advisory:%20Spring%20Cloud%20Framework%20Vulnerabilities&amp;body=https://bit.ly/3qSdaT4" title="Share via email"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.facebook.com/sharer/sharer.php?u=https://bit.ly/3qSdaT4" target="_blank" title="Share on facebook"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.linkedin.com/sharing/share-offsite/?title=Security%20Advisory:%20Spring%20Cloud%20Framework%20Vulnerabilities&amp;url=https://bit.ly/3qSdaT4" target="_blank" title="Share on linkedin"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://twitter.com/intent/tweet?text=https://bit.ly/3qSdaT4%20%E2%80%94%20Security%20Advisory:%20Spring%20Cloud%20Framework%20Vulnerabilities" target="_blank" title="Tweet"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.zscaler.com/blogs/feeds/security-research" title="Check feeds"> </a></li></ul><h2 class="fw-400 fg-color-blue zmb-0 zmt-15 zmt-md-0">Authors</h2><h3 class="zp-12 zmb-4 drop-shadow-hover"> <a class="fg-color-black" href="https://www.zscaler.com/author/jnair" title="Read all blog by Jithin Nair">Jithin Nair</a> </h3><h3 class="zp-12 zmb-4 drop-shadow-hover"> <a class="fg-color-black" href="https://www.zscaler.com/author/abanker" title="Read all blog by Amit Banker">Amit Banker</a> </h3><h2 class="fw-400 fg-color-blue zmb-md-24 zmb-0">Recommended for You</h2><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/analysis-blackguard-new-info-stealer-malware-being-sold-russian-hacking" title="Analysis of BlackGuard - A New Info Stealer Malware Being Sold In A Russian Hacking Forum">Analysis of BlackGuard - A New Info Stealer Malware Being Sold In A Russian Hacking Forum</a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/conti-ransomware-attacks-persist-updated-version-despite-leaks" title="Conti Ransomware Attacks Persist With an Updated Version Despite Leaks">Conti Ransomware Attacks Persist With an Updated Version Despite Leaks</a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/lapsus-attack-okta-how-evaluate-impact-your-organization" title="Lapsus$ Attack on Okta: How to Evaluate the Impact to your Organization ">Lapsus$ Attack on Okta: How to Evaluate the Impact to your Organization </a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/midas-ransomware-tracing-evolution-thanos-ransomware-variants" title="Midas Ransomware: Tracing the Evolution of Thanos Ransomware Variants">Midas Ransomware: Tracing the Evolution of Thanos Ransomware Variants</a></h6></div>