<div>
<a name="2926451460405415171"></a>
<h1 class="post-title entry-title">
Threat Advisory: DoubleZero
</h1>
<img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSednXb3kZnWB-soglsY6m1EhVPtCeH5mzT6k9YJQ8vXJU6OGnkYokjM8x-p0v0f6IBrun78KRjnpWgFqO2FQk40XSQfA8mgdrzRqceYP8JgFTgylzuM7wz6vFm_ifbN4dMUsZ5T9kegk49bY3KUc7rzlMGuaPVKUW5k5iwzPML0R8Q5mRMu8ZvgalnA/s16000/image3.jpg" style="max-width:80%;height:auto;width:auto;"/>
<h2 id="h.z3em7c6sk55i">Overview</h2>
The Computer Emergency Response Team of Ukraine released an <a href="https://cert.gov.ua/article/38088">advisory</a> on March 22, 2022 disclosing another wiper dubbed "DoubleZero" targeting Ukrainian enterprises during Russia's invasion of the country. This wiper was detected as early as March 17, 2022. DoubleZero is yet another wiper discovered in addition to previously disclosed attacks we've seen in Ukraine over the past two months, such as "<a href="https://blog.talosintelligence.com/2022/03/threat-advisory-caddywiper.html">CaddyWiper</a>" "<a href="https://blog.talosintelligence.com/2022/02/threat-advisory-hermeticwiper.html">HermeticWiper</a>" and "<a href="https://blog.talosintelligence.com/2022/01/ukraine-campaign-delivers-defacement.html">WhisperGate</a>."
DoubleZero is a .NET-based implant that destroys files, registry keys and trees on the infected endpoint.
Cisco Talos is actively conducting analysis to confirm the details included in these reports.
<a name="more"></a>
<h2 id="h.j3lg6troh5jm">Wiper analysis</h2>
The malware first checks if the current endpoint is one of the domain's controllers. If the endpoint's name is found, the wiper simply stops executing.
The wiper begins by obtaining the following privileges on the endpoint:
<ul>
<li>
SeTakeOwnershipPrivilege </li>
<li>
SeRestorePrivilege </li>
<li>
SeBackupPrivilege </li>
<li>
SeShutdownPrivilege </li>
</ul>
It aims to overwrite all files in all drives by destroying all files in all drives except for a specific list of the locations hardcoded in the wiper. The malware intends to destroy non-system files first, then system-related files. Destroying system related files while the overwriting of other files is pending can create instability and may lead to bricking the system before the complete destruction of the user's files is completed. In such cases, it may be possible to recover the files from the disk that haven't been overwritten yet.
The system folders reserved for destruction *after* all other files have been destroyed:
<ul>
<li>
&lt;Root_drive&gt;\Windows\Microsoft.NET</li>
<li>
&lt;Root_drive&gt;\Windows</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\Local Settings.*</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\AppData\\\\Local\\\\Application Data.*</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\Start Menu.*</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\Application Data.*</li>
<li>
&lt;Root_drive&gt;\\ProgramData\\\\Microsoft.*</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\AppData\\\\Local\\\\Microsoft.*</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\AppData\\\\Roaming\\\\Microsoft.*</li>
<li>
&lt;Root_drive&gt;\Documents and Settings</li>
<li>
&lt;Root_drive&gt;\ProgramData\Application Data</li>
<li>
&lt;Root_drive&gt;\Users\All Users</li>
<li>
&lt;Root_drive&gt;\Users\Default User</li>
<li>
&lt;Root_drive&gt;\system\drivers</li>
<li>
&lt;Root_drive&gt;\Windows\NTDS</li>
</ul>
The wiper will enumerate all file paths and decide if the file is "safe" to destroy immediately i.e., not a system file.
For each file that is deemed "safe" to destroy (i.e., not in the exclusions listed above), the wiper will: 
<ul>
<li>
Change the access control of files by giving the Local System Account (WellKnownSidType.LocalSystemSid) full control of the file.</li>
<li>
Use one of the two wiper functions to destroy the files.</li>
</ul>
<h3 id="h.sui7yei06t5q">Wiper function No. 1</h3>
This routine will use APIs such as NtfsControlFile with a control code of <a href="https://docs.microsoft.com/en-us/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data">FSCTL_SET_ZERO_DATA</a> (0x980C8) to fill up the file with all zero bytes.
<img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiznDZULRLv8joD_sL5oCN5tu7tS1MBoUnNM-cBOWRj_DJqdMtDk25WcyWNYId91DhoA29H3sgTNoQl210TO3cDunpZezb2Tk6QyN24tTcNUnIl0xE1odYmtOEhgiMf1CFpIeBogIZq6MuVvrRA6UnlktDoojjO4S8Cx8nE78wvCCPNCpQ-LpKTy4arnw/s16000/image1.png" style="max-width:80%;height:auto;width:auto;"/>
NtfsControlFile used against a file to zero it out.
<h3 id="h.18c01kreaxqv">Wiper function No. 2</h3>
The second routine used to overwrite the files is relatively simpler. It opens the target file as a FileStream and simply overwrites it with an array containing all zeros.
<img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgeYnbqn41q6SxAsH6ctYSdQPTZSKtqwxS_vnzInW8F_4YQ3nPhrnvlU83w8mseUxshkCzIqL2kCXOII5rsXLsRPAUfPOCME2GpqijXCJCDG-AMigW1Vp_wtbevVOVjpVI8slE_dSL_6ZYC1j979OReVjFiej5T4YrWJlsFo0hu3Kp1M01UCSm_rfAeKw/s16000/image2.png" style="max-width:80%;height:auto;width:auto;"/>
File being overwritten by an array containing all zeros.
Then the wiper moves on to the destruction of system files which is also carried out by the two wiper functions illustrated above. The order of destruction of the system files is:
First:
<ul>
<li>
&lt;Root_drive&gt;\system\drivers</li>
</ul>
Second:
<ul>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\Local Settings.*</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\AppData\\\\Local\\\\Application Data.*</li>
<li>
&lt;Root_drive&gt;\Windows\NTDS</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\AppData\\\\Local\\\\Microsoft.*</li>
<li>
&lt;Root_drive&gt;\\Users\\\\.*?\\\\AppData\\\\Roaming\\\\Microsoft.*</li>
</ul>
Third:
<ul>
<li>
&lt;Root_drive&gt;\Windows</li>
</ul>
The wiper then proceeds to destroy entries in the registry hives:
<ul>
<li>
HKLM</li>
<li>
HKCU</li>
<li>
HKU</li>
</ul>
It will first kill all processes on the system named "lsass". Then, it will set the current user as the owner of the registry keys under these hives, change the access rights to get full control of the reg keys and then overwrite the values. The wiper will also delete subkey trees recursively.
<img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhgwWtYNFZMlB6Nxr4HRL6BQcWhhphVuFgc4j30L18qD4RyNjR9jhOmK1jmsuDLh7BJ-K5vdyXWVeCk5e_JwsSRpXH22EKbz_47STDTPmYsBcgAuMjpFUVuW4CQQZhP9OC8W_H4VihT1cpdhS2B0PA8WKqz8NfXwrqciA-T36f6vOAQiYmtewl6YvGKRw/s16000/image4.png" style="max-width:80%;height:auto;width:auto;"/>
Wiper creating a rule to obtain full access to registry keys
<img border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjjjvKdPUtxuQvx-rfr_dBWMkGUIcvaL2sFcgYFTBnIx8cWdigi4gXZpUh5WYnqLWdwMF2IrfSCL1H0DRhqz1AlJ8WMM5uzsJQUlyqwL5iKIK0YElhCRyMAqjANiqgDJ5XQmxQMNJOQi62jIVRe4ZuEirVx3nBbJRQDd6KsjgAcsGRxJ_nfOZREqRsRSA/s16000/image6.png" style="max-width:80%;height:auto;width:auto;"/>
Wiper deleting subkey trees in registry.
Once all the destructive activity has been completed, the wiper will then shutdown the system using the <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-exitwindowsex">ExitWindowsEx</a> API call.
<h2 id="h.cppg99goporo">Coverage</h2>
Ways our customers can detect and block this threat are listed below.
<img border="0" height="622" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSXDXYZeQoDQhX-ag7d8nv4EJSYwdp4vL5k2ciGySLg56LAIY6-5NL7XQGmtQe8iJRSqaXFrWdoq6MNpY_PgCZoUgBYBsbVH7rLnxJ51JnQ7prHaFKjKPa9ltEcAvcUczFEQMDvpEd5si7vDxIOjc7d1Hi5ZyVlm89JfCweEpzi3u7N1eK-qfvDBGtug/w640-h622/image5.jpg" width="640"/>
<a href="https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/index.html">Cisco Secure Endpoint</a> (formerly AMP for Endpoints) is ideally suited to prevent the execution of the malware detailed in this post. Try Secure Endpoint for free <a href="https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/free-trial.html?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Damp-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Damp-free-trial">here.</a>
<a href="https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html">Cisco Secure Web Appliance</a> web scanning prevents access to malicious websites and detects malware used in these attacks.
<a href="https://www.cisco.com/c/en/us/products/security/email-security/index.html">Cisco Secure Email</a> (formerly Cisco Email Security) can block malicious emails sent by threat actors as part of their campaign. You can try Secure Email for free <a href="https://www.cisco.com/c/en/us/products/security/cloud-mailbox-defense?utm_medium%3Dweb-referral%26utm_source%3Dcisco%26utm_campaign%3Dcmd-free-trial-request%26utm_term%3Dpgm-talos-trial">here</a>.
<a href="https://www.cisco.com/c/en/us/products/security/firewalls/index.html">Cisco Secure Firewall</a> (formerly Next-Generation Firewall and Firepower NGFW) appliances such as Firepower Threat Defense (FTD), <a href="https://www.cisco.com/c/en/us/products/security/security-management/firepower-device-manager.html">Firepower Device Manager (FDM)</a>, <a href="https://www.cisco.com/c/en/us/products/collateral/security/firepower-ngfw-virtual/datasheet-c78-742858.html">Threat Defense Virtual</a>, <a href="https://www.cisco.com/c/en/us/products/security/adaptive-security-appliance-asa-software/index.html">Adaptive Security Appliance</a> can detect malicious activity associated with this threat.
<a href="https://www.cisco.com/c/en/us/products/security/threat-grid/index.html">Cisco Secure Malware Analytics</a> (formerly Threat Grid) identifies malicious binaries and builds protection into all Cisco Secure products.
<a href="https://www.cisco.com/c/en/us/products/security/stealthwatch/index.html">Cisco Secure Network/Cloud Analytics</a> (Stealthwatch/Stealthwatch Cloud) analyzes network traffic automatically and alerts users of potentially unwanted activity on every connected device.
For guidance on using Cisco Secure Analytics to respond to this threat, please click <a href="https://blogs.cisco.com/security/how-to-respond-to-apache-log4j-using-cisco-secure-analytics">here</a>.
<a href="https://meraki.cisco.com/products/appliances">Meraki MX</a> appliances can detect malicious activity associated with this threat.
<a href="https://umbrella.cisco.com/">Umbrella</a>, Secure Internet Gateway (SIG), blocks users from connecting to malicious domains, IPs and URLs, whether users are on or off the corporate network. Sign up for a free trial of Umbrella <a href="https://signup.umbrella.com/?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Dumbrella-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Dautomated-free-trial">here</a>.
Additional protections with context to your specific environment and threat data are available from the <a href="https://www.cisco.com/c/en/us/products/security/firepower-management-center/index.html">Firewall Management Center</a>.
<a href="https://signup.duo.com/?utm_source%3Dtalos%26utm_medium%3Dreferral%26utm_campaign%3Dduo-free-trial">Cisco Duo</a> provides multi-factor authentication for users to ensure only those authorized are accessing your network. 
Open-source Snort Subscriber Rule Set customers can stay up to date by downloading the latest rule pack available for purchase on <a href="https://www.snort.org/products">Snort.org</a>.
The following ClamAV signatures available for protection against this threat: 
<ul>
<li>
Win.Malware.DoubleZeroWiper-9942171-0</li>
</ul>
<h2 id="h.kust6uii2m1e">IOCs</h2>
d897f07ae6f42de8f35e2b05f5ef5733d7ec599d5e786d3225e66ca605a48f53
8dd8b9bd94de1e72f0c400c5f32dcefc114cc0a5bf14b74ba6edc19fd4aeb2a5
3b2e708eaa4744c76a633391cf2c983f4a098b46436525619e5ea44e105355fe
30b3cbe8817ed75d8221059e4be35d5624bd6b5dc921d4991a7adc4c3eb5de4a
Posted by
Asheer Malhotra
at
<a class="timestamp-link" href="http://blog.talosintelligence.com/2022/03/threat-advisory-doublezero.html" rel="bookmark" title="permanent link">12:57 PM</a>
<a href="https://www.blogger.com/post-edit.g?blogID=1029833275466591797&amp;postID=2926451460405415171&amp;from=pencil" title="Edit Post">
<img alt="" class="icon-action" height="18" src="https://img2.blogblog.com/img/icon18_edit_allbkg.gif" width="18"/>
</a>
Labels:
<a href="http://blog.talosintelligence.com/search/label/Malware" rel="tag">Malware</a>,
<a href="http://blog.talosintelligence.com/search/label/SecureX" rel="tag">SecureX</a>,
<a href="http://blog.talosintelligence.com/search/label/Ukraine" rel="tag">Ukraine</a>,
<a href="http://blog.talosintelligence.com/search/label/wiper" rel="tag">wiper</a>
Share This Post
<a class="facebook" href="https://www.facebook.com/sharer.php?u=http://blog.talosintelligence.com/2022/03/threat-advisory-doublezero.html&amp;text=Threat%20Advisory:%20DoubleZero" rel="nofollow" target="_blank" title="Share This On Facebook">
<img alt="Facebook share" border="0" src="https://www.talosintelligence.com/assets/icon_fb-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a class="twitter" href="https://twitter.com/share?url=http://blog.talosintelligence.com/2022/03/threat-advisory-doublezero.html&amp;text=Threat%20Advisory:%20DoubleZero" rel="nofollow" target="_blank" title="Tweet This">
<img alt="Twitter share" border="0" src="https://www.talosintelligence.com/assets/icon_tw-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a class="linkedin" href="https://www.linkedin.com/sharing/share-offsite/?url=http://blog.talosintelligence.com/2022/03/threat-advisory-doublezero.html&amp;text=Threat%20Advisory:%20DoubleZero" rel="nofollow" target="_blank" title="Share This On Linkedin">
<img alt="Linkedin share" border="0" src="https://www.talosintelligence.com/assets/icon_li-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a class="reddit" href="https://www.reddit.com/submit?url=http://blog.talosintelligence.com/2022/03/threat-advisory-doublezero.html&amp;title=Threat%20Advisory:%20DoubleZero" rel="nofollow" target="_blank" title="Reddit This">
<img alt="Reddit share" border="0" src="https://www.talosintelligence.com/assets/icon_re-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a href="mailto:?body=http://blog.talosintelligence.com/2022/03/threat-advisory-doublezero.html&amp;subject=Threat%20Advisory:%20DoubleZero">
<img alt="Email This" border="0" src="https://www.talosintelligence.com/assets/icon_em-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
</div>