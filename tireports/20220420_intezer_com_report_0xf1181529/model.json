{
    "id": "<report_0xf1181529>",
    "url": "https://www.intezer.com/blog/incident-response/analyze-malicious-pdf-files",
    "title": "How to Analyze Malicious PDF Files",
    "meta": [
        {
            "id": "<chapter_0xaf4cb5b7>",
            "title": "How to Analyze Malicious PDF Files",
            "title_level": 1,
            "sentences": [
                {
                    "id": "<sentence_0xf36defb6>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x417b2c4>": "https://149520725.v2.pressablecdn.com/wp-content/uploads/2020/07/Screenshot_20200720-202117__01-60x60.png"
                    },
                    "text": "",
                    "html": "<img class=\"user-photo\" src=\"https://149520725.v2.pressablecdn.com/wp-content/uploads/2020/07/Screenshot_20200720-202117__01-60x60.png\"/>"
                },
                {
                    "id": "<sentence_0x20df396a>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Written by Nicole Fishbein - 20 April 2022",
                    "html": "Written by Nicole Fishbein - 20 April 2022"
                },
                {
                    "id": "<sentence_0xf68c22f0>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x98b2b352>": "https://149520725.v2.pressablecdn.com/wp-content/uploads/2022/04/analyze-malicious-pdf-files-1270x475.png"
                    },
                    "text": "",
                    "html": "<img class=\"featured-img\" src=\"https://149520725.v2.pressablecdn.com/wp-content/uploads/2022/04/analyze-malicious-pdf-files-1270x475.png\"/>"
                },
                {
                    "id": "<sentence_0x85c8555>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Portable Document Format (PDF) files are cross-platform file format, supporting links, images, and fonts. The flexibility of the PDF format makes these files very useful and widely used by individuals and organizations all over the world. At the same time, this format is very appealing for cyber criminals, as they can create valid looking documents that will deliver malicious code, or will trick users into clicking links.",
                    "html": "<p>Portable Document Format (PDF) files are cross-platform file format, supporting links, images, and fonts. The flexibility of the PDF format makes these files very useful and widely used by individuals and organizations all over the world. At the same time, this format is very appealing for cyber criminals, as they can create valid looking documents that will deliver malicious code, or will trick users into clicking links.</p>"
                },
                {
                    "id": "<sentence_0xa27012f9>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Many attacks start from a received file, usually attached to an email. Then once the victim opens the file or interacts with it by clicking on links or buttons, the next stage of the attack is executed. The purpose of the attack can be information stealing, installing a backdoor, gaining access to the system, and more.",
                    "html": "<p>Many attacks start from a received file, usually attached to an email. Then once the victim opens the file or interacts with it by clicking on links or buttons, the next stage of the attack is executed. The purpose of the attack can be information stealing, installing a backdoor, gaining access to the system, and more. </p>"
                },
                {
                    "id": "<sentence_0x7aef72e0>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "One of the challenges of incident responders is to identify and classify the malicious files that were used in the attack that compromised the endpoint. PDF files make the process more time consuming because PDF files can carry malicious code that is hidden and compressed inside the streams of the file, all while these files are widely used for legitimate business both internally and externally in organizations. On top of that, alert fatigue can be a cause of missed alerts and increase the response time of new files to analyze.",
                    "html": "<p>One of the challenges of incident responders is to identify and classify the malicious files that were used in the attack that compromised the endpoint. PDF files make the process more time consuming because PDF files can carry malicious code that is hidden and compressed inside the streams of the file, all while these files are widely used for legitimate business both internally and externally in organizations. On top of that, alert fatigue can be a cause of missed alerts and increase the response time of new files to analyze. </p>"
                },
                {
                    "id": "<sentence_0x76da4345>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "In this article, we will describe the PDF format and how it can be abused to deliver malware. Then we will show how to identify and detect malicious PDF files using open-source and free tools.",
                    "html": "<p>In this article, we will describe the PDF format and how it can be abused to deliver malware. Then we will show how to identify and detect malicious PDF files using open-source and free tools. </p>"
                }
            ]
        }
    ],
    "chapters": [
        {
            "id": "<chapter_0x56a9d488>",
            "title": "How to Analyze Malicious PDF Files",
            "title_level": 1,
            "sentences": []
        },
        {
            "id": "<chapter_0x626b0b3d>",
            "title": "What is the PDF File Format?",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x1d34e27>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The PDF format was created by Adobe in 1993, as a text-based structure that gives users a reliable way to present documents regardless of the operating system and the software they are using. Besides text, PDF files can present a wide variety of content such as images, links, video files, 3D objects, editable forms and much more.",
                    "html": "<p>The PDF format was created by Adobe in 1993, as a text-based structure that gives users a reliable way to present documents regardless of the operating system and the software they are using. Besides text, PDF files can present a wide variety of content such as images, links, video files, 3D objects, editable forms and much more. </p>"
                },
                {
                    "id": "<sentence_0x9748f01a>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The PDF structure is hierarchical and contains four main parts:",
                    "html": "<p>The PDF structure is hierarchical and contains four main parts: </p>"
                },
                {
                    "id": "<sentence_0x1a9e0631>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "1. Header Specifies the version number of the PDF.",
                    "html": "<p>1. Header \u2013 Specifies the version number of the PDF.</p>"
                },
                {
                    "id": "<sentence_0x891a2860>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "2. The body The documents part that holds all of the information including text and other elements such as images, links, etc.",
                    "html": "<p>2. The body \u2013 The document\u2019s part that holds all of the information including text and other elements such as images, links, etc.</p>"
                },
                {
                    "id": "<sentence_0x3a2ee0b3>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The body of the PDF file contains different objects which can reference each other, the objects have different types:",
                    "html": "<p>The body of the PDF file contains different objects which can reference each other, the objects have different types:</p>"
                },
                {
                    "id": "<sentence_0xe7298b75>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Names /name backslash followed by ASCII characters setting a unique name.",
                    "html": "<ul><li>Names \u2013 <code>/name</code> backslash followed by ASCII characters \u2013 setting a unique name.</li></ul>"
                },
                {
                    "id": "<sentence_0xeaf8799f>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Strings (text) its full syntax is a bit complex but whats important is to know that it is enclosed in parentheses.<crlf>Arrays enclosed with square brackets ([...]) can contain other objects.<crlf>Dictionaries table of key and value pairs. The key is a name object and the value can be any other object. Enclosed within double angle brackets (<<...>>)<crlf>Streams contains embedded data structures like images (or code) which can be compressed. Streams represented by a dictionary that set the streams length with the key /Length and encoding /Filters.<crlf>Indirect object object that has a unique ID, the object starts with the keyboard obj and ends with endobj other objects can reference the object using its ID. For example a reference to object with ID 3 we would look like this: 3 0 R",
                    "html": "<ul><li>Strings \u2013 <code>(text)</code> its full syntax is a bit complex but what\u2019s important is to know that it is enclosed in parentheses. </li><li>Arrays \u2013 enclosed with square brackets <code>([...])</code> can contain other objects.</li><li>Dictionaries \u2013 table of key and value pairs. The key is a name object and the value can be any other object. Enclosed within double angle brackets <code>(&lt;&lt;...&gt;&gt;)</code></li><li>Streams \u2013 contains embedded data structures like images (or code) which can be compressed. Streams represented by a dictionary that set the stream\u2019s length with the key <code>/Length</code> and encoding <code>/Filters</code>.</li><li>Indirect object \u2013 object that has a unique ID, the object starts with the keyboard <code>obj</code> and ends with <code>endobj</code> other objects can reference the object using its ID. For example a reference to object with ID 3 we would look like this: <code>3 0 R</code>\n</li></ul>"
                },
                {
                    "id": "<sentence_0xde9a7553>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "3. Cross-reference table Specifies the offset from the start of the file to each object in the file, so that the PDF reader will be able to locate them without loading the whole document (it can save time when opening big files).<crlf>4. Trailer Specifies information about the cross-reference table so the PDF reader will be able to find the table and other objects. PDF readers start reading the file from the end, lets look at the example below:",
                    "html": "<p>3. Cross-reference table \u2013 Specifies the offset from the start of the file to each object in the file, so that the PDF reader will be able to locate them without loading the whole document (it can save time when opening big files).\n4. Trailer \u2013 Specifies information about the cross-reference table so the PDF reader will be able to find the table and other objects. PDF readers start reading the file from the end, let\u2019s look at the example below:</p>"
                },
                {
                    "id": "<sentence_0xccd33888>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0xe660dd7d>": "xref\n0 14\n0000000000 65535 f\n0000000015 00000 n\n0000000660 00000 n\n0000000803 00000 n\n0000001007 00000 n\n0000001322 00000 n\n0000001049 00000 n\n0000001410 00000 n\n0000001200 00000 n\n0000001461 00000 n\n0000001513 00000 n\n0000001573 00000 n\n0000001632 00000 n\n0000001737 00000 n\ntrailer\n<</Size 14/Root 12 0 R/Info 13 0 R/ID [<019e8b45c3227a3f8f35b7a9a09c2f70><019e8b45c3227a3f8f35b7a9a09c2f70>]>>\n%iText-5.5.10\nstartxref\n1901\n%%EOF"
                    },
                    "text": "",
                    "html": "<code class=\"language- hljs language-sas\">xref\n0 14\n0000000000 65535 f\n0000000015 00000 n\n0000000660 00000 n\n0000000803 00000 n\n0000001007 00000 n\n0000001322 00000 n\n0000001049 00000 n\n0000001410 00000 n\n0000001200 00000 n\n0000001461 00000 n\n0000001513 00000 n\n0000001573 00000 n\n0000001632 00000 n\n0000001737 00000 n\ntrailer\n&lt;&lt;/Size 14/Root 12 0 R/Info 13 0 R/ID [&lt;019e8b45c3227a3f8f35b7a9a09c2f70&gt;&lt;019e8b45c3227a3f8f35b7a9a09c2f70&gt;]&gt;&gt;\n%iText-5.5.10\nstartxref\n1901\n%%EOF</code>"
                },
                {
                    "id": "<sentence_0xaaf540a5>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The first line (from the bottom) is %%EOF above is the offset of the cross-reference table 1901. Above that is the trailer that specifies different settings:",
                    "html": "<p>The first line (from the bottom) is %%EOF above is the offset of the cross-reference table \u2013 1901. Above that is the trailer that specifies different settings: </p>"
                },
                {
                    "id": "<sentence_0x10af1ee6>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Size number of entries in the cross-reference table<crlf>Root which entry in the table holds the offset for the root object. This object is the Document Catalog; it contains information about how the file will be presented and references to other objects that describe the documents content.<crlf>Info which entry in the table holds the offset for the documents information dictionary.",
                    "html": "<ul><li>Size \u2013 number of entries in the cross-reference table</li><li>Root \u2013 which entry in the table holds the offset for the root object. This object is the Document Catalog; it contains information about how the file will be presented and references to other objects that describe the document\u2019s content. </li><li>Info \u2013 which entry in the table holds the offset for the document\u2019s information dictionary.</li></ul>"
                },
                {
                    "id": "<sentence_0xc670835f>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "PDF files can be modified so additional elements (such cross-reference tables) will be appended to the end of the file. Now that we understand the format lets see how it can be used by attackers to conceal malicious code.",
                    "html": "<p>PDF files can be modified so additional elements (such cross-reference tables) will be appended to the end of the file. Now that we understand the format let\u2019s see how it can be used by attackers to conceal malicious code.</p>"
                }
            ]
        },
        {
            "id": "<chapter_0xbf7dec58>",
            "title": "How PDF Files Get Used to Deliver Malware",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x4c6252e9>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "PDF files support a wide variety of data types that can be present (and not necessarily visible). Threat actors fully control the content of the files they send to lure victims and they use the different capabilities of the PDF format for their attacks.",
                    "html": "<p>PDF files support a wide variety of data types that can be present (and not necessarily visible). Threat actors fully control the content of the files they send to lure victims and they use the different capabilities of the PDF format for their attacks. </p>"
                },
                {
                    "id": "<sentence_0xd098918>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xc81b9af0>": "https://analyze.intezer.com/files/dd294bd399212b760e68434af9c96a70f0ef9f7bc43b06d67addd3472eb6d69a",
                        "<a_0xd995281>": "https://unit42.paloaltonetworks.com/phishing-trends-with-pdf-files/"
                    },
                    "text": "Many phishing attacks will contain links or images of buttons, coupons, fake CAPTCHA, fake play buttons and more. The purpose of these files is to redirect the victims to sites controlled by the threat actors where they can proceed to the next stage of the attack.",
                    "html": "<p>Many phishing attacks will contain links or images of buttons, coupons, <a class=\"blog-text-link\" href=\"https://analyze.intezer.com/files/dd294bd399212b760e68434af9c96a70f0ef9f7bc43b06d67addd3472eb6d69a\" rel=\"noreferrer noopener\" target=\"_blank\">fake CAPTCHA</a>, fake play buttons <a class=\"blog-text-link\" href=\"https://unit42.paloaltonetworks.com/phishing-trends-with-pdf-files/\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">and more</a>. The purpose of these files is to redirect the victims to sites controlled by the threat actors where they can proceed to the next stage of the attack.</p>"
                },
                {
                    "id": "<sentence_0xe8859e37>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "PDF files natively support JavaScript, so attackers can create files that will execute scripts once a file has been opened at this stage to download additional payload or steal information.",
                    "html": "<p>PDF files natively support JavaScript, so attackers can create files that will execute scripts once a file has been opened at this stage to download additional payload or steal information.</p>"
                },
                {
                    "id": "<sentence_0x3cb08e51>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Another way in which threat actors can use the format is to deliver malware in the PDF streams. Streams can contain any type of data (including scripts and binary files) and they can be compressed and encoded which makes it harder to detect embedded code inside files. The compression technique is specified with the name /filter (as mentioned in its part of the dictionary that describes a stream). A stream can have more than one filter.",
                    "html": "<p>Another way in which threat actors can use the format is to deliver malware in the PDF streams. Streams can contain any type of data (including scripts and binary files) and they can be compressed and encoded which makes it harder to detect embedded code inside files. The compression technique is specified with the name /filter (as mentioned in its part of the dictionary that describes a stream). A stream can have more than one filter.</p>"
                },
                {
                    "id": "<sentence_0xd8e22e26>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xddc1dc3b>": "https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=adobe+pdf+reader"
                    },
                    "text": "There are many PDF readers that are being used, some are multiplatform, others based on web browsers but like any other software they have bugs and vulnerabilities. Adobe PDF Reader alone has 91 reported vulnerabilities. Therefore threat actors can make PDF files that will exploit vulnerabilities, which will allow them to execute code and gain access to the victims endpoint.",
                    "html": "<p>There are many PDF readers that are being used, some are multiplatform, others based on web browsers but like any other software they have bugs and vulnerabilities. Adobe PDF Reader alone has <a class=\"blog-text-link\" href=\"https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=adobe+pdf+reader\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">91 reported vulnerabilities</a>. Therefore threat actors can make PDF files that will exploit vulnerabilities, which will allow them to execute code and gain access to the victim\u2019s endpoint. </p>"
                }
            ]
        },
        {
            "id": "<chapter_0xd922ca4b>",
            "title": "Investigating Suspicious PDF Files",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x261ba030>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xce96a165>": "https://github.com/jesparza/peepdf"
                    },
                    "text": "Lets investigate the following PDF file (MD5: a2852936a7e33787c0ab11f346631d89). The first tool that we are going to use is peepdf, a python tool that parses PDF files allowing us to get the types and content of each object. It will also color the object and highlight the objects that make the file suspicious, like the presence of javascript and embedded files.",
                    "html": "<p>Let\u2019s investigate the following PDF file (MD5: a2852936a7e33787c0ab11f346631d89). The first tool that we are going to use is <a class=\"blog-text-link\" href=\"https://github.com/jesparza/peepdf\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">peepdf</a>, a python tool that parses PDF files allowing us to get the types and content of each object. It will also color the object and highlight the objects that make the file suspicious, like the presence of javascript and embedded files.</p>"
                },
                {
                    "id": "<sentence_0x29df8629>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "After running the peepdf with the PDF file we get the output below. We can see that the file was updated and it has two versions. In the later version we can spot an encoded javascript code which makes this file suspicious so we will extract the content of the object and investigate it.",
                    "html": "<p>After running the peepdf with the PDF file we get the output below. We can see that the file was updated and it has two versions. In the later version we can spot an encoded javascript code which makes this file suspicious so we will extract the content of the object and investigate it.</p>"
                },
                {
                    "id": "<sentence_0xa445ddcb>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<img_0xfd5bd314>": "https://lh3.googleusercontent.com/nRKngVqb3ZPy-IkpGtA54VWSBeOoBH6tIBZFcBc-a8YNiInuIEv8IskvRH4_hY8ghwhN8EBEgbVKy73Sx-vpY0OLmCcqcKXLYMtY2QSrP7gVb3ZSW7WHdvn-Ycq3hgkpDtJvXPpe"
                    },
                    "text": "Output of peepdf",
                    "html": "<figure class=\"wp-block-image\"><img alt=\"\" class=\"jetpack-lazy-image\" src=\"https://lh3.googleusercontent.com/nRKngVqb3ZPy-IkpGtA54VWSBeOoBH6tIBZFcBc-a8YNiInuIEv8IskvRH4_hY8ghwhN8EBEgbVKy73Sx-vpY0OLmCcqcKXLYMtY2QSrP7gVb3ZSW7WHdvn-Ycq3hgkpDtJvXPpe\"/><img alt=\"\" src=\"https://lh3.googleusercontent.com/nRKngVqb3ZPy-IkpGtA54VWSBeOoBH6tIBZFcBc-a8YNiInuIEv8IskvRH4_hY8ghwhN8EBEgbVKy73Sx-vpY0OLmCcqcKXLYMtY2QSrP7gVb3ZSW7WHdvn-Ycq3hgkpDtJvXPpe\"/><figcaption>Output of peepdf</figcaption></figure>"
                },
                {
                    "id": "<sentence_0xa8a98bb>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x11732c10>": "https://github.com/DidierStevens/DidierStevensSuite/blob/master/pdf-parser.py"
                    },
                    "text": "To extract the data from the suspicious object number 18 we will use another open-source tool called pdf-parser created by Didier Stevens. This python tool allows us to inspect and extract different objects. The command below will extract the javascript saved in the object into a file called extract_js:",
                    "html": "<p>To extract the data from the suspicious object number 18 we will use another open-source tool called <a class=\"blog-text-link\" href=\"https://github.com/DidierStevens/DidierStevensSuite/blob/master/pdf-parser.py\" rel=\"noreferrer noopener\" target=\"_blank\">pdf-parser</a> created by Didier Stevens. This python tool allows us to inspect and extract different objects. The command below will extract the javascript saved in the object into a file called extract_js:</p>"
                },
                {
                    "id": "<sentence_0x7a702ee3>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0x7362f2ef>": "pdf-parser.py -f -o 18 -d extract_js files/example1.pdf"
                    },
                    "text": "",
                    "html": "<code class=\"language- hljs language-powershell\">pdf-parser.py -f -o 18 -d extract_js files/example1.pdf</code>"
                },
                {
                    "id": "<sentence_0x64539e58>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Upon inspecting the javascript code we can determine that the PDF file will open a window that will ask the victim to login into his Amazon account, but the data will be submit to a malicious site http://sellercentral[.]amazon.de.56U8GTHDGT4U7YWEWE84GTYS.abecklink.com eventually leading to credential stealing. In the screenshot below is the execution of the PDF file in Intezer Analyze, which lets us inspect the behavior of the file.",
                    "html": "<p>Upon inspecting the javascript code we can determine that the PDF file will open a window that will ask the victim to login into his Amazon account, but the data will be submit to a malicious site http://sellercentral[.]amazon.de.56U8GTHDGT4U7YWEWE84GTYS.abecklink.com eventually leading to credential stealing. In the screenshot below is the execution of the PDF file in Intezer Analyze, which lets us inspect the behavior of the file. </p>"
                },
                {
                    "id": "<sentence_0x4f4f6425>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x6163203d>": "https://www.bleepingcomputer.com/news/security/clever-amazon-phishing-scam-creates-login-prompts-in-pdf-docs/"
                    },
                    "text": "This PDF was sent as part of a phishing scam that targeted German speaking victims: the PDF was attached to an email regarding a tax invoice asking the victims to open the attached document and login to their Amazon account.",
                    "html": "<p>This PDF was sent as part of a <a class=\"blog-text-link\" href=\"https://www.bleepingcomputer.com/news/security/clever-amazon-phishing-scam-creates-login-prompts-in-pdf-docs/\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">phishing scam</a> that targeted German speaking victims: the PDF was attached to an email regarding a tax invoice asking the victims to open the attached document and login to their Amazon account.</p>"
                },
                {
                    "id": "<sentence_0x75fcdba6>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x68772ffe>": "https://analyze.intezer.com/files/2e26d1a3d65d7e15658033c8936c93d74cd7a1b0214c98d9a2e575fa4017d123",
                        "<img_0x9b8d06be>": "https://lh3.googleusercontent.com/3FmrRcQAFqO0LzQYcH6ngE8tVPmPFRw-x4-EbWHJWIUJ5of2L5JITvGmdrMp3OiQKr2yozMgXdFApsy2CnM6MR3fu3F_nB_7Q7c1hmThBn78Qg-arLsxSMN3DUIw9LTMyn2KMSOj"
                    },
                    "text": "The PDF file as it can be seen in the behavior tab in Intezer Analyze.",
                    "html": "<figure class=\"wp-block-image is-resized\"><img alt=\"malicious pdf file behavioral analysis\" class=\"jetpack-lazy-image\" height=\"369\" src=\"https://lh3.googleusercontent.com/3FmrRcQAFqO0LzQYcH6ngE8tVPmPFRw-x4-EbWHJWIUJ5of2L5JITvGmdrMp3OiQKr2yozMgXdFApsy2CnM6MR3fu3F_nB_7Q7c1hmThBn78Qg-arLsxSMN3DUIw9LTMyn2KMSOj\" width=\"840\"/><img alt=\"malicious pdf file behavioral analysis\" height=\"369\" src=\"https://lh3.googleusercontent.com/3FmrRcQAFqO0LzQYcH6ngE8tVPmPFRw-x4-EbWHJWIUJ5of2L5JITvGmdrMp3OiQKr2yozMgXdFApsy2CnM6MR3fu3F_nB_7Q7c1hmThBn78Qg-arLsxSMN3DUIw9LTMyn2KMSOj\" width=\"840\"/><figcaption>The PDF file as it can be seen in the <a class=\"blog-text-link\" href=\"https://analyze.intezer.com/files/2e26d1a3d65d7e15658033c8936c93d74cd7a1b0214c98d9a2e575fa4017d123\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">behavior tab</a> in Intezer Analyze. </figcaption></figure>"
                },
                {
                    "id": "<sentence_0x377e57b8>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Lets take a look at another PDF file (MD5: 1ba5c7ecab62609e4f1d44192cef850e). Once again we will start by running peepdf on the file to understand if the file might be malicious.",
                    "html": "<p>Let\u2019s take a look at another PDF file (MD5: 1ba5c7ecab62609e4f1d44192cef850e). Once again we will start by running peepdf on the file to understand if the file might be malicious.</p>"
                },
                {
                    "id": "<sentence_0x1f54440d>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<img_0xa847ecad>": "https://lh6.googleusercontent.com/qx9hL7oPvQ1xv-a5W5vku31__fCGW1Cxh711qlVfsgUHi1oMT6xcXteiLNxrc_4lUn_leXTOA9ivU1mOKrHdjAfyNfZUr7l88KWXjMte1xnNuAHph_R3DcypYehaoFR-huWe1a51"
                    },
                    "text": "Peepdf output",
                    "html": "<figure class=\"wp-block-image\"><img alt=\"\" class=\"jetpack-lazy-image\" src=\"https://lh6.googleusercontent.com/qx9hL7oPvQ1xv-a5W5vku31__fCGW1Cxh711qlVfsgUHi1oMT6xcXteiLNxrc_4lUn_leXTOA9ivU1mOKrHdjAfyNfZUr7l88KWXjMte1xnNuAHph_R3DcypYehaoFR-huWe1a51\"/><img alt=\"\" src=\"https://lh6.googleusercontent.com/qx9hL7oPvQ1xv-a5W5vku31__fCGW1Cxh711qlVfsgUHi1oMT6xcXteiLNxrc_4lUn_leXTOA9ivU1mOKrHdjAfyNfZUr7l88KWXjMte1xnNuAHph_R3DcypYehaoFR-huWe1a51\"/><figcaption>Peepdf output</figcaption></figure>"
                },
                {
                    "id": "<sentence_0x442ee808>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "As we see in the output below the file contains a javascript object (object number 9) and one embedded file (object number 8). Lets inspect the content of object 8 by running pdf-parser as we did in the previous example:",
                    "html": "<p>As we see in the output below the file contains a javascript object (object number 9) and one embedded file (object number 8). Let\u2019s inspect the content of object 8 by running pdf-parser as we did in the previous example:</p>"
                },
                {
                    "id": "<sentence_0x5e84ab6c>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0x9929533b>": "remnux@6866a79d9f93:~$ pdf-parser.py -o 8 -f -d drop_file2 exmple2.pdf \nobj 8 0\n Type: /EmbeddedFile\n Referencing:\n Contains stream\n <<\n /Length 2004304\n /Filter /FlateDecode\n /Type /EmbeddedFile\n >>"
                    },
                    "text": "",
                    "html": "<code class=\"language- hljs language-powershell\">remnux@6866a79d9f93:~$ pdf-parser.py -o 8 -f -d drop_file2 exmple2.pdf \nobj 8 0\n Type: /EmbeddedFile\n Referencing:\n Contains stream\n &lt;&lt;\n /Length 2004304\n /Filter /FlateDecode\n /Type /EmbeddedFile\n &gt;&gt;</code>"
                },
                {
                    "id": "<sentence_0x973151cc>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The content of the embedded file is saved to drop_file2, we see that the stream containing the data is The content of the embedded file is saved to drop_file2. We can see that the stream containing the data is decoded with FlateDecode therefore we use the -f flag which tells pdf-parser to pass the data through filters. Next well check what is the type of the embedded data, so lets use the file command on the extracted file:",
                    "html": "<p>The content of the embedded file is saved to drop_file2, we see that the stream containing the data is The content of the embedded file is saved to drop_file2. We can see that the stream containing the data is decoded with FlateDecode therefore we use the -f flag which tells pdf-parser to pass the data through filters. Next we\u2019ll check what is the type of the embedded data, so let\u2019s use the file command on the extracted file:</p>"
                },
                {
                    "id": "<sentence_0x9bb71fb2>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<code_0x94e1f976>": "remnux@6866a79d9f93:~$ file drop_file2\ndrop_file2: Rich Text Format data, unknown version"
                    },
                    "text": "",
                    "html": "<code class=\"language- hljs language-ruby\">remnux@6866a79d9f93:~$ file drop_file2\ndrop_file2: Rich Text Format data, unknown version</code>"
                },
                {
                    "id": "<sentence_0x2dc14111>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x7e787d5>": "https://github.com/decalage2/oletools/wiki/rtfobj"
                    },
                    "text": "At this point, we need to investigate an RTF file. Well use rtfobj from oletools to inspect the file:",
                    "html": "<p>At this point, we need to investigate an RTF file. We\u2019ll use <a class=\"blog-text-link\" href=\"https://github.com/decalage2/oletools/wiki/rtfobj\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">rtfobj</a> from oletools to inspect the file:</p>"
                },
                {
                    "id": "<sentence_0xd956ea9a>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<img_0xb3fdac06>": "https://lh6.googleusercontent.com/OdzG26EpV5_Ni-iGcJ9k_bPFPgf51FaUdk3eTT_uiUBUcrLT5EvnuDDTVI_BDO1v1YPufCzCou5kPaYeCtIXMGL8xI-_Jpd63nEvym0OpomBtRKpPT80hdm0H57RIQEOjaYVdIV2"
                    },
                    "text": "rtfobj output for the extracted RTF file",
                    "html": "<figure class=\"wp-block-image\"><img alt=\"\" class=\"jetpack-lazy-image\" src=\"https://lh6.googleusercontent.com/OdzG26EpV5_Ni-iGcJ9k_bPFPgf51FaUdk3eTT_uiUBUcrLT5EvnuDDTVI_BDO1v1YPufCzCou5kPaYeCtIXMGL8xI-_Jpd63nEvym0OpomBtRKpPT80hdm0H57RIQEOjaYVdIV2\"/><img alt=\"\" src=\"https://lh6.googleusercontent.com/OdzG26EpV5_Ni-iGcJ9k_bPFPgf51FaUdk3eTT_uiUBUcrLT5EvnuDDTVI_BDO1v1YPufCzCou5kPaYeCtIXMGL8xI-_Jpd63nEvym0OpomBtRKpPT80hdm0H57RIQEOjaYVdIV2\"/><figcaption>rtfobj output for the extracted RTF file</figcaption></figure>"
                },
                {
                    "id": "<sentence_0x2134d0d6>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xf90f13c9>": "https://www.intezer.com/blog/malware-analysis/analyze-malicious-microsoft-office-files/",
                        "<a_0x29bffd80>": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882",
                        "<a_0x8de5fe54>": "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2017-11882"
                    },
                    "text": "You can find more information about the tools and techniques to analyze malicious Office files by checking out our previous blog. From the output of rtfobj we learn that the extracted RTF file exploited CVE-2017-11882 a known vulnerability in Microsoft Equation Editor that enables code execution. Since Microsoft patched this vulnerability, this particular attack would only be effective if a user failed to keep their software updated. Now, we can either continue investigating the shellcode located in the RTF file or upload the original PDF to Intezer Analyze that will automatically execute all the steps we just did and on top of that provide a classification of the threat executed by the PDF.",
                    "html": "<p>You can find more information about the tools and techniques to <a class=\"blog-text-link\" href=\"https://www.intezer.com/blog/malware-analysis/analyze-malicious-microsoft-office-files/\" rel=\"noreferrer noopener\" target=\"_blank\">analyze malicious Office files</a> by checking out our previous blog. From the output of rtfobj we learn that the extracted RTF file exploited <a class=\"blog-text-link\" href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">CVE-2017-11882</a> \u2013 a known vulnerability in Microsoft Equation Editor that enables code execution. Since <a class=\"blog-text-link\" href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2017-11882\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">Microsoft patched</a> this vulnerability, this particular attack would only be effective if a user failed to keep their software updated. Now, we can either continue investigating the shellcode located in the RTF file or upload the original PDF to Intezer Analyze that will automatically execute all the steps we just did and on top of that provide a classification of the threat executed by the PDF.</p>"
                },
                {
                    "id": "<sentence_0x4c52ca0c>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "The results of the analysis can be seen in the screenshot below:",
                    "html": "<p>The results of the analysis can be seen in the screenshot below:</p>"
                },
                {
                    "id": "<sentence_0xe38aabec>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0xaccfa738>": "https://lh6.googleusercontent.com/zQ6fRO1GMYEH9K4Hi_qumN68AmjxLIj6X1up0hQtoeKwa-XwN1lJzWnDdOUHhWKi6qpxZNejcyYnCHdt1ZA2uHVlQwIiQAeLlUbofEH4Qpv5TiysPC45O_B-OTOfwbaSJKdq7W5e"
                    },
                    "text": "",
                    "html": "<p class=\"has-text-align-center\"><img class=\"jetpack-lazy-image\" height=\"232\" src=\"https://lh6.googleusercontent.com/zQ6fRO1GMYEH9K4Hi_qumN68AmjxLIj6X1up0hQtoeKwa-XwN1lJzWnDdOUHhWKi6qpxZNejcyYnCHdt1ZA2uHVlQwIiQAeLlUbofEH4Qpv5TiysPC45O_B-OTOfwbaSJKdq7W5e\" width=\"624\"/><img height=\"232\" src=\"https://lh6.googleusercontent.com/zQ6fRO1GMYEH9K4Hi_qumN68AmjxLIj6X1up0hQtoeKwa-XwN1lJzWnDdOUHhWKi6qpxZNejcyYnCHdt1ZA2uHVlQwIiQAeLlUbofEH4Qpv5TiysPC45O_B-OTOfwbaSJKdq7W5e\" width=\"624\"/></p>"
                },
                {
                    "id": "<sentence_0x563f2a77>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x6bacf34d>": "https://analyze.intezer.com/files/7a810869705eed61ae1afa60c0f4cf202fe4137fa7ffb164d523d9d380279ee6"
                    },
                    "text": "Behavior tab in the PDF analysis",
                    "html": "<p class=\"has-text-align-center\">Behavior tab in the PDF <a class=\"blog-text-link\" href=\"https://analyze.intezer.com/files/7a810869705eed61ae1afa60c0f4cf202fe4137fa7ffb164d523d9d380279ee6\" rel=\"noreferrer noopener\" target=\"_blank\">analysis</a></p>"
                },
                {
                    "id": "<sentence_0x6a1cd74a>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x59e2face>": "https://blogs.blackberry.com/en/2021/09/threat-thursday-raccoon-infostealer#:~:text=Raccoon%20is%20considered,April%20of%202019."
                    },
                    "text": "In the process tree we see the execution chain of the PDF followed by word process to open the RTF file and then the call to Equation Editor that is being exploited by the RTF. The malware is classified as Raccoon Stealer. We can see in the Genetic Analysis tab that the sample shares code with Azorult and thats because Raccoon Stealer is considered as its successor.",
                    "html": "<p>In the process tree we see the execution chain of the PDF followed by word process to open the RTF file and then the call to Equation Editor that is being exploited by the RTF. The malware is classified as Raccoon Stealer. We can see in the Genetic Analysis tab that the sample shares code with Azorult and that\u2019s because Raccoon Stealer is considered as its <a class=\"blog-text-link\" href=\"https://blogs.blackberry.com/en/2021/09/threat-thursday-raccoon-infostealer#:~:text=Raccoon%20is%20considered,April%20of%202019.\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">successor</a>.</p>"
                },
                {
                    "id": "<sentence_0x9dfb19eb>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x3a45b879>": "https://analyze.intezer.com/analyses/9fd616c5-d21d-40a0-bf24-9df348805752/genetic-analysis",
                        "<img_0x52316087>": "https://lh5.googleusercontent.com/7jVpZJZXIyVcNAa3ndOx55Dstli-6uy-NGBy9Nnkr0C7jz39iKH8PV51O2G6EuXn3NyzmjXtBk_nSY1_g3j7mY4QgwJs_fbRpmEU8rQl-i9O8foChPQSCeoMbDeXmxntrf6h7APW"
                    },
                    "text": "Genetic Analysis tab of the PDF file in intezer Analyze",
                    "html": "<figure class=\"wp-block-image\"><img alt=\"analysis of pdf file\" class=\"jetpack-lazy-image\" src=\"https://lh5.googleusercontent.com/7jVpZJZXIyVcNAa3ndOx55Dstli-6uy-NGBy9Nnkr0C7jz39iKH8PV51O2G6EuXn3NyzmjXtBk_nSY1_g3j7mY4QgwJs_fbRpmEU8rQl-i9O8foChPQSCeoMbDeXmxntrf6h7APW\"/><img alt=\"analysis of pdf file\" src=\"https://lh5.googleusercontent.com/7jVpZJZXIyVcNAa3ndOx55Dstli-6uy-NGBy9Nnkr0C7jz39iKH8PV51O2G6EuXn3NyzmjXtBk_nSY1_g3j7mY4QgwJs_fbRpmEU8rQl-i9O8foChPQSCeoMbDeXmxntrf6h7APW\"/><figcaption><a class=\"blog-text-link\" href=\"https://analyze.intezer.com/analyses/9fd616c5-d21d-40a0-bf24-9df348805752/genetic-analysis\">Genetic Analysis tab</a> of the PDF file in intezer Analyze</figcaption></figure>"
                }
            ]
        },
        {
            "id": "<chapter_0xef109e39>",
            "title": "Scanning a High Volume of PDFs for Malware",
            "title_level": 2,
            "sentences": [
                {
                    "id": "<sentence_0x77ce417f>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "PDF files are very common and useful for all types of organizations but the flexibility of the PDF format makes it also very attractive for threat actors who use it to carry out different sorts of attacks. In this blog we presented several open-source and free tools that can be used for static analysis of a single PDF.",
                    "html": "<p>PDF files are very common and useful for all types of organizations but the flexibility of the PDF format makes it also very attractive for threat actors who use it to carry out different sorts of attacks. In this blog we presented several open-source and free tools that can be used for static analysis of a single PDF. </p>"
                },
                {
                    "id": "<sentence_0xa28b1ca6>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "But manual analysis of PDFs isnt scalable for organizations when there are hundreds of files (or even more) that need to be investigated. In this case we can use a platform like Intezer that will automate the initial investigation of the files, allowing us to focus our efforts only on cases where the manual analysis is absolutely mandatory.",
                    "html": "<p>But manual analysis of PDFs isn\u2019t scalable for organizations when there are hundreds of files (or even more) that need to be investigated. In this case we can use a platform like Intezer that will automate the initial investigation of the files, allowing us to focus our efforts only on cases where the manual analysis is absolutely mandatory.\n</p>"
                },
                {
                    "id": "<sentence_0xcd68af80>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x278223d>": "https://analyze.intezer.com/",
                        "<a_0x4ff5d9fc>": "https://www.intezer.com/book-a-demo-analyze/"
                    },
                    "text": "Scan 50 files for free (including PDFs) with Intezer Analyze. If you want to learn how your team can automate alert triage to scan files, URLs, memory dumps, and more book a time to talk with us.",
                    "html": "<p><a class=\"blog-text-link\" href=\"https://analyze.intezer.com/\">Scan 50 files for free</a> (including PDFs) with Intezer Analyze. If you want to learn how your team can automate alert triage to scan files, URLs, memory dumps, and more \u2013 book a time to <a class=\"blog-text-link\" href=\"https://www.intezer.com/book-a-demo-analyze/\">talk with us.</a> </p>"
                },
                {
                    "id": "<sentence_0xaddc1d32>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<img_0x417b2c4>": "https://149520725.v2.pressablecdn.com/wp-content/uploads/2020/07/Screenshot_20200720-202117__01-60x60.png"
                    },
                    "text": "",
                    "html": "<img class=\"user-photo\" src=\"https://149520725.v2.pressablecdn.com/wp-content/uploads/2020/07/Screenshot_20200720-202117__01-60x60.png\"/>"
                },
                {
                    "id": "<sentence_0xf0053501>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Nicole Fishbein",
                    "html": " Nicole Fishbein"
                },
                {
                    "id": "<sentence_0xd91cdbbe>",
                    "is_empty": true,
                    "have_tags": true,
                    "tags": {
                        "<a_0x46cd2aab>": "https://twitter.com/NicoleFishi19"
                    },
                    "text": "",
                    "html": "<a class=\"twitter-link blog-text-link\" href=\"https://twitter.com/NicoleFishi19\" target=\"_blank\"></a>"
                },
                {
                    "id": "<sentence_0x29eee593>",
                    "is_empty": false,
                    "have_tags": false,
                    "tags": {},
                    "text": "Nicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps.",
                    "html": "<p>Nicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps.</p>"
                },
                {
                    "id": "<sentence_0x491afafb>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x87e773d5>": "https://www.intezer.com/tag/dfir/"
                    },
                    "text": "DFIR",
                    "html": "<a class=\"blog-text-link\" href=\"https://www.intezer.com/tag/dfir/\" rel=\"tag\">DFIR</a>"
                },
                {
                    "id": "<sentence_0x36d15ec8>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xe09fba8b>": "https://www.intezer.com/tag/digital-forensics/"
                    },
                    "text": "Digital Forensics",
                    "html": "<a class=\"blog-text-link\" href=\"https://www.intezer.com/tag/digital-forensics/\" rel=\"tag\">Digital Forensics</a>"
                },
                {
                    "id": "<sentence_0xdaaad70f>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xdfc8a3c6>": "https://www.intezer.com/tag/fine-analysis/"
                    },
                    "text": "fine analysis",
                    "html": "<a class=\"blog-text-link\" href=\"https://www.intezer.com/tag/fine-analysis/\" rel=\"tag\">fine analysis</a>"
                },
                {
                    "id": "<sentence_0x2630ce47>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0x8a45704>": "https://www.intezer.com/tag/incident-response/"
                    },
                    "text": "Incident Response",
                    "html": "<a class=\"blog-text-link\" href=\"https://www.intezer.com/tag/incident-response/\" rel=\"tag\">Incident Response</a>"
                },
                {
                    "id": "<sentence_0x2c5fe0b3>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xc6995bf2>": "https://www.intezer.com/tag/open-source/"
                    },
                    "text": "Open-Source",
                    "html": "<a class=\"blog-text-link\" href=\"https://www.intezer.com/tag/open-source/\" rel=\"tag\">Open-Source</a>"
                },
                {
                    "id": "<sentence_0x2b8b7a83>",
                    "is_empty": false,
                    "have_tags": true,
                    "tags": {
                        "<a_0xb37eb65f>": "https://www.intezer.com/tag/pdfs/"
                    },
                    "text": "PDFs",
                    "html": "<a class=\"blog-text-link\" href=\"https://www.intezer.com/tag/pdfs/\" rel=\"tag\">PDFs</a>"
                }
            ]
        }
    ]
}