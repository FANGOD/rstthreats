[
    {
        "report": {
            "id": "report_0xf1181529",
            "date": "20220420",
            "title": "How to Analyze Malicious PDF Files",
            "url": "https://www.intezer.com/blog/incident-response/analyze-malicious-pdf-files"
        },
        "chapter": {
            "id": "chapter_0x56a9d488",
            "title": "How to Analyze Malicious PDF Files",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0xf1181529",
            "date": "20220420",
            "title": "How to Analyze Malicious PDF Files",
            "url": "https://www.intezer.com/blog/incident-response/analyze-malicious-pdf-files"
        },
        "chapter": {
            "id": "chapter_0x626b0b3d",
            "title": "What is the PDF File Format?",
            "text": "The PDF format was created by Adobe in 1993, as a text-based structure that gives users a reliable way to present documents regardless of the operating system and the software they are using. Besides text, PDF files can present a wide variety of content such as images, links, video files, 3D objects, editable forms and much more.\nThe PDF structure is hierarchical and contains four main parts:\n1. Header Specifies the version number of the PDF.\n2. The body The documents part that holds all of the information including text and other elements such as images, links, etc.\nThe body of the PDF file contains different objects which can reference each other, the objects have different types:\nNames /name backslash followed by ASCII characters setting a unique name.\nStrings (text) its full syntax is a bit complex but whats important is to know that it is enclosed in parentheses.\nArrays enclosed with square brackets ([...]) can contain other objects.\nDictionaries table of key and value pairs. The key is a name object and the value can be any other object. Enclosed within double angle brackets (<<...>>)\nStreams contains embedded data structures like images (or code) which can be compressed. Streams represented by a dictionary that set the streams length with the key /Length and encoding /Filters.\nIndirect object object that has a unique ID, the object starts with the keyboard obj and ends with endobj other objects can reference the object using its ID. For example a reference to object with ID 3 we would look like this: 3 0 R\n3. Cross-reference table Specifies the offset from the start of the file to each object in the file, so that the PDF reader will be able to locate them without loading the whole document (it can save time when opening big files).\n4. Trailer Specifies information about the cross-reference table so the PDF reader will be able to find the table and other objects. PDF readers start reading the file from the end, lets look at the example below:\nThe first line (from the bottom) is %%EOF above is the offset of the cross-reference table 1901. Above that is the trailer that specifies different settings:\nSize number of entries in the cross-reference table\nRoot which entry in the table holds the offset for the root object. This object is the Document Catalog; it contains information about how the file will be presented and references to other objects that describe the documents content.\nInfo which entry in the table holds the offset for the documents information dictionary.\nPDF files can be modified so additional elements (such cross-reference tables) will be appended to the end of the file. Now that we understand the format lets see how it can be used by attackers to conceal malicious code."
        }
    },
    {
        "report": {
            "id": "report_0xf1181529",
            "date": "20220420",
            "title": "How to Analyze Malicious PDF Files",
            "url": "https://www.intezer.com/blog/incident-response/analyze-malicious-pdf-files"
        },
        "chapter": {
            "id": "chapter_0xbf7dec58",
            "title": "How PDF Files Get Used to Deliver Malware",
            "text": "PDF files support a wide variety of data types that can be present (and not necessarily visible). Threat actors fully control the content of the files they send to lure victims and they use the different capabilities of the PDF format for their attacks.\nMany phishing attacks will contain links or images of buttons, coupons, fake CAPTCHA, fake play buttons and more. The purpose of these files is to redirect the victims to sites controlled by the threat actors where they can proceed to the next stage of the attack.\nPDF files natively support JavaScript, so attackers can create files that will execute scripts once a file has been opened at this stage to download additional payload or steal information.\nAnother way in which threat actors can use the format is to deliver malware in the PDF streams. Streams can contain any type of data (including scripts and binary files) and they can be compressed and encoded which makes it harder to detect embedded code inside files. The compression technique is specified with the name /filter (as mentioned in its part of the dictionary that describes a stream). A stream can have more than one filter.\nThere are many PDF readers that are being used, some are multiplatform, others based on web browsers but like any other software they have bugs and vulnerabilities. Adobe PDF Reader alone has 91 reported vulnerabilities. Therefore threat actors can make PDF files that will exploit vulnerabilities, which will allow them to execute code and gain access to the victims endpoint."
        }
    },
    {
        "report": {
            "id": "report_0xf1181529",
            "date": "20220420",
            "title": "How to Analyze Malicious PDF Files",
            "url": "https://www.intezer.com/blog/incident-response/analyze-malicious-pdf-files"
        },
        "chapter": {
            "id": "chapter_0xd922ca4b",
            "title": "Investigating Suspicious PDF Files",
            "text": "Lets investigate the following PDF file (MD5: a2852936a7e33787c0ab11f346631d89). The first tool that we are going to use is peepdf, a python tool that parses PDF files allowing us to get the types and content of each object. It will also color the object and highlight the objects that make the file suspicious, like the presence of javascript and embedded files.\nAfter running the peepdf with the PDF file we get the output below. We can see that the file was updated and it has two versions. In the later version we can spot an encoded javascript code which makes this file suspicious so we will extract the content of the object and investigate it.\nOutput of peepdf\nTo extract the data from the suspicious object number 18 we will use another open-source tool called pdf-parser created by Didier Stevens. This python tool allows us to inspect and extract different objects. The command below will extract the javascript saved in the object into a file called extract_js:\nUpon inspecting the javascript code we can determine that the PDF file will open a window that will ask the victim to login into his Amazon account, but the data will be submit to a malicious site http://sellercentral[.]amazon.de.56U8GTHDGT4U7YWEWE84GTYS.abecklink.com eventually leading to credential stealing. In the screenshot below is the execution of the PDF file in Intezer Analyze, which lets us inspect the behavior of the file.\nThis PDF was sent as part of a phishing scam that targeted German speaking victims: the PDF was attached to an email regarding a tax invoice asking the victims to open the attached document and login to their Amazon account.\nThe PDF file as it can be seen in the behavior tab in Intezer Analyze.\nLets take a look at another PDF file (MD5: 1ba5c7ecab62609e4f1d44192cef850e). Once again we will start by running peepdf on the file to understand if the file might be malicious.\nPeepdf output\nAs we see in the output below the file contains a javascript object (object number 9) and one embedded file (object number 8). Lets inspect the content of object 8 by running pdf-parser as we did in the previous example:\nThe content of the embedded file is saved to drop_file2, we see that the stream containing the data is The content of the embedded file is saved to drop_file2. We can see that the stream containing the data is decoded with FlateDecode therefore we use the -f flag which tells pdf-parser to pass the data through filters. Next well check what is the type of the embedded data, so lets use the file command on the extracted file:\nAt this point, we need to investigate an RTF file. Well use rtfobj from oletools to inspect the file:\nrtfobj output for the extracted RTF file\nYou can find more information about the tools and techniques to analyze malicious Office files by checking out our previous blog. From the output of rtfobj we learn that the extracted RTF file exploited CVE-2017-11882 a known vulnerability in Microsoft Equation Editor that enables code execution. Since Microsoft patched this vulnerability, this particular attack would only be effective if a user failed to keep their software updated. Now, we can either continue investigating the shellcode located in the RTF file or upload the original PDF to Intezer Analyze that will automatically execute all the steps we just did and on top of that provide a classification of the threat executed by the PDF.\nThe results of the analysis can be seen in the screenshot below:\nBehavior tab in the PDF analysis\nIn the process tree we see the execution chain of the PDF followed by word process to open the RTF file and then the call to Equation Editor that is being exploited by the RTF. The malware is classified as Raccoon Stealer. We can see in the Genetic Analysis tab that the sample shares code with Azorult and thats because Raccoon Stealer is considered as its successor.\nGenetic Analysis tab of the PDF file in intezer Analyze"
        }
    },
    {
        "report": {
            "id": "report_0xf1181529",
            "date": "20220420",
            "title": "How to Analyze Malicious PDF Files",
            "url": "https://www.intezer.com/blog/incident-response/analyze-malicious-pdf-files"
        },
        "chapter": {
            "id": "chapter_0xef109e39",
            "title": "Scanning a High Volume of PDFs for Malware",
            "text": "PDF files are very common and useful for all types of organizations but the flexibility of the PDF format makes it also very attractive for threat actors who use it to carry out different sorts of attacks. In this blog we presented several open-source and free tools that can be used for static analysis of a single PDF.\nBut manual analysis of PDFs isnt scalable for organizations when there are hundreds of files (or even more) that need to be investigated. In this case we can use a platform like Intezer that will automate the initial investigation of the files, allowing us to focus our efforts only on cases where the manual analysis is absolutely mandatory.\nScan 50 files for free (including PDFs) with Intezer Analyze. If you want to learn how your team can automate alert triage to scan files, URLs, memory dumps, and more book a time to talk with us.\nNicole Fishbein\nNicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded researcher in the Israel Defense Forces (IDF) Intelligence Corps.\nDFIR\nDigital Forensics\nfine analysis\nIncident Response\nOpen-Source\nPDFs"
        }
    }
]