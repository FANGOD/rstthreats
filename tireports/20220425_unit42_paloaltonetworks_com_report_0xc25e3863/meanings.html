<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Title</title>
    <script>
    function highlight(text, elem_id) {
        let inputText = document.getElementById(elem_id);
        let innerHTML = inputText.innerHTML;
        let reg = new RegExp("(" + text + ")", "ig");
        innerHTML = innerHTML.replace(reg, '<mark>$1</mark>');
        inputText.innerHTML = innerHTML;
    }
</script>
</head>
<body>
    <div class="container-lg">
        <h1>Defeating BazarLoader Anti-Analysis Techniques</h1>
        <a href="https://unit42.paloaltonetworks.com/bazarloader-anti-analysis-techniques" target="_blank">https://unit42.paloaltonetworks.com/bazarloader-anti-analysis-techniques</a>
    </div>
    <br>
    <div class="container-lg">
        <ul>
            <li><a href="#chapter_iocs">IOCs</a></li>
            <li><a href="#chapter_threats">Threats</a></li>
            <li><a href="#chapter_meanings">Meanings</a></li>
            <li><a href="#chapter_ttps">TTPs</a></li>
            <li><a href="#chapter_unknownwords">Unknownwords</a></li>
            <li><a href="#chapter_resources">Resources</a> (Text_files: 0)</li>
        </ul>
        <br>
    </div>
    <div class="container-lg">
        <h2>Info</h2>
        <h3>Potential threat (9)</h3>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xbd360262">
                <div class="card-body">
                    <h5 class="card-title">idapython</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0xbd360262"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0xbd360262">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0xbd360262">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("idapython", "titles_pt_UNKNOWNWORD_0xbd360262")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0xbd360262"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0xbd360262">Sentences (11)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0xbd360262">
                        <ul>
                            
                                <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                            
                                <li>Figure 4. IDAPython code to search and extract the three parameters.</li>
                            
                                <li>Complete IDAPython script to search and patch Opaque Predicates in a function is available on GitHub.</li>
                            
                                <li>Complete IDAPython script to rename or resolve obfuscation API calls is available on GitHub.</li>
                            
                                <li>Figure 3. Using Appcall with IDAPython.</li>
                            
                                <li>Figure 5. IDAPython code to locate dynamic calls.</li>
                            
                                <li>Figure 12. IDAPython code to locate the OPs in a function.</li>
                            
                                <li>With the help of our IDAPython scripts, we are now able to faster assess which functionality this BazarLoader sample contains.</li>
                            
                                <li>Figure 13. IDAPython code to patch the OPs.</li>
                            
                                <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                            
                                <li>Figure 6. Before executing the above IDAPython scripts.</li>
                            
                        </ul>
                    </div>
                    <script>highlight("idapython", "sentences_pt_UNKNOWNWORD_0xbd360262")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x2984b699">
                <div class="card-body">
                    <h5 class="card-title">wildfire</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0x2984b699"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0x2984b699">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0x2984b699">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("wildfire", "titles_pt_UNKNOWNWORD_0x2984b699")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0x2984b699"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0x2984b699">Sentences (2)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0x2984b699">
                        <ul>
                            
                                <li>Palo Alto Networks customers are protected from malware families using similar anti-analysis techniques with Cortex XDR or the Next-Generation Firewall with the WildFire and Threat Prevention security subscriptions.</li>
                            
                                <li>Palo Alto Networks customers are further protected from malware families using similar anti-analysis techniques with Cortex XDR or the Next-Generation Firewall with the WildFire and Threat Prevention cloud-delivered security subscriptions.</li>
                            
                        </ul>
                    </div>
                    <script>highlight("wildfire", "sentences_pt_UNKNOWNWORD_0x2984b699")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xb13ffcad">
                <div class="card-body">
                    <h5 class="card-title">sub_18000b9b0</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0xb13ffcad"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0xb13ffcad">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0xb13ffcad">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("sub_18000b9b0", "titles_pt_UNKNOWNWORD_0xb13ffcad")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0xb13ffcad"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0xb13ffcad">Sentences (1)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0xb13ffcad">
                        <ul>
                            
                                <li>While most pieces of malware rely on publicly known hashing algorithms to resolve the functions addresses, the one used by BazarLoader is unique. The API function resolution procedure (sub_18000B9B0, labelled as FN_API_Decoder) requires three parameters and returns the address of the requested function.</li>
                            
                        </ul>
                    </div>
                    <script>highlight("sub_18000b9b0", "sentences_pt_UNKNOWNWORD_0xb13ffcad")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xf63b290f">
                <div class="card-body">
                    <h5 class="card-title">fn_api_decoder</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0xf63b290f"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0xf63b290f">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0xf63b290f">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("fn_api_decoder", "titles_pt_UNKNOWNWORD_0xf63b290f")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0xf63b290f"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0xf63b290f">Sentences (5)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0xf63b290f">
                        <ul>
                            
                                <li>Now, we could reverse engineer the algorithm used in FN_API_Decoder and reimplement it in Python to get all functions resolved. However, this would take a lot of time and we would have to repeat the whole process for every piece of malware that uses a different hashing algorithm.</li>
                            
                                <li>Using the following code, we can run FN_API_Decoder to resolve Windows API function addresses while debugging the malware process.</li>
                            
                                <li>While most pieces of malware rely on publicly known hashing algorithms to resolve the functions addresses, the one used by BazarLoader is unique. The API function resolution procedure (sub_18000B9B0, labelled as FN_API_Decoder) requires three parameters and returns the address of the requested function.</li>
                            
                                <li>Next, we gathered all the required parameters by looking up all the cross references to FN_API_Decoder. The following code will search and extract the required parameters for resolving the API function calls.</li>
                            
                                <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                            
                        </ul>
                    </div>
                    <script>highlight("fn_api_decoder", "sentences_pt_UNKNOWNWORD_0xf63b290f")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xfe3093ab">
                <div class="card-body">
                    <h5 class="card-title">appcall</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0xfe3093ab"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0xfe3093ab">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0xfe3093ab">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("appcall", "titles_pt_UNKNOWNWORD_0xfe3093ab")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0xfe3093ab"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0xfe3093ab">Sentences (3)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0xfe3093ab">
                        <ul>
                            
                                <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                            
                                <li>Finally, by using the returned value from Appcall we are able to rename all the dynamic calls to the APIs to their corresponding names and apply comments:</li>
                            
                                <li>Figure 3. Using Appcall with IDAPython.</li>
                            
                        </ul>
                    </div>
                    <script>highlight("appcall", "sentences_pt_UNKNOWNWORD_0xfe3093ab")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x59f7a4f9">
                <div class="card-body">
                    <h5 class="card-title">sub_1800155e0</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0x59f7a4f9"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0x59f7a4f9">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0x59f7a4f9">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("sub_1800155e0", "titles_pt_UNKNOWNWORD_0x59f7a4f9")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0x59f7a4f9"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0x59f7a4f9">Sentences (1)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0x59f7a4f9">
                        <ul>
                            
                                <li>After all the API function calls are renamed, we can now easily locate other interesting functions in the malware. For example, sub_1800155E0 is the procedure in BazarLoader that carries out code injection.</li>
                            
                        </ul>
                    </div>
                    <script>highlight("sub_1800155e0", "sentences_pt_UNKNOWNWORD_0x59f7a4f9")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x3887a346">
                <div class="card-body">
                    <h5 class="card-title">sub_18000f640</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0x3887a346"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0x3887a346">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0x3887a346">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("sub_18000f640", "titles_pt_UNKNOWNWORD_0x3887a346")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0x3887a346"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0x3887a346">Sentences (6)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0x3887a346">
                        <ul>
                            
                                <li>We can demonstrate the extent of the challenge OPs pose to malware analysts. The following CFG shows the unexecuted code blocks (Figure 11, red code blocks) in one of the smaller functions (sub_18000F640) in the sample.</li>
                            
                                <li>Figure 11. sub_18000F640 function in BazarLoader with unexecuted code blocks colored in red.</li>
                            
                                <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                            
                                <li>Figure 15. Decompiled sub_18000F640 function after removing the OPs.</li>
                            
                                <li>Figure 14. Decompiled sub_18000F640 function.</li>
                            
                                <li>The OPs also messed with the output of the HexRays decompiler. This is how the function (sub_18000F640) looks before the OPs are patched:</li>
                            
                        </ul>
                    </div>
                    <script>highlight("sub_18000f640", "sentences_pt_UNKNOWNWORD_0x3887a346")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xeb72eabb">
                <div class="card-body">
                    <h5 class="card-title">hexrays</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0xeb72eabb"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0xeb72eabb">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0xeb72eabb">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("hexrays", "titles_pt_UNKNOWNWORD_0xeb72eabb")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0xeb72eabb"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0xeb72eabb">Sentences (1)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0xeb72eabb">
                        <ul>
                            
                                <li>The OPs also messed with the output of the HexRays decompiler. This is how the function (sub_18000F640) looks before the OPs are patched:</li>
                            
                        </ul>
                    </div>
                    <script>highlight("hexrays", "sentences_pt_UNKNOWNWORD_0xeb72eabb")</script>
                </div>
            </div>
        
            <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xb2fc908b">
                <div class="card-body">
                    <h5 class="card-title">getmodulefilenamew</h5>

                        References:<br/>
                    <a data-bs-toggle="collapse"
                       href="#titles_pt_UNKNOWNWORD_0xb2fc908b"
                       role="button"
                       aria-expanded="false"
                       aria-controls="titles_pt_UNKNOWNWORD_0xb2fc908b">Titles (0)</a><br/>
                    <div class="collapse" id="titles_pt_UNKNOWNWORD_0xb2fc908b">
                        <ul>
                            
                        </ul>
                    </div>
                    <script>highlight("getmodulefilenamew", "titles_pt_UNKNOWNWORD_0xb2fc908b")</script>
                    <a data-bs-toggle="collapse"
                       href="#sentences_pt_UNKNOWNWORD_0xb2fc908b"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_pt_UNKNOWNWORD_0xb2fc908b">Sentences (1)</a>
                    <div class="collapse" id="sentences_pt_UNKNOWNWORD_0xb2fc908b">
                        <ul>
                            
                                <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                            
                        </ul>
                    </div>
                    <script>highlight("getmodulefilenamew", "sentences_pt_UNKNOWNWORD_0xb2fc908b")</script>
                </div>
            </div>
        
        </div>
        <div class="container-lg">
            <h3>Detects</h3>
            <div class="card" style="width: 60rem;">
                <div class="card-body">
                    <p>SIGMA: False</p>
                    <p>YARA: False</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container-lg">
        <h2>Keywords</h2>
        <div class="card" style="width: 60rem;">
            <div class="card-body">
                
                <a data-bs-toggle="collapse"
                       href="#sentences_classified"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_classified">Classified (0)</a>
                <br/>
                <div class="collapse" id="sentences_classified">
                    <ul>
                        
                    </ul>
                </div>
                <script>highlight("classified", "sentences_classified")</script>
                
                <a data-bs-toggle="collapse"
                       href="#sentences_dubbed"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_dubbed">Dubbed (0)</a>
                <br/>
                <div class="collapse" id="sentences_dubbed">
                    <ul>
                        
                    </ul>
                </div>
                <script>highlight("dubbed", "sentences_dubbed")</script>
                
                <a data-bs-toggle="collapse"
                       href="#sentences_associated"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_associated">Associated (0)</a>
                <br/>
                <div class="collapse" id="sentences_associated">
                    <ul>
                        
                    </ul>
                </div>
                <script>highlight("associated", "sentences_associated")</script>
                
                <a data-bs-toggle="collapse"
                       href="#sentences_targets"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_targets">Targets (0)</a>
                <br/>
                <div class="collapse" id="sentences_targets">
                    <ul>
                        
                    </ul>
                </div>
                <script>highlight("targets", "sentences_targets")</script>
                
                <a data-bs-toggle="collapse"
                       href="#sentences_attributed"
                       role="button"
                       aria-expanded="false"
                       aria-controls="sentences_attributed">Attributed (0)</a>
                
                <div class="collapse" id="sentences_attributed">
                    <ul>
                        
                    </ul>
                </div>
                <script>highlight("attributed", "sentences_attributed")</script>
                
            </div>
        </div>
    </div>
    
    
    
    
    
    
    <div class="container-lg" id="chapter_threats">
        <h2>THREATS (1)</h2>
        
            <div class="container-lg">
                <h3>Threat (1)</h3>
                <div>
                
                    <div class="card" style="width: 60rem;" id="THREAT_0xf4f1f185">
                        <div class="card-body">
                            <h5 class="card-title">
                                    bazarbackdoor
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_THREAT_0xf4f1f185"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_THREAT_0xf4f1f185">Titles (6)</a><br/>
                            <div class="collapse" id="titles_THREAT_0xf4f1f185">
                                <ul>
                                    
                                    <li>Reusing Malware Code to Defeat Obfuscated API Calls</li>
                                    
                                    <li>Executive Summary</li>
                                    
                                    <li>Defeating BazarLoader Anti-Analysis Techniques</li>
                                    
                                    <li>Automating Opaque Predicate Removal</li>
                                    
                                    <li>Malware Analysts vs Malware Authors</li>
                                    
                                    <li>Indicators of Compromise</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("bazarbackdoor", "titles_THREAT_0xf4f1f185")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_THREAT_0xf4f1f185"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_THREAT_0xf4f1f185">Sentences (14)</a><br/>
                            <div class="collapse" id="sentences_THREAT_0xf4f1f185">
                                <ul>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                        <li>Figure 1. Missing IAT in BazarLoader as seen with CFF Explorer.</li>
                                    
                                        <li>Tags: anti-analysis, BazarLoader</li>
                                    
                                        <li>Malware authors often include anti-analysis techniques with the hope that they will increase the time and resources taken for malware analysts. With the above script snippets showing how to defeat these techniques for BazarLoader, you can reduce the time needed to analyze malware samples of other families that use similar techniques.</li>
                                    
                                        <li>In fact, BazarLoader resolves every API function to be called individually at run time. After we figured out that the functions are resolved during execution, the following function caught our attention as it was referenced more than 300 times:</li>
                                    
                                        <li>After all the API function calls are renamed, we can now easily locate other interesting functions in the malware. For example, sub_1800155E0 is the procedure in BazarLoader that carries out code injection.</li>
                                    
                                        <li>With the help of our IDAPython scripts, we are now able to faster assess which functionality this BazarLoader sample contains.</li>
                                    
                                        <li>Figure 11. sub_18000F640 function in BazarLoader with unexecuted code blocks colored in red.</li>
                                    
                                        <li>While most pieces of malware rely on publicly known hashing algorithms to resolve the functions addresses, the one used by BazarLoader is unique. The API function resolution procedure (sub_18000B9B0, labelled as FN_API_Decoder) requires three parameters and returns the address of the requested function.</li>
                                    
                                        <li>To demonstrate, we focused on a BazarLoader sample we recently detected. After peeling away the packer layer of our BazarLoader sample, we saw that it doesnt have an IAT (see Figure 1). Also, there is no IAT constructed during execution, a technique sometimes seen in other malware. BazarLoader obfuscates its function calls to make analysis more difficult and to evade detection techniques that rely on reading the IAT.</li>
                                    
                                        <li>Opaque Predicate (OP) is used in BazarLoader to protect it from reverse engineering tools. OP is an expression that evaluates to either true or false at runtime. Malware authors make use of multiple OPs together with unexecuted code blocks to add complexities that static analysis tools have to deal with.</li>
                                    
                                        <li>BazarLoader Sample ce5ee2fd8aa4acda24baf6221b5de66220172da0eb312705936adc5b164cc052</li>
                                    
                                        <li>Figure 10. One example of OP in BazarLoader.</li>
                                    
                                        <li>The following disassembled code shows one of the OPs in Bazarloader:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("bazarbackdoor", "sentences_THREAT_0xf4f1f185")</script>

                            Links:<br/>
                            <ul>
                                
                                    <li>
                                            <a href="#CATEGORY_0xa179f90c">ransomware</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                                    <li>
                                            <a href="#CATEGORY_0xf1a480bb">malware</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                                    <li>
                                            <a href="#CATEGORY_0x96121f83">backdoor</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                                    <li>
                                            <a href="#SHA256_0x755b1afe">ce5ee2fd8aa4acda24baf6221b5de66220172da0eb312705936adc5b164cc052</a>
                                        
                                    >> (use_threat) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                                    <li>
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#CATEGORY_0xf1a480bb">malware</a>
                                        
                                    </li>
                                
                            </ul>
                        </div>
                    </div>
                
                </div>
            </div>
        
    </div>
    
    
    
    <div class="container-lg" id="chapter_ttps">
        <h2>TTPS (0)</h2>
        
    </div>
    
    
    
    <div class="container-lg" id="chapter_meanings">
        <h2>MEANINGS (1)</h2>
        
            <div class="container-lg">
                <h3>Category (3)</h3>
                <div>
                
                    <div class="card" style="width: 60rem;" id="CATEGORY_0xf1a480bb">
                        <div class="card-body">
                            <h5 class="card-title">
                                    malware
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_CATEGORY_0xf1a480bb"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_CATEGORY_0xf1a480bb">Titles (6)</a><br/>
                            <div class="collapse" id="titles_CATEGORY_0xf1a480bb">
                                <ul>
                                    
                                    <li>Reusing Malware Code to Defeat Obfuscated API Calls</li>
                                    
                                    <li>Executive Summary</li>
                                    
                                    <li>Defeating BazarLoader Anti-Analysis Techniques</li>
                                    
                                    <li>Automating Opaque Predicate Removal</li>
                                    
                                    <li>Table of Contents</li>
                                    
                                    <li>Malware Analysts vs Malware Authors</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("malware", "titles_CATEGORY_0xf1a480bb")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_CATEGORY_0xf1a480bb"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_CATEGORY_0xf1a480bb">Sentences (18)</a><br/>
                            <div class="collapse" id="sentences_CATEGORY_0xf1a480bb">
                                <ul>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                        <li>Category: Malware</li>
                                    
                                        <li>Not only do we need to locate the OPs, we also have to know the exact point when the malware sample decides to avoid the unexecuted code blocks.</li>
                                    
                                        <li>Palo Alto Networks customers are further protected from malware families using similar anti-analysis techniques with Cortex XDR or the Next-Generation Firewall with the WildFire and Threat Prevention cloud-delivered security subscriptions.</li>
                                    
                                        <li>First, we have to locate all the OPs. The most common way to do this is to make use of the binary search mechanism in IDA Pro to find all the byte sequences of the OPs. This turns out not to be possible, as the OPs were likely generated by a compiler during the build process of the malware sample. There are just too many variants of the OPs that could be covered using the byte sequence.</li>
                                    
                                        <li>Now, we could reverse engineer the algorithm used in FN_API_Decoder and reimplement it in Python to get all functions resolved. However, this would take a lot of time and we would have to repeat the whole process for every piece of malware that uses a different hashing algorithm.</li>
                                    
                                        <li>Malware authors often include anti-analysis techniques with the hope that they will increase the time and resources taken for malware analysts. With the above script snippets showing how to defeat these techniques for BazarLoader, you can reduce the time needed to analyze malware samples of other families that use similar techniques.</li>
                                    
                                        <li>We can demonstrate the extent of the challenge OPs pose to malware analysts. The following CFG shows the unexecuted code blocks (Figure 11, red code blocks) in one of the smaller functions (sub_18000F640) in the sample.</li>
                                    
                                        <li>Using the following code, we can run FN_API_Decoder to resolve Windows API function addresses while debugging the malware process.</li>
                                    
                                        <li>Reusing Malware Code to Defeat Obfuscated API Calls<br/>Automating Opaque Predicate Removal<br/>Malware Analysts vs Malware Authors<br/>Indicators of Compromise<br/>Additional Resources</li>
                                    
                                        <li>After all the API function calls are renamed, we can now easily locate other interesting functions in the malware. For example, sub_1800155E0 is the procedure in BazarLoader that carries out code injection.</li>
                                    
                                        <li>While most pieces of malware rely on publicly known hashing algorithms to resolve the functions addresses, the one used by BazarLoader is unique. The API function resolution procedure (sub_18000B9B0, labelled as FN_API_Decoder) requires three parameters and returns the address of the requested function.</li>
                                    
                                        <li>To demonstrate, we focused on a BazarLoader sample we recently detected. After peeling away the packer layer of our BazarLoader sample, we saw that it doesnt have an IAT (see Figure 1). Also, there is no IAT constructed during execution, a technique sometimes seen in other malware. BazarLoader obfuscates its function calls to make analysis more difficult and to evade detection techniques that rely on reading the IAT.</li>
                                    
                                        <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                                    
                                        <li>Opaque Predicate (OP) is used in BazarLoader to protect it from reverse engineering tools. OP is an expression that evaluates to either true or false at runtime. Malware authors make use of multiple OPs together with unexecuted code blocks to add complexities that static analysis tools have to deal with.</li>
                                    
                                        <li>Malware authors embed multiple anti-analysis techniques in their code to retard the analysis processes of human analysts and sandboxes. However, there are ways defenders can defeat these techniques in turn. This blog post describes two methods for faster analysis of malware that employs two distinctive anti-analysis techniques. The first technique is API function hashing, a known trick to obfuscate which functions are called. The second is opaque predicate, a technique used for control flow obfuscation.</li>
                                    
                                        <li>Malware compiled as native files has to call Windows API functions to carry out malicious behaviors. The information on which functions are used is usually stored in the Import Address Table (IAT) in the file. Therefore, this table is often a good place to start the analysis process to get an idea of what the malware is trying to do.</li>
                                    
                                        <li>Palo Alto Networks customers are protected from malware families using similar anti-analysis techniques with Cortex XDR or the Next-Generation Firewall with the WildFire and Threat Prevention security subscriptions.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("malware", "sentences_CATEGORY_0xf1a480bb")</script>

                            Links:<br/>
                            <ul>
                                
                                    <li>
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#CATEGORY_0xf1a480bb">malware</a>
                                        
                                    </li>
                                
                                    <li>
                                            <a href="#CATEGORY_0xf1a480bb">malware</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="CATEGORY_0x96121f83">
                        <div class="card-body">
                            <h5 class="card-title">
                                    backdoor
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_CATEGORY_0x96121f83"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_CATEGORY_0x96121f83">Titles (1)</a><br/>
                            <div class="collapse" id="titles_CATEGORY_0x96121f83">
                                <ul>
                                    
                                    <li>Executive Summary</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("backdoor", "titles_CATEGORY_0x96121f83")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_CATEGORY_0x96121f83"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_CATEGORY_0x96121f83">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_CATEGORY_0x96121f83">
                                <ul>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("backdoor", "sentences_CATEGORY_0x96121f83")</script>

                            Links:<br/>
                            <ul>
                                
                                    <li>
                                            <a href="#CATEGORY_0x96121f83">backdoor</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="CATEGORY_0xa179f90c">
                        <div class="card-body">
                            <h5 class="card-title">
                                    ransomware
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_CATEGORY_0xa179f90c"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_CATEGORY_0xa179f90c">Titles (1)</a><br/>
                            <div class="collapse" id="titles_CATEGORY_0xa179f90c">
                                <ul>
                                    
                                    <li>Executive Summary</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("ransomware", "titles_CATEGORY_0xa179f90c")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_CATEGORY_0xa179f90c"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_CATEGORY_0xa179f90c">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_CATEGORY_0xa179f90c">
                                <ul>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("ransomware", "sentences_CATEGORY_0xa179f90c")</script>

                            Links:<br/>
                            <ul>
                                
                                    <li>
                                            <a href="#CATEGORY_0xa179f90c">ransomware</a>
                                        
                                    >> (has_category) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                            </ul>
                        </div>
                    </div>
                
                </div>
            </div>
        
    </div>
    
    
    
    <div class="container-lg" id="chapter_iocs">
        <h2>IOCS (1)</h2>
        
            <div class="container-lg">
                <h3>Hash (1)</h3>
                <div>
                
                    <div class="card" style="width: 60rem;" id="SHA256_0x755b1afe">
                        <div class="card-body">
                            <h5 class="card-title">
                                    ce5ee2fd8aa4acda24baf6221b5de66220172da0eb312705936adc5b164cc052
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_SHA256_0x755b1afe"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_SHA256_0x755b1afe">Titles (1)</a><br/>
                            <div class="collapse" id="titles_SHA256_0x755b1afe">
                                <ul>
                                    
                                    <li>Indicators of Compromise</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("ce5ee2fd8aa4acda24baf6221b5de66220172da0eb312705936adc5b164cc052", "titles_SHA256_0x755b1afe")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_SHA256_0x755b1afe"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_SHA256_0x755b1afe">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_SHA256_0x755b1afe">
                                <ul>
                                    
                                        <li>BazarLoader Sample ce5ee2fd8aa4acda24baf6221b5de66220172da0eb312705936adc5b164cc052</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("ce5ee2fd8aa4acda24baf6221b5de66220172da0eb312705936adc5b164cc052", "sentences_SHA256_0x755b1afe")</script>

                            Links:<br/>
                            <ul>
                                
                                    <li>
                                            <a href="#SHA256_0x755b1afe">ce5ee2fd8aa4acda24baf6221b5de66220172da0eb312705936adc5b164cc052</a>
                                        
                                    >> (use_threat) >>
                                    
                                            <a href="#THREAT_0xf4f1f185">bazarbackdoor</a>
                                        
                                    </li>
                                
                            </ul>
                        </div>
                    </div>
                
                </div>
            </div>
        
    </div>
    
    
    
    <div class="container-lg" id="chapter_unknownwords">
        <h2>UNKNOWNWORDS (1)</h2>
        
            <div class="container-lg">
                <h3>UnknownWord (57)</h3>
                <div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xc55ad1e8">
                        <div class="card-body">
                            <h5 class="card-title">
                                    defeating
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xc55ad1e8"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xc55ad1e8">Titles (1)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xc55ad1e8">
                                <ul>
                                    
                                    <li>Defeating BazarLoader Anti-Analysis Techniques</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("defeating", "titles_UNKNOWNWORD_0xc55ad1e8")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xc55ad1e8"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xc55ad1e8">Sentences (0)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xc55ad1e8">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("defeating", "sentences_UNKNOWNWORD_0xc55ad1e8")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xf3eddc5a">
                        <div class="card-body">
                            <h5 class="card-title">
                                    reacted
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xf3eddc5a"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xf3eddc5a">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xf3eddc5a">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("reacted", "titles_UNKNOWNWORD_0xf3eddc5a")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xf3eddc5a"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xf3eddc5a">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xf3eddc5a">
                                <ul>
                                    
                                        <li>1,558 people reacted<br/>4<br/>7 min. read</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("reacted", "sentences_UNKNOWNWORD_0xf3eddc5a")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xe5b2fe07">
                        <div class="card-body">
                            <h5 class="card-title">
                                    mark lim
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xe5b2fe07"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xe5b2fe07">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xe5b2fe07">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("mark lim", "titles_UNKNOWNWORD_0xe5b2fe07")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xe5b2fe07"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xe5b2fe07">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xe5b2fe07">
                                <ul>
                                    
                                        <li>By Mark Lim</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("mark lim", "sentences_UNKNOWNWORD_0xe5b2fe07")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xcff94315">
                        <div class="card-body">
                            <h5 class="card-title">
                                    retard
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xcff94315"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xcff94315">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xcff94315">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("retard", "titles_UNKNOWNWORD_0xcff94315")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xcff94315"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xcff94315">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xcff94315">
                                <ul>
                                    
                                        <li>Malware authors embed multiple anti-analysis techniques in their code to retard the analysis processes of human analysts and sandboxes. However, there are ways defenders can defeat these techniques in turn. This blog post describes two methods for faster analysis of malware that employs two distinctive anti-analysis techniques. The first technique is API function hashing, a known trick to obfuscate which functions are called. The second is opaque predicate, a technique used for control flow obfuscation.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("retard", "sentences_UNKNOWNWORD_0xcff94315")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xdd062677">
                        <div class="card-body">
                            <h5 class="card-title">
                                    sandboxes
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xdd062677"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xdd062677">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xdd062677">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("sandboxes", "titles_UNKNOWNWORD_0xdd062677")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xdd062677"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xdd062677">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xdd062677">
                                <ul>
                                    
                                        <li>Malware authors embed multiple anti-analysis techniques in their code to retard the analysis processes of human analysts and sandboxes. However, there are ways defenders can defeat these techniques in turn. This blog post describes two methods for faster analysis of malware that employs two distinctive anti-analysis techniques. The first technique is API function hashing, a known trick to obfuscate which functions are called. The second is opaque predicate, a technique used for control flow obfuscation.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("sandboxes", "sentences_UNKNOWNWORD_0xdd062677")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xbf9b7e21">
                        <div class="card-body">
                            <h5 class="card-title">
                                    defeat
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xbf9b7e21"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xbf9b7e21">Titles (1)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xbf9b7e21">
                                <ul>
                                    
                                    <li>Reusing Malware Code to Defeat Obfuscated API Calls</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("defeat", "titles_UNKNOWNWORD_0xbf9b7e21")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xbf9b7e21"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xbf9b7e21">Sentences (4)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xbf9b7e21">
                                <ul>
                                    
                                        <li>Malware authors embed multiple anti-analysis techniques in their code to retard the analysis processes of human analysts and sandboxes. However, there are ways defenders can defeat these techniques in turn. This blog post describes two methods for faster analysis of malware that employs two distinctive anti-analysis techniques. The first technique is API function hashing, a known trick to obfuscate which functions are called. The second is opaque predicate, a technique used for control flow obfuscation.</li>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                        <li>Malware authors often include anti-analysis techniques with the hope that they will increase the time and resources taken for malware analysts. With the above script snippets showing how to defeat these techniques for BazarLoader, you can reduce the time needed to analyze malware samples of other families that use similar techniques.</li>
                                    
                                        <li>Reusing Malware Code to Defeat Obfuscated API Calls<br/>Automating Opaque Predicate Removal<br/>Malware Analysts vs Malware Authors<br/>Indicators of Compromise<br/>Additional Resources</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("defeat", "sentences_UNKNOWNWORD_0xbf9b7e21")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xb4b826ba">
                        <div class="card-body">
                            <h5 class="card-title">
                                    faster
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xb4b826ba"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xb4b826ba">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xb4b826ba">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("faster", "titles_UNKNOWNWORD_0xb4b826ba")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xb4b826ba"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xb4b826ba">Sentences (2)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xb4b826ba">
                                <ul>
                                    
                                        <li>Malware authors embed multiple anti-analysis techniques in their code to retard the analysis processes of human analysts and sandboxes. However, there are ways defenders can defeat these techniques in turn. This blog post describes two methods for faster analysis of malware that employs two distinctive anti-analysis techniques. The first technique is API function hashing, a known trick to obfuscate which functions are called. The second is opaque predicate, a technique used for control flow obfuscation.</li>
                                    
                                        <li>With the help of our IDAPython scripts, we are now able to faster assess which functionality this BazarLoader sample contains.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("faster", "sentences_UNKNOWNWORD_0xb4b826ba")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x9e97847e">
                        <div class="card-body">
                            <h5 class="card-title">
                                    illustration
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x9e97847e"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x9e97847e">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x9e97847e">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("illustration", "titles_UNKNOWNWORD_0x9e97847e")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x9e97847e"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x9e97847e">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x9e97847e">
                                <ul>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("illustration", "sentences_UNKNOWNWORD_0x9e97847e")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xbd360262">
                        <div class="card-body">
                            <h5 class="card-title">
                                    idapython
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xbd360262"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xbd360262">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xbd360262">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("idapython", "titles_UNKNOWNWORD_0xbd360262")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xbd360262"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xbd360262">Sentences (11)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xbd360262">
                                <ul>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                        <li>Figure 4. IDAPython code to search and extract the three parameters.</li>
                                    
                                        <li>Complete IDAPython script to search and patch Opaque Predicates in a function is available on GitHub.</li>
                                    
                                        <li>Complete IDAPython script to rename or resolve obfuscation API calls is available on GitHub.</li>
                                    
                                        <li>Figure 3. Using Appcall with IDAPython.</li>
                                    
                                        <li>Figure 5. IDAPython code to locate dynamic calls.</li>
                                    
                                        <li>Figure 12. IDAPython code to locate the OPs in a function.</li>
                                    
                                        <li>With the help of our IDAPython scripts, we are now able to faster assess which functionality this BazarLoader sample contains.</li>
                                    
                                        <li>Figure 13. IDAPython code to patch the OPs.</li>
                                    
                                        <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                                    
                                        <li>Figure 6. Before executing the above IDAPython scripts.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("idapython", "sentences_UNKNOWNWORD_0xbd360262")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xbfa11c9d">
                        <div class="card-body">
                            <h5 class="card-title">
                                    ida
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xbfa11c9d"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xbfa11c9d">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xbfa11c9d">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("ida", "titles_UNKNOWNWORD_0xbfa11c9d")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xbfa11c9d"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xbfa11c9d">Sentences (3)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xbfa11c9d">
                                <ul>
                                    
                                        <li>The scripts that we are going to show here can be applied to BazarLoader, as well as other malware families that utilize similar anti-analysis techniques. As an illustration, we will show the IDAPython scripts we created during a recent analysis of BazarLoader with the reverse engineering tool IDA Pro to defeat these anti-analysis techniques. BazarLoader is a Windows backdoor that is used by various ransomware groups.</li>
                                    
                                        <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                                    
                                        <li>First, we have to locate all the OPs. The most common way to do this is to make use of the binary search mechanism in IDA Pro to find all the byte sequences of the OPs. This turns out not to be possible, as the OPs were likely generated by a compiler during the build process of the malware sample. There are just too many variants of the OPs that could be covered using the byte sequence.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("ida", "sentences_UNKNOWNWORD_0xbfa11c9d")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x2984b699">
                        <div class="card-body">
                            <h5 class="card-title">
                                    wildfire
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x2984b699"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x2984b699">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x2984b699">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("wildfire", "titles_UNKNOWNWORD_0x2984b699")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x2984b699"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x2984b699">Sentences (2)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x2984b699">
                                <ul>
                                    
                                        <li>Palo Alto Networks customers are protected from malware families using similar anti-analysis techniques with Cortex XDR or the Next-Generation Firewall with the WildFire and Threat Prevention security subscriptions.</li>
                                    
                                        <li>Palo Alto Networks customers are further protected from malware families using similar anti-analysis techniques with Cortex XDR or the Next-Generation Firewall with the WildFire and Threat Prevention cloud-delivered security subscriptions.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("wildfire", "sentences_UNKNOWNWORD_0x2984b699")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x6955f4c8">
                        <div class="card-body">
                            <h5 class="card-title">
                                    reusing
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x6955f4c8"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x6955f4c8">Titles (1)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x6955f4c8">
                                <ul>
                                    
                                    <li>Reusing Malware Code to Defeat Obfuscated API Calls</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("reusing", "titles_UNKNOWNWORD_0x6955f4c8")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x6955f4c8"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x6955f4c8">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x6955f4c8">
                                <ul>
                                    
                                        <li>Reusing Malware Code to Defeat Obfuscated API Calls<br/>Automating Opaque Predicate Removal<br/>Malware Analysts vs Malware Authors<br/>Indicators of Compromise<br/>Additional Resources</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("reusing", "sentences_UNKNOWNWORD_0x6955f4c8")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x9402d58b">
                        <div class="card-body">
                            <h5 class="card-title">
                                    iat
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x9402d58b"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x9402d58b">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x9402d58b">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("iat", "titles_UNKNOWNWORD_0x9402d58b")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x9402d58b"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x9402d58b">Sentences (3)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x9402d58b">
                                <ul>
                                    
                                        <li>Malware compiled as native files has to call Windows API functions to carry out malicious behaviors. The information on which functions are used is usually stored in the Import Address Table (IAT) in the file. Therefore, this table is often a good place to start the analysis process to get an idea of what the malware is trying to do.</li>
                                    
                                        <li>To demonstrate, we focused on a BazarLoader sample we recently detected. After peeling away the packer layer of our BazarLoader sample, we saw that it doesnt have an IAT (see Figure 1). Also, there is no IAT constructed during execution, a technique sometimes seen in other malware. BazarLoader obfuscates its function calls to make analysis more difficult and to evade detection techniques that rely on reading the IAT.</li>
                                    
                                        <li>Figure 1. Missing IAT in BazarLoader as seen with CFF Explorer.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("iat", "sentences_UNKNOWNWORD_0x9402d58b")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xecc00055">
                        <div class="card-body">
                            <h5 class="card-title">
                                    peeling
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xecc00055"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xecc00055">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xecc00055">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("peeling", "titles_UNKNOWNWORD_0xecc00055")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xecc00055"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xecc00055">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xecc00055">
                                <ul>
                                    
                                        <li>To demonstrate, we focused on a BazarLoader sample we recently detected. After peeling away the packer layer of our BazarLoader sample, we saw that it doesnt have an IAT (see Figure 1). Also, there is no IAT constructed during execution, a technique sometimes seen in other malware. BazarLoader obfuscates its function calls to make analysis more difficult and to evade detection techniques that rely on reading the IAT.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("peeling", "sentences_UNKNOWNWORD_0xecc00055")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x2671a467">
                        <div class="card-body">
                            <h5 class="card-title">
                                    constructed
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x2671a467"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x2671a467">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x2671a467">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("constructed", "titles_UNKNOWNWORD_0x2671a467")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x2671a467"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x2671a467">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x2671a467">
                                <ul>
                                    
                                        <li>To demonstrate, we focused on a BazarLoader sample we recently detected. After peeling away the packer layer of our BazarLoader sample, we saw that it doesnt have an IAT (see Figure 1). Also, there is no IAT constructed during execution, a technique sometimes seen in other malware. BazarLoader obfuscates its function calls to make analysis more difficult and to evade detection techniques that rely on reading the IAT.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("constructed", "sentences_UNKNOWNWORD_0x2671a467")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x5ddfddb8">
                        <div class="card-body">
                            <h5 class="card-title">
                                    cff
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x5ddfddb8"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x5ddfddb8">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x5ddfddb8">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("cff", "titles_UNKNOWNWORD_0x5ddfddb8")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x5ddfddb8"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x5ddfddb8">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x5ddfddb8">
                                <ul>
                                    
                                        <li>Figure 1. Missing IAT in BazarLoader as seen with CFF Explorer.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("cff", "sentences_UNKNOWNWORD_0x5ddfddb8")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x24634d0c">
                        <div class="card-body">
                            <h5 class="card-title">
                                    individually
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x24634d0c"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x24634d0c">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x24634d0c">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("individually", "titles_UNKNOWNWORD_0x24634d0c")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x24634d0c"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x24634d0c">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x24634d0c">
                                <ul>
                                    
                                        <li>In fact, BazarLoader resolves every API function to be called individually at run time. After we figured out that the functions are resolved during execution, the following function caught our attention as it was referenced more than 300 times:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("individually", "sentences_UNKNOWNWORD_0x24634d0c")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x52609c40">
                        <div class="card-body">
                            <h5 class="card-title">
                                    figured
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x52609c40"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x52609c40">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x52609c40">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("figured", "titles_UNKNOWNWORD_0x52609c40")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x52609c40"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x52609c40">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x52609c40">
                                <ul>
                                    
                                        <li>In fact, BazarLoader resolves every API function to be called individually at run time. After we figured out that the functions are resolved during execution, the following function caught our attention as it was referenced more than 300 times:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("figured", "sentences_UNKNOWNWORD_0x52609c40")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x9879afd7">
                        <div class="card-body">
                            <h5 class="card-title">
                                    resolved
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x9879afd7"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x9879afd7">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x9879afd7">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("resolved", "titles_UNKNOWNWORD_0x9879afd7")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x9879afd7"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x9879afd7">Sentences (3)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x9879afd7">
                                <ul>
                                    
                                        <li>Now, we could reverse engineer the algorithm used in FN_API_Decoder and reimplement it in Python to get all functions resolved. However, this would take a lot of time and we would have to repeat the whole process for every piece of malware that uses a different hashing algorithm.</li>
                                    
                                        <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                                    
                                        <li>In fact, BazarLoader resolves every API function to be called individually at run time. After we figured out that the functions are resolved during execution, the following function caught our attention as it was referenced more than 300 times:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("resolved", "sentences_UNKNOWNWORD_0x9879afd7")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x5c9f9e46">
                        <div class="card-body">
                            <h5 class="card-title">
                                    resolving
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x5c9f9e46"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x5c9f9e46">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x5c9f9e46">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("resolving", "titles_UNKNOWNWORD_0x5c9f9e46")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x5c9f9e46"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x5c9f9e46">Sentences (2)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x5c9f9e46">
                                <ul>
                                    
                                        <li>Figure 2. Function for resolving the obfuscated Windows API functions (marked in yellow).</li>
                                    
                                        <li>Next, we gathered all the required parameters by looking up all the cross references to FN_API_Decoder. The following code will search and extract the required parameters for resolving the API function calls.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("resolving", "sentences_UNKNOWNWORD_0x5c9f9e46")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x4bf9aeed">
                        <div class="card-body">
                            <h5 class="card-title">
                                    yellow
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x4bf9aeed"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x4bf9aeed">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x4bf9aeed">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("yellow", "titles_UNKNOWNWORD_0x4bf9aeed")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x4bf9aeed"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x4bf9aeed">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x4bf9aeed">
                                <ul>
                                    
                                        <li>Figure 2. Function for resolving the obfuscated Windows API functions (marked in yellow).</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("yellow", "sentences_UNKNOWNWORD_0x4bf9aeed")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xb13ffcad">
                        <div class="card-body">
                            <h5 class="card-title">
                                    sub_18000b9b0
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xb13ffcad"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xb13ffcad">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xb13ffcad">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("sub_18000b9b0", "titles_UNKNOWNWORD_0xb13ffcad")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xb13ffcad"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xb13ffcad">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xb13ffcad">
                                <ul>
                                    
                                        <li>While most pieces of malware rely on publicly known hashing algorithms to resolve the functions addresses, the one used by BazarLoader is unique. The API function resolution procedure (sub_18000B9B0, labelled as FN_API_Decoder) requires three parameters and returns the address of the requested function.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("sub_18000b9b0", "sentences_UNKNOWNWORD_0xb13ffcad")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xf63b290f">
                        <div class="card-body">
                            <h5 class="card-title">
                                    fn_api_decoder
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xf63b290f"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xf63b290f">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xf63b290f">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("fn_api_decoder", "titles_UNKNOWNWORD_0xf63b290f")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xf63b290f"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xf63b290f">Sentences (5)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xf63b290f">
                                <ul>
                                    
                                        <li>Now, we could reverse engineer the algorithm used in FN_API_Decoder and reimplement it in Python to get all functions resolved. However, this would take a lot of time and we would have to repeat the whole process for every piece of malware that uses a different hashing algorithm.</li>
                                    
                                        <li>Using the following code, we can run FN_API_Decoder to resolve Windows API function addresses while debugging the malware process.</li>
                                    
                                        <li>While most pieces of malware rely on publicly known hashing algorithms to resolve the functions addresses, the one used by BazarLoader is unique. The API function resolution procedure (sub_18000B9B0, labelled as FN_API_Decoder) requires three parameters and returns the address of the requested function.</li>
                                    
                                        <li>Next, we gathered all the required parameters by looking up all the cross references to FN_API_Decoder. The following code will search and extract the required parameters for resolving the API function calls.</li>
                                    
                                        <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("fn_api_decoder", "sentences_UNKNOWNWORD_0xf63b290f")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x448d0256">
                        <div class="card-body">
                            <h5 class="card-title">
                                    repeat
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x448d0256"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x448d0256">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x448d0256">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("repeat", "titles_UNKNOWNWORD_0x448d0256")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x448d0256"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x448d0256">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x448d0256">
                                <ul>
                                    
                                        <li>Now, we could reverse engineer the algorithm used in FN_API_Decoder and reimplement it in Python to get all functions resolved. However, this would take a lot of time and we would have to repeat the whole process for every piece of malware that uses a different hashing algorithm.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("repeat", "sentences_UNKNOWNWORD_0x448d0256")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xfe3093ab">
                        <div class="card-body">
                            <h5 class="card-title">
                                    appcall
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xfe3093ab"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xfe3093ab">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xfe3093ab">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("appcall", "titles_UNKNOWNWORD_0xfe3093ab")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xfe3093ab"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xfe3093ab">Sentences (3)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xfe3093ab">
                                <ul>
                                    
                                        <li>Instead, the approach we used is independent from the hashing algorithm as it makes use of the hashing function itself. For this, we used the Appcall feature with IDAPython in IDA Pro to call FN_API_Decoder and pass it the required parameters. The result from Appcall would be the resolved address of the Windows API function. The Appcall feature used while debugging the malware allows us to execute any function from the sample as if it were a built-in function.</li>
                                    
                                        <li>Finally, by using the returned value from Appcall we are able to rename all the dynamic calls to the APIs to their corresponding names and apply comments:</li>
                                    
                                        <li>Figure 3. Using Appcall with IDAPython.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("appcall", "sentences_UNKNOWNWORD_0xfe3093ab")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xa5337478">
                        <div class="card-body">
                            <h5 class="card-title">
                                    cross
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xa5337478"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xa5337478">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xa5337478">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("cross", "titles_UNKNOWNWORD_0xa5337478")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xa5337478"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xa5337478">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xa5337478">
                                <ul>
                                    
                                        <li>Next, we gathered all the required parameters by looking up all the cross references to FN_API_Decoder. The following code will search and extract the required parameters for resolving the API function calls.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("cross", "sentences_UNKNOWNWORD_0xa5337478")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x59f7a4f9">
                        <div class="card-body">
                            <h5 class="card-title">
                                    sub_1800155e0
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x59f7a4f9"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x59f7a4f9">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x59f7a4f9">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("sub_1800155e0", "titles_UNKNOWNWORD_0x59f7a4f9")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x59f7a4f9"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x59f7a4f9">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x59f7a4f9">
                                <ul>
                                    
                                        <li>After all the API function calls are renamed, we can now easily locate other interesting functions in the malware. For example, sub_1800155E0 is the procedure in BazarLoader that carries out code injection.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("sub_1800155e0", "sentences_UNKNOWNWORD_0x59f7a4f9")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xcaaac1f6">
                        <div class="card-body">
                            <h5 class="card-title">
                                    renaming
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xcaaac1f6"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xcaaac1f6">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xcaaac1f6">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("renaming", "titles_UNKNOWNWORD_0xcaaac1f6")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xcaaac1f6"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xcaaac1f6">Sentences (2)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xcaaac1f6">
                                <ul>
                                    
                                        <li>Figure 8. Before renaming API calls.</li>
                                    
                                        <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("renaming", "sentences_UNKNOWNWORD_0xcaaac1f6")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xb8ae7ff7">
                        <div class="card-body">
                            <h5 class="card-title">
                                    labeled
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xb8ae7ff7"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xb8ae7ff7">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xb8ae7ff7">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("labeled", "titles_UNKNOWNWORD_0xb8ae7ff7")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xb8ae7ff7"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xb8ae7ff7">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xb8ae7ff7">
                                <ul>
                                    
                                        <li>Figure 9. Obfuscated API calls labeled with APIs related to code injection.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("labeled", "sentences_UNKNOWNWORD_0xb8ae7ff7")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xa96b8cef">
                        <div class="card-body">
                            <h5 class="card-title">
                                    ops
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xa96b8cef"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xa96b8cef">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xa96b8cef">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("ops", "titles_UNKNOWNWORD_0xa96b8cef")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xa96b8cef"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xa96b8cef">Sentences (13)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xa96b8cef">
                                <ul>
                                    
                                        <li>Using the following code, we locate the OPs in a function:</li>
                                    
                                        <li>Figure 12. IDAPython code to locate the OPs in a function.</li>
                                    
                                        <li>First, we have to locate all the OPs. The most common way to do this is to make use of the binary search mechanism in IDA Pro to find all the byte sequences of the OPs. This turns out not to be possible, as the OPs were likely generated by a compiler during the build process of the malware sample. There are just too many variants of the OPs that could be covered using the byte sequence.</li>
                                    
                                        <li>Using the following code, we patch the OPs in a function:</li>
                                    
                                        <li>We can demonstrate the extent of the challenge OPs pose to malware analysts. The following CFG shows the unexecuted code blocks (Figure 11, red code blocks) in one of the smaller functions (sub_18000F640) in the sample.</li>
                                    
                                        <li>Figure 13. IDAPython code to patch the OPs.</li>
                                    
                                        <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                                    
                                        <li>Figure 15. Decompiled sub_18000F640 function after removing the OPs.</li>
                                    
                                        <li>Next, we have to patch the instructions in OPs to force the code flow away from the unexecuted code blocks.</li>
                                    
                                        <li>Not only do we need to locate the OPs, we also have to know the exact point when the malware sample decides to avoid the unexecuted code blocks.</li>
                                    
                                        <li>Opaque Predicate (OP) is used in BazarLoader to protect it from reverse engineering tools. OP is an expression that evaluates to either true or false at runtime. Malware authors make use of multiple OPs together with unexecuted code blocks to add complexities that static analysis tools have to deal with.</li>
                                    
                                        <li>The OPs also messed with the output of the HexRays decompiler. This is how the function (sub_18000F640) looks before the OPs are patched:</li>
                                    
                                        <li>The following disassembled code shows one of the OPs in Bazarloader:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("ops", "sentences_UNKNOWNWORD_0xa96b8cef")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x8b0fa743">
                        <div class="card-body">
                            <h5 class="card-title">
                                    unexecuted
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x8b0fa743"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x8b0fa743">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x8b0fa743">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("unexecuted", "titles_UNKNOWNWORD_0x8b0fa743")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x8b0fa743"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x8b0fa743">Sentences (5)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x8b0fa743">
                                <ul>
                                    
                                        <li>We can demonstrate the extent of the challenge OPs pose to malware analysts. The following CFG shows the unexecuted code blocks (Figure 11, red code blocks) in one of the smaller functions (sub_18000F640) in the sample.</li>
                                    
                                        <li>Figure 11. sub_18000F640 function in BazarLoader with unexecuted code blocks colored in red.</li>
                                    
                                        <li>Next, we have to patch the instructions in OPs to force the code flow away from the unexecuted code blocks.</li>
                                    
                                        <li>Not only do we need to locate the OPs, we also have to know the exact point when the malware sample decides to avoid the unexecuted code blocks.</li>
                                    
                                        <li>Opaque Predicate (OP) is used in BazarLoader to protect it from reverse engineering tools. OP is an expression that evaluates to either true or false at runtime. Malware authors make use of multiple OPs together with unexecuted code blocks to add complexities that static analysis tools have to deal with.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("unexecuted", "sentences_UNKNOWNWORD_0x8b0fa743")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x312ae822">
                        <div class="card-body">
                            <h5 class="card-title">
                                    complexities
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x312ae822"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x312ae822">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x312ae822">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("complexities", "titles_UNKNOWNWORD_0x312ae822")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x312ae822"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x312ae822">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x312ae822">
                                <ul>
                                    
                                        <li>Opaque Predicate (OP) is used in BazarLoader to protect it from reverse engineering tools. OP is an expression that evaluates to either true or false at runtime. Malware authors make use of multiple OPs together with unexecuted code blocks to add complexities that static analysis tools have to deal with.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("complexities", "sentences_UNKNOWNWORD_0x312ae822")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x9342b4cf">
                        <div class="card-body">
                            <h5 class="card-title">
                                    deal
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x9342b4cf"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x9342b4cf">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x9342b4cf">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("deal", "titles_UNKNOWNWORD_0x9342b4cf")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x9342b4cf"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x9342b4cf">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x9342b4cf">
                                <ul>
                                    
                                        <li>Opaque Predicate (OP) is used in BazarLoader to protect it from reverse engineering tools. OP is an expression that evaluates to either true or false at runtime. Malware authors make use of multiple OPs together with unexecuted code blocks to add complexities that static analysis tools have to deal with.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("deal", "sentences_UNKNOWNWORD_0x9342b4cf")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x98920f36">
                        <div class="card-body">
                            <h5 class="card-title">
                                    disassembled
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x98920f36"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x98920f36">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x98920f36">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("disassembled", "titles_UNKNOWNWORD_0x98920f36")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x98920f36"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x98920f36">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x98920f36">
                                <ul>
                                    
                                        <li>The following disassembled code shows one of the OPs in Bazarloader:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("disassembled", "sentences_UNKNOWNWORD_0x98920f36")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x6e295d51">
                        <div class="card-body">
                            <h5 class="card-title">
                                    cfg
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x6e295d51"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x6e295d51">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x6e295d51">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("cfg", "titles_UNKNOWNWORD_0x6e295d51")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x6e295d51"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x6e295d51">Sentences (2)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x6e295d51">
                                <ul>
                                    
                                        <li>From the above control flow graph (CFG), the code flow wont end up in infinite loops (Figure 10, red code blocks). Therefore, the above OP will be evaluated to avoid the infinite loop.</li>
                                    
                                        <li>We can demonstrate the extent of the challenge OPs pose to malware analysts. The following CFG shows the unexecuted code blocks (Figure 11, red code blocks) in one of the smaller functions (sub_18000F640) in the sample.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("cfg", "sentences_UNKNOWNWORD_0x6e295d51")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x7968da93">
                        <div class="card-body">
                            <h5 class="card-title">
                                    evaluated
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x7968da93"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x7968da93">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x7968da93">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("evaluated", "titles_UNKNOWNWORD_0x7968da93")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x7968da93"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x7968da93">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x7968da93">
                                <ul>
                                    
                                        <li>From the above control flow graph (CFG), the code flow wont end up in infinite loops (Figure 10, red code blocks). Therefore, the above OP will be evaluated to avoid the infinite loop.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("evaluated", "sentences_UNKNOWNWORD_0x7968da93")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x3887a346">
                        <div class="card-body">
                            <h5 class="card-title">
                                    sub_18000f640
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x3887a346"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x3887a346">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x3887a346">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("sub_18000f640", "titles_UNKNOWNWORD_0x3887a346")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x3887a346"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x3887a346">Sentences (6)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x3887a346">
                                <ul>
                                    
                                        <li>We can demonstrate the extent of the challenge OPs pose to malware analysts. The following CFG shows the unexecuted code blocks (Figure 11, red code blocks) in one of the smaller functions (sub_18000F640) in the sample.</li>
                                    
                                        <li>Figure 11. sub_18000F640 function in BazarLoader with unexecuted code blocks colored in red.</li>
                                    
                                        <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                                    
                                        <li>Figure 15. Decompiled sub_18000F640 function after removing the OPs.</li>
                                    
                                        <li>Figure 14. Decompiled sub_18000F640 function.</li>
                                    
                                        <li>The OPs also messed with the output of the HexRays decompiler. This is how the function (sub_18000F640) looks before the OPs are patched:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("sub_18000f640", "sentences_UNKNOWNWORD_0x3887a346")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x1c2aa14e">
                        <div class="card-body">
                            <h5 class="card-title">
                                    colored
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x1c2aa14e"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x1c2aa14e">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x1c2aa14e">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("colored", "titles_UNKNOWNWORD_0x1c2aa14e")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x1c2aa14e"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x1c2aa14e">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x1c2aa14e">
                                <ul>
                                    
                                        <li>Figure 11. sub_18000F640 function in BazarLoader with unexecuted code blocks colored in red.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("colored", "sentences_UNKNOWNWORD_0x1c2aa14e")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x9b8a6287">
                        <div class="card-body">
                            <h5 class="card-title">
                                    manually
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x9b8a6287"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x9b8a6287">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x9b8a6287">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("manually", "titles_UNKNOWNWORD_0x9b8a6287")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x9b8a6287"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x9b8a6287">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x9b8a6287">
                                <ul>
                                    
                                        <li>We could manually patch away the code blocks that are not executed as we analyze each function in the sample, but this is not very practical and takes a lot of time. Instead, we will choose a smarter way by doing it automatically.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("manually", "sentences_UNKNOWNWORD_0x9b8a6287")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xbbd624b2">
                        <div class="card-body">
                            <h5 class="card-title">
                                    choose
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xbbd624b2"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xbbd624b2">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xbbd624b2">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("choose", "titles_UNKNOWNWORD_0xbbd624b2")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xbbd624b2"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xbbd624b2">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xbbd624b2">
                                <ul>
                                    
                                        <li>We could manually patch away the code blocks that are not executed as we analyze each function in the sample, but this is not very practical and takes a lot of time. Instead, we will choose a smarter way by doing it automatically.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("choose", "sentences_UNKNOWNWORD_0xbbd624b2")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x62810ecf">
                        <div class="card-body">
                            <h5 class="card-title">
                                    smarter
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x62810ecf"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x62810ecf">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x62810ecf">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("smarter", "titles_UNKNOWNWORD_0x62810ecf")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x62810ecf"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x62810ecf">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x62810ecf">
                                <ul>
                                    
                                        <li>We could manually patch away the code blocks that are not executed as we analyze each function in the sample, but this is not very practical and takes a lot of time. Instead, we will choose a smarter way by doing it automatically.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("smarter", "sentences_UNKNOWNWORD_0x62810ecf")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xe1c25700">
                        <div class="card-body">
                            <h5 class="card-title">
                                    decides
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xe1c25700"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xe1c25700">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xe1c25700">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("decides", "titles_UNKNOWNWORD_0xe1c25700")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xe1c25700"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xe1c25700">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xe1c25700">
                                <ul>
                                    
                                        <li>Not only do we need to locate the OPs, we also have to know the exact point when the malware sample decides to avoid the unexecuted code blocks.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("decides", "sentences_UNKNOWNWORD_0xe1c25700")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x417b753b">
                        <div class="card-body">
                            <h5 class="card-title">
                                    messed
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x417b753b"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x417b753b">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x417b753b">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("messed", "titles_UNKNOWNWORD_0x417b753b")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x417b753b"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x417b753b">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x417b753b">
                                <ul>
                                    
                                        <li>The OPs also messed with the output of the HexRays decompiler. This is how the function (sub_18000F640) looks before the OPs are patched:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("messed", "sentences_UNKNOWNWORD_0x417b753b")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xeb72eabb">
                        <div class="card-body">
                            <h5 class="card-title">
                                    hexrays
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xeb72eabb"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xeb72eabb">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xeb72eabb">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("hexrays", "titles_UNKNOWNWORD_0xeb72eabb")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xeb72eabb"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xeb72eabb">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xeb72eabb">
                                <ul>
                                    
                                        <li>The OPs also messed with the output of the HexRays decompiler. This is how the function (sub_18000F640) looks before the OPs are patched:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("hexrays", "sentences_UNKNOWNWORD_0xeb72eabb")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x30251f7d">
                        <div class="card-body">
                            <h5 class="card-title">
                                    decompiler
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x30251f7d"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x30251f7d">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x30251f7d">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("decompiler", "titles_UNKNOWNWORD_0x30251f7d")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x30251f7d"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x30251f7d">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x30251f7d">
                                <ul>
                                    
                                        <li>The OPs also messed with the output of the HexRays decompiler. This is how the function (sub_18000F640) looks before the OPs are patched:</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("decompiler", "sentences_UNKNOWNWORD_0x30251f7d")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x65d58bf5">
                        <div class="card-body">
                            <h5 class="card-title">
                                    decompiled
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x65d58bf5"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x65d58bf5">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x65d58bf5">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("decompiled", "titles_UNKNOWNWORD_0x65d58bf5")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x65d58bf5"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x65d58bf5">Sentences (3)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x65d58bf5">
                                <ul>
                                    
                                        <li>Figure 14. Decompiled sub_18000F640 function.</li>
                                    
                                        <li>After applying the two techniques above, we have decompiled pseudocode that is much easier to read and understand.</li>
                                    
                                        <li>Figure 15. Decompiled sub_18000F640 function after removing the OPs.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("decompiled", "sentences_UNKNOWNWORD_0x65d58bf5")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xcc77564">
                        <div class="card-body">
                            <h5 class="card-title">
                                    pseudocode
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xcc77564"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xcc77564">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xcc77564">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("pseudocode", "titles_UNKNOWNWORD_0xcc77564")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xcc77564"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xcc77564">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xcc77564">
                                <ul>
                                    
                                        <li>After applying the two techniques above, we have decompiled pseudocode that is much easier to read and understand.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("pseudocode", "sentences_UNKNOWNWORD_0xcc77564")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x8d24d1d">
                        <div class="card-body">
                            <h5 class="card-title">
                                    tell
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x8d24d1d"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x8d24d1d">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x8d24d1d">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("tell", "titles_UNKNOWNWORD_0x8d24d1d")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x8d24d1d"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x8d24d1d">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x8d24d1d">
                                <ul>
                                    
                                        <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("tell", "sentences_UNKNOWNWORD_0x8d24d1d")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x3eb3aef9">
                        <div class="card-body">
                            <h5 class="card-title">
                                    wrapper
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x3eb3aef9"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x3eb3aef9">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x3eb3aef9">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("wrapper", "titles_UNKNOWNWORD_0x3eb3aef9")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x3eb3aef9"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x3eb3aef9">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x3eb3aef9">
                                <ul>
                                    
                                        <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("wrapper", "sentences_UNKNOWNWORD_0x3eb3aef9")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xb2fc908b">
                        <div class="card-body">
                            <h5 class="card-title">
                                    getmodulefilenamew
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xb2fc908b"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xb2fc908b">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xb2fc908b">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("getmodulefilenamew", "titles_UNKNOWNWORD_0xb2fc908b")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xb2fc908b"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xb2fc908b">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xb2fc908b">
                                <ul>
                                    
                                        <li>After patching all the OPs and renaming the obfuscated API calls, we could then tell that the function (sub_18000F640) is just a wrapper function for GetModuleFileNameW().</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("getmodulefilenamew", "sentences_UNKNOWNWORD_0xb2fc908b")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x8bd87ea0">
                        <div class="card-body">
                            <h5 class="card-title">
                                    removing
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x8bd87ea0"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x8bd87ea0">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x8bd87ea0">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("removing", "titles_UNKNOWNWORD_0x8bd87ea0")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x8bd87ea0"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x8bd87ea0">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x8bd87ea0">
                                <ul>
                                    
                                        <li>Figure 15. Decompiled sub_18000F640 function after removing the OPs.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("removing", "sentences_UNKNOWNWORD_0x8bd87ea0")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0xdbf9d535">
                        <div class="card-body">
                            <h5 class="card-title">
                                    hope
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0xdbf9d535"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0xdbf9d535">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0xdbf9d535">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("hope", "titles_UNKNOWNWORD_0xdbf9d535")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0xdbf9d535"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0xdbf9d535">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0xdbf9d535">
                                <ul>
                                    
                                        <li>Malware authors often include anti-analysis techniques with the hope that they will increase the time and resources taken for malware analysts. With the above script snippets showing how to defeat these techniques for BazarLoader, you can reduce the time needed to analyze malware samples of other families that use similar techniques.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("hope", "sentences_UNKNOWNWORD_0xdbf9d535")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x5c2f38df">
                        <div class="card-body">
                            <h5 class="card-title">
                                    cloud-delivered
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x5c2f38df"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x5c2f38df">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x5c2f38df">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("cloud-delivered", "titles_UNKNOWNWORD_0x5c2f38df")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x5c2f38df"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x5c2f38df">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x5c2f38df">
                                <ul>
                                    
                                        <li>Palo Alto Networks customers are further protected from malware families using similar anti-analysis techniques with Cortex XDR or the Next-Generation Firewall with the WildFire and Threat Prevention cloud-delivered security subscriptions.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("cloud-delivered", "sentences_UNKNOWNWORD_0x5c2f38df")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x374c9b1c">
                        <div class="card-body">
                            <h5 class="card-title">
                                    mark
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x374c9b1c"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x374c9b1c">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x374c9b1c">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("mark", "titles_UNKNOWNWORD_0x374c9b1c")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x374c9b1c"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x374c9b1c">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x374c9b1c">
                                <ul>
                                    
                                        <li>Please mark, I'm not a robot!</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("mark", "sentences_UNKNOWNWORD_0x374c9b1c")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x7f74f4a3">
                        <div class="card-body">
                            <h5 class="card-title">
                                    robot
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x7f74f4a3"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x7f74f4a3">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x7f74f4a3">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("robot", "titles_UNKNOWNWORD_0x7f74f4a3")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x7f74f4a3"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x7f74f4a3">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x7f74f4a3">
                                <ul>
                                    
                                        <li>Please mark, I'm not a robot!</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("robot", "sentences_UNKNOWNWORD_0x7f74f4a3")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x9dd7f069">
                        <div class="card-body">
                            <h5 class="card-title">
                                    agree
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x9dd7f069"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x9dd7f069">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x9dd7f069">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("agree", "titles_UNKNOWNWORD_0x9dd7f069")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x9dd7f069"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x9dd7f069">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x9dd7f069">
                                <ul>
                                    
                                        <li>By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("agree", "sentences_UNKNOWNWORD_0x9dd7f069")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                    <div class="card" style="width: 60rem;" id="UNKNOWNWORD_0x83ab1027">
                        <div class="card-body">
                            <h5 class="card-title">
                                    acknowledge
                                
                            </h5>
                            References:<br/>
                            <a data-bs-toggle="collapse"
                               href="#titles_UNKNOWNWORD_0x83ab1027"
                               role="button"
                               aria-expanded="false"
                               aria-controls="titles_UNKNOWNWORD_0x83ab1027">Titles (0)</a><br/>
                            <div class="collapse" id="titles_UNKNOWNWORD_0x83ab1027">
                                <ul>
                                    
                                </ul>
                            </div>
                            <script>highlight("acknowledge", "titles_UNKNOWNWORD_0x83ab1027")</script>
                            <a data-bs-toggle="collapse"
                               href="#sentences_UNKNOWNWORD_0x83ab1027"
                               role="button"
                               aria-expanded="false"
                               aria-controls="sentences_UNKNOWNWORD_0x83ab1027">Sentences (1)</a><br/>
                            <div class="collapse" id="sentences_UNKNOWNWORD_0x83ab1027">
                                <ul>
                                    
                                        <li>By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.</li>
                                    
                                </ul>
                            </div>
                            <script>highlight("acknowledge", "sentences_UNKNOWNWORD_0x83ab1027")</script>

                            Links:<br/>
                            <ul>
                                
                            </ul>
                        </div>
                    </div>
                
                </div>
            </div>
        
    </div>
    
    
    
    
    
    
    
    
    
    

    <div class="container-lg" id="chapter_resources">
        <h2>Resources</h2>
        <h3>Links</h3>
        <div class="card" style="width: 60rem;">
            <div class="card-body">
                
                <a data-bs-toggle="collapse"
                       href="#res_links_github"
                       role="button"
                       aria-expanded="false"
                       aria-controls="res_links_github">Github (3)</a>
                <br/>
                <div class="collapse" id="res_links_github">
                    <ul>
                        
                            <li>https://github.com/idapython</li>
                        
                            <li>https://github.com/pan-unit42/iocs/blob/master/Appcall_rename_api</li>
                        
                            <li>https://github.com/pan-unit42/iocs/blob/master/DeObfuscate_Opaque</li>
                        
                    </ul>
                </div>
                
                <a data-bs-toggle="collapse"
                       href="#res_links_pastebin"
                       role="button"
                       aria-expanded="false"
                       aria-controls="res_links_pastebin">Pastebin (0)</a>
                <br/>
                <div class="collapse" id="res_links_pastebin">
                    <ul>
                        
                    </ul>
                </div>
                
                <a data-bs-toggle="collapse"
                       href="#res_links_text_files"
                       role="button"
                       aria-expanded="false"
                       aria-controls="res_links_text_files">Text_files (0)</a>
                <br/>
                <div class="collapse" id="res_links_text_files">
                    <ul>
                        
                    </ul>
                </div>
                
                <a data-bs-toggle="collapse"
                       href="#res_links_other"
                       role="button"
                       aria-expanded="false"
                       aria-controls="res_links_other">Other (18)</a>
                
                <div class="collapse" id="res_links_other">
                    <ul>
                        
                            <li>https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fbazarloader-anti-analysis-techniques%2F</li>
                        
                            <li>https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fbazarloader-anti-analysis-techniques%2F+-+Defeating+BazarLoader+Anti-Analysis+Techniques</li>
                        
                            <li>https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fbazarloader-anti-analysis-techniques%2F&title=Defeating+BazarLoader+Anti-Analysis+Techniques&summary=&source=</li>
                        
                            <li>https://unit42.paloaltonetworks.com//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/bazarloader-anti-analysis-techniques/</li>
                        
                            <li>https://unit42.paloaltonetworks.com/author/mark-lim/</li>
                        
                            <li>https://unit42.paloaltonetworks.com/category/malware-2/</li>
                        
                            <li>https://unit42.paloaltonetworks.com/tag/anti-analysis/</li>
                        
                            <li>https://unit42.paloaltonetworks.com/tag/bazarloader/</li>
                        
                            <li>https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor</li>
                        
                            <li>https://www.paloaltonetworks.com/cortex/cortex-xdr</li>
                        
                            <li>https://www.paloaltonetworks.com/products/secure-the-network/wildfire</li>
                        
                            <li>http://paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention</li>
                        
                            <li>https://unit42.paloaltonetworks.com/tag/bazarloader/</li>
                        
                            <li>https://unit42.paloaltonetworks.com/category/malware-2/</li>
                        
                            <li>https://unit42.paloaltonetworks.com/tag/anti-analysis/</li>
                        
                            <li>https://hex-rays.com/blog/introducing-the-appcall-feature-in-ida-pro-5-6/</li>
                        
                            <li>https://www.paloaltonetworks.com/legal-notices/terms-of-use</li>
                        
                            <li>https://www.paloaltonetworks.com/legal-notices/privacy</li>
                        
                    </ul>
                </div>
                
            </div>
        </div>
        <h3>Images</h3>
        <div class="card" style="width: 60rem;">
            <div class="card-body">
                <a data-bs-toggle="collapse"
                       href="#res_imgs_"
                       role="button"
                       aria-expanded="false"
                       aria-controls="res_imgs_">Expand (16)</a>
                <div class="collapse" id="res_imgs_">
                    <ul>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/Malware-r3d1.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-33.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-34.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-35.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-36.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-37.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-38.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-39.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-40.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-41.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-42.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-43.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-44.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-45.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-46.png</li>
                        
                            <li>https://unit42.paloaltonetworks.com/wp-content/uploads/2022/04/word-image-47.png</li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>