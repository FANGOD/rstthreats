[
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xe149e8f8",
            "title": "Hive Ransomware Analysis",
            "text": "Inside Out Security Blog\n\n\n\n/\n\n\nThreat Research"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xe00b65ae",
            "title": "Observation of the attack",
            "text": "The Forensics team observed that the actor managed to achieve its malicious goals and encrypt the environment in less than 72 hours from the initial compromise."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x3eb8e6f6",
            "title": "Stage 1: ProxyShell and WebShell",
            "text": "First, the attacker exploited multiple Exchange security vulnerabilities, referred to as ProxyShell. Next, the attack placed a malicious backdoor script, referred to as webshell, in a publicly accessible directory on the Exchange server. These web scripts could then execute malicious PowerShell code over the compromised server with SYSTEM privileges."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x43abe5a4",
            "title": "Stage 2: Cobalt Strike",
            "text": "The malicious PowerShell code downloaded additional stagers from a remote C2 (Command & Control) server associated with the Cobalt Strike framework. The stagers were not written to the file system but executed in memory."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x38bf9723",
            "title": "Stage 3: Mimikatz and Pass-The-Hash",
            "text": "Leveraging the SYSTEM permissions, the threat actor created a new system administrator user named \"user\" and advanced to the credential dumping stage, invoking Mimikatz. By stealing the domain Administrator NTLM hash and without needing to crack the password, the operator managed to reuse it via Pass-The-Hash attack and take control of the domain admin account."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x2304f402",
            "title": "Stage 4: Scanning for sensitive information",
            "text": "Next, the threat actor performed extensive discovery activities across the network. In addition to searching for files containing \"password\" in their names, observed activities included dropping network scanners and collecting the networks' IP addresses and device names, followed by RDPs to the backup servers and other critical assets."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x109bfc0a",
            "title": "Stage 5: Ransomware deployment",
            "text": "Finally, a custom-crafted malware payload named Windows.exe was delivered and executed on various devices, leading to wide encryption and denial of access to files within the organization.\nThe payload created a plain text ransomware demand note during the encryption phase."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xcf61e400",
            "title": "Initial Access",
            "text": "The initial indicator of compromise was the successful exploitation of Microsoft Exchange via vulnerabilities known as ProxyShell.\nRevealed in August 2021, ProxyShell is a Remote Code Execution (RCE) vulnerability. ProxyShell involves a set of three separate security flaws and allows remote attackers to execute arbitrary code on affected installations of Microsoft Exchange Server."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x7376a442",
            "title": "CVE-2021-34473 (Base Score: 9.8)",
            "text": "Microsoft Exchange Server Remote Code Execution Vulnerability."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x2393cf92",
            "title": "CVE-2021-34523 (Base Score: 9.8)",
            "text": "Microsoft Exchange Server Elevation of Privilege Vulnerability"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xf443fe4c",
            "title": "CVE-2021-31207 (Base Score: 7.2)",
            "text": "Microsoft Exchange Server Security Feature Bypass Vulnerability\nMicrosoft released patches for those three vulnerabilities in April and May 2021 as part of their \"Patch Tuesday\" releases. CVE-2021-34473 and CVE-2021-34523 were patched (KB5001779) In April 2021. CVE-2021-31207 was patched (KB5003435) in May.\nDuring the investigation, we found specific exploitation evidence of these CVEs (Common Vulnerabilities and Exposures), which allowed the adversary to deploy webshells successfully on the compromised server.\nBased on our analysis, four different IP addresses accessed the malicious files:"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x508f260a",
            "title": "139.60.161.228 (USA)",
            "text": "ASN: HOSTKEY\nRELATED ACTIVITY: Cobalt Strike C2 and Log4j vulnerability scanning"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xda9d26e5",
            "title": "139.60.161.56 (USA)",
            "text": "ASN: HOSTKEY\nRELATED ACTIVITY: Cobalt Strike C2 and Log4j vulnerability scanning"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xaa76cb2",
            "title": "185.70.184.8 (Netherlands)",
            "text": "ASN: HOSTKEY\nRELATED ACTIVITY: Cobalt Strike C2 and Log4j vulnerability scanning. Associated with Emotet, IcedID, and QBot."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x9619c902",
            "title": "91.208.52.149 (Netherlands)",
            "text": "ASN: SERVERIUS-A\nThe following malicious files were spotted:\nThese file names are made of random characters that do not appear to have any significance. Attackers commonly use this technique to prevent third parties from finding the webshells online by sending HTTP requests to a list of preconstructed names that are part of other campaigns.\nThe source code of the established webshells is taken from a public git repository at https://github.com/ThePacketBender/webshells."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x5c53ec1e",
            "title": "Execution",
            "text": "By establishing a foothold on the compromised Exchange Server, the threat actor executed various PowerShell commands designed to download malicious files from the remote C2 server to the victim's computer. Attackers would execute the malware by using commands such as Invoke-Expression (IEX) or by downloading the file content directly into the device's memory and executing it:\nFurther, attackers executed an additional obfuscated PowerShell script that was a part of the Cobalt Strike framework:\nThe Base64 encoded command contains several layers of encoding but finally decodes to the following PowerShell command:\nThe additional \"for loop\" function adds another layer of obfuscation and XORs the Base64 code with a key of 35. We successfully extracted the IP address of the target C2 by mimicking the process, which, unsurprisingly, turned out to be the same address we found previously.\nConverting the Base64 into a hexadecimal string and reformatting with a Python script restored the malicious file. VirusTotal analysis shows 23 out of 52 antivirus detections and attributes the file to the Cobalt Strike framework."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x1e76d141",
            "title": "Persistence",
            "text": "With the provided NT AUTHORITY\\SYSTEM privileges and to maintain persistence over the compromised server, a newly crafted account followed by the name \"user\" was created and added to \"Remote Desktop Users\" and \"Administrators\" groups. The user was used to access multiple paths seeking \"password\" related files, RDP access to backup servers, and more."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xe73660e8",
            "title": "Credential Access",
            "text": "The threat actor used Mimikatz, a post-exploitation tool, specifically its SekurLSA's \"logonPasswords\" module, which extracts the passwords and NTLM hashes of the accounts logged into the system and saves the results to a text file on the local system. With the administrator's NTLM hash in hand, the threat actor used the pass-the-hash technique to get highly privileged access to other assets in the network by launching a new command prompt on the affected system:"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x56f85a77",
            "title": "Lateral Movement",
            "text": "Leveraging the stolen domain admin account, the actor performed RDP access requests using mstsc.exe following the parameter \"/v\" to multiple devices on the network, mainly searching for servers associated with the network backups and SQL servers. We strongly believe that these actions were performed to confirm the ability to access the critical servers before the ransomware deployment."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x2ed3c858",
            "title": "Discovery",
            "text": "A known public network scanner tool named \"SoftPerfect\" was used to perform scans over the domain assets.\nBy utilizing the tool, the threat actor acquired the domain devices list and saved the results to a text file named \"domains.txt.\" To locate all live hosts, the attacker executed a Batch script called \"p.bat,\" which looped over the domains list sending pings and saved the results to a text file named \"res.txt.\"\nThe p.bat script and file naming convention match part of Conti's ransomware toolkit, which was provided to the group's affiliates and first leaked on August 21, 2022 and published on Twitter. This indicates that Hive affiliates are adopting other ransomware group techniques."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xc173011a",
            "title": "Impact",
            "text": "The threat actors began their final actions by distributing a file named \"windows.exe,\" which was the ransomware payload written in Golang. The payload performs multiple operations, including deleting shadow copies, disabling security products, clearing Windows event logs, and closing handles on files to guarantee a smooth encryption process. Below is a brief documentation of the executed commands:\nThe ransomware iterates through all the available folders encrypting the included files and drops a ransom note named \"_HOW_TO_DECRYPT.txt\" in each folder. Once it has finished encryption, it pops the ransom note to inform the user of the attack.",
            "table": "Command;Description\nvssadmin.exe delete shadows /all /quiet;Deleting the shadow copies from the machine to inhibit system recovery\n\"net.exe stop \"\"SamSs\"\" /y\";Stops the Security Accounts Manager to prevent sending alerts to SIEM system\n\"reg.exe add \"\"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\"\" /v \"\"DisableAntiSpyware\"\" /t REG_DWORD /d \"\"1\"\" /f\";Disables Windows Defender to avoid detection\nwevtutil.exe cl security;Clearing the Windows Security Event Logs\n"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xaa453ab0",
            "title": "Conclusions",
            "text": "Ransomware attacks have grown significantly over the past years and remain the preferred method of threat actors aiming to maximize profits. The impact of an attack can be detrimental. It may potentially harm an organization's reputation, disrupt regular operations and lead to temporary, and possibly permanent, loss of sensitive data.\nAlthough detecting and responding to such incidents can be challenging, most malicious activities can be prevented by having the right security tools, incident response plans, and patches for known vulnerabilities in place."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xbd1f695f",
            "title": "Recommendations",
            "text": "Varonis Forensics Team recommends the following:\nPatch Exchange server to the latest Exchange Cumulative Update (CU) and Security Update (SU) provided by Microsoft.\nEnforce the use of complex passwords and require users to change passwords periodically.\nUse the Microsoft LAPS solution to revoke local admin permissions from domain accounts (the principle of least privilege) and regularly check for and remove inactive user accounts.\nBlock SMBv1 usage and use SMB signing to protect against pass-the-hash attack.\nRestrict access to the minimum required for the employee's role.\nDetect and automatically prevent access control changes that violate your business rules.\nTrain employees in security principles and make sure employees receive security awareness training as a part of your cyber security plans.\nEstablish basic security practices, and set rules of behavior describing how to handle and protect the organization and customer information and other vital data."
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x123bee2c",
            "title": "MITRE Breakdown",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x5ba4a02e",
            "title": "1. Initial Access",
            "text": "Exploit Public-Facing Application (T1190)\nCVE-2021-34473\nCVE-2021-34523\nCVE-2021-31207"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x77838d2a",
            "title": "2. Execution",
            "text": "User Execution (T1204)\nMalicious File (T1204.002)\nCommand and Scripting Interpreter (T1059)\nPowerShell (T1059.001)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x4961967f",
            "title": "3. Persistence",
            "text": "Create Account (T1136)\nDomain Account (T1136.002)\nValid Accounts (T1078)\nDomain Accounts (T1078.002)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x6c28db0a",
            "title": "4. Privilege Escalation",
            "text": "Valid Accounts (T1078)\nDomain Accounts (T1078.002)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x56a1898",
            "title": "5. Defense Evasion",
            "text": "Deobfuscate/Decode Files or Information (T1140)\nIndicator Removal on Host (T1070)\nClear Windows Event Logs (T1070.001)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xe5421490",
            "title": "6. Credential Access",
            "text": "OS Credential Dumping (T1003)\nCached Domain Credentials (T1003.005)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xac786b31",
            "title": "7. Discovery",
            "text": "Remote System Discovery (T1018)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x584aefe",
            "title": "8. Lateral Movement",
            "text": "Remote Services (T1021)\nRemote Desktop Protocol (T1021.001)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0xc0e00303",
            "title": "9. Command and Control",
            "text": "Application Layer Protocol (T1071)\nWeb Protocols (T1071.001)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x5d74a7",
            "title": "10. Impact",
            "text": "Data Encrypted for Impact (T1486)"
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x54027252",
            "title": "IOC's",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x86c530d2",
            "title": "User accounts names created",
            "text": "\"user\""
        }
    },
    {
        "report": {
            "id": "report_0x3d7d7be4",
            "date": "20220422",
            "title": "Hive Ransomware Analysis",
            "url": "https://www.varonis.com/blog/hive-ransomware-analysis"
        },
        "chapter": {
            "id": "chapter_0x2fb17ea2",
            "title": "Malicious IP's",
            "text": "139.60.161.228\n139.60.161.56\n91.208.52.149\n185.70.184.8\nNadav Ovadia is a security researcher for Varonis.",
            "table": "Name;MD5;SHA1\nWindows.exe;;\nMimikatz.exe;6c9ad4e67032301a61a9897377d9cff8;655979d56e874fbe7561bb1b6e512316c25cbb19\nadvanced_port_scanner_2.5.3869.exe;6a58b52b184715583cda792b56a0a1ed;3477a173e2c1005a81d042802ab0f22cc12a4d55\nadvanced port scanner.exe;4fdabe571b66ceec3448939bfb3ffcd1;763499b37aacd317e7d2f512872f9ed719aacae1\nscan.exe;bb7c575e798ff5243b5014777253635d;2146f04728fe93c393a74331b76799ea8fe0269f\np.bat;5e1575c221f8826ce55ac2696cf1cf0b;ecf794599c5a813f31f0468aecd5662c5029b5c4\nWebshell #1;d46104947d8478030e8bcfcc74f2aef7;d1ef9f484f10d12345c41d6b9fca8ee0efa29b60\nWebshell #2;2401f681b4722965f82a3d8199a134ed;2aee699780f06857bb0fb9c0f73e33d1ac87a385\n"
        }
    }
]