<div> <h2>Introduction:</h2><p>Hacking forums often double up as underground marketplaces where cybercriminals buy, rent, and sell all kinds of malicious illegal products, including software, trojans, stealers, exploits, and leaked credentials. Malware-as-a-service has contributed substantially to the growth of ransomware and phishing attacks (among other attack types) in the past year, as they lower the technical barrier to entry for criminals to carry out attacks.</p><p>While recently perusing one of these hacking forums during regular research activities, the Zscaler ThreatLabz team came across BlackGuard, a sophisticated stealer, advertised for sale. Blackguard is currently being sold as malware-as-a-service with a lifetime price of $700 and a monthly price of $200.</p><p>BlackGuard has the capability to steal all types of information related to Crypto wallets, VPN, Messengers, FTP credentials, saved browser credentials, and email clients.</p><p>In this blog, we share analysis and screenshots of the techniques this stealer uses to steal information and evade detection using obfuscation, as well as techniques used for anti-debugging.</p><p> </p><p><a class="fancybox-media" href="https://lh6.googleusercontent.com/Y9W4ma_hQ8biEiYEVdBKfBUKqpOzSR7lo8wvgtpxBASJ4riona-Hd5H3kj7bzU6wPF_bzs-YmiamyvYqT6nLN-xSeR7T90hu0VjRX2kmK3pdXAeMmwGri_IugJo-mxMETa-RWvUE"><img class="lazyloaded" height="230" src="https://lh6.googleusercontent.com/Y9W4ma_hQ8biEiYEVdBKfBUKqpOzSR7lo8wvgtpxBASJ4riona-Hd5H3kj7bzU6wPF_bzs-YmiamyvYqT6nLN-xSeR7T90hu0VjRX2kmK3pdXAeMmwGri_IugJo-mxMETa-RWvUE" style="max-width:80%;height:auto;width:auto;"/></a></p><p>Fig 1. Forum thread promoting the BlackGuard stealer</p><h2>Technical Analysis:</h2><p>BlackGuard is a .NET stealer packed with a crypto packer. Currently, it is in active development and has the following capabilities:</p><p> </p><h3>Anti-Detection:</h3><p>Once executed, it checks and kills the processes related to antivirus and sandbox as shown in the figure below.</p><p><a class="fancybox-media" href="https://lh4.googleusercontent.com/hZeKYdR2kCGY3xXOLu8oBgn8W6qRZeKa5DjdVL9MJhSOJJq9g0El--pMnY1oswn_Z13WEanbX9pwQQfMTneCOzLPJuDnjf4n2ZbEM-eXvEweaeL_5MeOKQBtSoCeZvzYQjN7V-qD"><img class="lazyloaded" height="224" src="https://lh4.googleusercontent.com/hZeKYdR2kCGY3xXOLu8oBgn8W6qRZeKa5DjdVL9MJhSOJJq9g0El--pMnY1oswn_Z13WEanbX9pwQQfMTneCOzLPJuDnjf4n2ZbEM-eXvEweaeL_5MeOKQBtSoCeZvzYQjN7V-qD" style="max-width:80%;height:auto;width:auto;"/></a></p><p>Fig 2. BlackGuard detects antivirus processes</p><p> </p><h3>String Obfuscation:</h3><p>The stealer contains a hardcoded array of bytes which is decoded in runtime to ASCII strings followed by base64 decoding. This allows it to bypass antivirus and string-based detection.</p><p> </p><p><a class="fancybox-media" href="https://lh6.googleusercontent.com/vu5XQ7LX-t8MK-BRjpsodSvF3oivwxq1NgPkMfoffxma0hGioWeg7NYUkLPiSBX2M9OeOGGUTHPrppGN-nKilzcfZHBJ8Y9AvWaRqFCE6p8fEmjuioXFTSFBRNdIxzF6TdAG7bcW"></a><a class="fancybox-media" href="https://lh6.googleusercontent.com/vu5XQ7LX-t8MK-BRjpsodSvF3oivwxq1NgPkMfoffxma0hGioWeg7NYUkLPiSBX2M9OeOGGUTHPrppGN-nKilzcfZHBJ8Y9AvWaRqFCE6p8fEmjuioXFTSFBRNdIxzF6TdAG7bcW"><img class="lazyloaded" height="158" src="https://lh6.googleusercontent.com/vu5XQ7LX-t8MK-BRjpsodSvF3oivwxq1NgPkMfoffxma0hGioWeg7NYUkLPiSBX2M9OeOGGUTHPrppGN-nKilzcfZHBJ8Y9AvWaRqFCE6p8fEmjuioXFTSFBRNdIxzF6TdAG7bcW" style="max-width:80%;height:auto;width:auto;"/></a></p><p>Fig 3. String decryption technique</p><p> </p><h3>Anti-CIS:</h3><p>BlackGuard checks for the infected device country by sending a request to “http://ipwhois.app/xml/” and exits itself if the device is located in the Commonwealth of Independent States (CIS).</p><p><img class="lazyload" height="184" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 4. Whitelist CIS</p><p> </p><h3>Anti-Debug:</h3><p>BlackGuard uses user32!BlockInput() which can block all mouse and keyboard events in order to disrupt attempts at debugging.
 </p><p><img class="lazyload" height="127" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 5. Anti-debugging technique</p><h3>Stealing Function:</h3><p>After all the checks are completed, the stealer function gets called which collects information from various browsers, software, and hardcoded directories, as shown in the screenshot below.</p><p> </p><p><img class="lazyload" height="224" style="max-width:80%;height:auto;width:auto;"/> </p><p> Fig 6. Stealer code</p><p> <img class="lazyload" height="277" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 7. Features Posted on forum</p><h4>Browsers:</h4><p>BlackGuard steals credentials from Chrome- and Gecko-based browsers using the static path. It has the capability to steal history, passwords, autofill information, and downloads.</p><p><img class="lazyload" height="304" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 8. Browser stealing function</p><h4>Cryptocurrency Wallets:</h4><p>BlackGuard also supports the stealing of wallets and other sensitive files related to crypto wallet applications. It targets sensitive data in files such as wallet.dat that contain the address, the private key to access this address, and other data. The stealer checks for the default wallet file location in AppData and copies it to the working folder.</p><p> </p><p><img class="lazyload" height="129" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 9. Crypto wallet stealing function</p><h4>Crypto Extensions:</h4><p>This stealer also targets crypto wallet extensions installed in Chrome and Edge with hardcoded extension IDs as shown in the figure below.</p><p> </p><p><img class="lazyload" height="181" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 10. Crypto extensions stealing function</p><p> </p><h3>C2 Exfiltration:</h3><p>After collecting the information, BlackGuard creates a .zip of all the files and sends it to the C2 server through a POST request along with the system information like Hardware ID and country as shown in the figure below.</p><p><img class="lazyload" height="217" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 11. C2 Exfiltration code snippet</p><p> </p><p><img class="lazyload" height="206" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 12. Traffic capture of exfiltration</p><p>
</p><p><img class="lazyload" height="274" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 13. Panel screenshot</p><h3>Targeted Applications:</h3><h4>Browsers:</h4><p>Chrome, Opera, Firefox, MapleStudio, Iridium, 7Star, CentBrowser, Chedot, Vivaldi, Kometa, Elements Browser, Epic Privacy Browser, uCozMedia, Coowon, liebao, QIP Surf, Orbitum, Comodo, Amigo, Torch, Comodo, 360Browser, Maxthon3, K-Melon, Sputnik, Nichrome, CocCoc, Uran, Chromodo, Edge, BraveSoftware.</p><h4>Crypto Wallets:</h4><p>AtomicWallet, BitcoinCore, DashCore, Electrum, Ethereum, Exodus, LitecoinCore, Monero, Jaxx, Zcash, Solar, Zap, AtomicDEX, Binance, Frame, TokenPocket, Wassabi.</p><h4>Crypto Wallet Extensions:</h4><p>Binance, coin98, Phantom, Mobox, XinPay, Math10, Metamask, BitApp, Guildwallet, iconx, Sollet, Slope Wallet, Starcoin, Swash, Finnie, KEPLR, Crocobit, OXYGEN, Nifty, Liquality, Auvitas wallet, Math wallet, MTV wallet, Rabet wallet, Ronin wallet, Yoroi wallet, ZilPay wallet, Exodus, Terra Station, Jaxx.</p><h4>Email Clients:</h4><p>Outlook</p><h4>Other Applications:</h4><p>NordVPN, OpenVPN, ProtonVpn, Totalcomander, Filezilla, WinSCP, Steam</p><h4>Messengers:</h4><p>Telegram, Signal, Tox, Element, Pidgin, Discord</p><h2> </h2><h2>Conclusion:</h2><p>While applications of BlackGuard are not as broad as other stealers, BlackGuard is a growing threat as it continues to be improved and is developing a strong reputation in the underground community.</p><p>To combat against BlackGuard and similar credential theft malware, we recommend that security teams inspect all traffic and use malware prevention tools that include both antivirus (for known threats) and sandboxing capabilities (for unknown threats). We also recommend training end users on the following:</p><ol><li>Don’t use the same passwords for all the services and replace them on a regular cadence.</li><li>Use multi-factor authentication where applicable. </li><li>Avoid visiting unknown sites.</li><li>Avoid opening suspicious unknown files.</li></ol><h2>IOCs:</h2><h4>Hashes:</h4><p>4d66b5a09f4e500e7df0794552829c925a5728ad0acd9e68ec020e138abe80ac</p><p>c98e24c174130bba4836e08d24170866aa7128d62d3e2b25f3bc8562fdc74a66</p><p>7f2542ed2768a8bd5f6054eaf3c5f75cb4f77c0c8e887e58b613cb43d9dd9c13</p><p>f2d25cb96d3411e4696f8f5401cb8f1af0d83bf3c6b69f511f1a694b1a86b74d</p><p>bbc8ac47d3051fbab328d4a8a4c1c8819707ac045ab6ac94b1997dac59be2ece</p><p>f47db48129530cf19f3c42f0c9f38ce1915f403469483661999dc2b19e12650b</p><p>ead17dee70549740a4e649a647516c140d303f507e0c42ac4b6856e6a4ff9e14</p><p>1ee88a8f680ffd175943e465bf85e003e1ae7d90a0b677b785c7be8ded481392</p><p>71edf6e4460d3eaf5f385610004cfd68d1a08b753d3991c6a64ca61beb4c673a</p><p>e08d69b8256bcea27032d1faf574f47d5412b6da6565dbe52c968ccecea1cd5d</p><h4> </h4><h4>Domains: </h4><p>win.mirtonewbacker.com</p><p>umpulumpu.ru</p><p>greenblguard.shop</p><p>onetwostep.at
 </p><h2>Zscaler coverage:</h2><p>We have ensured coverage for the payloads seen in these attacks via advanced threat signatures as well as our advanced cloud sandbox.</p><p> </p><h3>Advanced Threat Protection: </h3><p>Win32.PWS.Blackguard</p><p> </p><h3>Advanced Cloud Sandbox:</h3><p><img class="lazyload" height="305" style="max-width:80%;height:auto;width:auto;"/></p><p>Fig 14. Zscaler sandbox detection</p><p> </p><p> </p><ul class="zp-0 zm-0 category-tags"><li class="d-block d-md-inline-block zmt-8 zmt-md-0 zmb-8 zmx-md-8"> <a class="h4 fw-400 fg-color-white bg-color-blue zpy-10 zpx-16 zmb-0 rounded d-inline-block category-tag" href="https://www.zscaler.com/blogs/security-research">Security Research</a></li><li class="d-block d-md-inline-block zmt-8 zmt-md-0 zmb-8 zmx-md-8"> <a class="h4 fw-400 fg-color-white bg-color-blue zpy-10 zpx-16 zmb-0 rounded d-inline-block category-tag" href="https://www.zscaler.com/blogs/insights-and-research">Insights and Research</a></li></ul><ul class="w-100 text-center text-md-left sharing-buttons zp-0 zm-0"><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="mailto:?subject=Analysis%20of%20BlackGuard%20-%20a%20new%20info%20stealer%20malware%20being%20sold%20in%20a%20Russian%20hacking%20forum&amp;body=https://bit.ly/3uFDpNN" title="Share via email"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.facebook.com/sharer/sharer.php?u=https://bit.ly/3uFDpNN" target="_blank" title="Share on facebook"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.linkedin.com/sharing/share-offsite/?title=Analysis%20of%20BlackGuard%20-%20a%20new%20info%20stealer%20malware%20being%20sold%20in%20a%20Russian%20hacking%20forum&amp;url=https://bit.ly/3uFDpNN" target="_blank" title="Share on linkedin"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://twitter.com/intent/tweet?text=https://bit.ly/3uFDpNN%20%E2%80%94%20Analysis%20of%20BlackGuard%20-%20a%20new%20info%20stealer%20malware%20being%20sold%20in%20a%20Russian%20hacking%20forum" target="_blank" title="Tweet"> </a></li><li class="d-inline-block zmr-16"> <a class="d-flex sharing-link text-left fg-color-blue" href="https://www.zscaler.com/blogs/feeds/security-research" title="Check feeds"> </a></li></ul><h2 class="fw-400 fg-color-blue zmb-0 zmt-15 zmt-md-0">Authors</h2><h3 class="zp-12 zmb-4 drop-shadow-hover"> <a class="fg-color-black" href="https://www.zscaler.com/author/mwani" title="Read all blog by Mitesh Wani">Mitesh Wani</a> </h3><h3 class="zp-12 zmb-4 drop-shadow-hover"> <a class="fg-color-black" href="https://www.zscaler.com/author/kkhursale" title="Read all blog by Kaivalya Khursale">Kaivalya Khursale</a> </h3><h2 class="fw-400 fg-color-blue zmb-md-24 zmb-0">Recommended for You</h2><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/conti-ransomware-attacks-persist-updated-version-despite-leaks" title="Conti Ransomware Attacks Persist With an Updated Version Despite Leaks">Conti Ransomware Attacks Persist With an Updated Version Despite Leaks</a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/lapsus-attack-okta-how-evaluate-impact-your-organization" title="Lapsus$ Attack on Okta: How to Evaluate the Impact to your Organization ">Lapsus$ Attack on Okta: How to Evaluate the Impact to your Organization </a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/midas-ransomware-tracing-evolution-thanos-ransomware-variants" title="Midas Ransomware : Tracing the Evolution of Thanos Ransomware Variants">Midas Ransomware : Tracing the Evolution of Thanos Ransomware Variants</a></h6><h6 class="fw-500 zmb-0"> <a class="fg-color-black" href="https://www.zscaler.com/blogs/security-research/domain-fronting-abuse-and-hiding" title="Domain Fronting, Abuse and Hiding">Domain Fronting, Abuse and Hiding</a></h6></div>