<div>
<img alt="" class="hidden-social-img" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Teabot.png" style="max-width:80%;height:auto;width:auto;"/>
<a class="uncategorized" href="https://labs.k7computing.com/index.php/category/android/">Android</a><a class="uncategorized" href="https://labs.k7computing.com/index.php/category/banking-malware/">Banking Malware</a><a class="uncategorized" href="https://labs.k7computing.com/index.php/category/deceptive-apps/">Deceptive Apps</a>
<h1 class="entry-title">Play Store App Serves Teabot Via GitHub</h1>
By Baran SMay 13, 2022
 
<p></p><p>We at K7 Labs recently came across this <a href="https://twitter.com/ThreatFabric/status/1522175714409209856" rel="noopener" target="_blank">twitter post</a> aboutTeabot (aka ‘Anatsa’) a banking Trojan. The main infection vector of Teabot was found on the official Google Play Store where it posed as QR Code &amp; BarCode Scanner app with 10,000+ downloads as shown in Figure 1.</p>
<figure class="wp-caption aligncenter" id="attachment_23985"><img alt="" class="wp-image-23985 size-full" height="818" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure1-1.png" style="max-width:800px;height:auto;width:auto;" width="654"/><figcaption class="wp-caption-text" id="caption-attachment-23985">Figure 1: QR Code &amp; BarCode Scanner from Google Play Store</figcaption></figure>
<p>Once launched, this app requests the user to update itself via a popup message as shown in Figure 2.</p>
<figure class="wp-caption aligncenter" id="attachment_23986"><img alt="" class="wp-image-23986 size-full" height="1440" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure2-1.png" style="max-width:800px;height:auto;width:auto;" width="2232"/><figcaption class="wp-caption-text" id="caption-attachment-23986">Figure 2: Update message popup</figcaption></figure>
<p>When the user clicks on the “Update” message this application downloads and installs the malicious Teabot Banking Trojan “main.apk” as shown in Figure 2.</p>
<p>From the ADB Logcat report we noticed that the malware file “main.apk” gets downloaded from a GitHub repository as shown in Figure 3.</p>
<figure class="wp-caption aligncenter" id="attachment_23987"><img alt="" class="wp-image-23987 size-full" height="71" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure3-1.png" style="max-width:800px;height:auto;width:auto;" width="1040"/><figcaption class="wp-caption-text" id="caption-attachment-23987">Figure 3: ADB Logcat shows malware sample download URL</figcaption></figure>
<p>Figure 4 shows the repository was created by mattiebryan4570, at the time of writing this blog the GitHub repository was still live.</p>
<figure class="wp-caption aligncenter" id="attachment_23988"><img alt="" class="wp-image-23988 size-full" height="430" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure4-1.png" style="max-width:800px;height:auto;width:auto;" width="940"/><figcaption class="wp-caption-text" id="caption-attachment-23988">Figure 4: GitHub repository where the malware sample was hosted</figcaption></figure>
<p>In this blog, we will be analyzing the package “com.joy.slab” corresponding to the main.apk which has been downloaded from the above mentioned GitHub repository as shown in Figure 5.</p>
<figure class="wp-caption aligncenter" id="attachment_23989"><img alt="" class="wp-image-23989 size-full" height="425" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure5-1.png" width="376"/><figcaption class="wp-caption-text" id="caption-attachment-23989">Figure 5: Malicious APK downloaded from GitHub</figcaption></figure>
<p>Once the Teabot malware is installed on the device, the app downloads itself as a QR-Code Scanner: Add-On which frequently brings up the Accessibility Service setting option on the device, as shown in Figure 6, until the user allows this app to have the Accessibility Service enabled. </p>
<figure class="wp-caption alignnone" id="attachment_23990"><img alt="" class="wp-image-23990 size-full" height="1440" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure6-1.png" style="max-width:800px;height:auto;width:auto;" width="1440"/><figcaption class="wp-caption-text" id="caption-attachment-23990">Figure 6: Request for accessibility service</figcaption></figure>
<p>Once the permissions are granted, this malicious apk decrypts the malicious payload file called eepHM.json from the app’s assets folder to an executable dex format named ‘eepHM.odex’ and loads the decrypted file as shown in Figure 7.</p>
<figure class="wp-caption aligncenter" id="attachment_23992"><img alt="" class="wp-image-23992 size-full" height="70" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure7-1.png" style="max-width:800px;height:auto;width:auto;" width="1097"/><figcaption class="wp-caption-text" id="caption-attachment-23992">Figure 7: The logcat image shows the eepHM.odex file execution at runtime</figcaption></figure>
<p>The trojan then attempts to intercept SMS messages and aborts the new SMSReceived broadcast to the victim; as per the bot command “logged_sms” as shown in Figure 8.</p>
<figure class="wp-caption aligncenter" id="attachment_23993"><img alt="" class="wp-image-23993 size-full" height="456" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure8-1.png" style="max-width:800px;height:auto;width:auto;" width="970"/><figcaption class="wp-caption-text" id="caption-attachment-23993">Figure 8: Intercept SMS messages</figcaption></figure>
<p>After abusing the Android Accessibility Service, this trojan acts as a keylogger to steal the victim’s keystroke information from the device.</p>
<figure class="wp-caption aligncenter" id="attachment_23994"><img alt="" class="wp-image-23994 size-full" height="288" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure9-1.png" style="max-width:800px;height:auto;width:auto;" width="1077"/><figcaption class="wp-caption-text" id="caption-attachment-23994">Figure 9: Keylogger functionality</figcaption></figure>
<h3>C2 Communication</h3>
<p>Teabot enumerates the list of installed applications on the victim’s device and then sends this list to the C2 server during its first communication. All the communications between C2 and the malware remain encrypted using an XOR key as shown in Figure 10. When one or more targeted apps are found, the C2 server sends the specific payload(s) to the victim’s device to perform an overlay attack and track all the activity related to the identified targeted application(s).</p>
<figure class="wp-caption aligncenter" id="attachment_23995"><img alt="" class="wp-image-23995 size-full" height="458" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure10-1.png" style="max-width:800px;height:auto;width:auto;" width="848"/><figcaption class="wp-caption-text" id="caption-attachment-23995">Figure 10: List of installed apps sent encrypted by the malware and the decrypted data</figcaption></figure>
<p>The following are the targeted applications in a typical victim’s device</p>
<figure class="wp-caption aligncenter" id="attachment_23996"><img alt="" class="wp-image-23996 size-full" height="645" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure11.png" width="488"/><figcaption class="wp-caption-text" id="caption-attachment-23996">Figure 11 : Targeted applications</figcaption></figure>
<p>This malware also terminates a predefined list of apps’ process(es), as shown in Figure 12. Interestingly, that list includes a few popular security products as highlighted below, in order to remain undetected.</p>
<figure class="wp-caption aligncenter" id="attachment_23997"><img alt="" class="wp-image-23997 size-full" height="503" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure12.png" width="393"/><figcaption class="wp-caption-text" id="caption-attachment-23997">Figure 12: Apps list terminated</figcaption></figure>
<figure class="wp-caption aligncenter" id="attachment_23998"><img alt="" class="wp-image-23998 size-full" height="488" src="https://labs.k7computing.com/wp-content/uploads/2022/05/Figure13.png" width="580"/><figcaption class="wp-caption-text" id="caption-attachment-23998">Figure 13: Security related apps list</figcaption></figure>
<p>At K7, we protect all our customers from such threats. Do ensure that you protect your mobile devices with a reputable security product like K7 Mobile Security and scan your devices with it. Also keep your security product and devices updated and patched for the latest vulnerabilities to stay safe from such threats.</p>
<h2>Indicators of Compromise (IoCs)</h2>
<table>
<tbody>
<tr>
<td>Package Name</td>
<td>Hash</td>
<td>K7 Detection Name</td>
</tr>
<tr>
<td>com.zynksoftware.docuscanapp </td>
<td>13DF6443BF24D0E49566735B93F22646</td>
<td>Trojan-Downloader ( 0058d95d1 )</td>
</tr>
<tr>
<td>com.joy.slab</td>
<td>04F4FB5E6CB95DFF7CCEE97B1F7D3636</td>
<td>Trojan ( 0053b5f91 ) </td>
</tr>
</tbody>
</table>
<p> </p>
<h3>C2 </h3>
<p>hxxp://62[.]182[.]81[.]71/api/</p>
<p>hxxp://185[.]215[.]113[.]31:83/api</p>
<p> </p>
<p></p>
<h3 class="comment-reply-title">Like what you're reading? Subscribe to our top stories.</h3>
<p>If you want to subscribe to our monthly newsletter, please submit the form below.</p> Email* : 
<ul class="controls">
<li class="previous-post mouse-leaving">
<h3>Previous Post« <a href="https://labs.k7computing.com/index.php/transparent-tribe-targets-educational-institution/" rel="prev">Transparent Tribe Targets Educational Institution</a>
</h3>
</li>
<li class="next-post mouse-leaving">
<h3>Next Post
</h3>
</li>
</ul>
<h3 class="related-title">More Posts</h3>
</div>