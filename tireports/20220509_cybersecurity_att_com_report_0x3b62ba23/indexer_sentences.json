{"id": "sentence_0x78b48889", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "May 9, 2022 |"}
{"id": "sentence_0x2d8c400e", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Robert Dean"}
{"id": "sentence_0xe6f4ef52", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Executive summary"}
{"id": "sentence_0x1f4d7f6", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Investigation"}
{"id": "sentence_0xf6cdd61d", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Initial alarm review"}
{"id": "sentence_0x924e2732", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Indicators of Compromise (IOC)"}
{"id": "sentence_0x4e8b7eea", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Expanded investigation"}
{"id": "sentence_0x8057ee7", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Events search"}
{"id": "sentence_0xf69d3b32", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Response"}
{"id": "sentence_0x83e819e3", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Building the investigation"}
{"id": "sentence_0xaab8dc63", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Customer interaction"}
{"id": "sentence_0xcc40fc09", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Limitations and opportunities"}
{"id": "sentence_0x7ffe7f45", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Limitations"}
{"id": "sentence_0x931ed12e", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x25251556", "chapter_title": "Stories from the SOC - Command and Control", "text": "Opportunities"}
{"id": "sentence_0x9a1b421e", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x409fa5cf", "chapter_title": "Stories from the SOC - Command and Control", "text": "Stories from the SOC is a blog series that describes recent real-world security incident investigations conducted and reported by the AT&T SOC analyst team for AT&T Managed Extended Detection and Response customers."}
{"id": "sentence_0xc8dd7dd8", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x97bd0c58", "chapter_title": "Executive summary", "text": "Once a malicious actor has gained initial access to an internal asset, they may attempt to conduct command and control activity. The Command and Control (C&C) tactic, as identified by the MITRE ATT&CK Framework, consists of techniques that adversaries may use to communicate with systems under their control within a victim network. Cobalt Strike is an effective adversary simulation tool used in security assessments but has been abused by malicious actors for Command and Control of victim networks. If configured by attackers, it can be used to deploy malicious software, execute scripts, and more."}
{"id": "sentence_0xd3f93c1b", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x97bd0c58", "chapter_title": "Executive summary", "text": "This investigation began when the Managed Extended Detection and Response (MXDR) analyst team received multiple alarms involving the detection of Cobalt Strike on an internal customer asset. Within ten minutes of this activity, the attacker launched a Meterpreter reverse shell and successfully installed remote access tools Atera and Splashtop Streamer on the asset. These actions allowed the attacker to establish multiple channels of command and control. In response, the MXDR team created an investigation and informed the customer of this activity. The customer determined that an endpoint detection and response (EDR) agent was not running on this asset, which could have prevented this attack from occurring. This threat was remediated by isolating the asset and scanning it with SentinelOne to remove indicators of compromise. Additionally, Cobalt Strike, Atera, and Splashtop Streamer were added to SentinelOnes blacklist to prevent unauthorized execution of this software in the customer environment."}
{"id": "sentence_0x3490b5a0", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x72e14bc3", "chapter_title": "Indicators of Compromise (IOC)", "text": "An initial alarm was triggered by a Windows Defender detection of Cobalt Strike on an internal customer asset. The associated log was provided to USM Anywhere using NXLog and was detected using a Windows Defender signature. Multiple processes related to Cobalt Strike were attached to this alarm."}
{"id": "sentence_0x9a60bb00", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x72e14bc3", "chapter_title": "Indicators of Compromise (IOC)", "text": "Cobalt Strike, as mentioned previously, is a legitimate security tool that can be abused by malicious actors for Command and Control of compromised machines. In this instance, a Cobalt Strike beacon was installed on the compromised asset to communicate with the attackers infrastructure. Windows Defender took action to prevent these processes from running."}
{"id": "sentence_0xeb53d185", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x72e14bc3", "chapter_title": "Indicators of Compromise (IOC)", "text": "Immediately following the Cobalt Strike detection, an additional alarm was triggered for a Meterpreter reverse shell."}
{"id": "sentence_0x2706bc24", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x72e14bc3", "chapter_title": "Indicators of Compromise (IOC)", "text": "A Meterpreter reverse shell is a component of the Metasploit Framework and requires the attacker to set up a remote listener on their own infrastructure that listens for connections. Upon successful exploitation, the victim machine connects to this remote listener, establishing a channel for the attacker to send malicious commands. A Meterpreter reverse shell can be used to allow an attacker to upload files to the victim machine, record user keystrokes, and more. In this instance, Windows Defender also took action to prevent this process from running."}
{"id": "sentence_0x47e4dc99", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x561c8072", "chapter_title": "Events search", "text": "During post-exploitation, an attacker may leverage scheduled tasks to run periodically, disable antivirus, or configure malicious applications to execute during startup. To query for this activity, specific event names, such as Windows Autostart Location, New Scheduled Task, and events containing Windows Defender, were added to a filter in USM Anywhere. An additional filter was applied to display events occurring in the last 24 hours. This expanded event search provided context into attacker activity around the time of the initial Cobalt Strike and Meterpreter alarms."}
{"id": "sentence_0x8960123c", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x561c8072", "chapter_title": "Events search", "text": "Event deep dive"}
{"id": "sentence_0xecd56e8", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x561c8072", "chapter_title": "Events search", "text": "Just after the Cobalt Strike and Meterpreter detections, a scheduled task was created named Monitoring Recovery. This task is identified by Windows Event ID 106:"}
{"id": "sentence_0x90eec5c3", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x561c8072", "chapter_title": "Events search", "text": "This scheduled task was used to install two remote monitoring and management (RMM) applications: Atera and Splashtop Streamer. Shortly after this task was created and executed, an event was received indicating AteraAgent.exe was added as a Windows auto-start service."}
{"id": "sentence_0xb92ee1f1", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x561c8072", "chapter_title": "Events search", "text": "AteraAgent.exe is associated with Atera, a legitimate computer management application that allows for remote access, management, and monitoring of computer systems, but has been abused by attackers for command and control of compromised systems."}
{"id": "sentence_0xabe37acc", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x561c8072", "chapter_title": "Events search", "text": "This change was followed by an event involving SRService.exe being added as a Windows auto-start service on this asset: SRService.exe is associated with Splashtop Streamer Service, a remote access application commonly used by IT support, also abused by attackers for C&C communications. At this point, the attacker attempted to create multiple channels for command and control using Cobalt Strike, Meterpreter, Atera, and Splashtop Streamer. While the Cobalt Strike and Meterpreter sessions were terminated by Windows Defender, Atera and Spashtop Streamer were successfully added as startup tasks. This allowed the attacker to establish persistence in the customer environment. Persistence, as identified by the MITRE ATT&CK framework, allows the attacker to maintain access to systems across restarts, changed credentials, and other interruptions that could cut off their access."}
{"id": "sentence_0x75efe54", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x2b347a43", "chapter_title": "Building the investigation", "text": "All alarms and events were carefully recorded in an investigation created in USM Anywhere. The customer was immediately contacted regarding this compromise, which lead to an all-hands-on-deck call to remediate this threat. This compromise was escalated to the customers Threat Hunter, as well as management and Tier 2 analysts."}
{"id": "sentence_0xcb793794", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x521911e0", "chapter_title": "Customer interaction", "text": "The MXDR team worked directly with the customer to contain and remediate this threat. This asset was quarantined from the customer network where it was scanned for malicious indicators using SentinelOne. The customer installed the SentinelOne EDR agent on this asset to protect it from any current threats. Additionally, the unauthorized applications Cobalt Strike, Meterpreter, Atera, and Splashtop Streamer were added to SentinelOnes blacklist to prevent future execution of these programs in the customer environment."}
{"id": "sentence_0xbffea933", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0x5264a9cc", "chapter_title": "Limitations", "text": "While this compromise was quickly detected and contained, the customer lacked the protection required to prevent the applications Atera and Splashtop Steamer from being installed and added as Windows auto-start programs."}
{"id": "sentence_0x34de6e3c", "report_id": "report_0x3b62ba23", "report_date": "2022-05-09T00:00:00Z", "report_title": "Stories from the SOC - Command and Control", "report_url": "https://cybersecurity.att.com/blogs/security-essentials/stories-from-the-soc-command-and-control", "chapter_id": "chapter_0xfc982838", "chapter_title": "Opportunities", "text": "To protect an enterprise network from current threats, a multi-layered approach must be taken, otherwise known as Defense in Depth. This entails multiple layers of protection, including Endpoint Detection and Response, implementation of a SIEM (Security Information and Event Management System), and additional security controls. With the addition of an EDR agent installed on this asset, this malicious behavior would have been prevented. AT&Ts Managed Endpoint Security (MES) provides endpoint detection and response and can be utilized along with USM Anywhere to actively detect, prevent, and notify the customer of malicious activity in their environment."}
