<div>
<h1>Upgraded version of Stealer Targeting Discord Users</h1>
<p></p>
<p>Cyble Research Labs has come across a new strain of malware performing stealing activities named Hazard Token Grabber. The initial version of Hazard Token Grabber was spotted in the wild in 2021, and we have observed an upgraded version now, which Threat Actors (TAs) are using to steal the user’s data. Both versions are available on GitHub for free.</p>
<p>During our OSINT threat hunting exercise, we came across over 2000 Samples related to this stealer present in the wild. Most of the samples seen in the wild are the actual Python source code of the malware used for compiling the binary, indicating that the malware has been used on a large scale. Interestingly few of the samples had either low or even zero detection.</p>
<p>As per the statement made by the Threat Actor (TA), it appears that an upgraded version of Hazard Stealer can be accessed by purchasing it on their Discord server or website. This indicates that the malware present on GitHub might not be that evasive, and the TA has only uploaded it there for advertisement purposes. Figure 1 shows the statement made by the Threat Actor.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11191 jetpack-lazy-image" height="158" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-1-Statement-made-by-TA.png?resize=994%2C158&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="994"/><img alt="" class="wp-image-11191" height="158" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-1-Statement-made-by-TA.png?resize=994%2C158&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="994"/><figcaption>Figure 1 – Statement made by TA</figcaption></figure>
<p></p>
<p>The number of samples related to Hazard stealer has increased significantly in the last three months, as shown below.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11192 jetpack-lazy-image" height="414" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-2-Stats-of-the-sample-submission-in-VirusTotal.png?resize=702%2C414&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="702"/><img alt="" class="wp-image-11192" height="414" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-2-Stats-of-the-sample-submission-in-VirusTotal.png?resize=702%2C414&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="702"/><figcaption>Figure 2 – Stats of the sample submission in VirusTotal</figcaption></figure>
<p></p>
<p>The figure below shows the file details of one of the recent samples we analyzed.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11193 jetpack-lazy-image" height="425" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-3-File-Details.png?resize=710%2C425&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="710"/><img alt="" class="wp-image-11193" height="425" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-3-File-Details.png?resize=710%2C425&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="710"/><figcaption>Figure 3 – File Details</figcaption></figure>
<p></p>
<h2 id="h-technical-analysis">Technical Analysis</h2>
<p></p>
<h3>Builder:</h3>
<p></p>
<p>Hazard Token Grabber is developed using Python, and the builder of this stealer supports Python version 3.10. The builder is a simple batch file that helps generate the payload and convert malicious Python script to a .exe file using Pyinstaller.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11195 jetpack-lazy-image" height="491" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-4-Hazard-builder.png?resize=936%2C491&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11195" height="491" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-4-Hazard-builder.png?resize=936%2C491&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 4 – Hazard builder</figcaption></figure>
<p></p>
<h3>Payload:</h3>
<p></p>
<p>The malware exfiltrates the data to a Discord channel using webhooks which can be modified through the configuration settings. The malware configuration also contains Flag variables and a list of programs to terminate during execution, as shown below. </p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11196 jetpack-lazy-image" height="453" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-5-File-Configuration.png?resize=809%2C453&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="809"/><img alt="" class="wp-image-11196" height="453" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-5-File-Configuration.png?resize=809%2C453&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="809"/><figcaption>Figure 5 – File Configuration</figcaption></figure>
<p></p>
<p>The malware copies itself into the startup location to establish persistence and creates a random directory in the %temp% to store the stolen data.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11198 jetpack-lazy-image" height="304" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-6-Creates-a-folder-in-Temp-directory.png?resize=477%2C304&amp;ssl=1" width="477"/><img alt="" class="wp-image-11198" height="304" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-6-Creates-a-folder-in-Temp-directory.png?resize=477%2C304&amp;ssl=1" width="477"/><figcaption>Figure 6 – Creating a folder in the Temp directory</figcaption></figure>
<p></p>
<p>Upon execution, the stealer checks the configuration settings and creates a list to append the function names whose flag is set to TRUE. After this, the malware creates a thread for each function present in the list to execute the malicious code parallelly.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11199 jetpack-lazy-image" height="365" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-7-Multithreading.png?resize=936%2C365&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11199" height="365" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-7-Multithreading.png?resize=936%2C365&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 7 – Multithreading</figcaption></figure>
<p></p>
<h3>Anti-debug:</h3>
<p></p>
<p>The malware performs various checks to prevent debugging and terminates itself if malware is being debugged. The malware has a list of a few hardcoded values such as hardware ID, PC names, and usernames to exclude them from infection. The figure below shows the hardcoded lists</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11200 jetpack-lazy-image" height="222" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-8-Anti-debug-check.png?resize=936%2C222&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11200" height="222" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-8-Anti-debug-check.png?resize=936%2C222&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 8 – Anti-debug check</figcaption></figure>
<p></p>
<p>The malware also checks for the disk size of the victim’s system. If it’s below 50GB, it terminates itself. It then reads the following registry keys for identifying the Virtual environment.</p>
<p>SYSTEM\\CurrentControlSet\\Services\\Disk\\Enum</p>
<p>HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Control\\Class\\{4D36E968-E325-11CE-BFC1-08002BE10318}\\0000\\DriverDesc 2&gt; nul”)</p>
<p>HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Control\\Class\\{4D36E968-E325-11CE-BFC1-08002BE10318}\\0000\\ProviderName 2&gt; nul”)</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11202 jetpack-lazy-image" height="314" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-9-Queries-registry.png?resize=936%2C314&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11202" height="314" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-9-Queries-registry.png?resize=936%2C314&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 9 – Query registry</figcaption></figure>
<p></p>
<h3>Data Harvesting:</h3>
<p></p>
<p>The malware then proceeds to scan for the presence of a Discord token protector, something that protects Discord tokens from malicious grabbers. To evade this, the malware checks for the presence of certain files such as DiscordTokenProtector.exe, ProtectionPayload.dll, and secure.dat. If these filesare present in the DiscordTokenProtector directory, the malware removes them. After this, the malware also modifies the config.json file present in the DiscordTokenProtector directory to bypass the token protector. </p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11203 jetpack-lazy-image" height="396" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-10-Bypass-DiscordTokenProtector.png?resize=918%2C396&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="918"/><img alt="" class="wp-image-11203" height="396" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-10-Bypass-DiscordTokenProtector.png?resize=918%2C396&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="918"/><figcaption>Figure 10 – Bypassing DiscordTokenProtector</figcaption></figure>
<p></p>
<p>The Hazard token grabber then bypasses the BetterDiscord by replacing the string ‘api/webhooks’ with ‘RdimoTheGoat,’ as shown below.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11204 jetpack-lazy-image" height="191" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-11-Bypass-BetterDiscord.png?resize=669%2C191&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="669"/><img alt="" class="wp-image-11204" height="191" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-11-Bypass-BetterDiscord.png?resize=669%2C191&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="669"/><figcaption>Figure 11 – Bypassing BetterDiscord</figcaption></figure>
<p></p>
<p>Using the subprocess module, the malware spawns PowerShell for fetching the Windows activation key and product name by querying registry keys shown in the figure below. The malware then steals this data for exfiltration. </p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11206 jetpack-lazy-image" height="162" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-12-Spawns-PowerShell.png?resize=936%2C162&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11206" height="162" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-12-Spawns-PowerShell.png?resize=936%2C162&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 12 – Spawning PowerShell</figcaption></figure>
<p></p>
<p>This malware targets over 20 applications with the express purpose of stealing Discord tokens which include:</p>
<p>Discord, DiscordCanary, Lightcord, DiscordPTB, Opera, OperaGX, Amigo, Torch, Kometa, Orbitum, CentBrowser, 7Star, Sputnik, Vivaldi, ChromeSxS, Chrome, EpicPrivacyBrowser, Microsoft Edge, Uran, Yandex, Brave, Iridium and Mozilla Firefox.</p>
<p>This grabber steals cookies and login credentials from the chrome browser only. The stolen credentials contain Domain, Username, and Password. The stolen data is saved in a text file which will be copied to the random folder created initially.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11207 jetpack-lazy-image" height="625" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-13-Steals-data-from-Chrome-browser.png?resize=891%2C625&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="891"/><img alt="" class="wp-image-11207" height="625" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-13-Steals-data-from-Chrome-browser.png?resize=891%2C625&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="891"/><figcaption>Figure 13 – Stealing data from Chrome browser</figcaption></figure>
<p></p>
<p>The malware uses the API <a href="mailto:hxxps%5B:%5D//discord.com/api/v9/users/@me">hxxps[:]//discord.com/api/v9/users/@me</a> and appends a Discord authorization token to identify Account information, such as email, mobile, and billing-related details. It also identifies the badge associated with the Discord account and writes all the harvested information into “Discord Info.txt”, as depicted below.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11208 jetpack-lazy-image" height="610" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-14-Harvest-data-using-discord-developers-API.png?resize=936%2C610&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11208" height="610" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-14-Harvest-data-using-discord-developers-API.png?resize=936%2C610&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 14 – Harvesting data using discord developer’s API</figcaption></figure>
<p></p>
<p>The Hazard token grabber reads the following registry key:</p>
<p>SOFTWARE\Roblox\RobloxStudioBrowser\roblox.com -Name .ROBLOSECURITY</p>
<p>to steal the Roblox studio cookie and writes the stolen data to the “Roblox Cookies.txt” file.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11209 jetpack-lazy-image" height="298" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-15-Steals-Roblox-Studio-Cookies.png?resize=936%2C298&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11209" height="298" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-15-Steals-Roblox-Studio-Cookies.png?resize=936%2C298&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 15 – Stealing Roblox Studio Cookies</figcaption></figure>
<p></p>
<h3>Data Exfiltration:</h3>
<p>Hazard token grabber sends a request to hxxps[:]//ipinfo[.]io/json to identify the victim’s IP and Location. It also finds the victim’s Google Maps Location. The malware does not write this data to a file but instead sends this as a message on Discord.</p>
<p>Finally, the malware compresses the stolen data and exfiltrates it using webhooks specified by the TA.</p>
<figure class="wp-block-image aligncenter size-full"><img alt="" class="wp-image-11211 jetpack-lazy-image" height="500" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-16-Data-Exfiltration.png?resize=936%2C500&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><img alt="" class="wp-image-11211" height="500" src="https://i0.wp.com/blog.cyble.com/wp-content/uploads/2022/06/Figure-16-Data-Exfiltration.png?resize=936%2C500&amp;ssl=1" style="max-width:800px;height:auto;width:auto;" width="936"/><figcaption>Figure 16 – Data Exfiltration</figcaption></figure>
<h2>Conclusion</h2>
<p></p>
<p>In the course of our analysis, we witnessed some samples of Hazard Token Grabber, which were fully undetectable. As the stealer is also available on GitHub, it’s possible that other TAs can also utilize its source code to create a variant of this stealer. Hazard stealer has the capability to steal data from multiple applications; however, considering its specific functionality, the primary target appears to be Discord users.</p>
<h2>Our Recommendations:</h2>
<p></p>
<ul><li>Avoid downloading applications from unknown sources.</li><li>Use a reputed anti-virus and internet security software package on your connected devices, including PC, laptop, and mobile. </li><li>Use strong passwords and enforce multi-factor authentication wherever possible. </li><li>Update your passwords periodically.</li></ul>
<ul><li>Refrain from opening untrusted links and email attachments without first verifying their authenticity. </li><li>Block URLs that could be used to spread the malware, e.g., Torrent/Warez. </li><li>Monitor the beacon on the network level to block data exfiltration by malware or TAs. </li><li>Enable Data Loss Prevention (DLP) Solution on the employees’ systems. </li></ul>
<h2>MITRE ATT&amp;CK® Techniques  </h2>
<figure class="wp-block-table"><table><tbody><tr><td>Tactic </td><td>Technique ID </td><td>Technique Name </td></tr><tr><td>Execution  </td><td><a href="https://attack.mitre.org/techniques/T1204/" rel="noreferrer noopener" target="_blank">T1204</a> </td><td>User Execution </td></tr><tr><td>Defense Evasion </td><td><a href="https://attack.mitre.org/techniques/T1497/001/" rel="noreferrer noopener" target="_blank">T1497.001</a> </td><td>Virtualization/Sandbox Evasion: System Checks </td></tr><tr><td>Persistence</td><td><a href="https://attack.mitre.org/techniques/T1547/001/">T1547.001</a></td><td>Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</td></tr><tr><td>Credential Access </td><td><a href="https://attack.mitre.org/techniques/T1555/" rel="noreferrer noopener" target="_blank">T1555</a>
<a href="https://attack.mitre.org/techniques/T1539/" rel="noreferrer noopener" target="_blank">T1539</a>
<a href="https://attack.mitre.org/techniques/T1528/" rel="noreferrer noopener" target="_blank">T1528</a> </td><td>Credentials from Password Stores
 Steal Web Session Cookie
 Steal Application Access Token </td></tr><tr><td>Collection </td><td><a href="https://attack.mitre.org/techniques/T1113/" rel="noreferrer noopener" target="_blank">T1113</a> </td><td>Screen Capture </td></tr><tr><td>Discovery </td><td><a href="https://attack.mitre.org/techniques/T1087/" rel="noreferrer noopener" target="_blank">T1087</a>
<a href="https://attack.mitre.org/techniques/T1518/" rel="noreferrer noopener" target="_blank">T1518</a>
<a href="https://attack.mitre.org/techniques/T1057/" rel="noreferrer noopener" target="_blank">T1057</a>
<a href="https://attack.mitre.org/techniques/T1124/" rel="noreferrer noopener" target="_blank">T1124</a>
<a href="https://attack.mitre.org/techniques/T1007/" rel="noreferrer noopener" target="_blank">T1007</a>
<a href="https://attack.mitre.org/techniques/T1614/" rel="noreferrer noopener" target="_blank">T1614</a> </td><td>Account Discovery
Software Discovery
Process Discovery
System Time Discovery
System Service Discovery
System Location Discovery </td></tr><tr><td>Command and Control </td><td><a href="https://attack.mitre.org/techniques/T1071/">T1071</a></td><td>Application Layer Protocol </td></tr><tr><td>Exfiltration </td><td><a href="https://attack.mitre.org/techniques/T1041/" rel="noreferrer noopener" target="_blank">T1041</a> </td><td>Exfiltration Over C2 Channel </td></tr></tbody></table></figure>
<h2>Indicators of Compromise (IoCs):   </h2>
<figure class="wp-block-table"><table><tbody><tr><td>Indicators </td><td>Indicator type </td><td>Description </td></tr><tr><td>2e434a36c1c3df178e3d19a66e871144
d079bcd90c03088e9c5e77084f8e4c385557db6b 2441f2df1789cfc48a170a7927d73b98d8676a65eb81f3b068e4c76c3b85e77a </td><td>MD5
SHA1 SHA256</td><td>Payload</td></tr><tr><td>7fdc0515d98ff7d113ce68cccf29ae12
3f4966ec6ecc8973702f32e51eb766dda737f2d0 4ac15d15ff16919a08770265c074e8e89b21c9b61ce6348072aa719e80b5ed06 </td><td>MD5
SHA1 SHA256</td><td>Payload</td></tr><tr><td>c2ea16d8bfec78e1b2bf4322df0f63bd 
083f1d520e8524d778e1c52b4cbdd5986ca6365c 6925d86fdedff2065c33df7806ba231d0d1c8f2d5246f1cad343f37fee54fe29 </td><td>MD5
SHA1 SHA256</td><td>Payload</td></tr></tbody></table></figure>
</div>