<div>
<ol>
<li>
<a href="#id1">Введение</a>
</li>
<li>
<a href="#id2">Общие сведения</a>
</li>
<li>
<a href="#id3">Анализ ВПО и инструментов</a>
<ol>
<li>
<a href="#id3-1">MyKLoadClient</a>
<ol>
<li>
<a href="#id3-1-1">Схема 1</a>
</li>
<li>
<a href="#id3-1-2">Схема 2</a>
</li>
<li>
<a href="#id3-1-3">Тестовый образец</a>
</li>
<li>
<a href="#id3-1-4">Полезная нагрузка</a>
</li>
</ol>
</li>
<li>
<a href="#id3-2">Zupdax</a>
<ol>
<li>
<a href="#id3-2-1">Полезная нагрузка</a>
</li>
<li>
<a href="#id3-2-2">Связь с Redsip</a>
</li>
<li>
<a href="#id3-2-3">Связи с Winnti и FF-RAT</a>
</li>
<li>
<a href="#id3-2-4">Связи с Bronze Union и TA428</a>
</li>
</ol>
</li>
<li>
<a href="#id3-3">Загрузчики</a>
<ol>
<li>
<a href="#id3-3-1">Downloader.Climax.A</a>
</li>
<li>
<a href="#id3-3-2">Downloader.Climax.B</a>
</li>
</ol>
</li>
<li>
<a href="#id3-4">RtlShare</a>
<ol>
<li>
<a href="#id3-4-1">Дроппер rtlstat.dll</a>
</li>
<li>
<a href="#id3-4-2">Инжектор rtlmake.dll</a>
</li>
<li>
<a href="#id3-4-3">Полезная нагрузка rtlmain.dll (rtlmainx64.dll)</a>
</li>
<li>
<a href="#id3-4-4">Использование RtlShare</a>
</li>
</ol>
</li>
<li>
<a href="#id3-5">PlugX</a>
<ol>
<li>
<a href="#id3-5-1">Demo dropper</a>
</li>
</ol>
</li>
<li>
<a href="#id3-6">BH_A006</a>
<ol>
<li>
<a href="#id3-6-1">Стадия 0. Загрузка DLL из оверлея</a>
</li>
<li>
<a href="#id3-6-2">Стадия 1. DLL-дроппер</a>
</li>
<li>
<a href="#id3-6-3">Стадия 2. Загрузчик .dat (SbieDll.dll / SbieMsg.dll)</a>
</li>
<li>
<a href="#id3-6-4">Стадия 3. Шеллкод .dat и DLL</a>
</li>
<li>
<a href="#id3-6-5">Стадия 4. MemLoadLibrary</a>
</li>
<li>
<a href="#id3-6-6">Стадия 5. Полезная нагрузка</a>
</li>
<li>
<a href="#id3-6-7">Связь с 9002 RAT</a>
</li>
</ol>
</li>
<li>
<a href="#id3-7">Deed RAT</a>
</li>
</ol>
</li>
<li>
<a href="#id4">Заключение</a>
</li>
<li>
<a href="#id5">Приложения</a>
<ol>
<li>
<a href="#id5-1">MITRE</a>
</li>
<li>
<a href="#id5-2">IOCs</a>
<ol>
<li>
<a href="#id5-2-1">Файловые индикаторы</a>
</li>
<li>
<a href="#id5-2-2">Сетевые индикаторы</a>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="id1">Введение</h2>
<p>В конце 2019 года специалисты экспертного центра безопасности Positive Technologies (<a href="https://www.ptsecurity.com/ru-ru/services/esc/" target="_blank">PT Expert Security Center</a>, PT ESC) обнаружили фишинговое письмо, нацеленное на одно из предприятий авиационно-космической отрасли России. Оно содержало ссылку на ранее неизвестное вредоносное ПО. Такое же ВПО наши эксперты обнаружили в 2020 году при расследовании инцидента ИБ в одной из российских государственных организаций. В ходе этих работ было также обнаружено несколько новых вредоносных семейств, использующих общую сетевую инфраструктуру, при этом часть из них ранее не упоминалась в открытых источниках.</p>
<p>Летом 2021 года <a href="https://www.ptsecurity.com/ru-ru/services/esc/" target="_blank">PT Expert Security Center</a> выявил следы компрометации другого предприятия. Организация была проинформирована. В результате расследования мы обнаружили на ее компьютерах соединения с той же самой сетевой инфраструктурой. Дальнейшее исследование позволило определить еще как минимум две организации в России, атакованные с использованием этого же ВПО и сетевой инфраструктуры, обе — с государственным участием.</p>
<p>Выявленную вредоносную активность не удалось однозначно связать с какой-либо из известных хакерских групп, поэтому мы дали атакующим новое имя — Space Pirates. Поводом для названия послужила строка P1Rat, использованная злоумышленниками в PDB-путях, и нацеленность некоторых атак на авиационно-космическую отрасль. В этом отчете описывается обнаруженная активность группировки, особенности используемого ею ВПО, а также ее связи с другими APT-группами.</p>
<h2 id="id2">Общие сведения</h2>
<p>Мы предполагаем, что Space Pirates имеет азиатские корни: на это указывает активное использование китайского языка в ресурсах, SFX-архивах и путях к PDB-файлам. Кроме того, в арсенал группы входят распространенные в среде хакеров азиатского происхождения билдер Royal Road RTF (или 8.t) и бэкдор PcShare, а почти все пересечения с уже известной активностью связаны с APT-группировками азиатского региона.</p>
<p>Свою активность группа начала не позднее 2017 года. Основными целями злоумышленников являются шпионаж и кража конфиденциальной информации. Среди жертв, которых удалось выявить в ходе исследования угроз, — государственные учреждения и ИТ-департаменты, предприятия авиационно-космической и электроэнергетической отраслей в России, Грузии и Монголии. При этом в России атакованы по крайней мере пять организаций, в Грузии — одна, а точное число жертв в Монголии неизвестно.</p>
<p>Некоторые атаки с использованием зловредов APT-группы также были нацелены на китайские компании, работающие в области финансов, что может говорить о наличии денежной мотивации. Все потенциальные жертвы были уведомлены по линии национальных CERT.</p>
<p>По меньшей мере две атаки на российские организации можно считать успешными. В первом случае злоумышленники получили доступ как минимум к 20 серверам в корпоративной сети, где присутствовали около 10 месяцев. За это время было похищено более 1500 внутренних документов, а также информация обо всех учетных записях сотрудников в одном из сетевых доменов. Во втором случае атакующим удалось закрепиться в сети компании более чем на год, получить сведения о входящих в сеть компьютерах и установить свое ВПО по крайней мере на 12 корпоративных узлов в трех различных регионах.</p>
<p>В инструментарий Space Pirates входят уникальные загрузчики и несколько бэкдоров, ранее нам не встречавшихся, и, предположительно, специфичных для группы: MyKLoadClient, BH_A006, Deed RAT. Злоумышленники также имеют доступ к бэкдору Zupdax: его современные варианты используют аналогичную MyKLoadClient схему исполнения, однако код самого бэкдора берет начало в 2010 году и не может быть однозначно привязан к группе.</p>
<p>Кроме того, атакующие используют и хорошо известное ВПО: PlugX, ShadowPad, Poison Ivy, модифицированный вариант PcShare и публичный шелл <a href="https://github.com/bitsadmin/ReVBShell" target="_blank">ReVBShell</a>. Для туннелирования трафика применяется утилита <a href="https://github.com/vzex/dog-tunnel" target="_blank">dog-tunnel</a>.</p>
<p>Основная сетевая инфраструктура группы задействует небольшое количество IP-адресов, на которые указывают DDNS-домены. Интересно, что злоумышленники при этом используют домены не только третьего уровня, но также четвертого и последующих, например w.asd3.as.amazon-corp.wikaba.com.</p>
<p>В процессе исследования деятельности Space Pirates мы обнаружили большое число пересечений с ранее выявленной активностью, которую исследователи связывают с группами Winnti (APT41), Bronze Union (APT27), TA428, RedFoxtrot, Mustang Panda и Night Dragon. Причиной этого, вероятно, является обмен инструментарием между группировками — частое явление для APT-групп азиатского региона.</p>
<p>Отдельно стоит отметить связь групп Space Pirates и TA428. В рамках одного из расследований мы наблюдали на зараженных компьютерах активность обеих группировок, которая, однако, не имела пересечений в сетевой инфраструктуре. В то же время в ходе операции StealthyTrident, <a href="https://www.welivesecurity.com/2020/12/10/luckymouse-ta428-compromise-able-desktop/" target="_blank">описанной ESET</a>, атакующие использовали Tmanger, приписываемый TA428, и Zupdax, связанный со Space Pirates. Связь другого ВПО TA428, в частности Albaniiutas (RemShell), и Zupdax можно проследить и в сетевой инфраструктуре, смежной с упомянутой в отчете ESET. Все это позволяет предполагать, что Space Pirates и TA428 могут объединять свои усилия и делиться инструментами, сетевыми ресурсами и доступом к зараженным системам.</p>
<p>Ключевые связи между затронутыми организациями, семействами ВПО и фрагментами сетевой инфраструктуры, а также публичной информацией об атакующих можно увидеть на рис. 1. Далее в отчете мы расскажем о них подробнее.</p>
<figure>
<img alt="Рисунок 1. Ключевые связи" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image1.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 1. Ключевые связи</figcaption>
</figure>
<h2 id="id3">Анализ ВПО и инструментов</h2>
<h3 id="id3-1">MyKLoadClient</h3>
<p>Данное вредоносное ПО использовалось в атаках на российские организации, включая государственные учреждения и предприятия из авиационно-космической отрасли, и часто распространялось с помощью целевого фишинга. Как показывает анализ писем, жертвами также становились китайские компании, предоставляющие финансовые сервисы.</p>
<p>Среди обнаруженных нами экземпляров ВПО с MyKLoadClient можно выделить две типичные схемы исполнения. Первая (далее также — схема 1) опирается на использование SFX-архивов в качестве дропперов, применяет технику DLL Side-Loading и использует вспомогательную библиотеку-лончер AntiVirusLoader.dll. Вторая (далее — схема 2) включает в себя только самописный дроппер, который передает управление полезной нагрузке напрямую. При этом во втором случае закрепление в системе в коде не предусмотрено.</p>
<p>Стоит отметить, что, по известным нам данным, прослеживается явная взаимосвязь между целями злоумышленников и выбором схемы исполнения: экземпляры с использованием схемы 1 были нацелены на российские организации, тогда как схема 2 использовалась в атаках на китайские компании. Если опираться на даты модификации и компиляции файлов (которые, однако, могли быть подменены), такое же разделение можно проследить и по времени: схема 1, предположительно, использовалась в 2018–2019 годах, а схема 2 — в 2020 году. Возможно, злоумышленники обновили цепочку исполнения примененного ранее ВПО, чтобы уменьшить вероятность его обнаружения в новых атаках.</p>
<h4 id="id3-1-1">Схема 1</h4>
<p>Характерным примером экземпляра с первой схемой исполнения является файл с именем Петербургский международный экономический форум (ПМЭФ)____2019.exe (d3a50abae9ab782b293d7e06c7cd518bbcec16df867f2bdcc106dec1e75dc80b). Файл представляет собой SFX-архив, который извлекает документ-приманку 0417.doc и еще один SFX-архив с именем apple.exe. Файлы в архиве модифицированы в апреле 2019 года. Документ содержит текст с описанием ПМЭФ, соответствующим действительности.</p>
<figure>
<img alt="Рисунок 2. Содержимое приманки 0417.doc" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image2.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 2. Содержимое приманки 0417.doc</figcaption>
</figure>
<p>Второй SFX-архив извлекает из себя три PE-файла: легитимный siteadv.exe, лончер siteadv.dll и библиотеку с полезной нагрузкой cc.tmp. Отметим, что в изученных нами экземплярах с первой схемой исполнения не всегда есть приманка. Однако во всех случаях применяется подобный SFX-архив, содержащий файлы с теми же именами и назначением.</p>
<figure>
<img alt="Рисунок 3. Содержимое архива apple.exe" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image3.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 3. Содержимое архива apple.exe</figcaption>
</figure>
<p>Исполняемый EXE-файл подписан McAfee, Inc. и является компонентом установщика McAfee SiteAdvisor. При запуске он загружает библиотеку siteadv.dll, которая отвечает за установку и запуск полезной нагрузки. В ресурсах лончера присутствует конфигурация, зашифрованная RC4 с ключом TDILocker и содержащая необходимые пути, имена ключей реестра и флаги.</p>
<figure>
<img alt="Рисунок 4. Фрагмент кода siteadv.dll" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image4.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 4. Фрагмент кода siteadv.dll</figcaption>
</figure>
<p>Лончер предусматривает несколько возможных команд, которые передаются через аргументы командной строки и отвечают за одну из стадий исполнения:</p>
<table class="table-article">
<thead>
<tr>
<th>Команда</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>stat</td>
<td>Команда, с которой начинается установка. Перезапускает процесс, в который загружена библиотека (siteadv.exe), с командой install_del. Дополнительно передает путь к родительскому процессу.</td>
</tr>
<tr>
<td>install_del</td>
<td>Закрепляется на зараженном компьютере (ключ реестра указан в конфигурации). При этом используется путь к файлу siteadv.exe с аргументом run или mrun. Удаляет файл, заданный третьим аргументом (путь к родительскому процессу). Запускает полезную нагрузку так же, как команда run.</td>
</tr>
<tr>
<td>run</td>
<td>Загружает DLL с полезной нагрузкой через LoadLibrary и выполняет экспортируемую из нее функцию (имя указано в конфигурации).</td>
</tr>
<tr>
<td>mrun</td>
<td>Не реализована.</td>
</tr>
<tr>
<td>ins</td>
<td>Не реализована.</td>
</tr>
</tbody>
</table>
<p>Помимо основной экспортируемой функции main, которая вызывается легитимным siteadv.exe, в siteadv.dll присутствует неиспользуемый экспорт buc_uninstallinterface, отвечающий за обход UAC <a href="https://3gstudent.github.io/backup-3gstudent.github.io/%E9%80%9A%E8%BF%87COM%E7%BB%84%E4%BB%B6IARPUninstallStringLauncher%E7%BB%95%E8%BF%87UAC/" target="_blank">с использованием компонента IARPUninstallStringLauncher</a>.</p>
<p>Библиотека лончера имеет экспортируемое имя AntiVirusLoader.dll. В некоторых ее экземплярах можно встретить PDB-путь:
D:\Leee\515远程文件\P1Rat_2017_07_28A\src\MyLoader_bypassKIS\snake\res\SiteAdv.pdb.</p>
<p>Полезная нагрузка cc.tmp — это бэкдор, реализованный в виде динамической библиотеки с внутренним именем client.dll. Она экспортирует функцию MyKLoad, которая является фактической точкой входа. Функциональность бэкдора мы рассмотрим ниже.</p>
<h4 id="id3-1-2">Схема 2</h4>
<p>В качестве дроппера во второй схеме выступает исполняемый файл, отвечающий за извлечение приманки и полезной нагрузки. Бинарные данные расположены в теле дроппера и зашифрованы XOR с однобайтовым ключом. Помимо стандартного запуска извлеченной нагрузки через вызов CreateProcess, дроппер также выполняет рефлективную загрузку и исполнение EXE-файла непосредственно в текущем процессе.</p>
<figure>
<img alt="Рисунок 5. Фрагмент кода дроппера" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image5.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 5. Фрагмент кода дроппера</figcaption>
</figure>
<p>В некоторых случаях функции дроппера дополнительно обфусцированы с применением техники <a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Control-Flow-Flattening" target="_blank">Control Flow Flattening</a>.</p>
<figure>
<img alt="Рисунок 6. Обфусцированная версия дроппера" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image6.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 6. Обфусцированная версия дроппера</figcaption>
</figure>
<p>В качестве приманки в изученных нами образцах используется PDF-документ, содержащий сообщение о «поврежденном файле» на китайском языке, либо приложение-заглушка, которое выводит сообщения 正在更新浏览器插件，请稍后… (Подключаемый модуль браузера обновляется, подождите …) и 更新完毕，请重启浏览器！ (Обновление завершено, перезапустите браузер!).</p>
<figure>
<img alt="Рисунок 7. PDF-приманка с текстом «Файл поврежден или несовместим»" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image7.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 7. PDF-приманка с текстом «Файл поврежден или несовместим»</figcaption>
</figure>
<p>Полезная нагрузка в данном случае представляет собой исполняемый файл, в котором указано внутреннее имя client.exe. В некоторых образцах также присутствует PDB-путь C:\Users\classone\Desktop\src\client\exe_debug\client.pdb.</p>
<h4 id="id3-1-3">Тестовый образец</h4>
<p>Нам также удалось обнаружить тестовый вариант ВПО, созданный не позднее 2018 года: b1d6ba4d995061a0011cb03cd821aaa79f0a45ba2647885171d473ca1a38c098. Это приложение-дроппер.</p>
<p>Интересно, что оно создано, по-видимому, на основе проекта игры «Змейка». На это указывает несколько деталей:</p>
<ul>
<li>в начале своей работы приложение создает окно, используя в качестве его имени строку Snake;</li>
<li>присутствует код, предположительно, отвечающий за логику игры — в частности за генерацию случайных координат очередного куска пищи на поле 50×50 и сравнение их с позицией змейки;</li>
<li>приложение обрабатывает нажатия клавиши «Пробел» и клавиш управления курсором;</li>
<li>в ресурсах приложения есть меню с пунктами на китайском языке: «Старт», «Пауза», «Перезагрузка» и «Выход».</li>
</ul>
<figure>
<img alt="Рисунок 8. Меню приложения" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image8.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 8. Меню приложения</figcaption>
</figure>
<p>Помимо этого, среди ресурсов дроппера также присутствует окно «О программе» (на китайском языке), из содержания которого следует, что это вторая версия игры Snake, созданная в 2016 году. Здесь же указан электронный адрес вероятного автора — mexbochen@foxmail.com.</p>
<figure>
<img alt="Рисунок 9. Окно «О программе»" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image9.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 9. Окно «О программе»</figcaption>
</figure>
<p>Поиск адреса в Google позволяет найти персональную страницу владельца электронной почты — программиста из Китая, который специализируется на задачах по обработке изображений.</p>
<figure>
<img alt="Рисунок 10. Сайт-визитка с контактным адресом mexbochen@foxmail.com" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image10.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 10. Сайт-визитка с контактным адресом mexbochen@foxmail.com</figcaption>
</figure>
<p>Несмотря на наличие связи между приложением и владельцем эл. почты, нельзя однозначно утверждать, что именно он является автором ВПО. Возможно, в некоторый момент времени проект игры «Змейка» находился в открытом доступе, и злоумышленники использовали его как основу для реализации дроппера.</p>
<p>Файлы, извлекаемые дроппером, содержатся в его ресурсах в открытом виде. Помимо этого, ресурсы содержат зашифрованную конфигурацию, в которой записаны имена файлов — точно такая же конфигурация используется и в лончере. В момент записи файлов на диск их содержимое шифруется XOR с ключом 0x80, а затем файлы открываются повторно и расшифровываются. Дроппер содержит тот же набор компонентов, что и SFX-архивы (<a href="#id3-1-1">схема 1</a>): легитимный компонент McAfee SiteAdvisor, DLL-лончер и библиотеку с полезной нагрузкой под именем Client.obj.</p>
<p>После извлечения дроппер формирует командную строку для запуска лончера с командой install (закрепление в реестре и запуск полезной нагрузки), но в дальнейшем не использует ее. Вероятно, это ошибка: в коде присутствует отладочное сообщение «CreateProcess success!», но функция CreateProcess не вызывается.</p>
<p>Лончер тестового образца отличается наличием реализации команды mrun: это вариация команды run, отвечающей за запуск экспортируемой из DLL функции с полезной нагрузкой. В отличие от run, mrun предварительно расшифровывает библиотеку по алгоритму RC4 с ключом GoogleMailData, а для ее исполнения использует рефлективную загрузку.</p>
<p>Полезная нагрузка Client.obj аналогична cc.tmp (<a href="#id3-1-1">схема 1</a>) и имеет лишь несущественные отличия. В частности, экспортируемая библиотекой функция точки входа называется main, а в начале своей работы она отображает MessageBox с текстом «just a demo for test!!!». Кроме того, конфигурация бэкдора не шифруется и содержит тестовый C2 127.0.0.1.</p>
<h4 id="id3-1-4">Полезная нагрузка</h4>
<p>Варианты реализации бэкдора в виде исполняемого файла client.exe и библиотеки client.dll имеют одинаковую функциональность. Однако в них по-разному инициализируется структура с параметрами конфигурации, которая содержит адрес и порт C2, флаг активности бэкдора, а также строковые идентификаторы ВПО, отправляемые на C2.</p>
<p>В библиотеке client.dll, так же как и в лончере (схема 1), в ресурсах полезной нагрузки есть конфигурация, зашифрованная RC4-ключом GoogleMailData. В EXE-варианте структура заполняется фиксированными в коде значениями.</p>
<p>В следующей таблице перечислены обнаруженные нами экземпляры бэкдора и данные, указанные в их конфигурации, а именно идентификаторы и контрольный сервер. Знак «?» означает, что строка представляет собой случайный набор байтов.</p>
<table class="table-article">
<thead>
<tr>
<th>SHA-256 полезной нагрузки</th>
<th>Схема</th>
<th>ID1</th>
<th>ID2</th>
<th>ID3</th>
<th>С2</th>
</tr>
</thead>
<tbody>
<tr>
<td>5847c8b8f54c60db939b045d385aba0795880d92b00d28447d7d9293693f622b</td>
<td>1</td>
<td>pwd</td>
<td>my vps</td>
<td>group</td>
<td>127.0.0.1</td>
</tr>
<tr>
<td>56b9648fd3ffd1bf3cb030cb64c1d983fcd1ee047bb6bd97f32edbe692fa8570</td>
<td>1</td>
<td>pwd</td>
<td>my vps</td>
<td>?</td>
<td>207.148.121.88</td>
</tr>
<tr>
<td>d0fb0a0379248cdada356da83cd2ee364e0e58f4ed272d3369fe1d6ca8029679</td>
<td>1</td>
<td>pwd</td>
<td>my vps</td>
<td>?</td>
<td>207.148.121.88</td>
</tr>
<tr>
<td>7b7a65c314125692524d588553da7f6ab3179ceb639f677ed1cefe3f1d03f36e</td>
<td>1</td>
<td>pwd</td>
<td>my vps</td>
<td>?</td>
<td>207.148.121.88</td>
</tr>
<tr>
<td>3ccae178d691fc95f6c52264242a39daf4c44813d835eaa051e7558b191d19ee</td>
<td>1</td>
<td>pwd</td>
<td>my vps</td>
<td>?</td>
<td>207.148.121.88</td>
</tr>
<tr>
<td>69863ba336156f4e559364b63a39f16e08ac3a6e3a0fa4ce11486ea16827f772</td>
<td>1</td>
<td>pwd</td>
<td>my vps</td>
<td>?</td>
<td>micro.dns04.com</td>
</tr>
<tr>
<td>949cb5d03a7952ce24b15d6fccd44f9ed461513209ad74e6b1efae01879395b1</td>
<td>1</td>
<td>pwd</td>
<td>my vps</td>
<td>?</td>
<td>microft.dynssl.com</td>
</tr>
<tr>
<td>fa3ecd74b9f329a96b5739bba7b1872ef1ab84bb95f89101a69b6b6e780e2063</td>
<td>-</td>
<td>pwd</td>
<td>memo</td>
<td>group</td>
<td>47.108.89.169</td>
</tr>
<tr>
<td>84eb2efa324eba0c2e06c3b84395e9f5e3f28a3c9b86edd1f813807ba39d9acb</td>
<td>2</td>
<td>pwd</td>
<td>memo</td>
<td>group</td>
<td>47.108.89.169</td>
</tr>
<tr>
<td>b822a4ec46aacb3bb4c22fe5d9298210bfa442118ee05a1532c324a5f847a9e6</td>
<td>2</td>
<td>gundan</td>
<td>memo</td>
<td>group</td>
<td>120.78.127.189</td>
</tr>
<tr>
<td>944a3c8293ff068d803f8537b15e6adbad7fa1e789f3dc404ba603a8cb7c22aa</td>
<td>2</td>
<td>gundan</td>
<td>memo</td>
<td>group</td>
<td>121.89.210.144</td>
</tr>
</tbody>
</table>
<p>Соединение с контрольным сервером происходит по TCP, при этом трафик не шифруется. Сообщения имеют заголовок следующей структуры:</p>
struct PacketHeader{
 _DWORD Version; // 0x20170510
 _DWORD CommandId;
 _DWORD PayloadSize;
 _DWORD LastError;
};
<p>В качестве версии всегда используется константа 0x20170510, вероятно, обозначающая некоторую дату.</p>
<p>ВПО имеет несколько классов-модулей, отвечающих за соответствующую функциональность:</p>
<ul>
<li>ShellManager — удаленная командная строка;</li>
<li>DiskManager — работа с дисками, установленными в зараженном компьютере;</li>
<li>FileTransferManager — передача файлов;</li>
<li>RS5Manager — использование зараженного компьютера в качестве прокси-сервера.</li>
</ul>
<p>В ID каждой команды есть идентификатор модуля, который получается применением маски 0xFF000. Полный список поддерживаемых команд:</p>
<table class="table-article">
<thead>
<tr>
<th>ID модуля</th>
<th>Полный ID</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>Собрать информацию о зараженной системе</td>
</tr>
<tr>
<td>0</td>
<td>3</td>
<td>Завершить работу ВПО</td>
</tr>
<tr>
<td>0x2000 (ShellManager)</td>
<td>0x2002</td>
<td>Запустить процесс cmd.exe и создать поток, отвечающий за отправку его вывода на C2</td>
</tr>
<tr>
<td></td>
<td>0x2003</td>
<td>Отправить команду в оболочку</td>
</tr>
<tr>
<td></td>
<td>0x2004</td>
<td>Завершить работу оболочки</td>
</tr>
<tr>
<td>0x3000 (DiskManager)</td>
<td>0x3000</td>
<td>Получить список доступных в системе дисков и информацию о них</td>
</tr>
<tr>
<td></td>
<td>0x3001</td>
<td>Получить листинг директории</td>
</tr>
<tr>
<td>0x4000 (FileTransferManager)</td>
<td>0x4001</td>
<td>Инициализировать передачу файла с зараженного компьютера на C2 (открытие файла для чтения)</td>
</tr>
<tr>
<td></td>
<td>0x4008</td>
<td>Прочитать блок данных из ранее открытого файла</td>
</tr>
<tr>
<td></td>
<td>0x4004</td>
<td>Инициализировать передачу файла с C2 на зараженный компьютер (открытие файла для записи)</td>
</tr>
<tr>
<td></td>
<td>0x4005</td>
<td>Записать блок данных в ранее открытый файл</td>
</tr>
<tr>
<td></td>
<td>0x4006</td>
<td>Завершить передачу файла на зараженный компьютер и установить временные метки</td>
</tr>
<tr>
<td></td>
<td>0x4009</td>
<td>Закрыть открытые файловые дескрипторы и обнулить внутренние поля</td>
</tr>
<tr>
<td></td>
<td>0x4010</td>
<td>Получить рекурсивный листинг директории</td>
</tr>
<tr>
<td>0x5000 (RS5Manager)</td>
<td>0x5000</td>
<td>Выполнить инициализацию, создать потоки, отвечающие за получение пакетов от удаленного узла и их отправку на C2</td>
</tr>
<tr>
<td></td>
<td>0x5001</td>
<td>Создать сокет и подключиться к удаленному узлу</td>
</tr>
<tr>
<td></td>
<td>0x5003</td>
<td>Отправить данные в подключенный сокет</td>
</tr>
<tr>
<td></td>
<td>0x5004</td>
<td>Закрыть подключенный сокет</td>
</tr>
</tbody>
</table>
<p>В процессе сбора информации о системе бэкдор создает уникальный идентификатор компьютера (GUID) и записывает его в реестр в один из кустов HKLM или HKCU по ключу Software\CLASSES\KmpiPlayer. Если ключ уже есть в реестре, то используется существующий ID.</p>
<h3 id="id3-2">Zupdax</h3>
<p>Первое публичное упоминание данного ВПО можно встретить в отчете <a href="https://unit42.paloaltonetworks.com/unit42-henbox-chickens-come-home-roost/" target="_blank">Unit 42</a>, посвященном вредоносному приложению HenBox для платформы Android. В сетевой инфраструктуре HenBox исследователи обнаружили следы использования атакующими ВПО из семейств PlugX, Zupdax, 9002 RAT и Poison Ivy. В 2019 году специалисты Unit 42 <a href="https://unit42.paloaltonetworks.com/pkplug_chinese_cyber_espionage_group_attacking_asia/" target="_blank">объединили</a> наблюдаемую три года активность, связанную с упомянутым набором ВПО, назвав стоящую за ней группу (или группы) именем PKPLUG.</p>
<p>В 2020 году компания ESET <a href="https://www.welivesecurity.com/2020/12/10/luckymouse-ta428-compromise-able-desktop/" target="_blank">обнаружила</a> следы атаки на цепочку поставок ПО Able Soft LLC. Одним из вариантов атаки была компрометация инсталлятора Able Desktop, заключающаяся в добавлении к нему вредоносного кода. В качестве полезной нагрузки, которая была встроена в инсталляторы, исследователи называют бэкдоры HyperBro и Korplug (PlugX).</p>
<p>По имеющимся у нас данным можно утверждать, что полезная нагрузка, обозначенная ESET как Korplug, в действительности является бэкдором Zupdax. Такого же мнения придерживаются аналитики NortonLifeLock и Avira, выпустившие осенью 2021 года <a href="https://www.nortonlifelock.com/sites/default/files/2021-10/OPERATION%20EXORCIST%20White%20Paper.pdf" target="_blank">отчет</a>, в котором описали основные особенности Zupdax.</p>
<p>Zupdax существует по крайней мере с 2014 года. В своем исследовании мы фокусировались на образцах, относящихся к периоду 2017–2019 годов, однако некоторые детали можно проследить только в более ранних версиях (периода 2014–2015 годов). Далее мы будем говорить о них, используя термин «старые».</p>
<p>В последних версиях Zupdax используется та же схема загрузки, что и в тестовом образце MyKLoadClient. Хотя кода игры «Змейка» в них нет, основная функциональность дроппера реализована аналогичным образом: в своих ресурсах он содержит легитимный siteadv.exe, библиотеку-лончер, полезную нагрузку и зашифрованную XOR конфигурацию с именами файлов и флагами. Точно такую же конфигурацию использует лончер.</p>
<p>В отличие от MyKLoadClient, практически во всех экземплярах с Zupdax полезная нагрузка (которая извлекается под именем ok.obj) шифруется и запускается методом mrun. Среди экземпляров лончера, которые используются в связке с Zupdax, можно встретить более функциональные варианты, поддерживающие обход UAC (в частности, с использованием экспорта buc_uninstallinterface) и закрепление в качестве сервиса.</p>
<p>В экземплярах дроппера и лончера можно встретить соответствующие PDB-пути:
 d:\Leee\515远程文件\P1Rat_2017_07_28A\src\MyLoaderBypassNorton\Release\loaderexe.pdb и
d:\Leee\515远程文件\P1Rat_2017_07_28A\src\MyLoader_bypassKIS\snake\res\SiteAdv.pdb.</p>
<p>Варианты ВПО, связанные с атакой на пользователей Able Desktop, также содержат PDB с аналогичной строкой MyLoader_bypassKIS:
c:\Users\PC-2015\Desktop\Badger\En-v2\免杀\MyLoader_bypassKIS\bin\loaderdll.pdb.</p>
<p>Интересно, что существует как минимум один экземпляр (a95dfb8a8d03e9bcb50451068773cc1f1dd4b022bb39dce3679f1b3ce70aa4f9), который полностью идентичен тестовой версии MyKLoadClient и содержит точно такое же окно «О программе». При этом полезная нагрузка в нем представляет собой бэкдор Zupdax.</p>
<h4 id="id3-2-1">Полезная нагрузка</h4>
<p>Для сетевого взаимодействия с C2 бэкдор использует <a href="https://udt.sourceforge.io" target="_blank">протокол UDT</a>, реализующий передачу данных поверх протокола UDP. Сообщения имеют заголовок со структурой, похожей на используемую в MyKLoadClient. Отличается лишь значение первого поля, равное 0x12345678:</p>
struct PacketHeader{
 _DWORD Magic; // 0x12345678
 _DWORD CommandId;
 _DWORD PayloadSize;
 _DWORD Unknown; // 0
};
<p>Сразу же после установки соединения с C2 бэкдор собирает и отправляет информацию о системе, включающую имя компьютера, имя пользователя, версию ОС, информацию об объеме дисков, оперативной памяти и процессоре, а также IP- и MAC-адреса сетевого адаптера. Собранная информация отправляется с ID команды 0x1.</p>
<p>Набор команд, которые бэкдор может обработать, существенно не меняется от версии к версии: его основные возможности сводятся к исполнению дополнительного кода, который он может получить от контрольного сервера. Более старые варианты Zupdax содержат отладочные сообщения, которые позволяют увидеть оригинальные названия операций:</p>
<table class="table-article">
<thead>
<tr>
<th>ID</th>
<th>Название</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0</td>
<td>CMD_END</td>
<td>Завершить работу бэкдора или перезапустить его (в зависимости от версии)</td>
</tr>
<tr>
<td>0x17</td>
<td>CMD_SET_REM</td>
<td>Записать в файл новый контрольный сервер (передается в сообщении)</td>
</tr>
<tr>
<td>0x19</td>
<td>CMD_UNINSTALL_HOST</td>
<td>Выполнить самоудаление из системы</td>
</tr>
<tr>
<td>0x28</td>
<td>CMD_TRANSMISSION_PLUGIN</td>
<td>Получить от C2 имя плагина и запустить его (плагином может быть шеллкод или EXE-файл). Если необходимый плагин отсутствует на диске, предварительно получить его от C2. (Присутствует только в старых версиях)</td>
</tr>
<tr>
<td>0x29</td>
<td>CMD_PLUGIN_TRANSMISSION_EXECUTE</td>
<td>Получить от C2 идентификатор плагина и запустить его точку входа (плагины хранятся в памяти). Если плагин отсутствует в памяти, предварительно получить PE-файл с контрольного сервера и рефлективно загрузить из него экспортируемую функцию. (В старых версиях то же, что и CMD_TRANSMISSION_PLUGIN)</td>
</tr>
<tr>
<td>0x38</td>
<td>CMD_UPDATE</td>
<td>Скачать EXE-файл по указанной ссылке, сохранить на диск и запустить на исполнение</td>
</tr>
<tr>
<td>0x68</td>
<td></td>
<td>Запустить исполняемый файл по фиксированному пути под именем текущего пользователя. Путь равен C:\ProgramData\AdobeBak\avanti.exe. (Присутствует только в последних версиях)</td>
</tr>
<tr>
<td>0x77</td>
<td>CMD_ADD_STARTUP</td>
<td>См. CMD_TRANSMISSION_PLUGIN</td>
</tr>
</tbody>
</table>
<p>В старых экземплярах Zupdax также присутствуют пути к PDB-файлам:
h:\E\项目问题\UDPUDP-英文\bin\server.pdb
d:\磁盘\E\项目问题\版本\UDPUDP-英文\bin\server.pdb</p>
<p>Из них следует, что оригинальное название проекта можно перевести как «UDPUDP-английский».</p>
<h4 id="id3-2-2">Связь с Redsip</h4>
<p>В 2011 году специалисты McAfee описали серию атак на омпании энергетического сектора, получившую название Night Dragon. Среди ВПО, использованного злоумышленниками, был бэкдор Redsip (e3165c2691dc27ddaeb21e007f2bf5aeb14ef3e12ec007938e104d6aed512f39).</p>
<p>По всей видимости, Zupdax представляет собой переработанную версию Redsip. Бэкдоры, в частности, имеют идентичную структуру сетевых сообщений (включая магическую константу 0x12345678), совпадающие по именам и идентификаторам команды (CMD_SET_REM и CMD_UNINSTALL_HOST), похожие отладочные сообщения. В обоих случаях полезная нагрузка реализуется через внешние плагины.</p>
<figure>
<img alt="Рисунок 11. Фрагмент кода Redsip (образец 2010 года)" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image11.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 11. Фрагмент кода Redsip (образец 2010 года)</figcaption>
</figure>
<figure>
<img alt="Рисунок 12. Фрагмент кода Zupdax (образец 2015 года)" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image12.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 12. Фрагмент кода Zupdax (образец 2015 года)</figcaption>
</figure>
<p>Стоит отметить, что в 2018 году Redsip был использован в атаке на российскую организацию, связанную с авиационно-космической отраслью. В качестве приманки злоумышленники использовали утекший корпоративный документ. Прямой связи этой атаки с деятельностью Space Pirates нам обнаружить не удалось.</p>
<figure>
<img alt="Рисунок 13. Внутренний документ, использованный в качестве приманки" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image13.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 13. Внутренний документ, использованный в качестве приманки</figcaption>
</figure>
<h4 id="id3-2-3">Связи с Winnti и FF-RAT</h4>
<p>Некоторые экземпляры Zupdax имеют валидные цифровые подписи. В частности, образец 24b749191d64ed793cb9e540e8d4b1808d6c37c5712e737674417573778f665b (upinstall.bat) подписан сертификатом YD Online Corp., а 84b8bfe8161da581a88c0ac362318827d4c28edb057e23402523d3c93a5b3429 (Slack.exe) — сертификатом NFINITY GAMES BILISIM ANONIM SIRKET.</p>
<p>Среди файлов, подписанных этими сертификатами, можно обнаружить компоненты ВПО PipeMon, которое <a href="https://www.welivesecurity.com/2020/05/21/no-game-over-winnti-group/" target="_blank">приписывают</a> группе Winnti. Изучая сетевую инфраструктуру второго образца, мы также отметили наличие косвенных связей со старой инфраструктурой Winnti, однако они требуют дополнительного подтверждения.</p>
<p>В то же время в случае Slack.exe можно говорить о наличии надежных инфраструктурных связей с бэкдором FF-RAT, который в 2017 году <a href="https://blogs.blackberry.com/en/2017/06/breaking-down-ff-rat-malware" target="_blank">описали</a> специалисты BlackBerry. Так, и экземпляр Zupdax, и образцы FF-RAT используют в качестве C2 поддомены playdr2.com и gamepoer7.com.</p>
<h4 id="id3-2-4">Связи с Bronze Union и TA428</h4>
<p>В ранее упоминавшемся отчете ESET <a href="https://www.welivesecurity.com/2020/12/10/luckymouse-ta428-compromise-able-desktop/" target="_blank">Operation StealthyTrident: corporate software under attack</a>, посвященном компрометации Able Desktop, отмечается присутствие бэкдоров HyperBro и Zupdax (Korplug по ESET), а также Tmanger и ShadowPad в рамках одной операции злоумышленников. Исследователи приводят несколько возможных объяснений такой взаимосвязи. Нам удалось выявить несколько дополнительных фактов, дающих больше информации о связях между группами Bronze Union (LuckyMouse, APT27), TA428 и ВПО Zupdax.</p>
Кодовые пересечения
<p>Экземпляр Zupdax из отчета ESET содержит стандартный для этого ВПО дроппер (data1.dat, 2486734ebe5a7fa6278ce6358d995d4546eb28917f8f50b01d8fdd7a1f9627a4), извлекающий полезную нагрузку из ресурсов. Интерес представляет схема, по которой он получает управление: в ней используется side-loading библиотеки pcalocalresloader.dll, в которой расположен шеллкод, расшифровывающий и выполняющий еще один шеллкод из файла thumb.db. Второй шеллкод содержит сжатую алгоритмом LZNT1 DLL-библиотеку, которую он рефлективно загружает в память.</p>
<figure>
<img alt="Рисунок 14. Фрагмент отчета ESET" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image14.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 14. Фрагмент отчета ESET</figcaption>
</figure>
<p>Оба шеллкода используют нетипичный алгоритм хеширования для имен импортируемых библиотек и функций (рис 15.). Так, kernel32.dll имеет хеш 0xD4E88, а ntdll.dll — 0x1B708. Однако поиск схожих экземпляров показал, что подобные шеллкоды можно встретить в различных семействах ВПО — например в <a href="https://n1ght-w0lf.github.io/malware%20analysis/smokeloader/#shellcode" target="_blank">SmokeLoader</a> или в <a href="https://unit42.paloaltonetworks.com/unit42-recent-inpage-exploits-lead-multiple-malware-families/" target="_blank">эксплойтах для InPage</a>. Вероятно, что для создания шеллкодов был использован билдер, доступный разным хакерским группировкам.</p>
<figure>
<img alt="Рисунок 15. Хеш-функция во вспомогательных шеллкодах" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image15.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 15. Хеш-функция во вспомогательных шеллкодах</figcaption>
</figure>
<p>При этом вся схема целиком, включающая легитимный компонент IntgStat.exe, библиотеку pcalocalresloader.dll и зашифрованный thumb.db, использовалась в таком виде только для загрузки бэкдора HyperBro и была <a href="https://securelist.ru/luckymouse-hits-national-data-center/90213/" target="_blank">описана «Лабораторией Касперского»</a>. Единственное расхождение состоит в том, что в случае с Able Desktop не применялась обфускация shikata_ga_nai.</p>
<p>Вспомогательная DLL, находящаяся в thumb.db, отвечает за одновременный запуск дроппера (data1.dat) и легитимного установщика Able Desktop. Она отличается наличием большого количества неиспользуемых строк в секции данных. Часть из этих строк характерна только для экземпляров бэкдора HyperBro:</p>
Elevation:Administrator!new:{FCC74B77-EC3E-4dd8-A80B-008A702075A9}
SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\test
system-%d
CreateProcessAsUser error %d
\\..\\config.ini
Win2008(R2)
Win2012(R2)
<p>Как следует из отчета ESET и нашего исследования, злоумышленники, стоящие за атакой на пользователей Able Desktop, имеют доступ как к HyperBro, так и к Zupdax. Однако при этом большая часть кодовых особенностей специфична именно для бэкдора HyperBro, который, в свою очередь, относят к группе Bronze Union.</p>
Сетевые пересечения
<figure>
<img alt="Рисунок 16. Фрагмент сетевой инфраструктуры Zupdax" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image16.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 16. Фрагмент сетевой инфраструктуры Zupdax</figcaption>
</figure>
<p>Один из экземпляров Zupdax (ffe19202300785f7e745957b48ecc1c108157a6edef6755667a9e7bebcbf750b) использует в качестве C2 поддомены flashplayeractivex.info, такие как update.flashplayeractivex.info и news.flashplayeractivex.info. В августе 2020 года эти домены некоторое время разрешались в IP-адрес 209.250.239.96. Одновременно с ними на том же IP-адресе присутствовал домен go.vegispaceshop.org.</p>
<p>Последний домен вместе с IP-адресом можно найти в <a href="https://insight-jp.nttsecurity.com/post/102gkfp/pandas-new-arsenal-part-2-albaniiutas" target="_blank">отчете NTT Security</a>, посвященном ВПО Albaniiutas из инструментария TA428. Как показал <a href="https://habr.com/ru/company/group-ib/blog/572192/" target="_blank">детальный анализ</a> образцов Albaniiutas, который провели наши коллеги из Group-IB, данное ВПО представляет собой новую версию <a href="https://www.ptsecurity.com/upload/corporate/ru-ru/analytics/Operation-Taskmasters-2019-rus.pdf" target="_blank">выявленного ранее</a> специалистами <a href="https://www.ptsecurity.com/ru-ru/services/esc/" target="_blank">PT Expert Security Center</a> бэкдора RemShell (BlueTraveller).</p>
<p>Еще один домен, появляющийся на IP-адресе 209.250.239.96 в то же самое время — nameserver.datacertsecure.info. Очевидным образом связанные с ним домены datacertsecure.info и check.datacertsecure.info в период с июня по июль 2020 года разрешаются в IP-адрес 139.180.208.225. Одновременно с этим узел становится <a href="https://twitter.com/vishnyak0v/status/1287308019336990720" target="_blank">известен</a> как контрольный сервер бэкдора HyperBro, а затем упоминается ESET в <a href="https://www.welivesecurity.com/2020/12/10/luckymouse-ta428-compromise-able-desktop/" target="_blank">Operation StealthyTrident</a>.</p>
<p>Перечисленные связи дополнительно объединяют цели злоумышленников: скомпрометированные установщики Able Desktop, так же как и упомянутые выше экземпляры Albaniiutas и HyperBro, были использованы в атаках на организации в Монголии.</p>
<h3 id="id3-3">Загрузчики</h3>
<p>В сетевой инфраструктуре Space Pirates мы обнаружили два вида загрузчиков, содержащие приманки с русским текстом. Один из них был также найден в сети нашего клиента, подвергшегося атаке злоумышленников.</p>
<figure>
<img alt="Рисунок 17. Пример документа-приманки" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image17.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 17. Пример документа-приманки</figcaption>
</figure>
<h4 id="id3-3-1">Downloader.Climax.A</h4>
<p>Первый загрузчик отличается использованием частей исходного кода буткита Rovnix (он был <a href="https://securelist.ru/oh-what-a-boot-iful-mornin/97317/" target="_blank">подробно описан</a> экспертами «Лаборатории Касперского»). Стоит отметить, что приведенные в отчете сетевые индикаторы, в частности домен bamo.ocry.com, а также IP-адреса 45.77.244.191 и 45.76.145.22, по нашим данным, входят в сетевую инфраструктуру Space Pirates.</p>
<p>У нас нет информации о том, какое вредоносное ПО доставлял этот загрузчик. Однако исследователям из «Лаборатории Касперского» удалось выявить вероятные экземпляры, основываясь на схожести PDB-путей и идентичных C2.</p>
<figure>
<img alt="Рисунок 18. Фрагмент отчета «Лаборатории Касперского»" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image18.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 18. Фрагмент отчета «Лаборатории Касперского»</figcaption>
</figure>
<p>На приведенных в отчете скриншотах полезной нагрузки можно заметить специфическую технику хранения строк: все они находятся в одном блоке данных и проиндексированы числами с префиксом «PS_». Такая техника встречается в коде публично доступного бэкдора PcShare. Выделенные исследователями наборы строк в точности соответствуют тем, которые можно встретить в открытом коде бэкдора. Аналогичное соответствие можно провести и между командами, которые поддерживает ВПО. В результате можно уверенно утверждать, что данная полезная нагрузка основана на коде PcShare.</p>
<figure>
<img alt="Рисунок 19. Фрагмент файла строк из кода PcShare" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image19.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 19. Фрагмент файла строк из кода PcShare</figcaption>
</figure>
<p>Далее мы рассмотрим модифицированный вариант PcShare, который мы назвали RtlShare. Стоит отметить, что во время расследования у нашего клиента мы обнаружили экземпляр RtlShare, соединяющийся с C2 202.182.98.74. Его же использует образец Downloader.Climax.A с SHA-256 e9c94ed7265c04eac25bbcdb520e65fcfa31a3290b908c2c2273c29120d0617b. Учитывая сказанное ранее, можно предположить, что полезной нагрузкой, которую доставляет загрузчик, является именно RtlShare.</p>
<h4 id="id3-3-2">Downloader.Climax.B</h4>
<p>Другой вид загрузчика для своего исполнения может использовать уязвимости в Microsoft Equation Editor. Такую уязвимость, в частности, эксплуатирует документ с именем «Мэр Сеула.rtf» (7079d8c92cc668f903f3a60ec04dbb2508f23840ef3c57efffb9f906d3bc05ff), созданный с помощью известного билдера Royal Road RTF (8.t), широко распространенного среди азиатских APT-групп.</p>
<p>Код этого загрузчика полностью отличается от Downloader.Climax.A, но при этом в нем можно выделить некоторые схожие особенности. В частности, для соединения с C2 оба загрузчика используют TCP, а получаемая полезная нагрузка в обоих случаях распаковывается с помощью алгоритма LZW.</p>
<p>Downloader.Climax.B закрепляется в системе через ключ реестра HKCU\Software\Microsoft\Windows\CurrentVersion\Run\GetUserConfig. Его задача —получить с контрольного сервера файлы с именами INFOP11.EXE и OINFO11.OCX и запустить EXE-файл на исполнение. При этом каждый из файлов имеет свой числовой идентификатор, который отправляется на C2.</p>
<figure>
<img alt="Рисунок 20. Фрагмент кода загрузчика" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image20.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 20. Фрагмент кода загрузчика</figcaption>
</figure>
<p>После загрузки в тело полученного OCX-файла записываются параметры конфигурации, которые присутствуют в самом загрузчике: узел и порт контрольного сервера, время ожидания между обращениями к C2, строка TodaySend, а также сгенерированный GUID.</p>
<h3 id="id3-4">RtlShare</h3>
<p>Полезная нагрузка ВПО RtlShare основана на <a href="https://github.com/LiveMirror/pcshare" target="_blank">публично доступном</a> коде бэкдора PcShare. Вместе с тем вредоносное ПО имеет специфическую цепочку исполнения, код которой отсутствует в открытых источниках. В ней участвует три DLL, каждая из которых имеет свое экспортируемое имя. Далее мы будем использовать эти имена для обозначения соответствующих библиотек.</p>
<p>Рассмотрим RtlShare на примере образца 8ac2165dc395d1e76c3d2fbd4bec429a98e3b2ec131e7951d28a10e9ca8bbc46.</p>
<p>Интересно, что для его доставки злоумышленники использовали взломанный сайт петрозаводской математической конференции PICCAnA (piccana.karelia.ru), который в настоящее время недоступен (<a href="https://web.archive.org/web/20200131000411/http://piccana.karelia.ru/" target="_blank">веб-архив</a>). В качестве контрольного сервера в нем указан частный IP-адрес 192.168.193.165.</p>
<p>В процессе расследования инцидента у одного из наших клиентов мы встретили практически идентичные образцы, использующие контрольные серверы 45.76.145.22, 141.164.35.87 и 202.182.98.74.</p>
<h4 id="id3-4-1">Дроппер rtlstat.dll</h4>
<p>В качестве начальной стадии заражения выступает DLL-библиотека rtlstat.dll, экспортирующая единственную функцию emBedding. Ее задача — извлечь и запустить библиотеку следующей стадии с внутренним именем rtlmake.dll.</p>
<p>Для этого сперва проверяется разрядность ОС и выбирается необходимый блок данных, после чего он расшифровывается XOR с ключом в виде одной из строк 4af233f4740c2fde7fc95ed3a834d7b1 (x64) и 3ad6faf2d7b714137de31efef137775b (x86). Затем расшифрованные данные распаковываются по алгоритму LZ4.</p>
<figure>
<img alt="Рисунок 21. Извлечение необходимой версии rtlmake.dll" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image21.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 21. Извлечение необходимой версии rtlmake.dll</figcaption>
</figure>
<p>В тело полученной библиотеки копируется блок данных, содержащий конфигурацию (на данном этапе она зашифрована). В качестве маркера, обозначающего место, куда будет скопирована конфигурация, используется магическое число 0xAADDEE99.</p>
<p>Чтобы обойти детектирование на основе хеш-сумм, злоумышленники добавляют в конец библиотеки случайное количество случайных байтов, обновляя при этом поле Checksum в PE-заголовке файла. Таким образом, при каждом новом запуске будет извлекаться новый файл.</p>
<p>Затем дроппер проверяет, запущен ли он от имени пользователя SYSTEM. Для этого он ищет подстроку config в пути к папке LocalAppData. Если подстрока присутствует, то библиотека перезапускается от имени текущего пользователя через rundll32.exe.</p>
<p>В противном случае полученная библиотека сохраняется в файл %LOCALAPPDATA%\Microsoft\Windows\WER\Security\wuaueng.hlk, а путь к ней записывается в реестр по ключу HKCU\Software\Classes\CLSID\{42aedc87-2188-41fd-b9a3-0c966feabec1}\InprocServer32. Данный раздел отвечает за COM-объект MruPidlList, используемый в библиотеке shell32.dll, которую, в свою очередь, подгружает процесс explorer.exe — это <a href="https://3gstudent.github.io/backup-3gstudent.github.io/Use-COM-Object-hijacking-to-maintain-persistence-Hijack-explorer.exe/" target="_blank">известная техника</a> закрепления ВПО в системе.</p>
<p>В конце своей работы дроппер запускает извлеченную DLL на исполнение с помощью regsvr32.exe и самоудаляется через BAT-файл.</p>
<h4 id="id3-4-2">Инжектор rtlmake.dll</h4>
<p>Версии rtlmake.dll разной разрядности имеют одну и ту же функциональность, которая сводится к извлечению DLL следующей стадии и внедрению ее кода в процесс rdpclip.exe (либо в текущий процесс).</p>
<p>В начале своей работы инжектор проверяет, что он работает в одном экземпляре: чаще всего с этой целью используются мьютексы, но в данном случае применены именованные отображения файлов в память (file mappings). На время работы rtlmake.dll создается mapping с именем 55fc3f9a654c500932, а за работу полезной нагрузки отвечает mapping 7f8b6a2440e5c9e5b6.</p>
<p>Затем с помощью аналогичной предыдущему этапу функции выполняется расшифровка и декомпрессия DLL с полезной нагрузкой и конфигурации (напомним, что она была ранее скопирована в rtlmake.dll). Ключ шифрования конфигурации — строка 2ae06f136eb6588508eefd4b5f6c98d8345f1104746d15141, а полезной нагрузки — 1192f6c4b018c8e0f51d31d6dde22ff3.</p>
<figure>
<img alt="Рисунок 22. Конфигурация бэкдора RtlShare" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image22.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 22. Конфигурация бэкдора RtlShare</figcaption>
</figure>
<p>Далее выбирается процесс, в который будет внедрена полезная нагрузка. Если текущий процесс — это explorer.exe (что верно, если библиотека была загружена в качестве COM-компонента), то целевым процессом станет rdpclip.exe. В случае если rdpclip.exe не удалось запустить, либо если DLL была загружена в другой процесс, целевым процессом становится текущий.</p>
<p>В память выбранного процесса записывается расшифрованная конфигурация, после чего инжектор формирует командную строку вида «/v /c:0x12345678», содержащую адрес конфигурации в адресном пространстве процесса. Полученная строка и полезная нагрузка также записываются в память процесса.</p>
<figure>
<img alt="Рисунок 23. Формирование командной строки в rtlmake.dll" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image23.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 23. Формирование командной строки в rtlmake.dll</figcaption>
</figure>
<p>Чтобы запустить исполнение полезной нагрузки, инжектор определяет смещение в PE-файле, по которому располагается экспортируемая ей функция Putklm, после чего она получает управление вызовом CreateRemoteThread. При этом в качестве аргументов ей передается адрес командной строки. Важно отметить, что рефлективной загрузки до этого момента не происходит: функция Putklm фактически работает как шеллкод.</p>
<h4 id="id3-4-3">Полезная нагрузка rtlmain.dll (rtlmainx64.dll)</h4>
<p>Последняя DLL полностью реализована на основе кода основного модуля бэкдора PcShare — PcMain. Отметим некоторые ее особенности, которые характерны только для семейства RtlShare:</p>
<ul>
<li>Внутри библиотеки реализован рефлективный загрузчик, который находится в функции Putklm. Адрес командной строки, который она принимает, передается в DllEntryPoint через параметр lpReserved и при этом шифруется XOR с константой 0x73DE2938. Восстановление адреса и разбор командной строки происходит внутри функции DllMain.</li>
<li>После запуска rtlmain.dll завершаются все процессы rdpclip.exe кроме текущего.</li>
<li>Хранилище строк бэкдора дополнительно к сжатию LZ4 (которое присутствует в открытом коде) зашифровано AES с ключом 68fa504a1aee69f71df454e554c74eaf. Аналогичным образом кодируются принимаемые (ключ 48d426ca6d45496e7413cf435516af06) и передаваемые (ключ 2e5140d04c7d7da454991bae10160369) сообщения.</li>
<li>Добавлена поддержка соединения через прокси-сервер.</li>
<li>Присутствует специальная команда, позволяющая злоумышленникам перезаписать конфигурацию внутри инжектора rtlmake.dll (необходимое смещение содержит магическую константу 0x76EE38BB).</li>
<li>В код, отвечающий за реализацию удаленной командной строки, добавлена команда getip, которая реализована через вызов nslookup myip.opendns.com resolver1.opendns.com.</li>
</ul>
<h4 id="id3-4-4">Использование RtlShare</h4>
<p>Образцы RtlShare можно обнаружить в других отчетах. Так, например, исследователи Recorded Future <a href="https://go.recordedfuture.com/hubfs/reports/cta-2021-0616.pdf" target="_blank">обнаружили</a> в сетевой инфраструктуре группы RedFoxtrot образцы ВПО PcShare, которые имеют значительное сходство с семейством RtlShare. Помимо этого, аналогичные экземпляры ранее <a href="https://www.bitdefender.com/files/News/CaseStudies/study/379/Bitdefender-Whitepaper-Chinese-APT.pdf" target="_blank">встречались Bitdefender</a> при расследовании активности APT-группы с азиатскими корнями, нацеленной на государственные учреждения Юго-Восточной Азии.</p>
<p>Связей в сетевой инфраструктуре ни между вышеупомянутыми случаями, ни между этими случаями и активностью, которую мы обнаружили при расследовании инцидента у нашего клиента, не наблюдается. Это позволяет предположить, что, несмотря на отсутствие кода RtlShare в открытых источниках, к данному ВПО имеют доступ несколько различных APT-групп азиатского происхождения.</p>
<h3 id="id3-5">PlugX</h3>
<p>В сети нашего клиента мы также обнаружили несколько экземпляров бэкдора PlugX. Найденные экземпляры использовали в качестве контрольных серверов адреса micro.dns04.com, microft.dynssl.com, api.microft.dynssl.com и www.0077.x24hr.com, входящие в сетевую инфраструктуру группы и прямо пересекающиеся с C2 MyKLoadClient.</p>
<p>PlugX широко применяется в среде киберпреступников, имеет несколько версий и большое количество модификаций. Однако выявленные нами образцы обладают набором особенностей, позволяющих выделить их в отдельную группу.</p>
<p>Как и в обычном PlugX, основная полезная нагрузка бэкдора реализована в виде DLL-библиотеки, которая рефлективно загружается в память в процессе исполнения ВПО. В ее точку входа первым аргументом передается указатель на структуру, в которой содержатся, в частности, сигнатура и адрес зашифрованной конфигурации.</p>
<p>В оригинальном PlugX сигнатура представляет собой константу 0x504C5547 (строка PLUG), однако в нашей группе образцов это значение было равно 0xCF455089. Нестандартен и размер конфигурации, который равен 0x1924 байта: нам не удалось найти упоминание такой конфигурации в открытых источниках. В отличие от многих других вариантов, имеющих сигнатуру XV вместо MZ и PE, в нашем случае заголовок PE-файла с полезной нагрузкой остается неизменным.</p>
<p>В бэкдоре активно применяется техника встраивания кода (inlining), в частности это касается API-вызовов и шифрования строк.</p>
<figure>
<img alt="Рисунок 24. Вызовы API-функций в PlugX" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image24.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 24. Вызовы API-функций в PlugX</figcaption>
</figure>
<p>Для поиска API-функций бэкдор использует CRC32-хеши от их имен. Полученные указатели кэшируются, при этом отвечающие за эту операцию фрагменты кода встроены в каждое место, где требуется обращение к WinAPI.</p>
<figure>
<img alt="Рисунок 25. Шифрование строк в PlugX" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image25.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 25. Шифрование строк в PlugX</figcaption>
</figure>
<p>Практически все строки в бэкдоре являются стековыми, большинство из них зашифровано методом ADD-XOR-SUB. Код для расшифровки копируется во все места, где используются шифрованные строки.</p>
<p>ВПО использует стандартный набор плагинов, <a href="https://www.lastline.com/labsblog/an-analysis-of-plugx-malware/" target="_blank">известный</a> с ранних версий. В оригинальном PlugX на этапе их инициализации используется параметр, выглядящий как дата. Так, плагин Disk имеет параметр 0x20120325. В нашем случае для всех плагинов сочетание 2012 изменено на 8102 (что может означать 2018): тот же плагин Disk использует значение 0x81020325.</p>
<p>Бэкдор целиком также имеет числовое значение, указывающее на версию: оно передается на C2 вместе с информацией о зараженной системе и равно 0x20161127. Такую же версию можно встретить в Backdoor.PlugX.38 из <a href="https://st.drweb.com/static/new-www/news/2020/july/Study_of_the_APT_attacks_on_state_institutions_in_Kazakhstan_and_Kyrgyzstan_ru.pdf" target="_blank">отчета Dr.Web</a> об атаках на государственные учреждения Казахстана и Киргизии. Однако другие уникальные значения из варианта группы Space Pirates, такие как сигнатура и размер конфигурации, в BackDoor.PlugX.38 отсутствуют. По-видимому, оба варианта основаны на базовом коде одной и той же версии PlugX, но его модификации в каждом из этих случаев отличаются.</p>
<p>Более точные пересечения мы встретили в других отчетах. Среди экземпляров PlugX, которые были использованы в <a href="https://www.nortonlifelock.com/sites/default/files/2021-10/OPERATION%20EXORCIST%20White%20Paper.pdf" target="_blank">атаках на Ватикан</a> в 2019–2020 годах, можно обнаружить несколько образцов, которые аналогичны используемым группой Space Pirates. Помимо этого, те же модификации бэкдора встречаются в образцах, которые <a href="https://go.recordedfuture.com/hubfs/reports/cta-2021-0616.pdf" target="_blank">связывают</a> с активностью группы RedFoxtrot. При этом обнаружить связей в сетевой инфраструктуре нам не удалось, что позволяет вновь говорить об обмене инструментарием между группами. Учитывая другие пересечения между использовавшимся в атаках ВПО (Zupdax и RtlShare), можно также предположить, что вся эта активность принадлежит одной или нескольким совместно действующим группам. Впрочем, это требует дополнительного подтверждения.</p>
<h4 id="id3-5-1">Demo dropper</h4>
<p>Некоторые экземпляры обнаруженного нами варианта PlugX извлекаются в систему интересным дроппером, исполняемый файл которого может называться demo.exe. Он реализован на основе библиотеки MFC. Его работа сводится к созданию VBS-скрипта с именем msiexece.vbs или cosetsvc.vbs и его последующему запуску.</p>
<p>В качестве параметров командной строки скрипту передается путь к EXE-дропперу и имена файлов, которые будут из него извлечены. Файлы находятся в оверлее demo.exe и могут быть зашифрованы однобайтовым XOR (но во всех известных нам экземплярах ключ равен 0). Смещение оверлея и длина каждого из файлов прописаны в VBS-коде. Скрипт извлекает стандартные для PlugX компоненты — легитимный EXE-файл, DLL для Side-Loading и зашифрованный шеллкод, после чего легитимный файл запускается.</p>
<figure>
<img alt="Рисунок 26. Запись и исполнение VBS-файла" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image26.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 26. Запись и исполнение VBS-файла</figcaption>
</figure>
<h3 id="id3-6">BH_A006</h3>
<p>Данное ВПО, как и в других случаях, мы обнаружили как во время конкретного расследования у клиента, так и в процессе исследования сетевой инфраструктуры группы. В качестве полезной нагрузки оно содержит модифицированный бэкдор Gh0st. Строка BH_A006 постоянно встречается в PDB-путях и внутренних именах DLL-библиотек, связанных с бэкдором, поэтому он получил такое название.</p>
<p>BH_A006 имеет нетривиальную схему исполнения полезной нагрузки, которая может варьироваться на начальных этапах в различных экземплярах. Рассмотрим ее на примере одного из вредоносных файлов.</p>
<h4 id="id3-6-1">Стадия 0. Загрузка DLL из оверлея</h4>
<p>SHA-256: 1e725f1fe67d1a596c9677df69ef5b1b2c29903e84d7b08284f0a767aedcc097</p>
<p>Исходный образец представляет собой исполняемый файл, использующий библиотеку MFC. Он извлекает содержимое оверлея, расшифровывает его XOR с ключом 0xA0 и рефлективно загружает полученную DLL в память.</p>
<h4 id="id3-6-2">Стадия 1. DLL-дроппер</h4>
<p>SHA-256: 8bf3df654459b1b8f553ad9a0770058fd2c31262f38f2e8ba12943f813200a4d</p>
<p>извлекает следующие файлы:</p>
<ul>
<li>C:\ProgramData\resmon.resmoncfg</li>
<li>C:\ProgramData\Sandboxie\SbieIni.dat (install32.dat)</li>
<li>C:\ProgramData\Sandboxie\SbieDll.dll</li>
<li>C:\ProgramData\Sandboxie\SandboxieBITS.exe</li>
</ul>
<p>После этого происходит проверка наличия прав записи в системную папку. Для этого дроппер пытается создать в ней файл с именем формата wmkawe_%d.data. В качестве содержимого выступает строка Stupid Japanese.</p>
<p>Если права отсутствуют, а система является 64-битной, дополнительно извлекаются еще два файла:</p>
<ul>
<li>C:\ProgramData\Sandboxie.dll (install64.dll)</li>
<li>C:\ProgramData\Sandboxie.dat (install64.dat)</li>
</ul>
<p>Имена, указанные в скобках, не используются, но присутствуют в коде. По всей видимости, они остались там от другой версии дроппера.</p>
<p>Все файлы содержатся в секции данных в упакованном виде, для сжатия используется вариант алгоритма LZMA. Такой метод сжатия применяется и на следующих этапах работы ВПО. Далее по тексту раздела, если не указано иное, мы будем иметь в виду данный алгоритм.</p>
<p>В зависимости от наличия прав и разрядности ОС дроппер запускает одну из цепочек для обхода UAC:</p>
<ul>
<li>(x32) C:\ProgramData\Sandboxie\SandboxieBITS.exe ByPassUAC</li>
<li>(x64) rundll32.exe C:\ProgramData\Sandboxie\SbieMsg.dll,installsvc ByPassUAC</li>
</ul>
<p>Либо сразу же переходит к исполнению следующей стадии:
C:\ProgramData\Sandboxie\SandboxieBITS.exe InsertS</p>
<p>В любом из трех случаев создается и запускается файл %tmp%\delself.bat, содержащий команды для самоудаления.</p>
<p>Стоит отметить, что данный экземпляр не впервые встречается исследователям. Другой вариант MFC-загрузчика (<a href="#id3-6-1">стадия 0</a>), содержащий тот же самый дроппер, был упомянут ESET в <a href="https://www.welivesecurity.com/2021/02/01/operation-nightscout-supply-chain-attack-online-gaming-asia/" target="_blank">отчете Operation NightScout</a>, а затем подробно <a href="https://blog.vincss.net/2021/02/re020-elephantrat-kunming-version-our-latest-discovered-RAT-of-Panda.html" target="_blank">изучен</a> нашими коллегами из VinCSS.</p>
<h4 id="id3-6-3">Стадия 2. Загрузчик .dat (SbieDll.dll / SbieMsg.dll)</h4>
<p>Вне зависимости от команды, которая была запущена DLL-дроппером, исполнение переходит к одной из извлеченных DLL-библиотек. В случае 32-битной версии для этого используется легитимный компонент утилиты <a href="https://ru.wikipedia.org/wiki/Sandboxie" target="_blank">Sandboxie</a>, уязвимый к DLL Side-Loading.</p>
<figure>
<img alt="Рисунок 27. Загрузка и запуск шеллкода в SbieDll.dll" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image27.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 27. Загрузка и запуск шеллкода в SbieDll.dll</figcaption>
</figure>
<p>Код в 32- и 64-битной версиях библиотек практически идентичен и отвечает за загрузку соответствующего файла .dat, расшифровку его содержимого и запуск на исполнение. Для расшифровки используется XOR с последовательностью байт вида 00, 01, 02, … FF, 00, 01, … Так же как и в коде предыдущей стадии, здесь можно увидеть альтернативные пути к файлам .dat, которые не используются во время работы.</p>
<h4 id="id3-6-4">Стадия 3. Шеллкод .dat и DLL</h4>
<p>Шеллкод представляет собой рефлективный загрузчик DLL-библиотеки, которая расположена в его теле сразу после функции загрузки. В данном случае в версиях шеллкода с разной разрядностью функциональность библиотеки существенно отличается.</p>
<p>Стадия 3.1 ByPassUAC (x64)</p>
<p>Стадия 3.1.1 Промежуточная DLL</p>
<p>64-битная версия отвечает только за реализацию обхода UAC. Для выполнения этой задачи она извлекает из себя в память еще одну DLL и передает ей управление. Рефлективная загрузка вновь выполняется с помощью шеллкода, который предварительно расшифровывается XOR с ключом 0x97. Шеллкод при этом не автономный: помимо буфера с PE-файлом, ему передаются указатели на необходимые функции, такие как GetProcAddress и LoadLibraryA.</p>
<figure>
<img alt="Рисунок 28. Расшифровка и выполнение шеллкода для рефлективной загрузки" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image28.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 28. Расшифровка и выполнение шеллкода для рефлективной загрузки</figcaption>
</figure>
<p>Стадия 3.1.2 DLL с реализацией обхода UAC</p>
<p>В DLL присутствует путь к PDB-файлу: e:\F35-F22\昆明版本\ElephantRat\nwsapagent\Bin\ByPassUAC64.pdb.</p>
<figure>
<img alt="Рисунок 29. Выбор метода обхода UAC" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image29.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 29. Выбор метода обхода UAC</figcaption>
</figure>
<p>Применяемый метод UAC bypass зависит от наличия в системе процесса avp.exe (компонент антивирусных продуктов «Лаборатории Касперского») и версии системы. Всего реализовано три известных метода, использующих <a href="http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass" target="_blank">sdclt.exe</a>, <a href="https://offsec.almond.consulting/UAC-bypass-dotnet.html" target="_blank">.NET-библиотеку</a> и <a href="https://medium.com/tenable-techblog/uac-bypass-by-mocking-trusted-directories-24a96675f6e" target="_blank">подделку доверенных директорий</a>.</p>
<p>При успешном выполнении обхода любым из способов будет запущена уже встречавшаяся ранее команда C:\ProgramData\Sandboxie\SandboxieBITS.exe InsertS.</p>
<p>Стадия 3.2. ByPassUAC / InstallS (x32)</p>
<p>Стадия 3.2.1. Промежуточная DLL</p>
<p>32-битная версия DLL, которая расположена в соответствующем файле DAT, обфусцирована с помощью неизвестного протектора.</p>
<figure>
<img alt="Рисунок 30. Точка входа в обфусцированном PE-файле" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image30.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 30. Точка входа в обфусцированном PE-файле</figcaption>
</figure>
<p>В секции данных этой DLL находится сжатый шеллкод, который распаковывается и получает управление.</p>
<p>Стадия 3.2.2. Шеллкод распаковки</p>
<figure>
<img alt="Рисунок 31. Передача аргументов функции через адрес возврата" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image31.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 31. Передача аргументов функции через адрес возврата</figcaption>
</figure>
<p>Шеллкод начинается с вызова функции sub_20F, которая принимает три аргумента: хеш от имени VirtualAlloc, размер буфера для распаковки и указатель на данные. Аргументы записаны сразу после инструкции call, и вызываемая функция обращается к ним, используя смещение относительно адреса возврата.</p>
<p>Функция sub_20F получает указатель на функцию VirtualAlloc, для чего находит библиотеку kernelbase.dll в списке загруженных модулей (предполагается, что она всегда находится на втором месте в списке InInitializationOrderModuleList) и итерирует ее таблицу экспорта, используя хеш для нахождения нужной функции. Затем выделяется буфер заданного в аргументах размера с правами RWX, и в него распаковываются сжатые данные. В данном случае для сжатия применяется алгоритм семейства NRV из <a href="http://www.oberhumer.com/opensource/ucl/" target="_blank">библиотеки UCL</a> (используется в пакере UPX). Данные представляют собой еще один шеллкод, на который передается управление.</p>
<p>Стадия 3.2.3. Шеллкод релокации</p>
<p>Основная часть очередного шеллкода представляет собой содержимое секций данных и кода, по всей видимости, извлеченного из некоторого PE-файла. Для корректного запуска в начале своей работы шеллкод выполняет корректировку адресов (релокацию). Необходимые для нее параметры передаются аналогично предыдущему шеллкоду с использованием адреса возврата. Релокация выполняется относительно стандартного базового адреса 0x401000. После ее завершения управление передается на указанный в параметрах (как смещение относительно конца таблицы релокации) адрес точки входа.</p>
<figure>
<img alt="Рисунок 32. Параметры шеллкода релокации" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image32.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 32. Параметры шеллкода релокации</figcaption>
</figure>
<p>Стадия 3.2.4. Инсталлятор в формате шеллкода</p>
<p>Основная функция инсталлятора загружает необходимые для работы функции WinAPI, после чего может выполнить указанную в командной строке операцию.</p>
<figure>
<img alt="Рисунок 33. Фрагмент кода шеллкода-установщика" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image33.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 33. Фрагмент кода шеллкода-установщика</figcaption>
</figure>
<p>Поддерживаются следующие команды:</p>
<ul>
<li>InsertS — создание сервиса Network Service. В качестве пути для запуска указывается имя текущего модуля с параметром runsvc. При отсутствии в списке процессов avp.exe сервис будет сразу же запущен.</li>
<li><p>Runsvc — удаление всех вспомогательных файлов и папок, которые могли использоваться в процессе обхода UAC. Распаковка шеллкода следующей стадии, создание процесса svchost.exe и инъекция распакованного шеллкода.
Интересно, что в коде, отвечающем за имперсонацию и запуск процесса svchost.exe, реализована специальная проверка для русского языка системы (и только для него), что говорит об ориентации на русскоязычные версии ОС.</p>
<figure>
<img alt="Рисунок 34. Особая обработка для русского языка системы" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image34.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 34. Особая обработка для русского языка системы</figcaption>
</figure>
<p>Помимо этого, создается отдельный поток, который каждые 50 секунд проверяет наличие маппинга Global\MYKERNELDLLMAPPING06. В случае его отсутствия в системе повторяется создание svchost.exe и инъекция шеллкода.</p>
</li>
<li>ByPassUAC — работает полностью аналогично 64-битной версии (<a href="#stage3-1-1">стадия 3.1.1</a>): распаковывает DLL с реализацией методов обхода UAC и передает ей управление.</li>
<li>Memload — в коде присутствует отладочное сообщение MemLoadServer. Распаковывает шеллкод следующей стадии и запускает его напрямую в текущем процессе.</li>
</ul>
<h4 id="id3-6-5">Стадия 4. MemLoadLibrary</h4>
<p>Четвертая стадия имеет уже встречавшийся ранее формат: шеллкод распаковки извлекает шеллкод релокации, который в свою очередь запускает на исполнение основной код (полученный из PE-файла). Основной код в данном случае имеет небольшой объем и отвечает за распаковку и рефлективную загрузку DLL в память. Рефлективный загрузчик реализован в виде зашифрованного XOR шеллкода, как и на стадии <a href="#stage3-1-1">3.1.1</a>. После загрузки библиотеки управление передается экспортируемой функции Online.</p>
<figure>
<img alt="Рисунок 35. Распаковка DLL и запуск экспорта Online" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image35.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 35. Распаковка DLL и запуск экспорта Online</figcaption>
</figure>
<p>DLL вновь является лишь промежуточным загрузчиком и запускает очередной шеллкод.</p>
<figure>
<img alt="Рисунок 36. Код функции Online" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image36.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 36. Код функции Online</figcaption>
</figure>
<p>Новый шеллкод является шеллкодом распаковки, и стадия 4 повторяется в точности, вплоть до вызова функции Online из последней DLL-библиотеки.</p>
<h4 id="id3-6-6">Стадия 5. Полезная нагрузка</h4>
<p>Представляет собой частично обфусцированный с помощью уже встречавшегося пакера (стадия <a href="#stage3-2-1">3.2.1</a>) бэкдор, который основан на коде трояна Gh0st.</p>
<p>Интересно, что сигнатура сетевых пакетов (Gh0st в оригинале) в данной версии генерируется и проверяется особым образом. В четырехбайтовом значении полезную нагрузку несет только младший бит каждого байта, остальные биты случайны. Младшие биты должны удовлетворять набору логических соотношений, в которых участвуют младшие биты магической константы 0x31230C0. Стоит отметить, что аналогичный алгоритм проверки этих соотношений, использующий ту же константу, можно найти в загрузчиках файлов .dat (<a href="#id3-6-3">стадия 2</a>), однако там результат его работы не используется.</p>
<figure>
<img alt="Рисунок 37. Генерация сигнатуры в конструкторе класса CClientSocket" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image37.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 37. Генерация сигнатуры в конструкторе класса CClientSocket</figcaption>
</figure>
<p>Библиотека имеет экспортируемое имя BH_A006_SRV.dll, а в оверлее PE-файла можно обнаружить соответствующий PDB-путь:</p>
<p>D:\005（fastapp f35 20181009）\nwsapagent\KernelTrjoan\BH_A006_SRV\BH_A006_SRV\Debug\BH_A006_SRV.pdb</p>
<p>Нам удалось найти экземпляр ВПО (57d4c08ce9a45798cd9b0cf08c933e26ffa964101dcafb1640d1df19c223e738), который имеет аналогичную обфускацию, идентичный алгоритм генерации сетевой сигнатуры и содержит имя BH_A006_SRV.dll. При этом данный экземпляр был загружен на VirusTotal в 2015 году.</p>
<h4 id="id3-6-7">Связь с 9002 RAT</h4>
<p>В процессе изучения цепочки исполнения бэкдора BH_A006 оказалось, что использованная в ней техника преобразования PE-файла в автономный сжатый шеллкод не уникальна. Аналогичные шеллкоды распаковки и релокации, а также процедура загрузки WinAPI-функций присутствуют в экземплярах ВПО 9002 RAT. Например, их можно найти в образце 52374f68d1e43f1ca6cd04e5816999ba45c4e42eb0641874be25808c9fe15005 из <a href="https://www.trendmicro.com/en_us/research/18/h/supply-chain-attack-operation-red-signature-targets-south-korean-organizations.html" target="_blank">отчета Trend Micro</a> об атаках на южнокорейские компании — одного из последних упоминаний данного ВПО.</p>
<h3 id="id3-7">Deed RAT</h3>
<p>Еще один вид ранее неизвестного ВПО, который в единственном экземпляре мы обнаружили у нашего клиента, представляет собой модульный бэкдор. По значению сигнатуры, которая используется в заголовке его модулей, мы дали ему название Deed RAT.</p>
<p>Контрольный сервер Deed RAT ftp.microft.dynssl.com напрямую связан с инфраструктурой группы Space Pirates. Сходство можно найти и в одной из кодовых особенностей: для шифрования шеллкода так же, как и в части экземпляров PlugX, используются операции [xor 0xBB, sub 0x1].</p>
<p>Схема исполнения полезной нагрузки напоминает стандартный метод, который использует PlugX: легитимный EXE-файл, подписанный Trend Micro, загружает в процессе работы вредоносную библиотеку TmDbgLog.dll, которая, в свою очередь, запускает на исполнение зашифрованный шеллкод из файла PTWD.tmp.</p>
<p>Однако при этом используется интересный метод передачи управления шеллкоду: в момент загрузки библиотека модифицирует исполняемый файл таким образом, чтобы после возврата управления в EXE-файл для нее сразу же была вызвана функция FreeLibrary. Повторно получив управление в момент выгрузки, библиотека вновь модифицирует исполняемый файл, записывая в него ассемблерные инструкции для вызова шеллкода: они будут выполнены сразу после возврата из FreeLibrary.</p>
<p>Шеллкод представляет собой загрузчик основного модуля, который в сжатом и зашифрованном виде располагается после кода загрузки. Модуль имеет специальную структуру и использует техники, заимствованные из PE-файлов. В частности, в модуле присутствуют три «секции» с различными правами доступа и таблица релокации, полностью аналогичная используемой в формате PE.</p>
<p>Расшифрованный модуль состоит из заголовка, начинающегося с сигнатуры 0xDEED4554 и основного блока данных, сжатого LZNT1, в котором содержатся данные секций и таблица релокации. Для каждой из секций в заголовке указаны ее фактический размер и размер в памяти, который выровнен на границу 0x1000. Структура заголовка выглядит следующим образом:</p>
struct SectionHeader{
 _DWORD VirtualSize;
 _DWORD SizeOfRawData;
};
struct ModuleHeader{
 _DWORD Signature; // 0xDEED4554
 _DWORD ModuleId;
 _DWORD EntryPoint;
 _DWORD OriginalBase;
 _DWORD AbsoluteOffset; // 0x1000
 SectionHeader Sections[3];
 _DWORD Unknown;
};
<p>В процессе работы загрузчик выделяет необходимую область памяти, копирует в нее каждую из секций (учитывая ее размер в памяти) и выполняет настройку адресов (релокацию). Первая из секций содержит исполняемый код, и для ее области памяти устанавливаются права RX, остальные секции имеют права RW. После загрузки секций управление получает точка входа модуля, указанная в заголовке.</p>
<p>Основной модуль бэкдора имеет идентификатор 0x20 и отвечает за загрузку и управление плагинами, реализующими различные функции. В его секции данных расположены восемь зашифрованных плагинов, которые инициализируются в начале работы:</p>
<table class="table-article">
<thead>
<tr>
<th>ID</th>
<th>Имя</th>
<th>Описание</th>
<th>Сетевые команды</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x30</td>
<td>Startup</td>
<td>Плагин, реализующий алгоритм запуска ВПО</td>
<td></td>
</tr>
<tr>
<td>0x40</td>
<td>Config</td>
<td>Плагин, отвечающий за работу с конфигурацией</td>
<td>0x40 — передача конфигурации на C2
0x41 — получение новой конфигурации от C2</td>
</tr>
<tr>
<td>0xA0</td>
<td>Install</td>
<td>Плагин, отвечающий за закрепление на зараженной машине. Закрепление может выполняться через механизм служб и через реестр (ключ задается конфигурацией)</td>
<td></td>
</tr>
<tr>
<td>0xB0</td>
<td>Inject</td>
<td>Плагин, осуществляющей внедрение кода в заданный процесс (определяется конфигурацией)</td>
<td></td>
</tr>
<tr>
<td>0x60</td>
<td>Network</td>
<td>Плагин, управляющий сетевым взаимодействием</td>
<td></td>
</tr>
<tr>
<td>0x70</td>
<td>NetSocket</td>
<td>Плагин, реализующий различные типы коннекторов для сетевого взаимодействия</td>
<td></td>
</tr>
<tr>
<td>0x50</td>
<td>Plugin</td>
<td>Плагин, реализующий мониторинг реестра на предмет появления в нем новых плагинов и их загрузку</td>
<td>0x50 — сбор информации о плагинах
0x51 — добавление плагина в реестр и его запуск
0x52 — удаление плагина из реестра и памяти</td>
</tr>
<tr>
<td>0x90</td>
<td>NetProxy</td>
<td>Плагин, управляющий информацией о доступных прокси-серверах. Имеет встроенный сниффер для автоматического обнаружения прокси, используемых зараженной машиной</td>
<td></td>
</tr>
</tbody>
</table>
<p>В отличие от основного модуля для шифрования плагинов используется алгоритм на основе Salsa20. Среди модификаций — собственная константа для расширения ключа, равная arbitraryconstat. Структура расшифрованного плагина полностью повторяет структуру основного модуля, и для его загрузки используется аналогичный алгоритм.</p>
<p>Каждый плагин реализует пять служебных операций, которые реализованы в его точке входа:</p>
<ol>
<li>Инициализация.</li>
<li>Получение числового идентификатора плагина.</li>
<li>Получение названия плагина.</li>
<li>Получение ссылки на структуру с API-функциями плагина.</li>
<li>Освобождение ресурсов.</li>
</ol>
<figure>
<img alt="Рисунок 38. Точка входа плагина Config" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image38.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 38. Точка входа плагина Config</figcaption>
</figure>
<p>Полезная функциональность плагина доступна через структуру с его API-функциями. Среди них может присутствовать функция-диспетчер, отвечающая за обработку сетевых команд, которые поддерживает плагин. Основной модуль также имеет API-интерфейс, позволяющий получить доступ к другим плагинам и реализующий вспомогательные функции, такие как шифрование или работа с реестром.</p>
<p>Одной из интересных особенностей бэкдора является псевдослучайная генерация различного рода строк — ключей реестра, имен мьютексов и каналов (pipes), аргументов командной строки. Строка необходимой длины создается на основе сида, в формировании которого участвуют числовой идентификатор строки, а также серийный номер системного тома. В результате на каждой из зараженных машин используется свой уникальный набор строковых констант.</p>
<figure>
<img alt="Рисунок 39. Алгоритм генерации идентификатора" src="https://www.ptsecurity.com/upload/corporate/ru-ru/images/pt-esc/article_333365/image39.png" style="max-width:80%;height:auto;width:auto;"/>
<figcaption>Рисунок 39. Алгоритм генерации идентификатора</figcaption>
</figure>
<p>Все необходимые данные бэкдор хранит в разделе реестра [HKLM|HKCU]\Software\Microsoft\. Для каждого типа информации в нем создается свой подраздел, имя которого получается с помощью описанного выше генератора строк. Чтобы получить все ключи, которые может использовать бэкдор, мы реализовали скрипт на Python, принимающий серийный номер тома и воспроизводящий работу генератора.</p>
<h4>Генератор ключей реестра</h4>
 
import click
def rshift(val, n):
 s = val &amp; 0x80000000
 for i in range(0,n):
 val &gt;&gt;= 1
 val |= s
 return val
def generator(volume_number, seed, length):
 gr_seed = (volume_number + seed + 0x1000193) &amp; 0xffffffff
 r = []
 for i in range(length):
 r1 = (gr_seed * 0x2001) &amp; 0xffffffff
 r2 = rshift(r1, 7)
 r3 = r2 ^ r1
 r4 = (r3 * 9) &amp; 0xffffffff
 r5 = rshift(r4, 17)
 r6 = r4 ^ r5
 r7 = (r6 * 33) &amp; 0xffffffff
 r.append(((r7 &amp; 0xffff) % 26) + 0x41)
 gr_seed = r7 
 
 return bytes(r).decode('utf-8')
@click.command()
@click.argument("VOLUME_NUMBER")
def main(volume_number):
 try:
 serial_number = int(volume_number, 16)
 except ValueError:
 print("[~] Invalid Volume number")
 return 
 registry_key_1 = generator(serial_number, 0xC4DA8B2F, 6)
 registry_key_2 = generator(serial_number, 0x7BD90AA1, 10)
 registry_key_3 = generator(serial_number, 0xF7BBC23F, 10)
 registry_key_4 = generator(serial_number, 0xDF12A5B2, 8)
 registry_key_5 = generator(serial_number, 0x6EB208A4, 9)
 registry_key_6 = generator(serial_number, 0xDE8765CB, 8)
 registry_key_7 = generator(serial_number, 0x6D3C218A, 8)
 registry_key_8 = generator(serial_number, 0x78D3BC22, 8)
 registry_key_9 = generator(serial_number, 0xD53BCA90, 10)
 registry_key_11 = generator(serial_number, 0x4FD82CB4, 8)
 registry_key_13 = generator(serial_number, 0xDCBC5D23, 8)
 registry_key_10 = generator(serial_number, 0xE2C7BA56, 15)
 
 registry_key_12 = generator(serial_number, 0x8BD43C12, 8)
 print(f"[+] Plugin monitor registry key: [HKCU|HKLM]\\Software\\Microsoft\\{registry_key_1}")
 print(f"[+] Executable path: [HKCU|HKLM]\\Software\\Microsoft\\{registry_key_3}; ValueName: {registry_key_2}")
 print(f"[+] Machine ID: [HKCU|HKLM]\\Software\\Microsoft\\{registry_key_5}; ValueName: {registry_key_4}")
 print(f"[+] Shellcode for injection: [HKCU|HKLM]\\Software\\Microsoft\\{registry_key_6}; ValueName: {registry_key_7}")
 print(f"[+] Proxies: [HKCU|HKLM]\\Software\\Microsoft\\{registry_key_9}; ValueName: {registry_key_8}")
 print(f"[+] Config : [HKCU|HKLM]\\Software\\Microsoft\\{registry_key_11}; ValueName: {registry_key_13}")
if __name__ == "__main__":
 main()
 
 
<p>За алгоритм взаимодействия с контрольным сервером отвечает плагин Network. Он извлекает адрес C2 в виде URL-строки из конфигурации и в зависимости от указанной в нем схемы выбирает один из коннекторов, доступных в плагине NetSocket. Все они реализуют общий интерфейс, позволяющий единообразно принимать и передавать сетевые сообщения. Перед отправкой сообщения сжимаются с помощью алгоритма LZNT1 и шифруются модифицированным Salsa20 с использованием случайного ключа.</p>
<p>Для разрешения домена контрольного сервера бэкдор последовательно использует DNS over HTTPS и обычные DNS-серверы, указанные в конфигурации (публичные серверы Google и других провайдеров), прежде чем обратиться к стандартному механизму. Это дает ВПО возможность скрыть домен C2 от средств инспекции сетевого трафика.</p>
<p>Среди поддерживаемых протоколов соединения — TCP, TLS, HTTP, HTTPS, UDP и DNS.</p>
<p>Для TCP доступна опция REUSEPORT — ее указание приводит к предварительной привязке сокета, с помощью которого выполняется соединение с C2. Привязка выполняется к наибольшему свободному порту в диапазоне системных (well-known) портов. Порты перебираются начиная с 1022 в порядке убывания. По-видимому, такая техника внедрена для обхода средств защиты и маскировки трафика под системные сетевые сервисы.</p>
<p>В бэкдоре также предусмотрена возможность получения нового C2 по протоколу HTTP. Для этого может быть использована веб-страница, адрес которой указывается в конфигурации со схемой URL://. Страница загружается, после чего в ее теле происходит поиск подстрок agmsy4 и ciou0, которые обозначают начало и конец строки с контрольным сервером. Эта строка закодирована с помощью base16 (hex) с алфавитом abcghimnostuyz0456 и обрабатывается аналогично адресу из конфигурации.</p>
<p>Коннекторы TCP/TLS и HTTP/HTTPS поддерживают соединение через прокси-сервер, который может быть получен с помощью плагина NetProxy. Плагин имеет собственное хранилище прокси, которое располагается в реестре и может наполняться значениями из конфигурации, системными прокси и данными из установленных браузеров (Chrome, Opera и Firefox). Кроме того, плагин имеет функциональность встроенного сниффера, который прослушивает трафик зараженной машины с помощью raw socket. Если сниффер обнаруживает в исходящем пакете попытку соединения с прокси-сервером (SOCKS4, SOCKS5 или HTTP), он сохраняет информацию о нем в хранилище.</p>
<p>Прежде чем подключаться к контрольному серверу, бэкдор проверяет расписание: в его конфигурации может быть указано до четырех записей, содержащих дни недели и часы, в которые соединение запрещено.</p>
<p>После установки соединения бэкдор может выполнять следующие команды:</p>
<table class="table-article">
<thead>
<tr>
<th>ID</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x210</td>
<td>Сбор информации о системе</td>
</tr>
<tr>
<td>0x211</td>
<td>Создание отдельного соединения для работы с плагинами</td>
</tr>
<tr>
<td>0x212</td>
<td>Самоудаление</td>
</tr>
<tr>
<td>0x213</td>
<td>Пустая команда (пинг)</td>
</tr>
<tr>
<td>0x214</td>
<td>Деактивация соединения</td>
</tr>
<tr>
<td>0x215</td>
<td>Обновление шеллкода для инжекта, который хранится в реестре</td>
</tr>
<tr>
<td>0x216</td>
<td>Обновление основного шеллкода на диске. Все сохраненные в реестре плагины удаляются</td>
</tr>
</tbody>
</table>
<p>Если получена команда, которой нет в списке выше, то предполагается, что это сетевая команда одного из плагинов. Его ID определяется наложением маски 0xFFF0 на идентификатор команды. Если плагин отсутствует локально, он предварительно загружается с C2 и сохраняется в реестре.</p>
<p>На зараженной Deed RAT машине нам удалось обнаружить единственный плагин, полученный динамически с контрольного сервера. Он называется Shell и имеет ID 0x270. Shell поддерживает две сетевые команды (0x270 и 0x271), каждая из которых запускает указанный процесс и перенаправляет его ввод-вывод на C2. В первом случае взаимодействие происходит в текстовом режиме через потоки (pipes). Во втором случае используются операции Windows Console API, что позволяет злоумышленникам полноценно эмулировать консольное окно на своей стороне, учитывая информацию о размере экранного буфера, позиции курсора и другие параметры.</p>
<p>В конфигурации исследованного нами образца содержался следующий набор строк:</p>
<table class="table-article">
<thead>
<tr>
<th>Строка</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr>
<td>%ALLUSERSPROFILE%\Test\Test.exe</td>
<td>Путь к легитимному исполняемому файлу (путь установки)</td>
</tr>
<tr>
<td>TmDbgLog.dll</td>
<td>Имя библиотеки для DLL Side-Loading</td>
</tr>
<tr>
<td>PTWD.tmp</td>
<td>Имя файла с зашифрованным шеллкодом</td>
</tr>
<tr>
<td>Test</td>
<td>Имя сервиса</td>
</tr>
<tr>
<td>Trend Micro Platinum</td>
<td>Отображаемое имя сервиса</td>
</tr>
<tr>
<td>Platinum Watch Dog</td>
<td>Описание сервиса</td>
</tr>
<tr>
<td>SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</td>
<td>Ключ для закрепления в реестре</td>
</tr>
<tr>
<td>%windir%\system32\svchost.exe</td>
<td>Имена процессов для инжектирования кода</td>
</tr>
<tr>
<td>%windir%\system32\taskeng.exe</td>
<td></td>
</tr>
<tr>
<td>%ProgramFiles%\Internet Explorer\iexplore.exe</td>
<td></td>
</tr>
<tr>
<td>%windir%\system32\WmiPrvSE.exe</td>
<td></td>
</tr>
<tr>
<td>hio2cF9VF2Jsdf9n</td>
<td>Идентификатор, отправляемый вместе с информацией о системе</td>
</tr>
<tr>
<td>asdRFSDabormhkmfgUIYGBDURE</td>
<td>Имя мьютекса</td>
</tr>
<tr>
<td>https://dns.google/dns-query</td>
<td>Адреса серверов DNS over HTTPS</td>
</tr>
<tr>
<td>https://cloudflare-dns.com/dns-query</td>
<td></td>
</tr>
<tr>
<td>https://dns.adguard.com/dns-query</td>
<td></td>
</tr>
<tr>
<td>https://dns.quad9.net/dns-query</td>
<td></td>
</tr>
<tr>
<td>TCP://ftp.microft.dynssl.com:53412</td>
<td>URL контрольного сервера</td>
</tr>
</tbody>
</table>
<h2 id="id4">Заключение</h2>
<p>APT-группировки с азиатскими корнями продолжают атаковать российские компании, что подтверждает и активность группы Space Pirates. Злоумышленники как разрабатывают новое ВПО, реализующее нестандартные техники (такое, например, как Deed RAT), так и используют модификации уже существующих бэкдоров. Иногда такие модификации могут иметь множество слоев обфускации, добавленных для противодействия средствам защиты и усложнения процедуры анализа — как в случае BH_A006, построенного на коде популярного бэкдора Gh0st.</p>
<p>Отдельную сложность в случае APT-групп азиатского региона представляет точная атрибуция наблюдаемой активности: частый обмен используемыми инструментами, а также совместная в некоторых случаях деятельность различных группировок существенно затрудняют эту задачу. Основная часть нашего исследования построена на результатах работ по расследованию инцидента ИБ у нашего клиента и анализу специфической сетевой инфраструктуры, использующей DDNS-домены. Полученные данные позволяют уверенно утверждать, что за выявленной активностью стоят одни и те же злоумышленники.</p>
<p>Специалисты PT ESC продолжат работу по мониторингу угроз: новые факты могут дать больше информации о деятельности группы Space Pirates и ее взаимосвязи с другими группировками.</p>
<h2 id="id5">Приложения</h2>
<h3 id="id5-1">MITRE</h3>
<table class="table-article">
<thead>
<tr>
<th>ID</th>
<th>Имя</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>Initial Access</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1566.001</td>
<td>Phishing: Spearphishing Attachment</td>
<td>Группа Space Pirates использует фишинговые рассылки с вредоносным вложением</td>
</tr>
<tr>
<td>T1566.002</td>
<td>Phishing: Spearphishing Link</td>
<td>Группа Space Pirates использует фишинговые письма со ссылками на ВПО</td>
</tr>
<tr>
<td>Execution</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1059.003</td>
<td>Command and Scripting Interpreter: Windows Command Shell</td>
<td>ВПО группы Space Pirates имеет функциональность удаленной командной строки</td>
</tr>
<tr>
<td>T1059.005</td>
<td>Command and Scripting Interpreter: Visual Basic</td>
<td>Группа Space Pirates использует VBS-скрипты, включая ReVBShell</td>
</tr>
<tr>
<td>T1106</td>
<td>Native API</td>
<td>ВПО группы Space Pirates использует функции WinAPI для запуска новых процессов и внедрения шеллкода</td>
</tr>
<tr>
<td>T1053.002</td>
<td>Scheduled Task/Job: At (Windows)</td>
<td>Группа Space Pirates использует atexec.py для запуска команд на удаленном узле</td>
</tr>
<tr>
<td>T1053.005</td>
<td>Scheduled Task/Job: Scheduled Task</td>
<td>Группа Space Pirates использует системные задачи</td>
</tr>
<tr>
<td>T1569.002</td>
<td>System Services: Service Execution</td>
<td>Группа Space Pirates создает вредоносные сервисы.</td>
</tr>
<tr>
<td>Persistence</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1053.005</td>
<td>Scheduled Task/Job: Scheduled Task</td>
<td>Для закрепления на узле группа Space Pirates создает системные задачи</td>
</tr>
<tr>
<td>T1543.003</td>
<td>Create or Modify System Process: Windows Service</td>
<td>Для закрепления на узле группа Space Pirates создает вредоносные сервисы</td>
</tr>
<tr>
<td>T1546.015</td>
<td>Event Triggered Execution: Component Object Model Hijacking</td>
<td>ВПО RtlShare закрепляется в системе через подмену COM-объекта MruPidlList</td>
</tr>
<tr>
<td>T1547.001</td>
<td>Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</td>
<td>Для закрепления на узле группа Space Pirates может размещать ярлык в папке автозапуска и использовать ключи реестра Run и RunOnce</td>
</tr>
<tr>
<td>Privilege Escalation</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1548.002</td>
<td>Abuse Elevation Control Mechanism: Bypass User Account Control</td>
<td>ВПО группы Space Pirates содержит различные техники для обхода UAC</td>
</tr>
<tr>
<td>T1068</td>
<td>Exploitation for Privilege Escalation</td>
<td>Группа Space Pirates может использовать уязвимость CVE-2017-0213 для повышения привилегий</td>
</tr>
<tr>
<td>Defense Evasion</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1027.001</td>
<td>Obfuscated Files or Information: Binary Padding</td>
<td>Дроппер RtlShare добавляет случайные байты в извлеченную нагрузку</td>
</tr>
<tr>
<td>T1027.002</td>
<td>Obfuscated Files or Information: Software Packing</td>
<td>Одна из стадий ВПО BH_A006 обфусцирована с помощью неизвестного протектора</td>
</tr>
<tr>
<td>T1036.004</td>
<td>Masquerading: Masquerade Task or Service</td>
<td>При создании сервисов группа Space Pirates использует легитимно выглядящие имена</td>
</tr>
<tr>
<td>T1036.005</td>
<td>Masquerading: Match Legitimate Name or Location</td>
<td>Группа Space Pirates маскирует свое ВПО под легитимное ПО</td>
</tr>
<tr>
<td>T1055</td>
<td>Process Injection</td>
<td>ВПО группы Space Pirates может внедрять шеллкод в другие процессы</td>
</tr>
<tr>
<td>T1055.001</td>
<td>Process Injection: Dynamic-link Library Injection</td>
<td>ВПО группы Space Pirates может внедрять DLL с полезной нагрузкой в другие процессы</td>
</tr>
<tr>
<td>T1078.002</td>
<td>Valid Accounts: Domain Accounts</td>
<td>Группа Space Pirates использует скомпрометированные привилегированные учетные данные</td>
</tr>
<tr>
<td>T1112</td>
<td>Modify Registry</td>
<td>Deed RAT хранит в реестре все свои данные, включая конфигурацию и плагины</td>
</tr>
<tr>
<td>T1140</td>
<td>Deobfuscate/Decode Files or Information</td>
<td>ВПО группы Space Pirates шифрует конфигурационные данные и полезную нагрузку с помощью различных алгоритмов</td>
</tr>
<tr>
<td>T1197</td>
<td>BITS Jobs</td>
<td>Группа Space Pirates использует BITS Job для загрузки ВПО</td>
</tr>
<tr>
<td>T1218.011</td>
<td>Signed Binary Proxy Execution: Rundll32</td>
<td>Группа Space Pirates может использовать rundll32.exe для запуска DLL-библиотек</td>
</tr>
<tr>
<td>T1553.002</td>
<td>Subvert Trust Controls: Code Signing</td>
<td>Группа Space Pirates использует похищенные сертификаты для подписи некоторых экземпляров Zupdax</td>
</tr>
<tr>
<td>T1564.001</td>
<td>Hide Artifacts: Hidden Files and Directories</td>
<td>Группа Space Pirates может хранить свое ВПО в скрытых папках по пути C:\ProgramData</td>
</tr>
<tr>
<td>T1574.002</td>
<td>Hijack Execution Flow: DLL Side-Loading</td>
<td>Группа Space Pirates использует легитимные приложения, уязвимые к DLL Side-Loading</td>
</tr>
<tr>
<td>T1620</td>
<td>Reflective Code Loading</td>
<td>ВПО группы Space Pirates использует рефлективную загрузку для запуска полезной нагрузки в памяти</td>
</tr>
<tr>
<td>Credential Access</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1555.003</td>
<td>Credentials from Password Stores: Credentials from Web Browsers</td>
<td>Группа Space Pirates использует утилиту Chromepass для извлечения паролей из хранилища браузера Chrome</td>
</tr>
<tr>
<td>T1003.001</td>
<td>OS Credential Dumping: LSASS Memory</td>
<td>Группа Space Pirates получает дампы процесса lsass для дальнейшего извлечения учетных записей</td>
</tr>
<tr>
<td>T1040</td>
<td>Network Sniffing</td>
<td>Deed RAT собирает информацию об используемых прокси с помощью прослушивания трафика</td>
</tr>
<tr>
<td>Discovery</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1087.001</td>
<td>Account Discovery: Local Account</td>
<td>Группа Space Pirates собирает информацию о пользователях посредством команды query user</td>
</tr>
<tr>
<td>T1087.002</td>
<td>Account Discovery: Domain Account</td>
<td>Группа Space Pirates собирает информацию о пользователях в домене посредством легитимной утилиты CSVDE</td>
</tr>
<tr>
<td>T1082</td>
<td>System Information Discovery</td>
<td>ВПО группы Space Pirates собирает информацию о системе, включающую версию ОС, информацию о процессоре, памяти и дисках</td>
</tr>
<tr>
<td>T1614.001</td>
<td>System Location Discovery: System Language Discovery</td>
<td>Deed RAT в процессе сбора информации о системе получает языковой идентификатор LCID</td>
</tr>
<tr>
<td>T1016</td>
<td>System Network Configuration Discovery</td>
<td>Группа Space Pirates собирает информацию о сетевых параметрах зараженной машины</td>
</tr>
<tr>
<td>T1069.002</td>
<td>Permission Groups Discovery: Domain Groups</td>
<td>Группа Space Pirates собирает информацию о группах в домене посредством легитимной утилиты CSVDE</td>
</tr>
<tr>
<td>T1083</td>
<td>File and Directory Discovery</td>
<td>Группа Space Pirates собирает информацию о наличии файлов в системе по расширениям .doc и .pdf</td>
</tr>
<tr>
<td>T1033</td>
<td>System Owner/User Discovery</td>
<td>Группа Space Pirates собирает информацию о пользователях скомпрометированных компьютеров</td>
</tr>
<tr>
<td>T1057</td>
<td>Process Discovery</td>
<td>Группа Space Pirates использует утилиту tasklist.exe для получения информации о процессах</td>
</tr>
<tr>
<td>Lateral Movement</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1021.002</td>
<td>Remote Services: SMB/Windows Admin Shares</td>
<td>Группа Space Pirates использует утилиты atexec.py и psexec.rb для продвижения по сети</td>
</tr>
<tr>
<td>Collection</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1119</td>
<td>Automated Collection</td>
<td>Группа Space Pirates производит поиск и копирование файлов с масками *.doc и *.pdf</td>
</tr>
<tr>
<td>T1560.001</td>
<td>Archive Collected Data: Archive via Utility</td>
<td>Группа Space Pirates собирает в защищенные паролем архивы украденные документы с помощью 7-Zip</td>
</tr>
<tr>
<td>T1056.001</td>
<td>Input Capture: Keylogging</td>
<td>Группа Space Pirates может записывать пользовательский ввод с помощью своего ВПО</td>
</tr>
<tr>
<td>Command and Control</td>
<td></td>
<td></td>
</tr>
<tr>
<td>T1071.001</td>
<td>Application Layer Protocol: Web Protocols</td>
<td>Deed RAT может инкапсулировать свой протокол в HTTP и HTTPS</td>
</tr>
<tr>
<td>T1071.004</td>
<td>Application Layer Protocol: DNS</td>
<td>Deed RAT может инкапсулировать свой протокол в DNS</td>
</tr>
<tr>
<td>T1132.001</td>
<td>Data Encoding: Standard Encoding</td>
<td>ВПО группы Space Pirates может сжимать сетевые сообщения с помощью алгоритмов LZNT1 и LZW</td>
</tr>
<tr>
<td>T1573.001</td>
<td>Encrypted Channel: Symmetric Cryptography</td>
<td>ВПО группы Space Pirates может шифровать сетевые сообщения с помощью симметричных алгоритмов</td>
</tr>
<tr>
<td>T1008</td>
<td>Fallback Channels</td>
<td>ВПО группы Space Pirates поддерживает работу с несколькими C2 и может обновлять список C2 через веб-страницы</td>
</tr>
<tr>
<td>T1095</td>
<td>Non-Application Layer Protocol</td>
<td>ВПО группы Space Pirates использует собственные протоколы для коммуникации с управляющим сервером</td>
</tr>
<tr>
<td>T1105</td>
<td>Ingress Tool Transfer</td>
<td>Группа Space Pirates загружает дополнительные утилиты с управляющего сервера посредством утилиты certutil</td>
</tr>
<tr>
<td>T1571</td>
<td>Non-Standard Port</td>
<td>Группировка Space Pirates для связи с управляющим сервером использует нестандартные порты, такие как 8081, 5351, 63514 и другие</td>
</tr>
<tr>
<td>T1572</td>
<td>Protocol Tunneling</td>
<td>Группа Space Pirates для туннелирования трафика использует утилиту dog-tunnel</td>
</tr>
<tr>
<td>T1090.001</td>
<td>Proxy: Internal Proxy</td>
<td>Deed RAT может обнаруживать и использовать прокси для соединения с C2</td>
</tr>
</tbody>
</table>
<h3 id="id5-2">IOCs</h3>
<h4 id="id5-2-1">Файловые индикаторы</h4>
<p>MyKLoadClient</p>
<table class="table-article">
<tbody>
<tr>
<td>947f042bd07902100dd2f72a15c37e2397d44db4974f4aeb2af709258953636f</td>
<td>09c29c4d01d25bae31c5a8b29474258dc1e40936</td>
<td>a2f2e6cdd27c13d2d2d3a5d15e905bb4</td>
</tr>
<tr>
<td>949cb5d03a7952ce24b15d6fccd44f9ed461513209ad74e6b1efae01879395b1</td>
<td>55604a258d56931d0e1be05bcbe76f675ed69e6e</td>
<td>5cce810a04197dc25231c477e7e0b402</td>
</tr>
<tr>
<td>35e36627dbbcb2b6091cc5a75ab26d9e5b0d6f9764bc11eb2851e3ebd3fbfe6e</td>
<td>415ae82bc0aa94e425009068a239e85a78b8e837</td>
<td>f250cc6ea8b240cfe9eb7e2007656e53</td>
</tr>
<tr>
<td>730b9ee9f031c8c543664ee281c7988467a3c83eabbbde181aa280314a91ba41</td>
<td>7be81aa01715c78166b8529eb999ec52f01a6367</td>
<td>399e655f1544e6c34601d3ee1e99d088</td>
</tr>
<tr>
<td>16c2e10b2e3d74732edfae4a4fcc118600e9212162256434f34121fa41eaf108</td>
<td>7f9d53dc8247e68bfc30c2399eb227a9f1aa9dae</td>
<td>850c1355f713c6f6235863d7245221ea</td>
</tr>
<tr>
<td>b822a4ec46aacb3bb4c22fe5d9298210bfa442118ee05a1532c324a5f847a9e6</td>
<td>869bd4d2520e5f2cf1d86e7fa21d0fb9a8fae41b</td>
<td>12c83dc14e08c206725933e7b69e8e66</td>
</tr>
<tr>
<td>192499ad69ec23900f4c0971801e7688f9b5e1dc5d5365d3d77cb9bf14e5fd73</td>
<td>c3f82d46c5138ba89e3a8fe5ea80ce3b0d2467c0</td>
<td>5865679e252c0c9fcfcae4546760f7a5</td>
</tr>
<tr>
<td>56b9648fd3ffd1bf3cb030cb64c1d983fcd1ee047bb6bd97f32edbe692fa8570</td>
<td>a8d5e941b04cdd0070fe3218fa1bc04fb1bdd1b4</td>
<td>a5d85f982d6650b26cccee4741fc3f00</td>
</tr>
<tr>
<td>0bac8f569df79b5201e353e1063933e52cfb7e34cd092fc441d514d3487f7771</td>
<td>64d97ea909a9b14857490724f19b971bb95d641d</td>
<td>cb9617de5bc93949844a3e26e1360aa3</td>
</tr>
<tr>
<td>1bab80116fa1f1123553bdaf3048246f8c8a8bb3a71b2a13e87b704e68d10d2b</td>
<td>3f32c341a71a32b6421822f44d4efde30d15421b</td>
<td>e26713d8091da1946a158f168342cae9</td>
</tr>
<tr>
<td>444d376d251911810f3f4b75923313b3726050153d50ad59deff5a0b8b1ada20</td>
<td>90ff670baddb8bce0444a8a422096461e78fb287</td>
<td>bf11b368d610922ac28cd4a9f20bfe97</td>
</tr>
<tr>
<td>84eb2efa324eba0c2e06c3b84395e9f5e3f28a3c9b86edd1f813807ba39d9acb</td>
<td>82c18765ac3a1a2ecf3f258c0912beaf5aedd175</td>
<td>ddc9174f111e8aa445a71b8eeb0ad490</td>
</tr>
<tr>
<td>14b03ac41b5ef44ca31790fefb23968f2525c3aabfe11e96b9b1ccb6215eb8be</td>
<td>e5882192901c00d8ac47bd82b7d4565761847e7b</td>
<td>7b7c21eac0d9a06178a68d73fc5a18a6</td>
</tr>
<tr>
<td>b1d6ba4d995061a0011cb03cd821aaa79f0a45ba2647885171d473ca1a38c098</td>
<td>9f671e338bc9b66e2dd3b7a3c9115723911b8f65</td>
<td>135f224c2d740b1f1b6f43235e96d3f2</td>
</tr>
<tr>
<td>5847c8b8f54c60db939b045d385aba0795880d92b00d28447d7d9293693f622b</td>
<td>878b2b8543ee103841cf30af70813b1c27434d71</td>
<td>10b52c1ccaba52a52c991b05704bb12e</td>
</tr>
<tr>
<td>95811d4e3c274f4c2d8f1bf092b9ddc488aa325aabf7c87a2c4877af4ba8bfb7</td>
<td>6b0bebd54877e42f5082e674d07563f527fdd110</td>
<td>fed14e228ba25fdef9904adaf70c145f</td>
</tr>
<tr>
<td>0712456669e65b2b3e8d1305256992c79213a6dd4fd9128cf3e78ab9bae3cff6</td>
<td>ee6b0845ebaae57f88b262c198fad8cf151f6b85</td>
<td>72571ebddf49e7546f9d5fafc0664e0c</td>
</tr>
<tr>
<td>607c92088b7a3256302f69edbfad204cab12bf051a5aac3395130e18ae568dd5</td>
<td>2452567c5e28f622fa11c8e92f737cd5d8272abf</td>
<td>3562bd5a94f4e8d62250201e035e1a49</td>
</tr>
<tr>
<td>d0fb0a0379248cdada356da83cd2ee364e0e58f4ed272d3369fe1d6ca8029679</td>
<td>96bae22955bd85110c3f0b7de9a71b81c025f76a</td>
<td>8a8425a0a4988fa7e9bf98def23c1ec4</td>
</tr>
<tr>
<td>a8a16168af9dcdc4b34d8817b430a76275338dbbda32328520a4669dbe56e91b</td>
<td>57bd45e4afb8cd0d6b5360de6411ae0327812d5f</td>
<td>a2b245bbb1de4f61dd8c31f391b28605</td>
</tr>
<tr>
<td>7b7a65c314125692524d588553da7f6ab3179ceb639f677ed1cefe3f1d03f36e</td>
<td>a97b1e1e0de7f0eab5304d206f4d7131987aca6e</td>
<td>568594397a24a53ecbbb9c7766194678</td>
</tr>
<tr>
<td>f6c4c84487bbec5959068e4a8b84e515de4695c794769c3d3080bf5c2bb63d00</td>
<td>9358b341bc217dcd15599b43d88b157f8a9f4882</td>
<td>05a025736a6fd75f183a04a267cee165</td>
</tr>
<tr>
<td>467979d766b7e4a804b2247bbcdde7ef2bbaf15a4497ddb454d77ced72980580</td>
<td>ae021c91c759d087ead95319608326e0ed154cfd</td>
<td>78acab8a8d263968c46ef07d8ba98f0a</td>
</tr>
<tr>
<td>3e57ca992c235b68027cb62740d8e86a3294ac0ebcff4a2683b29bdaec016646</td>
<td>aad3241fd23372523528a99f4c18127a3ebbea59</td>
<td>a75c81a18e3965b5942e7b1669db16ca</td>
</tr>
<tr>
<td>c3415bddc506839614cbb7186bfc6643713806de4f5b1c15445e96a644b44bea</td>
<td>e29b263a89217412f45d6c7a0235b19af030755a</td>
<td>b1f907379148c1e09009cda3cbd3877b</td>
</tr>
<tr>
<td>d3a50abae9ab782b293d7e06c7cd518bbcec16df867f2bdcc106dec1e75dc80b</td>
<td>a9d64e615171b05a402422056ddfcd250febae93</td>
<td>b03192389159b15f5552c82a29c747fe</td>
</tr>
<tr>
<td>69863ba336156f4e559364b63a39f16e08ac3a6e3a0fa4ce11486ea16827f772</td>
<td>ec928047d511286c4db2580045d02ced34b639ea</td>
<td>27ea69e0233f32d521c7bb1330690731</td>
</tr>
<tr>
<td>50f035100948f72b6f03ccc02f9c6073c9060d6e9c53c563a3fdb1d0c454916e</td>
<td>d5ce13a66e8407baec0f447c7fb41d493fd8d73a</td>
<td>343a9cc37cc9843cf862dd946c7eb714</td>
</tr>
<tr>
<td>6bc77fa21232460c1b0c89000e7d45fe42e7723d075b752359c28a473d8dd1fd</td>
<td>74847db3abdb5b0fd3952bb76018f9346815035a</td>
<td>359ae18fbfc16b5b09e0f571d563d8e6</td>
</tr>
<tr>
<td>3ccae178d691fc95f6c52264242a39daf4c44813d835eaa051e7558b191d19ee</td>
<td>0e40d0424aefa672c18e0500ff940681798f2f02</td>
<td>196222b313b6c2ef728695ad5133da06</td>
</tr>
<tr>
<td>a99612370a8407f98746eb0bf60c72393b1b4a23f52e7d7a6896471f85e28834</td>
<td>757af512d07fc8fe1167750a748dbb9c700f71f1</td>
<td>6b2e4ff182bffe5a22944fa8d2a7d41d</td>
</tr>
</tbody>
</table>
<p>Zupdax</p>
<table class="table-article">
<tbody>
<tr>
<td>f2ce101698952e1c4309f8696fd43d694a79d35bb090e6a7fd4651c8f41794a3</td>
<td>9ec2f21641bd3f482b4c85cd6050432dc05e7680</td>
<td>d0cb15e5fd961e4f5b3b120fc60dbdf8</td>
</tr>
<tr>
<td>84b8bfe8161da581a88c0ac362318827d4c28edb057e23402523d3c93a5b3429</td>
<td>6f1b4ccd2ad5f4787ed78a7b0a304e927e7d9a3c</td>
<td>6e9ff09f5a7daa46cfbfb1cf5707179f</td>
</tr>
<tr>
<td>3a093f2c2cb5ba59197a4c978cfa9687d5778a53ae17c2ce2757d3577a5e7c69</td>
<td>9e0e0582eef9e2e2f38893a06c552d607f835fcc</td>
<td>b0f95350b13b65ae427075fbdf5f7230</td>
</tr>
<tr>
<td>137a3cc8b2ecd98f7d6b787d259e66ca2c1dae968c785d75c7a2fecb4cbbcaf0</td>
<td>1a7967c6357269414cfd1f9e1060a8613bc59f7b</td>
<td>869de5ac4d3520373a8a2f1a5991d365</td>
</tr>
<tr>
<td>9e010a2b43a6b588b95b5281544739833fb0250e8e990a4fe9879459f92367d0</td>
<td>24732b6b00326439dc373df56aff78c9c82d7169</td>
<td>814019ff0004d54c9b14981ac02752d4</td>
</tr>
<tr>
<td>408608c6b6f7299561c04f37ab46ca9c82834428ad0e8d42b16ca5da9b86d62e</td>
<td>9f596346c9acc09772bc5baf8c4dbc80fbdbf03b</td>
<td>3801a156c01b2d3ab42bc431a5f2fc46</td>
</tr>
<tr>
<td>6cc33a21417967a1bb3294179ea10aa3d9ee8d945a5ea0f6c44530189344a10a</td>
<td>6f43f6e8cb1474a6272f9632487fa1932dfba18c</td>
<td>6d6c3cbf2c2a3f106fcffdcbf4c70990</td>
</tr>
<tr>
<td>24b749191d64ed793cb9e540e8d4b1808d6c37c5712e737674417573778f665b</td>
<td>26062de2657bd2a3c228049af27333d2c46a041b</td>
<td>58c734474fc415905c6c9f95783d79b7</td>
</tr>
<tr>
<td>a95dfb8a8d03e9bcb50451068773cc1f1dd4b022bb39dce3679f1b3ce70aa4f9</td>
<td>1e8bf3c1a05f37857a9e8f7adb773ed9b9af1b8b</td>
<td>4ef9466b7ef300ec5fc98257e07efd40</td>
</tr>
<tr>
<td>efaa30bef6327ca8123e5443aa831dd7173de8ac9a016aaa2ae878641f85f952</td>
<td>04951144dc621f5f7ff2d66c8bcb710b77cc3d55</td>
<td>80397808492e12b83e5c9f5467740fd7</td>
</tr>
<tr>
<td>699bd1babf50a360e0a2ba6b5e0ed2379571ee8356f3f08b09ff8ce434d72696</td>
<td>3c10a0256cc1f0af3c31770314257eb8f994260c</td>
<td>09c34b06199eb1cacfbfc159e88e13e4</td>
</tr>
<tr>
<td>d6af2d1df948e2221a4bdaa3dd736dc0646c95d76f1aa1a1d314e5b20185e161</td>
<td>44858761afc0439ba361c90f04ae9719b362d315</td>
<td>9afe1f1936145a0a2ff1f6b34160c37f</td>
</tr>
<tr>
<td>0ecd7741dbdfa0707ccd8613a5ea91e62ab187313dd07d41760c87ed42649793</td>
<td>daacbe773105fd7b0834ed2e3a05ef80275e3c11</td>
<td>e8357ac87261f74c5d40e4baa273d3f0</td>
</tr>
<tr>
<td>2360fa60a1b6e9705bf6b631fcfe53616f37738cf61bc0444ea94ce09c699c7f</td>
<td>54e9de60e3a5c58fc2f3daadd18a1355350e13ec</td>
<td>e0592c56ee8f0a2149fd9a8ed3b85f6f</td>
</tr>
<tr>
<td>ffe19202300785f7e745957b48ecc1c108157a6edef6755667a9e7bebcbf750b</td>
<td>25d0321df77623c5af6629c357201941d4cd452c</td>
<td>ddf7ed52856f7ab9cb75403c30cc2c2b</td>
</tr>
<tr>
<td>d45c1ce5678259755df24bd680316a945515fc1bd916ce1d504f9d27cf9d03e4</td>
<td>0f5a74f11c270a02b0c0cc317e0b850c78261b04</td>
<td>a2972cb5228a56a530543f187e33e160</td>
</tr>
<tr>
<td>00847787ea6568cfaaa762f4ee333b44f35a34e90858c1c8899144be016510ef</td>
<td>d82bc3800396452ee519fbb35f708802fee335af</td>
<td>41f3e576216bb551a0ab1f3f18e9749d</td>
</tr>
</tbody>
</table>
<p>Downloader.Climax.A</p>
<table class="table-article">
<tbody>
<tr>
<td>fa2305975aded0fd0601fdab3013f8877969cb873fb9620b4d65ac6ff3b25522</td>
<td>003f46f74bbfc44ffd7f3ebfec67c80cf0a07bbf</td>
<td>24b90157056913bef8c90b6319164afe</td>
</tr>
<tr>
<td>0a0ce7fb610e3c037beb2c331e147c8750ba9f7ea2ece2f91f27f1a83c6839e4</td>
<td>1e0a63331814aab39ffb7806289a8ef3433553c3</td>
<td>68875f4b80fd1350af7dbea4d05a811b</td>
</tr>
<tr>
<td>898741e11fbbe6b5534fb12a489add1aaa379ee6757c0bd8d6c631473d5c66f7</td>
<td>3fa2f11e142f5f07f2dd63d89b58d01e9397ded0</td>
<td>1fe521f0ad24145704e6085b4a4859a9</td>
</tr>
<tr>
<td>59e4b8d2b65f1690139c094ee27182285febda115304c44e8d9e7329e09dc794</td>
<td>18cd249add7cfae87615ca5b32aca8503337a2d6</td>
<td>9bf855e5e8480fdb93fd12068699446d</td>
</tr>
<tr>
<td>0c64cc96a52ff9bdf6593e948fed1bc743bdf714ec1f7b392490423d927c3bb4</td>
<td>bb1c27db5f8d7e43592fa81cbfa319f1ce7c828f</td>
<td>0830581452de0c91090f8de7dbd123fb</td>
</tr>
<tr>
<td>1ca423fe0159e75718eb66524cd24002071a06b2fa68ce2cbb39d10682a154a6</td>
<td>78c8298b8357eee1a2d5d9da86f290bad798ce39</td>
<td>ff5896c0749b1e8c403203ebb679ab09</td>
</tr>
<tr>
<td>e9c94ed7265c04eac25bbcdb520e65fcfa31a3290b908c2c2273c29120d0617b</td>
<td>47edf57c5724ef9ff232dbb76f749977c767106a</td>
<td>ef8bcb5865669bc1d1776aeecd1c29de</td>
</tr>
<tr>
<td>d376164e377577fc590a780d15603d6411fde6e45ea21971670d5dff597d9def</td>
<td>d9e12317a43f233a739972723abc00f1b88f53b0</td>
<td>5faa973967fee2f35229685ceacf20b3</td>
</tr>
<tr>
<td>4301abae1a62f87b1c51acc6a6b4f2c3926a248b4aa9c04b734cef550196c030</td>
<td>cc402936b3d6fa5db14b54f0065404d975f2aeb5</td>
<td>f0f2731cabf1c1a6381d0cd265c937bd</td>
</tr>
</tbody>
</table>
<p>Downloader.Climax.B</p>
<table class="table-article">
<tbody>
<tr>
<td>7d9e1a193402b87dbbb81c2ab95632686154cff9c991324e46b275850a4b2db6</td>
<td>36a6eb414c9b8a7c2cdf12eb46e490d288e7a47a</td>
<td>98416b41f386bb45ed36c2b6bd0f55ca</td>
</tr>
<tr>
<td>dd82a7b9b5dc0ee1f9e9f19d46212f3e2a1d09a816f5c0ece96275ee221fca13</td>
<td>cf0fb4950130abddead04c21316912418562bf8a</td>
<td>a74341091f88d5980a2394be28ed0239</td>
</tr>
<tr>
<td>9f4d15ca56f87a5ded792f2a27a4c112bf59517079aedbefe49fcd0474600b69</td>
<td>bbbca10a8545b0421fbfcbd0b3b7a42527fea641</td>
<td>1bdaa370b064f90abbc2c7cecc6d3316</td>
</tr>
<tr>
<td>5872abe12a8e4c7182e4c6a894d6c27961b00d333657736bcbfd7cb1b38af2ed</td>
<td>133eca56512d8d5f8c730e102bf9042915e9bf41</td>
<td>c60df47562dba1c75e9932aa088c24bf</td>
</tr>
<tr>
<td>8dcb99e56c888800e0712faddc07d991b6dcb7a6fd4cceffe9e27fe3da83d206</td>
<td>2e76fa63adc870ca1de19fc7ea5afd6860f36e32</td>
<td>1a22342f883ad150c5a6f7e85e9ba2ae</td>
</tr>
<tr>
<td>7079d8c92cc668f903f3a60ec04dbb2508f23840ef3c57efffb9f906d3bc05ff</td>
<td>8993d0d5ec2f898eb8d1b8785cc5bb3275b43571</td>
<td>1690766e844034b3c2ab4f853bd59df7</td>
</tr>
<tr>
<td>5e8df46c9bc75450e2660d77897fa3dfa4d6c21eea10a962f7a9cf950ca9ca76</td>
<td>b0506335e332d64d6568f7830a8fab6a8a6ce1f8</td>
<td>923d60f3e63c95021f9e99f943fcfbbc</td>
</tr>
</tbody>
</table>
<p>RtlShare</p>
<table class="table-article">
<tbody>
<tr>
<td>8932c2d1ed0ae1f64d9cff4942f08699b4a7b1b30f45626d7bc46c8c51f8a420</td>
<td>8903e04d7ffae2081867337801ca2fa5f93220bd</td>
<td>9d116d94151682934dfd753485c91b88</td>
</tr>
<tr>
<td>8ac2165dc395d1e76c3d2fbd4bec429a98e3b2ec131e7951d28a10e9ca8bbc46</td>
<td>c0988a4ade711993632a03a2f82eea412616ef2a</td>
<td>ab01a4642e76df9e20a6d936d1f287fc</td>
</tr>
<tr>
<td>3f6102bd9add588b4df9b1523e40bb124af36a729037b8c3f2261563e4fa4be9</td>
<td>c865ef013018db3ed00f946b96a7a98ef2660e65</td>
<td>e8e966455a60c6f5dbfce3e82564d2c7</td>
</tr>
<tr>
<td>785ac72b10fd9cf98b5e2a40dc607e1ff735fcd8192bf71747755c963c764e2d</td>
<td>a429d9c8c67c8c8036ef05f7b4a27530ee6ae98a</td>
<td>f15c15e2b26f47b436b2a91d332ad59f</td>
</tr>
</tbody>
</table>
<p>PlugX</p>
<table class="table-article">
<tbody>
<tr>
<td>0f7556c6490c4a45a95f5b74ced21185fe48a788bcbe847017084ec1bf75d20a</td>
<td>53a17133173ee8f32261d4ac8afb956e1540f7be</td>
<td>4b6e1f5375552e09975f23fd8661e0f3</td>
</tr>
<tr>
<td>429b6c5d380589f2d654a79ea378db118db4c1fd1d399456af08e807d552e428</td>
<td>97ecc5aba4ce94a5012dcf609f2d325f293d4bea</td>
<td>3f8de0e26ee2f1f030e7d61215a227fe</td>
</tr>
<tr>
<td>0956ab263c7c112e0a8466406e68765350db654dbe6d6905e7c38e4f912a244e</td>
<td>457a592ece5e309cc8844623f29fc6be62c5be60</td>
<td>bdc734d2c049d77285fdb503aac86cd8</td>
</tr>
<tr>
<td>1c0cf69bce6fb6ec59be3044d35d3a130acddbbf9288d7bc58b7bb87c0a4fb97</td>
<td>ef3e558ecb313a74eeafca3f99b7d4e038e11516</td>
<td>b4f12a7be68d71f9645b789ccdc20561</td>
</tr>
<tr>
<td>a072133a68891a37076cd1eaf1abb1b0bf9443488d4c6b9530e490f246008dba</td>
<td>e9e8c2e720f5179ff1c0ac30ce017224ac0b2f1b</td>
<td>d5f5bb6368735f34440621b80fb8e003</td>
</tr>
<tr>
<td>1bad7e53cb4924576b221a62d2cddb4d18bd387734328b7d48e32046700e2df9</td>
<td>7539e5f25b3e66ea849ebee6bf6104d504573035</td>
<td>25db7152f66588dd8ce035f4bbd811d6</td>
</tr>
<tr>
<td>39083375012d2a854e6310411e7ce4c4e3440bd5784ae158599be25deaeabcb5</td>
<td>7ad24d1873325a02ca4644ebbebe5c5f95bb927c</td>
<td>e7a9d56297f8d0c16eca077b5f0a86bf</td>
</tr>
<tr>
<td>3c4483e1185d00b282b19910ad5e7970462122b8b7d8895860ffc132a05b3b9d</td>
<td>62d33015859f49e2ad178239891dbed78a0e2de6</td>
<td>a83b0a6b5c590aaf7528dc23ce1856f2</td>
</tr>
<tr>
<td>f8885d5caeec2627d808dc20bd1fbcd42732700686d34f1bb29d83d5d5115ee0</td>
<td>8a44433cfc2e4f116ebd59aac5f596f83c468d44</td>
<td>633eaedd4944db79d0ac68e71418c34c</td>
</tr>
<tr>
<td>07ef63b7c9554065e3a6047404d2526e8c8e450c5fe977247336626be403d790</td>
<td>a397d9d7d242bc748dc2bf5307d0f16c5144d98d</td>
<td>cfd0a7ab2c2c99dd341d844a5486599b</td>
</tr>
<tr>
<td>8d2ff35a5c941cb2f0438969be1a16116efacb51bb9820e6facc285640855682</td>
<td>702cf75a6b23a18001a909d6743a739837cc2053</td>
<td>0fe86427810229e4927b3a7091bea583</td>
</tr>
<tr>
<td>31af406fababf825eb15969970f5de1d2de9fa29a3ca609aed3174c48806492f</td>
<td>12e4407d5341836635ce54727ad4dae7712c2a4c</td>
<td>f4c9dd900488d6ad172f16a812b5e0fc</td>
</tr>
<tr>
<td>c150172ae47f9708bf4a87cf67eb19b09e6d4f5a565043f309c1da5ffc9bd656</td>
<td>eb6b2ddf1da767848ffe51f14b177298173227f5</td>
<td>7a4a791eeb0a195057a65ecceeafc8ff</td>
</tr>
<tr>
<td>5f8e8eada8ad8fcb007a1da7d2dedfdc55473cd5d65a287224c345edf9c1e964</td>
<td>a7837c8e3f789a112fbc2eea623c4e03664280ce</td>
<td>11fba00953cbd550be12a5691f79547a</td>
</tr>
<tr>
<td>fda4712cfb3007e7eb5f61b37c746640ff5428108c74106352b69a11193d79a1</td>
<td>628dc1642de5e74bf230e9b933f264196b9678bb</td>
<td>be4625cb6e797b05a5ce3f2f5d0618c2</td>
</tr>
<tr>
<td>17c4a6adca907b7cd0fc75d6008a307a3813ac3b75bfebb4f173360b5d2e7964</td>
<td>d5959009d3a2bdadd0db5385706920da21e5c8d4</td>
<td>ff7b237c3049fce0559876239e5c0ae8</td>
</tr>
<tr>
<td>b153195807d9b58168bba751517498268e396a79965c5d323fad5c16bbc9520d</td>
<td>c14b4468a33b12250b560a0c7e884e01dd986c95</td>
<td>9f4150eee0d18c7ebe6fe2881e40f1a2</td>
</tr>
<tr>
<td>7112f1033f1fafd9cef1862f6ea0a77994858bb54270deede1ed24b0f18fa7b1</td>
<td>bc0a54644b5ba7eff9ca10d8b42d73f0c69e4c53</td>
<td>824e76688a5b5bad414bc170721a29da</td>
</tr>
<tr>
<td>5ece318d3df972291896e858b76224c5ec34637d5409db44c89ec67ee0a6089d</td>
<td>b253c8ff5fc2cb1ea8933721c3a4002a42eec2f9</td>
<td>b0b6d1d000f031c2883df9f67360a338</td>
</tr>
<tr>
<td>e452ea28a9d3e37a2ac0cb8f4bca8ce41bea1a362d4c1680ab3ccaec6e5123d9</td>
<td>7f81103b574a3c26b478e9ab41abc422f979f299</td>
<td>49a5af86baf3d7bee422b841781d1bfe</td>
</tr>
<tr>
<td>195b39d40cd9d50e0b4b6b41f8b45140bb0f6e201e75b4398bd07b1e5959970b</td>
<td>5d449cad4b2a8d8a6b7489d82b110c370142acdd</td>
<td>ff58ce5d9d76502785ed1900056a4501</td>
</tr>
<tr>
<td>675abcf2bc7b1792b50fa296315f39ce5ac8e7e3f754a9be867eb0dd6bbf1799</td>
<td>103cf5647a8dc33d9d611b5b1eafc3e498d02dab</td>
<td>cb9b8cf286b84678784e7456b7d8fa85</td>
</tr>
<tr>
<td>e60757a893881559104513d75cf521c8f72e10653442b9f2510402453e48cdcb</td>
<td>b2e4179f7a2d1942fdb8e0fff632a3b65e9dce37</td>
<td>3a0536d8cd93119389d06575adc64079</td>
</tr>
<tr>
<td>a9acf75a658cb6e8aed6f638b08931fbe74f7b69a26e6b45486caff9d8e455a4</td>
<td>187541ef47985e11324be53309808e23b33c12a1</td>
<td>ef479d7cd2e77a764ffb0a4b291a70fc</td>
</tr>
<tr>
<td>ad48650c6ab73e2f94b706e28a1b17b2ff1af1864380edc79642df3a47e579bb</td>
<td>f1a8c309806c90c100e680299a037ec71cf4397c</td>
<td>1cba2ec3fc5f1451aaf3a75c9823825e</td>
</tr>
<tr>
<td>0b1ed5214dd31a241920de4b5c7cdf3f02ad5f76260bcd260328732c9bedbcec</td>
<td>9be46478e3cbeb51267b8fb88952860790051c07</td>
<td>b404e426c53c066620d440f92331a113</td>
</tr>
<tr>
<td>555fd0d7c1584f7b504ac65f34017f7070ee12ce0f4070cd0555361b3adea54c</td>
<td>1f10627b46b51a97b059395bf062117fdfae4cf0</td>
<td>895644020eba9ec62d47ca85ccf94012</td>
</tr>
<tr>
<td>fe885d1a2bef4e99dcbcacd9393c59ed52a718ff2cbbc6a15e443e150edaa662</td>
<td>9d490725443c9f426cdc0bfa75b3d900404153c0</td>
<td>13febb9240f37a69f251fd6055b8e1eb</td>
</tr>
<tr>
<td>354c3c2a7602475b72727158ebae8261f0ac9f2ce6c2ab86ee9ec38169b40f62</td>
<td>68a651026a3bae94776a9e1a45c6cca58b9609b7</td>
<td>1d866ed934518061839588565ff71edd</td>
</tr>
<tr>
<td>ab1282afced126da7d330d7be338dfe1f3623970a696710e55a67fb549118f1d</td>
<td>3ebe6bd2d44a4d54d8ba314b92c9c379398bf095</td>
<td>c063adbb4a8a41a8678c594258065fb7</td>
</tr>
<tr>
<td>e3d32b0758f98b55483a18631ae42e944c387b5a73b1fbc39f62b2c13a6ec198</td>
<td>5fe3b83b3ccdf78303b59e5f3e628a2cf80e9d13</td>
<td>923165c972c38678f6d9ab4cef36a007</td>
</tr>
<tr>
<td>a4576ca47764284bc3aa8e5dacad84163ca56258dc8af4aa4916bb3bacbd58e0</td>
<td>1166b3daa8ad2496a8b71f37656be7ac41821e03</td>
<td>a1503cec20057e367cff4db5e4a8b93c</td>
</tr>
<tr>
<td>8871bd39918868d4f4390e430e82730819182a8ae9fb3ef7096c2ce5dbafbe26</td>
<td>f1d74087627879e224303ee56e74d53f6dc67204</td>
<td>ec0a9cecb7e1b4b40ffdba19407332ea</td>
</tr>
<tr>
<td>f5e780d10780f45adb0ddc540978d7e170e8c143a251003651e12c18142cee16</td>
<td>8e5ef3c08eb584d041a7aa93473aa2e31787d111</td>
<td>f16790e4e2029367cf3ae07037169424</td>
</tr>
<tr>
<td>37b3fb9aa12277f355bbb334c82b41e4155836cf3a1b83e543ce53da9d429e2f</td>
<td>ea7595bff1cfd1d72fe72417bf263d9adc9bc59e</td>
<td>9ae8a7837c60f3f587701934ff41bd96</td>
</tr>
<tr>
<td>6cd5079a69d9a68029e37f2680f44b7ba71c2b1eecf4894c2a8b293d5f768f10</td>
<td>50064d66c9b55b6f7d22051b81914d8366fe36c8</td>
<td>d5915394a6916a00c426aa2827d97c0e</td>
</tr>
<tr>
<td>c21a3a44b46e7242c0762c8ec5e8a394ddc74b747244c5b83678620ae141e59c</td>
<td>31d67b5a5588b2d28365534c36a7b754f28e1df9</td>
<td>ecab63b6de18073453310a9c4551074b</td>
</tr>
<tr>
<td>fe18adaec076ffce63da6a2a024ce99b8a55bc40a1f06ed556e0997ba6b6d716</td>
<td>1e8dee59355e064790d05e44199443d94ab1aa02</td>
<td>219983c1a7c6c08707f4907b17a72eb9</td>
</tr>
</tbody>
</table>
<p>PlugX demo dropper</p>
<table class="table-article">
<tbody>
<tr>
<td>50f1092795c493c5275637b81fbcacfc4ca7951dfda06782a792988bbde2f5a1</td>
<td>8e0ee1ceb7ce14994a481c266eef1f67087b59b1</td>
<td>6dfabe77bf18f1424cf47e2e0794f6d5</td>
</tr>
<tr>
<td>82894e2534feb0d9edbb3dd5339c3ff0f6eb73b07e40f0f8b15e759e8a55d052</td>
<td>0b8c9bbea5614d2fec852cf2f74fd20b591edbb2</td>
<td>814e3cfdbf77e8b400dda78ab0a80e24</td>
</tr>
<tr>
<td>e5f471dcd4f5a47f0a53fc389e58c70b9ef81805c503ed6b100950d02ee7f777</td>
<td>9eb2ed9db419cda517fbea69a9204644e946913c</td>
<td>a70db29d6a7ba154eeb029be19136cb6</td>
</tr>
<tr>
<td>aeee80588212bc941e179ca95931a91bf446cbc1446111d4e520243d708f1d5b</td>
<td>dbb93c7b7e36b5eb0dd408e836f7bf305ee076bf</td>
<td>661635e774fef37e56928333d6040cac</td>
</tr>
<tr>
<td>c66dda5131c0aaa118e7cbb5de16fbc984f1f0c9194717b8981bca0fb024f170</td>
<td>58ec65e2d39e3dff7df3c85d3896ab37a04cd475</td>
<td>a96e3b2fd7c8bb7c903240e0b9b1e980</td>
</tr>
<tr>
<td>051b08ef35a6122bd9ff75609ccd50d84793e5502a9e428a57f2bf688d21d1e9</td>
<td>1b43bb893767f48bc134c1894f3390fd20dbb22d</td>
<td>d2b60af1360508ca2728f06f45a3f931</td>
</tr>
<tr>
<td>f96adc9e046ecc6f22d3ba9cfea47a4af75bcba369f454b7a9c8d7ca3d423ac4</td>
<td>cb85578a26dd90f536b9c97cf88ff93baba22107</td>
<td>4412dcf06cb428d710297a3efcf24a91</td>
</tr>
</tbody>
</table>
<p>BH_A006</p>
<table class="table-article">
<tbody>
<tr>
<td>1e725f1fe67d1a596c9677df69ef5b1b2c29903e84d7b08284f0a767aedcc097</td>
<td>c0292c55fca5f68f4f4831fb5d2a77a78c1f1a45</td>
<td>36a8ce6f27c251a81d9deada291b2a2c</td>
</tr>
<tr>
<td>e76567a61f905a2825262d5f653416ef88728371a0a2fe75ddc53aad100e6f46</td>
<td>e45a5d9b03cfbe7eb2e90181756fdf0dd690c00c</td>
<td>06af27c0f47837fb54490a8fe8332e04</td>
</tr>
<tr>
<td>f2ab7d78377fe1898eb6406d66668c9dbbe0836e9c97af08bc57da56a78272a1</td>
<td>87ae868159d572acbb376faf7fda6593058f8518</td>
<td>c241e8486a0674f7af1b0928b59b94df</td>
</tr>
<tr>
<td>1a4cc1c66082f4bb10b917bc434ecc9e7e4f92877fd42e3fbe5e8a96154318f5</td>
<td>927f428e0de0391a6392943b3c79fda8363828d0</td>
<td>758eabd1b7b644b01a21011d6e1159e6</td>
</tr>
<tr>
<td>1b0e8f31b513ad53db7ca6d8db35c37eb24eaddf859521b6913209af934808ce</td>
<td>9df3431e26b958f671b28d1c4d34dfa5c0c653bf</td>
<td>94759ce1618ffa9e38cfa7c3ad43061a</td>
</tr>
<tr>
<td>f42f8896183d298a6ecd2c3fa78393bf7e58bc33ab7994e35346a57cbe2e2521</td>
<td>f214cbda1dcdc75b3d355affef74354a104d5b29</td>
<td>5ea6d25bb95d8643dfe2deb4afd92843</td>
</tr>
<tr>
<td>bd366f22fd0f1b5b5a041621f70b357287c45883e847bb8f31809d16ca46052f</td>
<td>c213d8d98359c32e1b320b8ab0cf168e3f369441</td>
<td>8f088b92a9f68681dd17f0fb89b1058d</td>
</tr>
<tr>
<td>77052236a7061f91ba6442568f6db1200169fe4afdf9c3c81750e0929dd4fb96</td>
<td>aa9b71858b893a131908b3236bb724226af6b1dc</td>
<td>02a7272416fefc68ff214b24214fc370</td>
</tr>
<tr>
<td>2bd9b56ddcccc0a9d33debd1c56b493bb60f8b4229f728b0c6c3bac0e556d080</td>
<td>0e2c294692cebcaecb5e2f3677d07f96a09ab610</td>
<td>c7f0ec11b70be64695d826587d8fb9f2</td>
</tr>
<tr>
<td>59fe1b5b641c140225ed12a8122da47716b9d841754f4604a2bdbb2a0dc765ad</td>
<td>7324dd736142db51c4d3887c30df810a45b46b08</td>
<td>32cb37c984fe0d00009e7566f18463eb</td>
</tr>
<tr>
<td>cb35899e21269b564ffdd4785961195af1779daf5ff3e64746e2d6368744ba2a</td>
<td>5ad5183ce68975a59d85d650e72b13a845be82e4</td>
<td>7950cf56e58e2be3fc401885e815e9b6</td>
</tr>
<tr>
<td>f97d1f7e3ed963654fb68803f2ac6cd79580abb8f86ab477c49aec76157bb184</td>
<td>cf1a335ffe672f19fa0160151c50eb9209b5e99b</td>
<td>b66203f634e48430af63a3c1503b2a4d</td>
</tr>
<tr>
<td>74af7c238935e2fc11f97e122bbcf0b813c27f5a4a3b8aa47a574c24003df533</td>
<td>ffb8da41d8a92b4cbeaf4d85a4c2732b90d178c3</td>
<td>7428f82ed54e0d75c37afc0dde45ea57</td>
</tr>
<tr>
<td>9cd487bcec62fb5192fbe654ca5c02750b846070b85016fc3d2071add8e04f39</td>
<td>b20c993e963a5540593120cfc1b596ba42aff649</td>
<td>46c4fd5ae4f5907d5ba3faa2978ffbe5</td>
</tr>
<tr>
<td>b0a58c6c859833eb6fb1c7d8cb0c5875ab42be727996bcc20b17dd8ad0058ffa</td>
<td>fcc66ea2198a03def308c53adda78d4a64ed22f7</td>
<td>823e689e34be362faeddb2bd8d32a05e</td>
</tr>
<tr>
<td>9843ceaca2b9173d3a1f9b24ba85180a40884dbf78dd7298b0c57008fa36e33d</td>
<td>6c8ab56853218f28ac11c16b050ad589ea14bafe</td>
<td>964be19e477b57d85aceb7648e2c105d</td>
</tr>
<tr>
<td>9969fc3043ed2917b76b6dbae36bd2e0846b90e9d93df4fc4f490fdf153da435</td>
<td>e102a2ff536d2df93ec9c507e52c04bba773b550</td>
<td>fff3c03e6c455eaba70ec816a4439b95</td>
</tr>
<tr>
<td>690f5bd392269d80061e8e90a9aedac4f9bb2e898db4211b76a6e27a1ed95462</td>
<td>5c1d4af865b4d514340d6a2dbb42523a142ab5d8</td>
<td>18ea3d4c9639a696b96e49f53af2b161</td>
</tr>
<tr>
<td>7bd1016b5f3a5004166de5cf7f1846024684979de413417d83321c931c1b5929</td>
<td>cebabb80844c823df4539f4db29d7bca27e1f50a</td>
<td>89de9c0ce214d2e437e2ce6d266ab100</td>
</tr>
<tr>
<td>1687af091d38108eeed634c0539b9639c6128aed9588a370f51a957bee534f39</td>
<td>53ab54c2c3ea3d6921fa2bf5fde69255dc41fbed</td>
<td>ae755e20cd3a6f2721096736c5c3aed5</td>
</tr>
<tr>
<td>16d2b4bb67147c0086c5716639e226fe1656da26f40bac86f7df970fa92a8460</td>
<td>1f89b71204ef85c00a6675f65acf4b834c0a58ce</td>
<td>68f52f72f9f3becd0f51da342dd6bd31</td>
</tr>
</tbody>
</table>
<p>Примечание: файл с SHA-256 9843ceaca2b9173d3a1f9b24ba85180a40884dbf78dd7298b0c57008fa36e33d ранее был ошибочно приведен в нашем <a href="https://www.ptsecurity.com/ru-ru/research/pt-esc-threat-intelligence/shadowpad-novaya-aktivnost-gruppirovki-winnti/" target="_blank">отчете</a> как экземпляр ShadowPad. В действительности он относится к семейству образцов бэкдора BH_A006.</p>
<p>Deed RAT</p>
<table class="table-article">
<tbody>
<tr>
<td>ff87ec66b89db551d6f4ce33ad150fae7286f58d465179acf2b8001d9ca9bcea</td>
<td>6c2e080407f03e507316c7bc340ecfe2fa1c248f</td>
<td>508b845dbb4d182116fe1d3a7c52a578</td>
</tr>
<tr>
<td>761557ecc63ec5fbc2e3573f61a860bd8967f04818be25893361c63409ab5af0</td>
<td>60b4af5c44d0ccdfb6003ca77d5ddda808219972</td>
<td>60c6573fe8bc47943009b71046cbf895</td>
</tr>
</tbody>
</table>
<p>ShadowPad</p>
<table class="table-article">
<tbody>
<tr>
<td>9324d7a72c436d8eb77f3df72b6f41aa4e1b85f08ef7583e26de75e17cad490c</td>
<td>c82f168cdd311078bc1a9a748a0e304d26b10d04</td>
<td>e88442798b3881f41b369b849ed6ee52</td>
</tr>
<tr>
<td>06ce5271836a6a1ee40513b1de6991ccd87bc7ff640948f194e7c12bdf779fd9</td>
<td>3e38742d05ab64d1c484f157b345d339becef404</td>
<td>927af917daaee340c2095fb3f86ecaf3</td>
</tr>
<tr>
<td>d34b6306aeaaccea3b30dde377701c4a23b861b47f9bda777ca7dc0552f2754f</td>
<td>72881125929a2c445c6cd094fa13607b9cdea95c</td>
<td>15d973bcaef5f97329f76be89ee26cdd</td>
</tr>
<tr>
<td>d011130defd8b988ab78043b30a9f7e0cada5751064b3975a19f4de92d2c0025</td>
<td>a43edb2221919ac5d52bde498f604164b3c86118</td>
<td>08b419b754122d44b44831384c520b21</td>
</tr>
<tr>
<td>459f386be186c0e23234f299f2607d0eb2745eb743e1422a95ec2dca645b0e21</td>
<td>9d05decdda370292012ded9c4e04d8d46c1d0de7</td>
<td>3b0a45da21a9244970f91df6dde5204e</td>
</tr>
</tbody>
</table>
<p>Poison Ivy</p>
<table class="table-article">
<tbody>
<tr>
<td>672d1ec9f27870a9ed4983038e58e8577bacc735d5168d74bcff8d6ed9aa7947</td>
<td>f5ccdd6cc4aae67c822ddd4509f33672ca5335f4</td>
<td>4e87e5af554322a2c7c754701290c52c</td>
</tr>
<tr>
<td>2e35a1599b58e76167f2235d46840cc973dc49a6f14c0c2a2e91310a2fe2c2dd</td>
<td>d80b939d9d46cdff9cf20f6234186a1bf3b963c2</td>
<td>b1aadcb19d49519f4564d6f52c3c8efa</td>
</tr>
</tbody>
</table>
<h4 id="id5-2-2">Сетевые индикаторы</h4>
<p>MyKLoadClient</p>
<p>microft.dynssl.com</p>
<p>micro.dns04.com</p>
<p>207.148.121.88</p>
<p>47.108.89.169</p>
<p>120.78.127.189</p>
<p>121.89.210.144</p>
<p>Zupdax</p>
<p>ns2.gamepoer7.com</p>
<p>mail.playdr2.com</p>
<p>pop.playdr2.com</p>
<p>news.flashplayeractivex.info</p>
<p>update.flashplayeractivex.info</p>
<p>ns9.mcafee-update.com</p>
<p>154.211.161.161</p>
<p>192.225.226.218</p>
<p>Downloader.Climax.A</p>
<p>bamo.ocry.com</p>
<p>202.182.98.74</p>
<p>Downloader.Climax.B</p>
<p>ruclient.dns04.com</p>
<p>loge.otzo.com</p>
<p>RtlShare</p>
<p>asd.powergame.0077.x24hr.com</p>
<p>w.asd3.as.amazon-corp.wikaba.com</p>
<p>45.76.145.22</p>
<p>141.164.35.87</p>
<p>202.182.98.74</p>
<p>PlugX</p>
<p>microft.dynssl.com</p>
<p>api.microft.dynssl.com</p>
<p>micro.dns04.com</p>
<p>www.0077.x24hr.com</p>
<p>js.journal.itsaol.com</p>
<p>fgjhkergvlimdfg2.wikaba.com</p>
<p>goon.oldvideo.longmusic.com</p>
<p>as.amazon-corp.wikaba.com</p>
<p>freewula.strangled.net</p>
<p>szuunet.strangled.net</p>
<p>lib.hostareas.com</p>
<p>web.miscrosaft.com</p>
<p>eset.zzux.com</p>
<p>elienceso.kozow.com</p>
<p>lck.gigabitdate.com</p>
<p>miche.justdied.com</p>
<p>45.77.16.91</p>
<p>103.101.178.152</p>
<p>123.1.151.64</p>
<p>154.85.48.108</p>
<p>154.213.21.207</p>
<p>192.225.226.123</p>
<p>192.225.226.217</p>
<p>BH_A006</p>
<p>comein.journal.itsaol.com</p>
<p>www.omgod.org</p>
<p>findanswer123.tk</p>
<p>45.76.145.22</p>
<p>103.27.109.234</p>
<p>108.160.134.113</p>
<p>Deed RAT</p>
<p>ftp.microft.dynssl.com</p>
<p>ShadowPad</p>
<p>toogasd.www.oldvideo.longmusic.com</p>
<p>wwa1we.wbew.amazon-corp.wikaba.com</p>
<p>Poison Ivy</p>
<p>shareddocs.microft.dynssl.com</p>
<p>DDNS-домены третьего уровня</p>
<p>microft.dynssl.com</p>
<p>reportsearch.dynamic-dns.net</p>
<p>micro.dns04.com</p>
<p>werwesf.dynamic-dns.net</p>
<p>fssprus.dns04.com</p>
<p>loge.otzo.com</p>
<p>alex.dnset.com</p>
<p>ruclient.dns04.com</p>
<p>bamo.ocry.com</p>
<p>tombstone.kozow.com</p>
<p>toon.mrbasic.com</p>
<p>fgjhkergvlimdfg2.wikaba.com</p>
<p>rt.ftp1.biz</p>
<p>apple-corp.changeip.org</p>
<p>amazon-corp.wikaba.com</p>
<p>0077.x24hr.com</p>
<p>staticd.dynamic-dns.net</p>
<p>srv.xxxy.biz</p>
<p>serviechelp.changeip.us</p>
<p>mktoon.ftp1.biz</p>
<p>noon.dns04.com</p>
<p>ybcps4.freeddns.org</p>
<p>oldvideo.longmusic.com</p>
<p>chdsjjkrazomg.dhcp.biz</p>
<p>q34ewrd.youdontcare.com</p>
<p>journal.itsaol.com</p>
 
Статьи по теме
<ul>
<li>
8 сентября 2020
<a class="link" href="https://www.ptsecurity.com/ru-ru/research/pt-esc-threat-intelligence/shadowpad-novaya-aktivnost-gruppirovki-winnti/" title="ShadowPad: новая активность группировки Winnti">ShadowPad: новая активность группировки Winnti</a>
</li>
<li>
27 апреля 2021
<a class="link" href="https://www.ptsecurity.com/ru-ru/research/pt-esc-threat-intelligence/lazarus-recruitment/" title="«Работодатель года» Атака Lazarus Group">«Работодатель года» Атака Lazarus Group</a>
</li>
<li>
27 ноября 2020
<a class="link" href="https://www.ptsecurity.com/ru-ru/research/pt-esc-threat-intelligence/incident-response-polar-ransomware-apt27/" title="История одного расследования: целевая атака по ошибке и несостоявшиеся деструктивные действия">История одного расследования: целевая атака по ошибке и несостоявшиеся деструктивные действия</a>
</li>
</ul>
<a href="https://www.ptsecurity.com/ru-ru/products/ai/?utm_source=site&amp;utm_medium=sidebanner" target="_blank">
<img alt="" src="https://www.ptsecurity.com/upload/iblock/c4a/banner_ai.jpg" style="max-width:80%;height:auto;width:auto;"/>
</a>
</div>